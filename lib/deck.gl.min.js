(function webpackUniversalModuleDefinition(root, factory) {
    if (typeof exports === 'object' && typeof module === 'object')
      module.exports = factory();
    else if (typeof define === 'function' && define.amd) define([], factory);
          else if (typeof exports === 'object') exports['deck'] = factory();
    else root['deck'] = factory();})(globalThis, function () {
  "use strict";var __exports__=(()=>{var H8=Object.create;var ul=Object.defineProperty;var W8=Object.getOwnPropertyDescriptor;var G8=Object.getOwnPropertyNames;var j8=Object.getPrototypeOf,q8=Object.prototype.hasOwnProperty;var X8=(e,t,r)=>t in e?ul(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var Ub=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var ye=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),Bt=(e,t)=>{for(var r in t)ul(e,r,{get:t[r],enumerable:!0})},zb=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of G8(t))!q8.call(e,s)&&s!==r&&ul(e,s,{get:()=>t[s],enumerable:!(n=W8(t,s))||n.enumerable});return e};var Nn=(e,t,r)=>(r=e!=null?H8(j8(e)):{},zb(t||!e||!e.__esModule?ul(r,"default",{value:e,enumerable:!0}):r,e)),Y8=e=>zb(ul({},"__esModule",{value:!0}),e);var H=(e,t,r)=>(X8(e,typeof t!="symbol"?t+"":t,r),r);var VR=ye((vFt,TA)=>{"use strict";TA.exports=im;TA.exports.default=im;function im(e,t,r){r=r||2;var n=t&&t.length,s=n?t[0]*r:e.length,i=kR(e,0,s,r,!0),o=[];if(!i||i.next===i.prev)return o;var a,c,l,h,f,u,d;if(n&&(i=p$(e,t,i,r)),e.length>80*r){a=l=e[0],c=h=e[1];for(var p=r;p<s;p+=r)f=e[p],u=e[p+1],f<a&&(a=f),u<c&&(c=u),f>l&&(l=f),u>h&&(h=u);d=Math.max(l-a,h-c),d=d!==0?32767/d:0}return Tf(i,o,r,a,c,d,0),o}function kR(e,t,r,n,s){var i,o;if(s===AA(e,t,r,n)>0)for(i=t;i<r;i+=n)o=DR(i,e[i],e[i+1],o);else for(i=r-n;i>=t;i-=n)o=DR(i,e[i],e[i+1],o);return o&&om(o,o.next)&&(Ef(o),o=o.next),o}function go(e,t){if(!e)return e;t||(t=e);var r=e,n;do if(n=!1,!r.steiner&&(om(r,r.next)||zt(r.prev,r,r.next)===0)){if(Ef(r),r=t=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==t);return t}function Tf(e,t,r,n,s,i,o){if(e){!o&&i&&y$(e,n,s,i);for(var a=e,c,l;e.prev!==e.next;){if(c=e.prev,l=e.next,i?f$(e,n,s,i):h$(e)){t.push(c.i/r|0),t.push(e.i/r|0),t.push(l.i/r|0),Ef(e),e=l.next,a=l.next;continue}if(e=l,e===a){o?o===1?(e=u$(go(e),t,r),Tf(e,t,r,n,s,i,2)):o===2&&d$(e,t,r,n,s,i):Tf(go(e),t,r,n,s,i,1);break}}}}function h$(e){var t=e.prev,r=e,n=e.next;if(zt(t,r,n)>=0)return!1;for(var s=t.x,i=r.x,o=n.x,a=t.y,c=r.y,l=n.y,h=s<i?s<o?s:o:i<o?i:o,f=a<c?a<l?a:l:c<l?c:l,u=s>i?s>o?s:o:i>o?i:o,d=a>c?a>l?a:l:c>l?c:l,p=n.next;p!==t;){if(p.x>=h&&p.x<=u&&p.y>=f&&p.y<=d&&Xa(s,a,i,c,o,l,p.x,p.y)&&zt(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function f$(e,t,r,n){var s=e.prev,i=e,o=e.next;if(zt(s,i,o)>=0)return!1;for(var a=s.x,c=i.x,l=o.x,h=s.y,f=i.y,u=o.y,d=a<c?a<l?a:l:c<l?c:l,p=h<f?h<u?h:u:f<u?f:u,g=a>c?a>l?a:l:c>l?c:l,m=h>f?h>u?h:u:f>u?f:u,_=xA(d,p,t,r,n),y=xA(g,m,t,r,n),x=e.prevZ,A=e.nextZ;x&&x.z>=_&&A&&A.z<=y;){if(x.x>=d&&x.x<=g&&x.y>=p&&x.y<=m&&x!==s&&x!==o&&Xa(a,h,c,f,l,u,x.x,x.y)&&zt(x.prev,x,x.next)>=0||(x=x.prevZ,A.x>=d&&A.x<=g&&A.y>=p&&A.y<=m&&A!==s&&A!==o&&Xa(a,h,c,f,l,u,A.x,A.y)&&zt(A.prev,A,A.next)>=0))return!1;A=A.nextZ}for(;x&&x.z>=_;){if(x.x>=d&&x.x<=g&&x.y>=p&&x.y<=m&&x!==s&&x!==o&&Xa(a,h,c,f,l,u,x.x,x.y)&&zt(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;A&&A.z<=y;){if(A.x>=d&&A.x<=g&&A.y>=p&&A.y<=m&&A!==s&&A!==o&&Xa(a,h,c,f,l,u,A.x,A.y)&&zt(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function u$(e,t,r){var n=e;do{var s=n.prev,i=n.next.next;!om(s,i)&&UR(s,n,n.next,i)&&Mf(s,i)&&Mf(i,s)&&(t.push(s.i/r|0),t.push(n.i/r|0),t.push(i.i/r|0),Ef(n),Ef(n.next),n=e=i),n=n.next}while(n!==e);return go(n)}function d$(e,t,r,n,s,i){var o=e;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&M$(o,a)){var c=zR(o,a);o=go(o,o.next),c=go(c,c.next),Tf(o,t,r,n,s,i,0),Tf(c,t,r,n,s,i,0);return}a=a.next}o=o.next}while(o!==e)}function p$(e,t,r,n){var s=[],i,o,a,c,l;for(i=0,o=t.length;i<o;i++)a=t[i]*n,c=i<o-1?t[i+1]*n:e.length,l=kR(e,a,c,n,!1),l===l.next&&(l.steiner=!0),s.push(T$(l));for(s.sort(g$),i=0;i<s.length;i++)r=m$(s[i],r);return r}function g$(e,t){return e.x-t.x}function m$(e,t){var r=_$(e,t);if(!r)return t;var n=zR(r,e);return go(n,n.next),go(r,r.next)}function _$(e,t){var r=t,n=e.x,s=e.y,i=-1/0,o;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var a=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>i&&(i=a,o=r.x<r.next.x?r:r.next,a===n))return o}r=r.next}while(r!==t);if(!o)return null;var c=o,l=o.x,h=o.y,f=1/0,u;r=o;do n>=r.x&&r.x>=l&&n!==r.x&&Xa(s<h?n:i,s,l,h,s<h?i:n,s,r.x,r.y)&&(u=Math.abs(s-r.y)/(n-r.x),Mf(r,e)&&(u<f||u===f&&(r.x>o.x||r.x===o.x&&x$(o,r)))&&(o=r,f=u)),r=r.next;while(r!==c);return o}function x$(e,t){return zt(e.prev,e,t.prev)<0&&zt(t.next,e,e.next)<0}function y$(e,t,r,n){var s=e;do s.z===0&&(s.z=xA(s.x,s.y,t,r,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,A$(s)}function A$(e){var t,r,n,s,i,o,a,c,l=1;do{for(r=e,e=null,i=null,o=0;r;){for(o++,n=r,a=0,t=0;t<l&&(a++,n=n.nextZ,!!n);t++);for(c=l;a>0||c>0&&n;)a!==0&&(c===0||!n||r.z<=n.z)?(s=r,r=r.nextZ,a--):(s=n,n=n.nextZ,c--),i?i.nextZ=s:e=s,s.prevZ=i,i=s;r=n}i.nextZ=null,l*=2}while(o>1);return e}function xA(e,t,r,n,s){return e=(e-r)*s|0,t=(t-n)*s|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function T$(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function Xa(e,t,r,n,s,i,o,a){return(s-o)*(t-a)>=(e-o)*(i-a)&&(e-o)*(n-a)>=(r-o)*(t-a)&&(r-o)*(i-a)>=(s-o)*(n-a)}function M$(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!E$(e,t)&&(Mf(e,t)&&Mf(t,e)&&b$(e,t)&&(zt(e.prev,e,t.prev)||zt(e,t.prev,t))||om(e,t)&&zt(e.prev,e,e.next)>0&&zt(t.prev,t,t.next)>0)}function zt(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function om(e,t){return e.x===t.x&&e.y===t.y}function UR(e,t,r,n){var s=sm(zt(e,t,r)),i=sm(zt(e,t,n)),o=sm(zt(r,n,e)),a=sm(zt(r,n,t));return!!(s!==i&&o!==a||s===0&&nm(e,r,t)||i===0&&nm(e,n,t)||o===0&&nm(r,e,n)||a===0&&nm(r,t,n))}function nm(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function sm(e){return e>0?1:e<0?-1:0}function E$(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&UR(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function Mf(e,t){return zt(e.prev,e,e.next)<0?zt(e,t,e.next)>=0&&zt(e,e.prev,t)>=0:zt(e,t,e.prev)<0||zt(e,e.next,t)<0}function b$(e,t){var r=e,n=!1,s=(e.x+t.x)/2,i=(e.y+t.y)/2;do r.y>i!=r.next.y>i&&r.next.y!==r.y&&s<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e);return n}function zR(e,t){var r=new yA(e.i,e.x,e.y),n=new yA(t.i,t.x,t.y),s=e.next,i=t.prev;return e.next=t,t.prev=e,r.next=s,s.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function DR(e,t,r,n){var s=new yA(e,t,r);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function Ef(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function yA(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}im.deviation=function(e,t,r,n){var s=t&&t.length,i=s?t[0]*r:e.length,o=Math.abs(AA(e,0,i,r));if(s)for(var a=0,c=t.length;a<c;a++){var l=t[a]*r,h=a<c-1?t[a+1]*r:e.length;o-=Math.abs(AA(e,l,h,r))}var f=0;for(a=0;a<n.length;a+=3){var u=n[a]*r,d=n[a+1]*r,p=n[a+2]*r;f+=Math.abs((e[u]-e[p])*(e[d+1]-e[u+1])-(e[u]-e[d])*(e[p+1]-e[u+1]))}return o===0&&f===0?0:Math.abs((f-o)/o)};function AA(e,t,r,n){for(var s=0,i=t,o=r-n;i<r;i+=n)s+=(e[o]-e[i])*(e[i+1]+e[o+1]),o=i;return s}im.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,s=0;s<e.length;s++){for(var i=0;i<e[s].length;i++)for(var o=0;o<t;o++)r.vertices.push(e[s][i][o]);s>0&&(n+=e[s-1].length,r.holes.push(n))}return r}});var Tm=ye(ss=>{"use strict";var OI=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",J$=OI+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040",LI="["+OI+"]["+J$+"]*",Q$=new RegExp("^"+LI+"$"),tK=function(e,t){let r=[],n=t.exec(e);for(;n;){let s=[];s.startIndex=t.lastIndex-n[0].length;let i=n.length;for(let o=0;o<i;o++)s.push(n[o]);r.push(s),n=t.exec(e)}return r},eK=function(e){let t=Q$.exec(e);return!(t===null||typeof t>"u")};ss.isExist=function(e){return typeof e<"u"};ss.isEmptyObject=function(e){return Object.keys(e).length===0};ss.merge=function(e,t,r){if(t){let n=Object.keys(t),s=n.length;for(let i=0;i<s;i++)r==="strict"?e[n[i]]=[t[n[i]]]:e[n[i]]=t[n[i]]}};ss.getValue=function(e){return ss.isExist(e)?e:""};ss.isName=eK;ss.getAllMatches=tK;ss.nameRegexp=LI});var wA=ye(kI=>{"use strict";var vA=Tm(),rK={allowBooleanAttributes:!1,unpairedTags:[]};kI.validate=function(e,t){t=Object.assign({},rK,t);let r=[],n=!1,s=!1;e[0]==="\uFEFF"&&(e=e.substr(1));for(let i=0;i<e.length;i++)if(e[i]==="<"&&e[i+1]==="?"){if(i+=2,i=BI(e,i),i.err)return i}else if(e[i]==="<"){let o=i;if(i++,e[i]==="!"){i=FI(e,i);continue}else{let a=!1;e[i]==="/"&&(a=!0,i++);let c="";for(;i<e.length&&e[i]!==">"&&e[i]!==" "&&e[i]!=="	"&&e[i]!==`
  `&&e[i]!=="\r";i++)c+=e[i];if(c=c.trim(),c[c.length-1]==="/"&&(c=c.substring(0,c.length-1),i--),!hK(c)){let f;return c.trim().length===0?f="Invalid space after '<'.":f="Tag '"+c+"' is an invalid name.",Zt("InvalidTag",f,qe(e,i))}let l=iK(e,i);if(l===!1)return Zt("InvalidAttr","Attributes for '"+c+"' have open quote.",qe(e,i));let h=l.value;if(i=l.index,h[h.length-1]==="/"){let f=i-h.length;h=h.substring(0,h.length-1);let u=DI(h,t);if(u===!0)n=!0;else return Zt(u.err.code,u.err.msg,qe(e,f+u.err.line))}else if(a)if(l.tagClosed){if(h.trim().length>0)return Zt("InvalidTag","Closing tag '"+c+"' can't have attributes or invalid starting.",qe(e,o));if(r.length===0)return Zt("InvalidTag","Closing tag '"+c+"' has not been opened.",qe(e,o));{let f=r.pop();if(c!==f.tagName){let u=qe(e,f.tagStartPos);return Zt("InvalidTag","Expected closing tag '"+f.tagName+"' (opened in line "+u.line+", col "+u.col+") instead of closing tag '"+c+"'.",qe(e,o))}r.length==0&&(s=!0)}}else return Zt("InvalidTag","Closing tag '"+c+"' doesn't have proper closing.",qe(e,i));else{let f=DI(h,t);if(f!==!0)return Zt(f.err.code,f.err.msg,qe(e,i-h.length+f.err.line));if(s===!0)return Zt("InvalidXml","Multiple possible root nodes found.",qe(e,i));t.unpairedTags.indexOf(c)!==-1||r.push({tagName:c,tagStartPos:o}),n=!0}for(i++;i<e.length;i++)if(e[i]==="<")if(e[i+1]==="!"){i++,i=FI(e,i);continue}else if(e[i+1]==="?"){if(i=BI(e,++i),i.err)return i}else break;else if(e[i]==="&"){let f=cK(e,i);if(f==-1)return Zt("InvalidChar","char '&' is not expected.",qe(e,i));i=f}else if(s===!0&&!NI(e[i]))return Zt("InvalidXml","Extra text at the end",qe(e,i));e[i]==="<"&&i--}}else{if(NI(e[i]))continue;return Zt("InvalidChar","char '"+e[i]+"' is not expected.",qe(e,i))}if(n){if(r.length==1)return Zt("InvalidTag","Unclosed tag '"+r[0].tagName+"'.",qe(e,r[0].tagStartPos));if(r.length>0)return Zt("InvalidXml","Invalid '"+JSON.stringify(r.map(i=>i.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1})}else return Zt("InvalidXml","Start tag expected.",1);return!0};function NI(e){return e===" "||e==="	"||e===`
  `||e==="\r"}function BI(e,t){let r=t;for(;t<e.length;t++)if(e[t]=="?"||e[t]==" "){let n=e.substr(r,t-r);if(t>5&&n==="xml")return Zt("InvalidXml","XML declaration allowed only at the start of the document.",qe(e,t));if(e[t]=="?"&&e[t+1]==">"){t++;break}else continue}return t}function FI(e,t){if(e.length>t+5&&e[t+1]==="-"&&e[t+2]==="-"){for(t+=3;t<e.length;t++)if(e[t]==="-"&&e[t+1]==="-"&&e[t+2]===">"){t+=2;break}}else if(e.length>t+8&&e[t+1]==="D"&&e[t+2]==="O"&&e[t+3]==="C"&&e[t+4]==="T"&&e[t+5]==="Y"&&e[t+6]==="P"&&e[t+7]==="E"){let r=1;for(t+=8;t<e.length;t++)if(e[t]==="<")r++;else if(e[t]===">"&&(r--,r===0))break}else if(e.length>t+9&&e[t+1]==="["&&e[t+2]==="C"&&e[t+3]==="D"&&e[t+4]==="A"&&e[t+5]==="T"&&e[t+6]==="A"&&e[t+7]==="["){for(t+=8;t<e.length;t++)if(e[t]==="]"&&e[t+1]==="]"&&e[t+2]===">"){t+=2;break}}return t}var nK='"',sK="'";function iK(e,t){let r="",n="",s=!1;for(;t<e.length;t++){if(e[t]===nK||e[t]===sK)n===""?n=e[t]:n!==e[t]||(n="");else if(e[t]===">"&&n===""){s=!0;break}r+=e[t]}return n!==""?!1:{value:r,index:t,tagClosed:s}}var oK=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function DI(e,t){let r=vA.getAllMatches(e,oK),n={};for(let s=0;s<r.length;s++){if(r[s][1].length===0)return Zt("InvalidAttr","Attribute '"+r[s][2]+"' has no space in starting.",Ff(r[s]));if(r[s][3]!==void 0&&r[s][4]===void 0)return Zt("InvalidAttr","Attribute '"+r[s][2]+"' is without value.",Ff(r[s]));if(r[s][3]===void 0&&!t.allowBooleanAttributes)return Zt("InvalidAttr","boolean attribute '"+r[s][2]+"' is not allowed.",Ff(r[s]));let i=r[s][2];if(!lK(i))return Zt("InvalidAttr","Attribute '"+i+"' is an invalid name.",Ff(r[s]));if(!n.hasOwnProperty(i))n[i]=1;else return Zt("InvalidAttr","Attribute '"+i+"' is repeated.",Ff(r[s]))}return!0}function aK(e,t){let r=/\d/;for(e[t]==="x"&&(t++,r=/[\da-fA-F]/);t<e.length;t++){if(e[t]===";")return t;if(!e[t].match(r))break}return-1}function cK(e,t){if(t++,e[t]===";")return-1;if(e[t]==="#")return t++,aK(e,t);let r=0;for(;t<e.length;t++,r++)if(!(e[t].match(/\w/)&&r<20)){if(e[t]===";")break;return-1}return t}function Zt(e,t,r){return{err:{code:e,msg:t,line:r.line||r,col:r.col}}}function lK(e){return vA.isName(e)}function hK(e){return vA.isName(e)}function qe(e,t){let r=e.substring(0,t).split(/\r?\n/);return{line:r.length,col:r[r.length-1].length+1}}function Ff(e){return e.startIndex+e[1].length}});var zI=ye(CA=>{var UI={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(e,t,r){return e}},fK=function(e){return Object.assign({},UI,e)};CA.buildOptions=fK;CA.defaultOptions=UI});var HI=ye((gDt,VI)=>{"use strict";var PA=class{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,r){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:r})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,[":@"]:t[":@"]}):this.child.push({[t.tagname]:t.child})}};VI.exports=PA});var GI=ye((mDt,WI)=>{var uK=Tm();function dK(e,t){let r={};if(e[t+3]==="O"&&e[t+4]==="C"&&e[t+5]==="T"&&e[t+6]==="Y"&&e[t+7]==="P"&&e[t+8]==="E"){t=t+9;let n=1,s=!1,i=!1,o="";for(;t<e.length;t++)if(e[t]==="<"&&!i){if(s&&mK(e,t))t+=7,[entityName,val,t]=pK(e,t+1),val.indexOf("&")===-1&&(r[AK(entityName)]={regx:RegExp(`&${entityName};`,"g"),val});else if(s&&_K(e,t))t+=8;else if(s&&xK(e,t))t+=8;else if(s&&yK(e,t))t+=9;else if(gK)i=!0;else throw new Error("Invalid DOCTYPE");n++,o=""}else if(e[t]===">"){if(i?e[t-1]==="-"&&e[t-2]==="-"&&(i=!1,n--):n--,n===0)break}else e[t]==="["?s=!0:o+=e[t];if(n!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:r,i:t}}function pK(e,t){let r="";for(;t<e.length&&e[t]!=="'"&&e[t]!=='"';t++)r+=e[t];if(r=r.trim(),r.indexOf(" ")!==-1)throw new Error("External entites are not supported");let n=e[t++],s="";for(;t<e.length&&e[t]!==n;t++)s+=e[t];return[r,s,t]}function gK(e,t){return e[t+1]==="!"&&e[t+2]==="-"&&e[t+3]==="-"}function mK(e,t){return e[t+1]==="!"&&e[t+2]==="E"&&e[t+3]==="N"&&e[t+4]==="T"&&e[t+5]==="I"&&e[t+6]==="T"&&e[t+7]==="Y"}function _K(e,t){return e[t+1]==="!"&&e[t+2]==="E"&&e[t+3]==="L"&&e[t+4]==="E"&&e[t+5]==="M"&&e[t+6]==="E"&&e[t+7]==="N"&&e[t+8]==="T"}function xK(e,t){return e[t+1]==="!"&&e[t+2]==="A"&&e[t+3]==="T"&&e[t+4]==="T"&&e[t+5]==="L"&&e[t+6]==="I"&&e[t+7]==="S"&&e[t+8]==="T"}function yK(e,t){return e[t+1]==="!"&&e[t+2]==="N"&&e[t+3]==="O"&&e[t+4]==="T"&&e[t+5]==="A"&&e[t+6]==="T"&&e[t+7]==="I"&&e[t+8]==="O"&&e[t+9]==="N"}function AK(e){if(uK.isName(e))return e;throw new Error(`Invalid entity name ${e}`)}WI.exports=dK});var qI=ye((_Dt,jI)=>{var TK=/^[-+]?0x[a-fA-F0-9]+$/,MK=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt);!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);var EK={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};function bK(e,t={}){if(t=Object.assign({},EK,t),!e||typeof e!="string")return e;let r=e.trim();if(t.skipLike!==void 0&&t.skipLike.test(r))return e;if(t.hex&&TK.test(r))return Number.parseInt(r,16);{let n=MK.exec(r);if(n){let s=n[1],i=n[2],o=SK(n[3]),a=n[4]||n[6];if(!t.leadingZeros&&i.length>0&&s&&r[2]!==".")return e;if(!t.leadingZeros&&i.length>0&&!s&&r[1]!==".")return e;{let c=Number(r),l=""+c;return l.search(/[eE]/)!==-1||a?t.eNotation?c:e:r.indexOf(".")!==-1?l==="0"&&o===""||l===o||s&&l==="-"+o?c:e:i?o===l||s+o===l?c:e:r===l||r===s+l?c:e}}else return e}}function SK(e){return e&&e.indexOf(".")!==-1&&(e=e.replace(/0+$/,""),e==="."?e="0":e[0]==="."?e="0"+e:e[e.length-1]==="."&&(e=e.substr(0,e.length-1))),e}jI.exports=bK});var $I=ye((xDt,YI)=>{"use strict";var XI=Tm(),Df=HI(),vK=GI(),wK=qI(),RA=class{constructor(t){this.options=t,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"\xA2"},pound:{regex:/&(pound|#163);/g,val:"\xA3"},yen:{regex:/&(yen|#165);/g,val:"\xA5"},euro:{regex:/&(euro|#8364);/g,val:"\u20AC"},copyright:{regex:/&(copy|#169);/g,val:"\xA9"},reg:{regex:/&(reg|#174);/g,val:"\xAE"},inr:{regex:/&(inr|#8377);/g,val:"\u20B9"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(r,n)=>String.fromCharCode(Number.parseInt(n,10))},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(r,n)=>String.fromCharCode(Number.parseInt(n,16))}},this.addExternalEntities=CK,this.parseXml=LK,this.parseTextData=PK,this.resolveNameSpace=RK,this.buildAttributesMap=OK,this.isItStopNode=DK,this.replaceEntitiesValue=BK,this.readStopNodeData=UK,this.saveTextToParentTag=FK,this.addChild=NK}};function CK(e){let t=Object.keys(e);for(let r=0;r<t.length;r++){let n=t[r];this.lastEntities[n]={regex:new RegExp("&"+n+";","g"),val:e[n]}}}function PK(e,t,r,n,s,i,o){if(e!==void 0&&(this.options.trimValues&&!n&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e));let a=this.options.tagValueProcessor(t,e,r,s,i);return a==null?e:typeof a!=typeof e||a!==e?a:this.options.trimValues?OA(e,this.options.parseTagValue,this.options.numberParseOptions):e.trim()===e?OA(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function RK(e){if(this.options.removeNSPrefix){let t=e.split(":"),r=e.charAt(0)==="/"?"/":"";if(t[0]==="xmlns")return"";t.length===2&&(e=r+t[1])}return e}var IK=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function OK(e,t,r){if(!this.options.ignoreAttributes&&typeof e=="string"){let n=XI.getAllMatches(e,IK),s=n.length,i={};for(let o=0;o<s;o++){let a=this.resolveNameSpace(n[o][1]),c=n[o][4],l=this.options.attributeNamePrefix+a;if(a.length)if(this.options.transformAttributeName&&(l=this.options.transformAttributeName(l)),l==="__proto__"&&(l="#__proto__"),c!==void 0){this.options.trimValues&&(c=c.trim()),c=this.replaceEntitiesValue(c);let h=this.options.attributeValueProcessor(a,c,t);h==null?i[l]=c:typeof h!=typeof c||h!==c?i[l]=h:i[l]=OA(c,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(i[l]=!0)}if(!Object.keys(i).length)return;if(this.options.attributesGroupName){let o={};return o[this.options.attributesGroupName]=i,o}return i}}var LK=function(e){e=e.replace(/\r\n?/g,`
  `);let t=new Df("!xml"),r=t,n="",s="";for(let i=0;i<e.length;i++)if(e[i]==="<")if(e[i+1]==="/"){let a=xo(e,">",i,"Closing Tag is not closed."),c=e.substring(i+2,a).trim();if(this.options.removeNSPrefix){let f=c.indexOf(":");f!==-1&&(c=c.substr(f+1))}this.options.transformTagName&&(c=this.options.transformTagName(c)),r&&(n=this.saveTextToParentTag(n,r,s));let l=s.substring(s.lastIndexOf(".")+1);if(c&&this.options.unpairedTags.indexOf(c)!==-1)throw new Error(`Unpaired tag can not be used as closing tag: </${c}>`);let h=0;l&&this.options.unpairedTags.indexOf(l)!==-1?(h=s.lastIndexOf(".",s.lastIndexOf(".")-1),this.tagsNodeStack.pop()):h=s.lastIndexOf("."),s=s.substring(0,h),r=this.tagsNodeStack.pop(),n="",i=a}else if(e[i+1]==="?"){let a=IA(e,i,!1,"?>");if(!a)throw new Error("Pi Tag is not closed.");if(n=this.saveTextToParentTag(n,r,s),!(this.options.ignoreDeclaration&&a.tagName==="?xml"||this.options.ignorePiTags)){let c=new Df(a.tagName);c.add(this.options.textNodeName,""),a.tagName!==a.tagExp&&a.attrExpPresent&&(c[":@"]=this.buildAttributesMap(a.tagExp,s,a.tagName)),this.addChild(r,c,s)}i=a.closeIndex+1}else if(e.substr(i+1,3)==="!--"){let a=xo(e,"-->",i+4,"Comment is not closed.");if(this.options.commentPropName){let c=e.substring(i+4,a-2);n=this.saveTextToParentTag(n,r,s),r.add(this.options.commentPropName,[{[this.options.textNodeName]:c}])}i=a}else if(e.substr(i+1,2)==="!D"){let a=vK(e,i);this.docTypeEntities=a.entities,i=a.i}else if(e.substr(i+1,2)==="!["){let a=xo(e,"]]>",i,"CDATA is not closed.")-2,c=e.substring(i+9,a);n=this.saveTextToParentTag(n,r,s);let l=this.parseTextData(c,r.tagname,s,!0,!1,!0,!0);l==null&&(l=""),this.options.cdataPropName?r.add(this.options.cdataPropName,[{[this.options.textNodeName]:c}]):r.add(this.options.textNodeName,l),i=a+2}else{let a=IA(e,i,this.options.removeNSPrefix),c=a.tagName,l=a.rawTagName,h=a.tagExp,f=a.attrExpPresent,u=a.closeIndex;this.options.transformTagName&&(c=this.options.transformTagName(c)),r&&n&&r.tagname!=="!xml"&&(n=this.saveTextToParentTag(n,r,s,!1));let d=r;if(d&&this.options.unpairedTags.indexOf(d.tagname)!==-1&&(r=this.tagsNodeStack.pop(),s=s.substring(0,s.lastIndexOf("."))),c!==t.tagname&&(s+=s?"."+c:c),this.isItStopNode(this.options.stopNodes,s,c)){let p="";if(h.length>0&&h.lastIndexOf("/")===h.length-1)c[c.length-1]==="/"?(c=c.substr(0,c.length-1),s=s.substr(0,s.length-1),h=c):h=h.substr(0,h.length-1),i=a.closeIndex;else if(this.options.unpairedTags.indexOf(c)!==-1)i=a.closeIndex;else{let m=this.readStopNodeData(e,l,u+1);if(!m)throw new Error(`Unexpected end of ${l}`);i=m.i,p=m.tagContent}let g=new Df(c);c!==h&&f&&(g[":@"]=this.buildAttributesMap(h,s,c)),p&&(p=this.parseTextData(p,c,s,!0,f,!0,!0)),s=s.substr(0,s.lastIndexOf(".")),g.add(this.options.textNodeName,p),this.addChild(r,g,s)}else{if(h.length>0&&h.lastIndexOf("/")===h.length-1){c[c.length-1]==="/"?(c=c.substr(0,c.length-1),s=s.substr(0,s.length-1),h=c):h=h.substr(0,h.length-1),this.options.transformTagName&&(c=this.options.transformTagName(c));let p=new Df(c);c!==h&&f&&(p[":@"]=this.buildAttributesMap(h,s,c)),this.addChild(r,p,s),s=s.substr(0,s.lastIndexOf("."))}else{let p=new Df(c);this.tagsNodeStack.push(r),c!==h&&f&&(p[":@"]=this.buildAttributesMap(h,s,c)),this.addChild(r,p,s),r=p}n="",i=u}}else n+=e[i];return t.child};function NK(e,t,r){let n=this.options.updateTag(t.tagname,r,t[":@"]);n===!1||(typeof n=="string"&&(t.tagname=n),e.addChild(t))}var BK=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){let r=this.docTypeEntities[t];e=e.replace(r.regx,r.val)}for(let t in this.lastEntities){let r=this.lastEntities[t];e=e.replace(r.regex,r.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){let r=this.htmlEntities[t];e=e.replace(r.regex,r.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function FK(e,t,r,n){return e&&(n===void 0&&(n=Object.keys(t.child).length===0),e=this.parseTextData(e,t.tagname,r,!1,t[":@"]?Object.keys(t[":@"]).length!==0:!1,n),e!==void 0&&e!==""&&t.add(this.options.textNodeName,e),e=""),e}function DK(e,t,r){let n="*."+r;for(let s in e){let i=e[s];if(n===i||t===i)return!0}return!1}function kK(e,t,r=">"){let n,s="";for(let i=t;i<e.length;i++){let o=e[i];if(n)o===n&&(n="");else if(o==='"'||o==="'")n=o;else if(o===r[0])if(r[1]){if(e[i+1]===r[1])return{data:s,index:i}}else return{data:s,index:i};else o==="	"&&(o=" ");s+=o}}function xo(e,t,r,n){let s=e.indexOf(t,r);if(s===-1)throw new Error(n);return s+t.length-1}function IA(e,t,r,n=">"){let s=kK(e,t+1,n);if(!s)return;let i=s.data,o=s.index,a=i.search(/\s/),c=i,l=!0;a!==-1&&(c=i.substring(0,a),i=i.substring(a+1).trimStart());let h=c;if(r){let f=c.indexOf(":");f!==-1&&(c=c.substr(f+1),l=c!==s.data.substr(f+1))}return{tagName:c,tagExp:i,closeIndex:o,attrExpPresent:l,rawTagName:h}}function UK(e,t,r){let n=r,s=1;for(;r<e.length;r++)if(e[r]==="<")if(e[r+1]==="/"){let i=xo(e,">",r,`${t} is not closed`);if(e.substring(r+2,i).trim()===t&&(s--,s===0))return{tagContent:e.substring(n,r),i};r=i}else if(e[r+1]==="?")r=xo(e,"?>",r+1,"StopNode is not closed.");else if(e.substr(r+1,3)==="!--")r=xo(e,"-->",r+3,"StopNode is not closed.");else if(e.substr(r+1,2)==="![")r=xo(e,"]]>",r,"StopNode is not closed.")-2;else{let i=IA(e,r,">");i&&((i&&i.tagName)===t&&i.tagExp[i.tagExp.length-1]!=="/"&&s++,r=i.closeIndex)}}function OA(e,t,r){if(t&&typeof e=="string"){let n=e.trim();return n==="true"?!0:n==="false"?!1:wK(e,r)}else return XI.isExist(e)?e:""}YI.exports=RA});var JI=ye(ZI=>{"use strict";function zK(e,t){return KI(e,t)}function KI(e,t,r){let n,s={};for(let i=0;i<e.length;i++){let o=e[i],a=VK(o),c="";if(r===void 0?c=a:c=r+"."+a,a===t.textNodeName)n===void 0?n=o[a]:n+=""+o[a];else{if(a===void 0)continue;if(o[a]){let l=KI(o[a],t,c),h=WK(l,t);o[":@"]?HK(l,o[":@"],c,t):Object.keys(l).length===1&&l[t.textNodeName]!==void 0&&!t.alwaysCreateTextNode?l=l[t.textNodeName]:Object.keys(l).length===0&&(t.alwaysCreateTextNode?l[t.textNodeName]="":l=""),s[a]!==void 0&&s.hasOwnProperty(a)?(Array.isArray(s[a])||(s[a]=[s[a]]),s[a].push(l)):t.isArray(a,c,h)?s[a]=[l]:s[a]=l}}}return typeof n=="string"?n.length>0&&(s[t.textNodeName]=n):n!==void 0&&(s[t.textNodeName]=n),s}function VK(e){let t=Object.keys(e);for(let r=0;r<t.length;r++){let n=t[r];if(n!==":@")return n}}function HK(e,t,r,n){if(t){let s=Object.keys(t),i=s.length;for(let o=0;o<i;o++){let a=s[o];n.isArray(a,r+"."+a,!0,!0)?e[a]=[t[a]]:e[a]=t[a]}}}function WK(e,t){let{textNodeName:r}=t,n=Object.keys(e).length;return!!(n===0||n===1&&(e[r]||typeof e[r]=="boolean"||e[r]===0))}ZI.prettify=zK});var tO=ye((ADt,QI)=>{var{buildOptions:GK}=zI(),jK=$I(),{prettify:qK}=JI(),XK=wA(),LA=class{constructor(t){this.externalEntities={},this.options=GK(t)}parse(t,r){if(typeof t!="string")if(t.toString)t=t.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(r){r===!0&&(r={});let i=XK.validate(t,r);if(i!==!0)throw Error(`${i.err.msg}:${i.err.line}:${i.err.col}`)}let n=new jK(this.options);n.addExternalEntities(this.externalEntities);let s=n.parseXml(t);return this.options.preserveOrder||s===void 0?s:qK(s,this.options)}addEntity(t,r){if(r.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(t.indexOf("&")!==-1||t.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(r==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[t]=r}};QI.exports=LA});var iO=ye((TDt,sO)=>{var YK=`
  `;function $K(e,t){let r="";return t.format&&t.indentBy.length>0&&(r=YK),rO(e,t,"",r)}function rO(e,t,r,n){let s="",i=!1;for(let o=0;o<e.length;o++){let a=e[o],c=KK(a);if(c===void 0)continue;let l="";if(r.length===0?l=c:l=`${r}.${c}`,c===t.textNodeName){let p=a[c];ZK(l,t)||(p=t.tagValueProcessor(c,p),p=nO(p,t)),i&&(s+=n),s+=p,i=!1;continue}else if(c===t.cdataPropName){i&&(s+=n),s+=`<![CDATA[${a[c][0][t.textNodeName]}]]>`,i=!1;continue}else if(c===t.commentPropName){s+=n+`<!--${a[c][0][t.textNodeName]}-->`,i=!0;continue}else if(c[0]==="?"){let p=eO(a[":@"],t),g=c==="?xml"?"":n,m=a[c][0][t.textNodeName];m=m.length!==0?" "+m:"",s+=g+`<${c}${m}${p}?>`,i=!0;continue}let h=n;h!==""&&(h+=t.indentBy);let f=eO(a[":@"],t),u=n+`<${c}${f}`,d=rO(a[c],t,l,h);t.unpairedTags.indexOf(c)!==-1?t.suppressUnpairedNode?s+=u+">":s+=u+"/>":(!d||d.length===0)&&t.suppressEmptyNode?s+=u+"/>":d&&d.endsWith(">")?s+=u+`>${d}${n}</${c}>`:(s+=u+">",d&&n!==""&&(d.includes("/>")||d.includes("</"))?s+=n+t.indentBy+d+n:s+=d,s+=`</${c}>`),i=!0}return s}function KK(e){let t=Object.keys(e);for(let r=0;r<t.length;r++){let n=t[r];if(e.hasOwnProperty(n)&&n!==":@")return n}}function eO(e,t){let r="";if(e&&!t.ignoreAttributes)for(let n in e){if(!e.hasOwnProperty(n))continue;let s=t.attributeValueProcessor(n,e[n]);s=nO(s,t),s===!0&&t.suppressBooleanAttributes?r+=` ${n.substr(t.attributeNamePrefix.length)}`:r+=` ${n.substr(t.attributeNamePrefix.length)}="${s}"`}return r}function ZK(e,t){e=e.substr(0,e.length-t.textNodeName.length-1);let r=e.substr(e.lastIndexOf(".")+1);for(let n in t.stopNodes)if(t.stopNodes[n]===e||t.stopNodes[n]==="*."+r)return!0;return!1}function nO(e,t){if(e&&e.length>0&&t.processEntities)for(let r=0;r<t.entities.length;r++){let n=t.entities[r];e=e.replace(n.regex,n.val)}return e}sO.exports=$K});var aO=ye((MDt,oO)=>{"use strict";var JK=iO(),QK={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function ri(e){this.options=Object.assign({},QK,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=rZ),this.processTextOrObjNode=tZ,this.options.format?(this.indentate=eZ,this.tagEndChar=`>
  `,this.newLine=`
  `):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}ri.prototype.build=function(e){return this.options.preserveOrder?JK(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)};ri.prototype.j2x=function(e,t){let r="",n="";for(let s in e)if(Object.prototype.hasOwnProperty.call(e,s))if(typeof e[s]>"u")this.isAttribute(s)&&(n+="");else if(e[s]===null)this.isAttribute(s)?n+="":s[0]==="?"?n+=this.indentate(t)+"<"+s+"?"+this.tagEndChar:n+=this.indentate(t)+"<"+s+"/"+this.tagEndChar;else if(e[s]instanceof Date)n+=this.buildTextValNode(e[s],s,"",t);else if(typeof e[s]!="object"){let i=this.isAttribute(s);if(i)r+=this.buildAttrPairStr(i,""+e[s]);else if(s===this.options.textNodeName){let o=this.options.tagValueProcessor(s,""+e[s]);n+=this.replaceEntitiesValue(o)}else n+=this.buildTextValNode(e[s],s,"",t)}else if(Array.isArray(e[s])){let i=e[s].length,o="",a="";for(let c=0;c<i;c++){let l=e[s][c];if(!(typeof l>"u"))if(l===null)s[0]==="?"?n+=this.indentate(t)+"<"+s+"?"+this.tagEndChar:n+=this.indentate(t)+"<"+s+"/"+this.tagEndChar;else if(typeof l=="object")if(this.options.oneListGroup){let h=this.j2x(l,t+1);o+=h.val,this.options.attributesGroupName&&l.hasOwnProperty(this.options.attributesGroupName)&&(a+=h.attrStr)}else o+=this.processTextOrObjNode(l,s,t);else if(this.options.oneListGroup){let h=this.options.tagValueProcessor(s,l);h=this.replaceEntitiesValue(h),o+=h}else o+=this.buildTextValNode(l,s,"",t)}this.options.oneListGroup&&(o=this.buildObjectNode(o,s,a,t)),n+=o}else if(this.options.attributesGroupName&&s===this.options.attributesGroupName){let i=Object.keys(e[s]),o=i.length;for(let a=0;a<o;a++)r+=this.buildAttrPairStr(i[a],""+e[s][i[a]])}else n+=this.processTextOrObjNode(e[s],s,t);return{attrStr:r,val:n}};ri.prototype.buildAttrPairStr=function(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&t==="true"?" "+e:" "+e+'="'+t+'"'};function tZ(e,t,r){let n=this.j2x(e,r+1);return e[this.options.textNodeName]!==void 0&&Object.keys(e).length===1?this.buildTextValNode(e[this.options.textNodeName],t,n.attrStr,r):this.buildObjectNode(n.val,t,n.attrStr,r)}ri.prototype.buildObjectNode=function(e,t,r,n){if(e==="")return t[0]==="?"?this.indentate(n)+"<"+t+r+"?"+this.tagEndChar:this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar;{let s="</"+t+this.tagEndChar,i="";return t[0]==="?"&&(i="?",s=""),(r||r==="")&&e.indexOf("<")===-1?this.indentate(n)+"<"+t+r+i+">"+e+s:this.options.commentPropName!==!1&&t===this.options.commentPropName&&i.length===0?this.indentate(n)+`<!--${e}-->`+this.newLine:this.indentate(n)+"<"+t+r+i+this.tagEndChar+e+this.indentate(n)+s}};ri.prototype.closeTag=function(e){let t="";return this.options.unpairedTags.indexOf(e)!==-1?this.options.suppressUnpairedNode||(t="/"):this.options.suppressEmptyNode?t="/":t=`></${e}`,t};ri.prototype.buildTextValNode=function(e,t,r,n){if(this.options.cdataPropName!==!1&&t===this.options.cdataPropName)return this.indentate(n)+`<![CDATA[${e}]]>`+this.newLine;if(this.options.commentPropName!==!1&&t===this.options.commentPropName)return this.indentate(n)+`<!--${e}-->`+this.newLine;if(t[0]==="?")return this.indentate(n)+"<"+t+r+"?"+this.tagEndChar;{let s=this.options.tagValueProcessor(t,e);return s=this.replaceEntitiesValue(s),s===""?this.indentate(n)+"<"+t+r+this.closeTag(t)+this.tagEndChar:this.indentate(n)+"<"+t+r+">"+s+"</"+t+this.tagEndChar}};ri.prototype.replaceEntitiesValue=function(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){let r=this.options.entities[t];e=e.replace(r.regex,r.val)}return e};function eZ(e){return this.options.indentBy.repeat(e)}function rZ(e){return e.startsWith(this.options.attributeNamePrefix)&&e!==this.options.textNodeName?e.substr(this.attrPrefixLen):!1}oO.exports=ri});var lO=ye((EDt,cO)=>{"use strict";var nZ=wA(),sZ=tO(),iZ=aO();cO.exports={XMLParser:sZ,XMLValidator:nZ,XMLBuilder:iZ}});var WA=ye((TO,Wf)=>{(function(e,t){typeof define=="function"&&define.amd?define([],t):typeof Ub=="function"&&typeof Wf=="object"&&Wf&&Wf.exports?Wf.exports=t():(e.dcodeIO=e.dcodeIO||{}).Long=t()})(TO,function(){"use strict";function e(b,T,I){this.low=b|0,this.high=T|0,this.unsigned=!!I}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1});function t(b){return(b&&b.__isLong__)===!0}e.isLong=t;var r={},n={};function s(b,T){var I,N,B;return T?(b>>>=0,(B=0<=b&&b<256)&&(N=n[b],N)?N:(I=o(b,(b|0)<0?-1:0,!0),B&&(n[b]=I),I)):(b|=0,(B=-128<=b&&b<128)&&(N=r[b],N)?N:(I=o(b,b<0?-1:0,!1),B&&(r[b]=I),I))}e.fromInt=s;function i(b,T){if(isNaN(b)||!isFinite(b))return T?_:m;if(T){if(b<0)return _;if(b>=d)return E}else{if(b<=-p)return w;if(b+1>=p)return M}return b<0?i(-b,T).neg():o(b%u|0,b/u|0,T)}e.fromNumber=i;function o(b,T,I){return new e(b,T,I)}e.fromBits=o;var a=Math.pow;function c(b,T,I){if(b.length===0)throw Error("empty string");if(b==="NaN"||b==="Infinity"||b==="+Infinity"||b==="-Infinity")return m;if(typeof T=="number"?(I=T,T=!1):T=!!T,I=I||10,I<2||36<I)throw RangeError("radix");var N;if((N=b.indexOf("-"))>0)throw Error("interior hyphen");if(N===0)return c(b.substring(1),T,I).neg();for(var B=i(a(I,8)),C=m,V=0;V<b.length;V+=8){var rt=Math.min(8,b.length-V),J=parseInt(b.substring(V,V+rt),I);if(rt<8){var St=i(a(I,rt));C=C.mul(St).add(i(J))}else C=C.mul(B),C=C.add(i(J))}return C.unsigned=T,C}e.fromString=c;function l(b){return b instanceof e?b:typeof b=="number"?i(b):typeof b=="string"?c(b):o(b.low,b.high,b.unsigned)}e.fromValue=l;var h=1<<16,f=1<<24,u=h*h,d=u*u,p=d/2,g=s(f),m=s(0);e.ZERO=m;var _=s(0,!0);e.UZERO=_;var y=s(1);e.ONE=y;var x=s(1,!0);e.UONE=x;var A=s(-1);e.NEG_ONE=A;var M=o(-1,2147483647,!1);e.MAX_VALUE=M;var E=o(-1,-1,!0);e.MAX_UNSIGNED_VALUE=E;var w=o(0,-2147483648,!1);e.MIN_VALUE=w;var v=e.prototype;return v.toInt=function(){return this.unsigned?this.low>>>0:this.low},v.toNumber=function(){return this.unsigned?(this.high>>>0)*u+(this.low>>>0):this.high*u+(this.low>>>0)},v.toString=function(T){if(T=T||10,T<2||36<T)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(w)){var I=i(T),N=this.div(I),B=N.mul(I).sub(this);return N.toString(T)+B.toInt().toString(T)}else return"-"+this.neg().toString(T);for(var C=i(a(T,6),this.unsigned),V=this,rt="";;){var J=V.div(C),St=V.sub(J.mul(C)).toInt()>>>0,ht=St.toString(T);if(V=J,V.isZero())return ht+rt;for(;ht.length<6;)ht="0"+ht;rt=""+ht+rt}},v.getHighBits=function(){return this.high},v.getHighBitsUnsigned=function(){return this.high>>>0},v.getLowBits=function(){return this.low},v.getLowBitsUnsigned=function(){return this.low>>>0},v.getNumBitsAbs=function(){if(this.isNegative())return this.eq(w)?64:this.neg().getNumBitsAbs();for(var T=this.high!=0?this.high:this.low,I=31;I>0&&!(T&1<<I);I--);return this.high!=0?I+33:I+1},v.isZero=function(){return this.high===0&&this.low===0},v.isNegative=function(){return!this.unsigned&&this.high<0},v.isPositive=function(){return this.unsigned||this.high>=0},v.isOdd=function(){return(this.low&1)===1},v.isEven=function(){return(this.low&1)===0},v.equals=function(T){return t(T)||(T=l(T)),this.unsigned!==T.unsigned&&this.high>>>31===1&&T.high>>>31===1?!1:this.high===T.high&&this.low===T.low},v.eq=v.equals,v.notEquals=function(T){return!this.eq(T)},v.neq=v.notEquals,v.lessThan=function(T){return this.comp(T)<0},v.lt=v.lessThan,v.lessThanOrEqual=function(T){return this.comp(T)<=0},v.lte=v.lessThanOrEqual,v.greaterThan=function(T){return this.comp(T)>0},v.gt=v.greaterThan,v.greaterThanOrEqual=function(T){return this.comp(T)>=0},v.gte=v.greaterThanOrEqual,v.compare=function(T){if(t(T)||(T=l(T)),this.eq(T))return 0;var I=this.isNegative(),N=T.isNegative();return I&&!N?-1:!I&&N?1:this.unsigned?T.high>>>0>this.high>>>0||T.high===this.high&&T.low>>>0>this.low>>>0?-1:1:this.sub(T).isNegative()?-1:1},v.comp=v.compare,v.negate=function(){return!this.unsigned&&this.eq(w)?w:this.not().add(y)},v.neg=v.negate,v.add=function(T){t(T)||(T=l(T));var I=this.high>>>16,N=this.high&65535,B=this.low>>>16,C=this.low&65535,V=T.high>>>16,rt=T.high&65535,J=T.low>>>16,St=T.low&65535,ht=0,vt=0,Dt=0,$e=0;return $e+=C+St,Dt+=$e>>>16,$e&=65535,Dt+=B+J,vt+=Dt>>>16,Dt&=65535,vt+=N+rt,ht+=vt>>>16,vt&=65535,ht+=I+V,ht&=65535,o(Dt<<16|$e,ht<<16|vt,this.unsigned)},v.subtract=function(T){return t(T)||(T=l(T)),this.add(T.neg())},v.sub=v.subtract,v.multiply=function(T){if(this.isZero()||(t(T)||(T=l(T)),T.isZero()))return m;if(this.eq(w))return T.isOdd()?w:m;if(T.eq(w))return this.isOdd()?w:m;if(this.isNegative())return T.isNegative()?this.neg().mul(T.neg()):this.neg().mul(T).neg();if(T.isNegative())return this.mul(T.neg()).neg();if(this.lt(g)&&T.lt(g))return i(this.toNumber()*T.toNumber(),this.unsigned);var I=this.high>>>16,N=this.high&65535,B=this.low>>>16,C=this.low&65535,V=T.high>>>16,rt=T.high&65535,J=T.low>>>16,St=T.low&65535,ht=0,vt=0,Dt=0,$e=0;return $e+=C*St,Dt+=$e>>>16,$e&=65535,Dt+=B*St,vt+=Dt>>>16,Dt&=65535,Dt+=C*J,vt+=Dt>>>16,Dt&=65535,vt+=N*St,ht+=vt>>>16,vt&=65535,vt+=B*J,ht+=vt>>>16,vt&=65535,vt+=C*rt,ht+=vt>>>16,vt&=65535,ht+=I*St+N*J+B*rt+C*V,ht&=65535,o(Dt<<16|$e,ht<<16|vt,this.unsigned)},v.mul=v.multiply,v.divide=function(T){if(t(T)||(T=l(T)),T.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?_:m;var I,N,B;if(this.unsigned){if(T.unsigned||(T=T.toUnsigned()),T.gt(this))return _;if(T.gt(this.shru(1)))return x;B=_}else{if(this.eq(w)){if(T.eq(y)||T.eq(A))return w;if(T.eq(w))return y;var C=this.shr(1);return I=C.div(T).shl(1),I.eq(m)?T.isNegative()?y:A:(N=this.sub(T.mul(I)),B=I.add(N.div(T)),B)}else if(T.eq(w))return this.unsigned?_:m;if(this.isNegative())return T.isNegative()?this.neg().div(T.neg()):this.neg().div(T).neg();if(T.isNegative())return this.div(T.neg()).neg();B=m}for(N=this;N.gte(T);){I=Math.max(1,Math.floor(N.toNumber()/T.toNumber()));for(var V=Math.ceil(Math.log(I)/Math.LN2),rt=V<=48?1:a(2,V-48),J=i(I),St=J.mul(T);St.isNegative()||St.gt(N);)I-=rt,J=i(I,this.unsigned),St=J.mul(T);J.isZero()&&(J=y),B=B.add(J),N=N.sub(St)}return B},v.div=v.divide,v.modulo=function(T){return t(T)||(T=l(T)),this.sub(this.div(T).mul(T))},v.mod=v.modulo,v.not=function(){return o(~this.low,~this.high,this.unsigned)},v.and=function(T){return t(T)||(T=l(T)),o(this.low&T.low,this.high&T.high,this.unsigned)},v.or=function(T){return t(T)||(T=l(T)),o(this.low|T.low,this.high|T.high,this.unsigned)},v.xor=function(T){return t(T)||(T=l(T)),o(this.low^T.low,this.high^T.high,this.unsigned)},v.shiftLeft=function(T){return t(T)&&(T=T.toInt()),(T&=63)===0?this:T<32?o(this.low<<T,this.high<<T|this.low>>>32-T,this.unsigned):o(0,this.low<<T-32,this.unsigned)},v.shl=v.shiftLeft,v.shiftRight=function(T){return t(T)&&(T=T.toInt()),(T&=63)===0?this:T<32?o(this.low>>>T|this.high<<32-T,this.high>>T,this.unsigned):o(this.high>>T-32,this.high>=0?0:-1,this.unsigned)},v.shr=v.shiftRight,v.shiftRightUnsigned=function(T){if(t(T)&&(T=T.toInt()),T&=63,T===0)return this;var I=this.high;if(T<32){var N=this.low;return o(N>>>T|I<<32-T,I>>>T,this.unsigned)}else return T===32?o(I,0,this.unsigned):o(I>>>T-32,0,this.unsigned)},v.shru=v.shiftRightUnsigned,v.toSigned=function(){return this.unsigned?o(this.low,this.high,!1):this},v.toUnsigned=function(){return this.unsigned?this:o(this.low,this.high,!0)},v.toBytes=function(b){return b?this.toBytesLE():this.toBytesBE()},v.toBytesLE=function(){var b=this.high,T=this.low;return[T&255,T>>>8&255,T>>>16&255,T>>>24&255,b&255,b>>>8&255,b>>>16&255,b>>>24&255]},v.toBytesBE=function(){var b=this.high,T=this.low;return[b>>>24&255,b>>>16&255,b>>>8&255,b&255,T>>>24&255,T>>>16&255,T>>>8&255,T&255]},e})});var Kf=ye((wUt,eL)=>{eL.exports=globalThis.h3||{}});var dU=ye(tb=>{tb.read=function(e,t,r,n,s){var i,o,a=s*8-n-1,c=(1<<a)-1,l=c>>1,h=-7,f=r?s-1:0,u=r?-1:1,d=e[t+f];for(f+=u,i=d&(1<<-h)-1,d>>=-h,h+=a;h>0;i=i*256+e[t+f],f+=u,h-=8);for(o=i&(1<<-h)-1,i>>=-h,h+=n;h>0;o=o*256+e[t+f],f+=u,h-=8);if(i===0)i=1-l;else{if(i===c)return o?NaN:(d?-1:1)*(1/0);o=o+Math.pow(2,n),i=i-l}return(d?-1:1)*o*Math.pow(2,i-n)};tb.write=function(e,t,r,n,s,i){var o,a,c,l=i*8-s-1,h=(1<<l)-1,f=h>>1,u=s===23?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:i-1,p=n?1:-1,g=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=h):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?t+=u/c:t+=u*Math.pow(2,1-f),t*c>=2&&(o++,c/=2),o+f>=h?(a=0,o=h):o+f>=1?(a=(t*c-1)*Math.pow(2,s),o=o+f):(a=t*Math.pow(2,f-1)*Math.pow(2,s),o=0));s>=8;e[r+d]=a&255,d+=p,a/=256,s-=8);for(o=o<<s|a,l+=s;l>0;e[r+d]=o&255,d+=p,o/=256,l-=8);e[r+d-p]|=g*128}});var yU=ye((Zte,xU)=>{"use strict";xU.exports=_t;var k1=dU();function _t(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}_t.Varint=0;_t.Fixed64=1;_t.Bytes=2;_t.Fixed32=5;var eb=(1<<16)*(1<<16),pU=1/eb,Mlt=12,_U=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");_t.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),s=n>>3,i=this.pos;this.type=n&7,e(s,t,this),this.pos===i&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=U1(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=mU(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=U1(this.buf,this.pos)+U1(this.buf,this.pos+4)*eb;return this.pos+=8,e},readSFixed64:function(){var e=U1(this.buf,this.pos)+mU(this.buf,this.pos+4)*eb;return this.pos+=8,e},readFloat:function(){var e=k1.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=k1.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t=this.buf,r,n;return n=t[this.pos++],r=n&127,n<128||(n=t[this.pos++],r|=(n&127)<<7,n<128)||(n=t[this.pos++],r|=(n&127)<<14,n<128)||(n=t[this.pos++],r|=(n&127)<<21,n<128)?r:(n=t[this.pos],r|=(n&15)<<28,Elt(r,e,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2===1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=Mlt&&_U?Dlt(this.buf,t,e):Flt(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==_t.Bytes)return e.push(this.readVarint(t));var r=ys(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==_t.Bytes)return e.push(this.readSVarint());var t=ys(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==_t.Bytes)return e.push(this.readBoolean());var t=ys(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==_t.Bytes)return e.push(this.readFloat());var t=ys(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==_t.Bytes)return e.push(this.readDouble());var t=ys(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==_t.Bytes)return e.push(this.readFixed32());var t=ys(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==_t.Bytes)return e.push(this.readSFixed32());var t=ys(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==_t.Bytes)return e.push(this.readFixed64());var t=ys(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==_t.Bytes)return e.push(this.readSFixed64());var t=ys(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=e&7;if(t===_t.Varint)for(;this.buf[this.pos++]>127;);else if(t===_t.Bytes)this.pos=this.readVarint()+this.pos;else if(t===_t.Fixed32)this.pos+=4;else if(t===_t.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Yc(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Yc(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Yc(this.buf,e&-1,this.pos),Yc(this.buf,Math.floor(e*pU),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Yc(this.buf,e&-1,this.pos),Yc(this.buf,Math.floor(e*pU),this.pos+4),this.pos+=8},writeVarint:function(e){if(e=+e||0,e>268435455||e<0){blt(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))},writeSVarint:function(e){this.writeVarint(e<0?-e*2-1:e*2)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(e.length*4),this.pos++;var t=this.pos;this.pos=klt(this.buf,e,this.pos);var r=this.pos-t;r>=128&&gU(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),k1.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),k1.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var n=this.pos-r;n>=128&&gU(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,r){this.writeTag(e,_t.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,wlt,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Clt,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Ilt,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Plt,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Rlt,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Olt,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Llt,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Nlt,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Blt,t)},writeBytesField:function(e,t){this.writeTag(e,_t.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,_t.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,_t.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,_t.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,_t.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,_t.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,_t.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,_t.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,_t.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,_t.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};function Elt(e,t,r){var n=r.buf,s,i;if(i=n[r.pos++],s=(i&112)>>4,i<128||(i=n[r.pos++],s|=(i&127)<<3,i<128)||(i=n[r.pos++],s|=(i&127)<<10,i<128)||(i=n[r.pos++],s|=(i&127)<<17,i<128)||(i=n[r.pos++],s|=(i&127)<<24,i<128)||(i=n[r.pos++],s|=(i&1)<<31,i<128))return Xc(e,s,t);throw new Error("Expected varint not more than 10 bytes")}function ys(e){return e.type===_t.Bytes?e.readVarint()+e.pos:e.pos+1}function Xc(e,t,r){return r?t*4294967296+(e>>>0):(t>>>0)*4294967296+(e>>>0)}function blt(e,t){var r,n;if(e>=0?(r=e%4294967296|0,n=e/4294967296|0):(r=~(-e%4294967296),n=~(-e/4294967296),r^4294967295?r=r+1|0:(r=0,n=n+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),Slt(r,n,t),vlt(n,t)}function Slt(e,t,r){r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos]=e&127}function vlt(e,t){var r=(e&7)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=e&127)))))}function gU(e,t,r){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));r.realloc(n);for(var s=r.pos-1;s>=e;s--)r.buf[s+n]=r.buf[s]}function wlt(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Clt(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function Plt(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function Rlt(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function Ilt(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function Olt(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Llt(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function Nlt(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function Blt(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function U1(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+e[t+3]*16777216}function Yc(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function mU(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Flt(e,t,r){for(var n="",s=t;s<r;){var i=e[s],o=null,a=i>239?4:i>223?3:i>191?2:1;if(s+a>r)break;var c,l,h;a===1?i<128&&(o=i):a===2?(c=e[s+1],(c&192)===128&&(o=(i&31)<<6|c&63,o<=127&&(o=null))):a===3?(c=e[s+1],l=e[s+2],(c&192)===128&&(l&192)===128&&(o=(i&15)<<12|(c&63)<<6|l&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(c=e[s+1],l=e[s+2],h=e[s+3],(c&192)===128&&(l&192)===128&&(h&192)===128&&(o=(i&15)<<18|(c&63)<<12|(l&63)<<6|h&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,n+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),n+=String.fromCharCode(o),s+=a}return n}function Dlt(e,t,r){return _U.decode(e.subarray(t,r))}function klt(e,t,r){for(var n=0,s,i;n<t.length;n++){if(s=t.charCodeAt(n),s>55295&&s<57344)if(i)if(s<56320){e[r++]=239,e[r++]=191,e[r++]=189,i=s;continue}else s=i-55296<<10|s-56320|65536,i=null;else{s>56319||n+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):i=s;continue}else i&&(e[r++]=239,e[r++]=191,e[r++]=189,i=null);s<128?e[r++]=s:(s<2048?e[r++]=s>>6|192:(s<65536?e[r++]=s>>12|224:(e[r++]=s>>18|240,e[r++]=s>>12&63|128),e[r++]=s>>6&63|128),e[r++]=s&63|128)}return r}});var Lft={};Bt(Lft,{AmbientLight:()=>Pa,ArcLayer:()=>$g,Attribute:()=>ts,AttributeManager:()=>ur,BitmapLayer:()=>Kg,BrushingExtension:()=>vk,COORDINATE_SYSTEM:()=>W,CPUAggregator:()=>Ye,ClipExtension:()=>w1,CollisionFilterExtension:()=>Kk,ColumnLayer:()=>Tn,CompassWidget:()=>y_,CompositeLayer:()=>Ft,ContourLayer:()=>q5,Controller:()=>je,DarkGlassTheme:()=>Oft,DarkTheme:()=>Rft,DataFilterExtension:()=>Uk,Deck:()=>jr,DeckGL:()=>Ju,DeckRenderer:()=>eo,DirectionalLight:()=>Xn,FillStyleExtension:()=>Xk,FirstPersonController:()=>lo,FirstPersonView:()=>DP,FirstPersonViewport:()=>ao,FlyToInterpolator:()=>rs,Fp64Extension:()=>Vk,FullscreenWidget:()=>x_,GeoJsonLayer:()=>_o,GeohashLayer:()=>UU,GoogleMapsOverlay:()=>ad,GreatCircleLayer:()=>AO,GridCellLayer:()=>PR,GridLayer:()=>Z5,H3ClusterLayer:()=>iL,H3HexagonLayer:()=>ec,HeatmapLayer:()=>g8,HexagonLayer:()=>d5,IconLayer:()=>ja,Layer:()=>ut,LayerExtension:()=>ce,LayerManager:()=>Ji,LightGlassTheme:()=>Ift,LightTheme:()=>Pft,LightingEffect:()=>Hs,LineLayer:()=>aR,LinearInterpolator:()=>Ee,MVTLayer:()=>BU,MapController:()=>to,MapView:()=>qs,MapboxOverlay:()=>fd,MaskExtension:()=>Qk,OPERATION:()=>Tw,OrbitController:()=>ho,OrbitView:()=>kP,OrbitViewport:()=>oo,OrthographicController:()=>fo,OrthographicView:()=>UP,OrthographicViewport:()=>es,PathLayer:()=>Mn,PathStyleExtension:()=>Gk,PointCloudLayer:()=>Zg,PointLight:()=>Na,PolygonLayer:()=>ei,PostProcessEffect:()=>Sh,QuadkeyLayer:()=>NO,S2Layer:()=>OO,ScatterplotLayer:()=>Jg,ScenegraphLayer:()=>s0,ScreenGridLayer:()=>r5,SimpleMeshLayer:()=>So,SolidPolygonLayer:()=>ti,TRANSITION_EVENTS:()=>Ph,TerrainLayer:()=>Ek,Tesselator:()=>ns,TextLayer:()=>mm,Tile3DLayer:()=>mk,TileLayer:()=>bo,TransitionInterpolator:()=>Jn,TripsLayer:()=>tL,UNIT:()=>Lt,VERSION:()=>Rd,View:()=>Ge,Viewport:()=>oe,WebGLAggregator:()=>ne,WebMercatorViewport:()=>Re,ZoomWidget:()=>A_,_AggregationLayer:()=>Ln,_CameraLight:()=>mh,_Component:()=>Wa,_ComponentState:()=>io,_GeoCellLayer:()=>En,_GlobeController:()=>uo,_GlobeView:()=>Xg,_GlobeViewport:()=>Xr,_LayersPass:()=>Me,_MultiIconLayer:()=>dm,_PickLayersPass:()=>Ur,_SunLight:()=>_h,_TerrainExtension:()=>nU,_TextBackgroundLayer:()=>gm,_Tile2DHeader:()=>To,_Tileset2D:()=>Eo,_WMSLayer:()=>Qa,_applyStyles:()=>Yr,_compareProps:()=>Ha,_count:()=>kg,_deepEqual:()=>tt,_fillArray:()=>ig,_flatten:()=>We,_getURLFromTemplate:()=>Sn,_memoize:()=>Je,_mergeShaders:()=>Ks,_registerLoggers:()=>Pd,_removeStyles:()=>Zs,assert:()=>yt,createIterable:()=>Yt,fp64LowPart:()=>Oa,getShaderAssembler:()=>Yp,gouraudLighting:()=>Cp,log:()=>k,phongLighting:()=>Pp,picking:()=>Tt,project:()=>qt,project32:()=>st,project64:()=>S1,shadow:()=>Ca});async function sr(e,t,r,n){return n._parse(e,t,r,n)}function nt(e,t){if(!e)throw new Error(t||"loader assertion failed.")}var nn={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},$8=nn.self||nn.window||nn.global||{},K8=nn.window||nn.self||nn.global||{},Z8=nn.global||nn.self||nn.window||{},J8=nn.document||{};var Bn=Boolean(typeof process!="object"||String(process)!=="[object process]"||process.browser);var Vb=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),Q8=Vb&&parseFloat(Vb[1])||0;var pd=globalThis,tz=globalThis.document||{},gd=globalThis.process||{},ez=globalThis.console,Hb=globalThis.navigator||{};function md(e){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&Boolean(process.versions?.electron))return!0;let t=typeof navigator<"u"&&navigator.userAgent,r=e||t;return Boolean(r&&r.indexOf("Electron")>=0)}function Ve(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||md()}function T_(e){return!e&&!Ve()?"Node":md(e)?"Electron":(e||Hb.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}var M_="4.1.0";function nz(e){try{let t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch{return null}}var _d=class{constructor(t,r,n="sessionStorage"){this.storage=nz(n),this.id=t,this.config=r,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){let r=JSON.stringify(this.config);this.storage.setItem(this.id,r)}}_loadConfiguration(){let t={};if(this.storage){let r=this.storage.getItem(this.id);t=r?JSON.parse(r):{}}return Object.assign(this.config,t),this}};function Wb(e){let t;return e<10?t=`${e.toFixed(2)}ms`:e<100?t=`${e.toFixed(1)}ms`:e<1e3?t=`${e.toFixed(0)}ms`:t=`${(e/1e3).toFixed(2)}s`,t}function Gb(e,t=8){let r=Math.max(t-e.length,0);return`${" ".repeat(r)}${e}`}var xd;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(xd||(xd={}));var sz=10;function jb(e){return typeof e!="string"?e:(e=e.toUpperCase(),xd[e]||xd.WHITE)}function qb(e,t,r){return!Ve&&typeof e=="string"&&(t&&(e=`\x1B[${jb(t)}m${e}\x1B[39m`),r&&(e=`\x1B[${jb(r)+sz}m${e}\x1B[49m`)),e}function Xb(e,t=["constructor"]){let r=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(r),s=e;for(let i of n){let o=s[i];typeof o=="function"&&(t.find(a=>i===a)||(s[i]=o.bind(e)))}}function dl(e,t){if(!e)throw new Error(t||"Assertion failed")}function wi(){let e;if(Ve()&&pd.performance)e=pd?.performance?.now?.();else if("hrtime"in gd){let t=gd?.hrtime?.();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}var Yo={debug:Ve()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},iz={enabled:!0,level:0};function $o(){}var Yb={},$b={once:!0},Ke=class{constructor({id:t}={id:""}){this.VERSION=M_,this._startTs=wi(),this._deltaTs=wi(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new _d(`__probe-${this.id}__`,iz),this.timeStamp(`${this.id} started`),Xb(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((wi()-this._startTs).toPrecision(10))}getDelta(){return Number((wi()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,r){this._storage.setConfiguration({[t]:r})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,r){if(!t)throw new Error(r||"Assertion failed")}warn(t){return this._getLogFunction(0,t,Yo.warn,arguments,$b)}error(t){return this._getLogFunction(0,t,Yo.error,arguments)}deprecated(t,r){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${r}\` instead`)}removed(t,r){return this.error(`\`${t}\` has been removed. Use \`${r}\` instead`)}probe(t,r){return this._getLogFunction(t,r,Yo.log,arguments,{time:!0,once:!0})}log(t,r){return this._getLogFunction(t,r,Yo.debug,arguments)}info(t,r){return this._getLogFunction(t,r,console.info,arguments)}once(t,r){return this._getLogFunction(t,r,Yo.debug||Yo.info,arguments,$b)}table(t,r,n){return r?this._getLogFunction(t,r,console.table||$o,n&&[n],{tag:az(r)}):$o}time(t,r){return this._getLogFunction(t,r,console.time?console.time:console.info)}timeEnd(t,r){return this._getLogFunction(t,r,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,r){return this._getLogFunction(t,r,console.timeStamp||$o)}group(t,r,n={collapsed:!1}){let s=Kb({logLevel:t,message:r,opts:n}),{collapsed:i}=n;return s.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(s)}groupCollapsed(t,r,n={}){return this.group(t,r,Object.assign({},n,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||$o)}withGroup(t,r,n){this.group(t,r)();try{n()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=Zb(t)}_getLogFunction(t,r,n,s,i){if(this._shouldLog(t)){i=Kb({logLevel:t,message:r,args:s,opts:i}),n=n||i.method,dl(n),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=wi();let o=i.tag||i.message;if(i.once&&o)if(!Yb[o])Yb[o]=wi();else return $o;return r=oz(this.id,i.message,i),n.bind(console,r,...i.args)}return $o}};Ke.VERSION=M_;function Zb(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return dl(Number.isFinite(t)&&t>=0),t}function Kb(e){let{logLevel:t,message:r}=e;e.logLevel=Zb(t);let n=e.args?Array.from(e.args):[];for(;n.length&&n.shift()!==r;);switch(typeof t){case"string":case"function":r!==void 0&&n.unshift(r),e.message=t;break;case"object":Object.assign(e,t);break;default:}typeof e.message=="function"&&(e.message=e.message());let s=typeof e.message;return dl(s==="string"||s==="object"),Object.assign(e,{args:n},e.opts)}function oz(e,t,r){if(typeof t=="string"){let n=r.time?Gb(Wb(r.total)):"";t=r.time?`${e}: ${n}  ${t}`:`${e}: ${t}`,t=qb(t,r.color,r.background)}return t}function az(e){for(let t in e)for(let r in e[t])return r||"untitled";return"empty"}globalThis.probe={};var E_=new Ke({id:"@probe.gl/log"});function pl(e,t){return Jb(e||{},t)}function Jb(e,t,r=0){if(r>3)return t;let n={...e};for(let[s,i]of Object.entries(t))i&&typeof i=="object"&&!Array.isArray(i)?n[s]=Jb(n[s]||{},t[s],r+1):n[s]=t[s];return n}function b_(e){globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,e)}function S_(e){return globalThis.loaders?.modules?.[e]||null}var Qb="latest";function cz(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.1"),globalThis._loadersgl_.version}var gl=cz();function Ae(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}var sn={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},Mut=sn.self||sn.window||sn.global||{},Eut=sn.window||sn.self||sn.global||{},but=sn.global||sn.self||sn.window||{},Sut=sn.document||{};var de=typeof process!="object"||String(process)!=="[object process]"||process.browser,ml=typeof importScripts=="function",eS=typeof window<"u"&&typeof window.orientation<"u",tS=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),vut=tS&&parseFloat(tS[1])||0;var _l=class{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(t,r){this.name=t,this.workerThread=r,this.result=new Promise((n,s)=>{this._resolve=n,this._reject=s})}postMessage(t,r){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:r})}done(t){Ae(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Ae(this.isRunning),this.isRunning=!1,this._reject(t)}};var Ko=class{terminate(){}};var v_=new Map;function rS(e){Ae(e.source&&!e.url||!e.source&&e.url);let t=v_.get(e.source||e.url);return t||(e.url&&(t=lz(e.url),v_.set(e.url,t)),e.source&&(t=nS(e.source),v_.set(e.source,t))),Ae(t),t}function lz(e){if(!e.startsWith("http"))return e;let t=hz(e);return nS(t)}function nS(e){let t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function hz(e){return`try {
    importScripts('${e}');
  } catch (error) {
    console.error(error);
    throw error;
  }`}function w_(e,t=!0,r){let n=r||new Set;if(e){if(sS(e))n.add(e);else if(sS(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(t&&typeof e=="object")for(let s in e)w_(e[s],t,n)}}return r===void 0?Array.from(n):[]}function sS(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}var C_=()=>{},As=class{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return typeof Worker<"u"&&de||typeof Ko<"u"&&!de}constructor(t){let{name:r,source:n,url:s}=t;Ae(n||s),this.name=r,this.source=n,this.url=s,this.onMessage=C_,this.onError=i=>console.log(i),this.worker=de?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=C_,this.onError=C_,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(t,r){r=r||w_(t),this.worker.postMessage(t,r)}_getErrorFromErrorEvent(t){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,t.message&&(r+=`${t.message} in `),t.lineno&&(r+=`:${t.lineno}:${t.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=rS({source:this.source,url:this.url});let t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=r=>{r.data?this.onMessage(r.data):this.onError(new Error("No data received"))},t.onerror=r=>{this.onError(this._getErrorFromErrorEvent(r)),this.terminated=!0},t.onmessageerror=r=>console.error(r),t}_createNodeWorker(){let t;if(this.url){let n=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new Ko(n,{eval:!1})}else if(this.source)t=new Ko(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",r=>{this.onMessage(r)}),t.on("error",r=>{this.onError(r)}),t.on("exit",r=>{}),t}};var xl=class{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return As.isSupported()}constructor(t){this.source=t.source,this.url=t.url,this.setProps(t)}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,r=(s,i,o)=>s.done(o),n=(s,i)=>s.error(i)){let s=new Promise(i=>(this.jobQueue.push({name:t,onMessage:r,onError:n,onStart:i}),this));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;let t=this._getAvailableWorker();if(!t)return;let r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:t,backlog:this.jobQueue.length});let n=new _l(r.name,t);t.onMessage=s=>r.onMessage(n,s.type,s.payload),t.onError=s=>r.onError(n,s),r.onStart(n);try{await n.result}catch(s){console.error(`Worker exception: ${s}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!de||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;let t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new As({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return eS?this.maxMobileConcurrency:this.maxConcurrency}};var fz={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Ci=class{props;workerPools=new Map;static isSupported(){return As.isSupported()}static getWorkerFarm(t={}){return Ci._workerFarm=Ci._workerFarm||new Ci({}),Ci._workerFarm.setProps(t),Ci._workerFarm}constructor(t){this.props={...fz},this.setProps(t),this.workerPools=new Map}destroy(){for(let t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(let r of this.workerPools.values())r.setProps(this._getWorkerPoolProps())}getWorkerPool(t){let{name:r,source:n,url:s}=t,i=this.workerPools.get(r);return i||(i=new xl({name:r,source:n,url:s}),i.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,i)),i}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}},Ts=Ci;H(Ts,"_workerFarm");function P_(e,t={}){let r=t[e.id]||{},n=de?`${e.id}-worker.js`:`${e.id}-worker-node.js`,s=r.workerUrl;if(!s&&e.id==="compression"&&(s=t.workerUrl),t._workerType==="test"&&(de?s=`modules/${e.module}/dist/${n}`:s=`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!s){let i=e.version;i==="latest"&&(i=Qb);let o=i?`@${i}`:"";s=`https://unpkg.com/@loaders.gl/${e.module}${o}/dist/${n}`}return Ae(s),s}function R_(e,t=gl){Ae(e,"no worker provided");let r=e.version;return!(!t||!r)}var I_={};async function on(e,t=null,r={},n=null){return t&&(e=iS(e,t,r,n)),I_[e]=I_[e]||uz(e),await I_[e]}function iS(e,t,r={},n=null){if(!r.useLocalLibraries&&e.startsWith("http"))return e;n=n||e;let s=r.modules||{};return s[n]?s[n]:de?r.CDN?(Ae(r.CDN.startsWith("http")),`${r.CDN}/${t}@${gl}/dist/libs/${n}`):ml?`../src/libs/${n}`:`modules/${t}/src/libs/${n}`:`modules/${t}/dist/libs/${n}`}async function uz(e){if(e.endsWith("wasm"))return await pz(e);if(!de)try{let{requireFromFile:r}=globalThis.loaders||{};return await r?.(e)}catch(r){return console.error(r),null}if(ml)return importScripts(e);let t=await gz(e);return dz(t,e)}function dz(e,t){if(!de){let{requireFromString:n}=globalThis.loaders||{};return n?.(e,t)}if(ml)return eval.call(globalThis,e),null;let r=document.createElement("script");r.id=t;try{r.appendChild(document.createTextNode(e))}catch{r.text=e}return document.body.appendChild(r),null}async function pz(e){let{readFileAsArrayBuffer:t}=globalThis.loaders||{};return de||!t||e.startsWith("http")?await(await fetch(e)).arrayBuffer():await t(e)}async function gz(e){let{readFileAsText:t}=globalThis.loaders||{};return de||!t||e.startsWith("http")?await(await fetch(e)).text():await t(e)}function O_(e,t){return!Ts.isSupported()||!de&&!t?._nodeWorkers?!1:e.worker&&t?.worker}async function L_(e,t,r,n,s){let i=e.id,o=P_(e,r),c=Ts.getWorkerFarm(r).getWorkerPool({name:i,url:o});r=JSON.parse(JSON.stringify(r)),n=JSON.parse(JSON.stringify(n||{}));let l=await c.startJob("process-on-worker",mz.bind(null,s));return l.postMessage("process",{input:t,options:r,context:n}),await(await l.result).result}async function mz(e,t,r,n){switch(r){case"done":t.done(n);break;case"error":t.error(new Error(n.error));break;case"process":let{id:s,input:i,options:o}=n;try{let a=await e(i,o);t.postMessage("done",{id:s,result:a})}catch(a){let c=a instanceof Error?a.message:"unknown error";t.postMessage("error",{id:s,error:c})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}function aS(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?oS(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?oS(e,0,t):""}function oS(e,t,r){if(e.byteLength<=t+r)return"";let n=new DataView(e),s="";for(let i=0;i<r;i++)s+=String.fromCharCode(n.getUint8(t+i));return s}function N_(e){try{return JSON.parse(e)}catch{throw new Error(`Failed to parse JSON from data starting with "${aS(e)}"`)}}function B_(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;let n=new Uint8Array(e),s=new Uint8Array(t);for(let i=0;i<n.length;++i)if(n[i]!==s[i])return!1;return!0}function F_(...e){return cS(e)}function cS(e){let t=e.map(i=>i instanceof ArrayBuffer?new Uint8Array(i):i),r=t.reduce((i,o)=>i+o.byteLength,0),n=new Uint8Array(r),s=0;for(let i of t)n.set(i,s),s+=i.byteLength;return n.buffer}function yl(...e){let t=e,r=t&&t.length>1&&t[0].constructor||null;if(!r)throw new Error('"concatenateTypedArrays" - incorrect quantity of arguments or arguments have incompatible data types');let n=t.reduce((o,a)=>o+a.length,0),s=new r(n),i=0;for(let o of t)s.set(o,i),i+=o.length;return s}function Pi(e,t,r){let n=r!==void 0?new Uint8Array(e).subarray(t,t+r):new Uint8Array(e).subarray(t);return new Uint8Array(n).buffer}function Ms(e,t){return nt(e>=0),nt(t>0),e+(t-1)&~(t-1)}function D_(e,t,r){let n;if(e instanceof ArrayBuffer)n=new Uint8Array(e);else{let s=e.byteOffset,i=e.byteLength;n=new Uint8Array(e.buffer||e.arrayBuffer,s,i)}return t.set(n,r),r+Ms(n.byteLength,4)}async function k_(e){let t=[];for await(let r of e)t.push(r);return F_(...t)}function Al(){let e;if(typeof window<"u"&&window.performance)e=window.performance.now();else if(typeof process<"u"&&process.hrtime){let t=process.hrtime();e=t[0]*1e3+t[1]/1e6}else e=Date.now();return e}var Ri=class{constructor(t,r){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=t,this.type=r,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(t){return this.sampleSize=t,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(t){return this._count+=t,this._samples++,this._checkSampling(),this}subtractCount(t){return this._count-=t,this._samples++,this._checkSampling(),this}addTime(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Al(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Al()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}};var we=class{constructor(t){this.stats={},this.id=t.id,this.stats={},this._initializeStats(t.stats),Object.seal(this)}get(t,r="count"){return this._getOrCreate({name:t,type:r})}get size(){return Object.keys(this.stats).length}reset(){for(let t of Object.values(this.stats))t.reset();return this}forEach(t){for(let r of Object.values(this.stats))t(r)}getTable(){let t={};return this.forEach(r=>{t[r.name]={time:r.time||0,count:r.count||0,average:r.getAverageTime()||0,hz:r.getHz()||0}}),t}_initializeStats(t=[]){t.forEach(r=>this._getOrCreate(r))}_getOrCreate(t){let{name:r,type:n}=t,s=this.stats[r];return s||(t instanceof Ri?s=t:s=new Ri(r,n),this.stats[r]=s),s}};var _z="Queued Requests",xz="Active Requests",yz="Cancelled Requests",Az="Queued Requests Ever",Tz="Active Requests Ever",Mz={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0},Es=class{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(t={}){this.props={...Mz,...t},this.stats=new we({id:this.props.id}),this.stats.get(_z),this.stats.get(xz),this.stats.get(yz),this.stats.get(Az),this.stats.get(Tz)}scheduleRequest(t,r=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(t))return this.requestMap.get(t);let n={handle:t,priority:0,getPriority:r},s=new Promise(i=>(n.resolve=i,n));return this.requestQueue.push(n),this.requestMap.set(t,s),this._issueNewRequests(),s}_issueRequest(t){let{handle:r,resolve:n}=t,s=!1,i=()=>{s||(s=!0,this.requestMap.delete(r),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,n?n({done:i}):Promise.resolve({done:i})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;let t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(t!==0){this._updateAllRequests();for(let r=0;r<t;++r){let n=this.requestQueue.shift();n&&this._issueRequest(n)}}}_updateAllRequests(){let t=this.requestQueue;for(let r=0;r<t.length;++r){let n=t[r];this._updateRequest(n)||(t.splice(r,1),this.requestMap.delete(n.handle),r--)}t.sort((r,n)=>r.priority-n.priority)}_updateRequest(t){return t.priority=t.getPriority(t.handle),t.priority<0?(t.resolve(null),!1):!0}};var Ez="",lS={};function U_(e){for(let t in lS)if(e.startsWith(t)){let r=lS[t];e=e.replace(t,r)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`${Ez}${e}`),e}function hS(e){return e&&typeof e=="object"&&e.isBuffer}function yd(e){if(hS(e))return e;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){let t=e;return new TextEncoder().encode(t).buffer}if(e&&typeof e=="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}var ir={};Bt(ir,{dirname:()=>Sz,filename:()=>bz,join:()=>vz,resolve:()=>wz});function fS(){if(typeof process<"u"&&typeof process.cwd<"u")return process.cwd();let e=window.location?.pathname;return e?.slice(0,e.lastIndexOf("/")+1)||""}function bz(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function Sz(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function vz(...e){let t="/";return e=e.map((r,n)=>(n&&(r=r.replace(new RegExp(`^${t}`),"")),n!==e.length-1&&(r=r.replace(new RegExp(`${t}$`),"")),r)),e.join(t)}function wz(...e){let t=[];for(let i=0;i<e.length;i++)t[i]=e[i];let r="",n=!1,s;for(let i=t.length-1;i>=-1&&!n;i--){let o;i>=0?o=t[i]:(s===void 0&&(s=fS()),o=s),o.length!==0&&(r=`${o}/${r}`,n=o.charCodeAt(0)===Tl)}return r=Cz(r,!n),n?`/${r}`:r.length>0?r:"."}var Tl=47,z_=46;function Cz(e,t){let r="",n=-1,s=0,i,o=!1;for(let a=0;a<=e.length;++a){if(a<e.length)i=e.charCodeAt(a);else{if(i===Tl)break;i=Tl}if(i===Tl){if(!(n===a-1||s===1))if(n!==a-1&&s===2){if(r.length<2||!o||r.charCodeAt(r.length-1)!==z_||r.charCodeAt(r.length-2)!==z_){if(r.length>2){let c=r.length-1,l=c;for(;l>=0&&r.charCodeAt(l)!==Tl;--l);if(l!==c){r=l===-1?"":r.slice(0,l),n=a,s=0,o=!1;continue}}else if(r.length===2||r.length===1){r="",n=a,s=0,o=!1;continue}}t&&(r.length>0?r+="/..":r="..",o=!0)}else{let c=e.slice(n+1,a);r.length>0?r+=`/${c}`:r=c,o=!1}n=a,s=0}else i===z_&&s!==-1?++s:s=-1}return r}var Ad=class{fetch;loadOptions;_needsRefresh=!0;props;constructor(t){this.props={...t},this.loadOptions={...t.loadOptions},this.fetch=Pz(this.loadOptions)}setProps(t){this.props=Object.assign(this.props,t),this.setNeedsRefresh()}setNeedsRefresh(){this._needsRefresh=!0}getNeedsRefresh(t=!0){let r=this._needsRefresh;return t&&(this._needsRefresh=!1),r}};function Pz(e){let t=e?.fetch;if(t&&typeof t=="function")return(n,s)=>t(n,s);let r=e?.fetch;return r&&typeof r!="function"?n=>fetch(n,r):n=>fetch(n)}var pr=class extends Ad{};H(pr,"type","template"),H(pr,"testURL",t=>!1);var Rz=e=>typeof e=="boolean",Ml=e=>typeof e=="function",Ii=e=>e!==null&&typeof e=="object",V_=e=>Ii(e)&&e.constructor==={}.constructor;var uS=e=>Boolean(e)&&typeof e[Symbol.iterator]=="function",dS=e=>e&&typeof e[Symbol.asyncIterator]=="function";var gr=e=>typeof Response<"u"&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json;var mr=e=>typeof Blob<"u"&&e instanceof Blob,pS=e=>e&&typeof e=="object"&&e.isBuffer;var Iz=e=>typeof ReadableStream<"u"&&e instanceof ReadableStream||Ii(e)&&Ml(e.tee)&&Ml(e.cancel)&&Ml(e.getReader);var Oz=e=>Ii(e)&&Ml(e.read)&&Ml(e.pipe)&&Rz(e.readable),Td=e=>Iz(e)||Oz(e);var Md=class extends Error{constructor(t,r){super(t),this.reason=r.reason,this.url=r.url,this.response=r.response}reason;url;response};var Lz=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Nz=/^([-\w.]+\/[-\w.+]+)/;function H_(e,t){return e.toLowerCase()===t.toLowerCase()}function gS(e){let t=Nz.exec(e);return t?t[1]:e}function W_(e){let t=Lz.exec(e);return t?t[1]:""}var mS=/\?.*/;function _S(e){let t=e.match(mS);return t&&t[0]}function Zo(e){return e.replace(mS,"")}function xS(e){if(e.length<50)return e;let t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}function Oi(e){return gr(e)?e.url:mr(e)?e.name||"":typeof e=="string"?e:""}function El(e){if(gr(e)){let t=e,r=t.headers.get("content-type")||"",n=Zo(t.url);return gS(r)||W_(n)}return mr(e)?e.type||"":typeof e=="string"?W_(e):""}function yS(e){return gr(e)?e.headers["content-length"]||-1:mr(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}async function Ed(e){if(gr(e))return e;let t={},r=yS(e);r>=0&&(t["content-length"]=String(r));let n=Oi(e),s=El(e);s&&(t["content-type"]=s);let i=await Fz(e);i&&(t["x-first-bytes"]=i),typeof e=="string"&&(e=new TextEncoder().encode(e));let o=new Response(e,{headers:t});return Object.defineProperty(o,"url",{value:n}),o}async function AS(e){if(!e.ok)throw await Bz(e)}async function Bz(e){let t=xS(e.url),r=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;r=r.length>100?`${r.slice(0,100)}...`:r;let n={reason:e.statusText,url:e.url,response:e};try{let s=e.headers.get("Content-Type");n.reason=s?.includes("application/json")?await e.json():e.text()}catch{}return new Md(r,n)}async function Fz(e){if(typeof e=="string")return`data:,${e.slice(0,5)}`;if(e instanceof Blob){let r=e.slice(0,5);return await new Promise(n=>{let s=new FileReader;s.onload=i=>n(i?.target?.result),s.readAsDataURL(r)})}if(e instanceof ArrayBuffer){let r=e.slice(0,5);return`data:base64,${Dz(r)}`}return null}function Dz(e){let t="",r=new Uint8Array(e);for(let n=0;n<r.byteLength;n++)t+=String.fromCharCode(r[n]);return btoa(t)}function kz(e){return!Uz(e)&&!zz(e)}function Uz(e){return e.startsWith("http:")||e.startsWith("https:")}function zz(e){return e.startsWith("data:")}async function Jo(e,t){if(typeof e=="string"){let r=U_(e);return kz(r)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,t):await fetch(r,t)}return await Ed(e)}var G_=new Ke({id:"loaders.gl"}),bd=class{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}},Sd=class{console;constructor(){this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}};var j_={fetch:null,mimeType:void 0,nothrow:!1,log:new Sd,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Bn,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},TS={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function q_(){globalThis.loaders=globalThis.loaders||{};let{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function X_(){let e=q_();return e.globalOptions=e.globalOptions||{...j_},e.globalOptions}function bS(e,t,r,n){return r=r||[],r=Array.isArray(r)?r:[r],Vz(e,r),Wz(t,e,n)}function Vz(e,t){MS(e,null,j_,TS,t);for(let r of t){let n=e&&e[r.id]||{},s=r.options&&r.options[r.id]||{},i=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};MS(n,r.id,s,i,t)}}function MS(e,t,r,n,s){let i=t||"Top level",o=t?`${t}.`:"";for(let a in e){let c=!t&&Ii(e[a]),l=a==="baseUri"&&!t,h=a==="workerUrl"&&t;if(!(a in r)&&!l&&!h){if(a in n)G_.warn(`${i} loader option '${o}${a}' no longer supported, use '${n[a]}'`)();else if(!c){let f=Hz(a,s);G_.warn(`${i} loader option '${o}${a}' not recognized. ${f}`)()}}}}function Hz(e,t){let r=e.toLowerCase(),n="";for(let s of t)for(let i in s.options){if(e===i)return`Did you mean '${s.id}.${i}'?`;let o=i.toLowerCase();(r.startsWith(o)||o.startsWith(r))&&(n=n||`Did you mean '${s.id}.${i}'?`)}return n}function Wz(e,t,r){let s={...e.options||{}};return Gz(s,r),s.log===null&&(s.log=new bd),ES(s,X_()),ES(s,t),s}function ES(e,t){for(let r in t)if(r in t){let n=t[r];V_(n)&&V_(e[r])?e[r]={...e[r],...t[r]}:e[r]=t[r]}}function Gz(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)}function bl(e){return e?(Array.isArray(e)&&(e=e[0]),Array.isArray(e?.extensions)):!1}function Sl(e){nt(e,"null loader"),nt(bl(e),"invalid loader");let t;return Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}var SS=()=>{let e=q_();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function vl(e){let t=SS();e=Array.isArray(e)?e:[e];for(let r of e){let n=Sl(r);t.find(s=>n===s)||t.unshift(n)}}function vS(){return SS()}var wS=new Ke({id:"loaders.gl"});var jz=/\.([^.]+)$/;async function RS(e,t=[],r,n){if(!IS(e))return null;let s=CS(e,t,{...r,nothrow:!0},n);if(s)return s;if(mr(e)&&(e=await e.slice(0,10).arrayBuffer(),s=CS(e,t,r,n)),!s&&!r?.nothrow)throw new Error(OS(e));return s}function CS(e,t=[],r,n){if(!IS(e))return null;if(t&&!Array.isArray(t))return Sl(t);let s=[];t&&(s=s.concat(t)),r?.ignoreRegisteredLoaders||s.push(...vS()),Xz(s);let i=qz(e,s,r,n);if(!i&&!r?.nothrow)throw new Error(OS(e));return i}function qz(e,t,r,n){let s=Oi(e),i=El(e),o=Zo(s)||n?.url,a=null,c="";return r?.mimeType&&(a=Y_(t,r?.mimeType),c=`match forced by supplied MIME type ${r?.mimeType}`),a=a||Yz(t,o),c=c||(a?`matched url ${o}`:""),a=a||Y_(t,i),c=c||(a?`matched MIME type ${i}`:""),a=a||Kz(t,e),c=c||(a?`matched initial data ${LS(e)}`:""),r?.fallbackMimeType&&(a=a||Y_(t,r?.fallbackMimeType),c=c||(a?`matched fallback MIME type ${i}`:"")),c&&wS.log(1,`selectLoader selected ${a?.name}: ${c}.`),a}function IS(e){return!(e instanceof Response&&e.status===204)}function OS(e){let t=Oi(e),r=El(e),n="No valid loader found (";n+=t?`${ir.filename(t)}, `:"no url provided, ",n+=`MIME type: ${r?`"${r}"`:"not provided"}, `;let s=e?LS(e):"";return n+=s?` first bytes: "${s}"`:"first bytes: not available",n+=")",n}function Xz(e){for(let t of e)Sl(t)}function Yz(e,t){let r=t&&jz.exec(t),n=r&&r[1];return n?$z(e,n):null}function $z(e,t){t=t.toLowerCase();for(let r of e)for(let n of r.extensions)if(n.toLowerCase()===t)return r;return null}function Y_(e,t){for(let r of e)if(r.mimeTypes?.some(n=>H_(t,n))||H_(t,`application/x.${r.id}`))return r;return null}function Kz(e,t){if(!t)return null;for(let r of e)if(typeof t=="string"){if(Zz(t,r))return r}else if(ArrayBuffer.isView(t)){if(PS(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer&&PS(t,0,r))return r;return null}function Zz(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(n=>e.startsWith(n))}function PS(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(s=>Jz(e,t,r,s))}function Jz(e,t,r,n){if(n instanceof ArrayBuffer)return B_(n,e,n.byteLength);switch(typeof n){case"function":return n(e);case"string":let s=$_(e,t,n.length);return n===s;default:return!1}}function LS(e,t=5){return typeof e=="string"?e.slice(0,t):ArrayBuffer.isView(e)?$_(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?$_(e,0,t):""}function $_(e,t,r){if(e.byteLength<t+r)return"";let n=new DataView(e),s="";for(let i=0;i<r;i++)s+=String.fromCharCode(n.getUint8(t+i));return s}function*NS(e,t){let r=t?.chunkSize||262144,n=0,s=new TextEncoder;for(;n<e.length;){let i=Math.min(e.length-n,r),o=e.slice(n,n+i);n+=i,yield s.encode(o)}}function*BS(e,t={}){let{chunkSize:r=262144}=t,n=0;for(;n<e.byteLength;){let s=Math.min(e.byteLength-n,r),i=new ArrayBuffer(s),o=new Uint8Array(e,n,s);new Uint8Array(i).set(o),n+=s,yield i}}async function*FS(e,t){let r=t?.chunkSize||1048576,n=0;for(;n<e.size;){let s=n+r,i=await e.slice(n,s).arrayBuffer();n=s,yield i}}function K_(e,t){return Bn?Qz(e,t):tV(e,t)}async function*Qz(e,t){let r=e.getReader(),n;try{for(;;){let s=n||r.read();t?._streamReadAhead&&(n=r.read());let{done:i,value:o}=await s;if(i)return;yield yd(o)}}catch{r.releaseLock()}}async function*tV(e,t){for await(let r of e)yield yd(r)}function DS(e,t){if(typeof e=="string")return NS(e,t);if(e instanceof ArrayBuffer)return BS(e,t);if(mr(e))return FS(e,t);if(Td(e))return K_(e,t);if(gr(e))return K_(e.body,t);throw new Error("makeIterator")}var kS="Cannot convert supplied data type";function eV(e,t,r){if(t.text&&typeof e=="string")return e;if(pS(e)&&(e=e.buffer),e instanceof ArrayBuffer){let n=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(n):n}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let n=e.buffer,s=e.byteLength||e.length;return(e.byteOffset!==0||s!==n.byteLength)&&(n=n.slice(e.byteOffset,e.byteOffset+s)),n}throw new Error(kS)}async function US(e,t,r){let n=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if(typeof e=="string"||n)return eV(e,t,r);if(mr(e)&&(e=await Ed(e)),gr(e)){let s=e;return await AS(s),t.binary?await s.arrayBuffer():await s.text()}if(Td(e)&&(e=DS(e,r)),uS(e)||dS(e))return k_(e);throw new Error(kS)}function vd(e,t){let r=X_(),n=e||r;return typeof n.fetch=="function"?n.fetch:Ii(n.fetch)?s=>Jo(s,n.fetch):t?.fetch?t?.fetch:Jo}function zS(e,t,r){if(r)return r;let n={fetch:vd(t,e),...e};if(n.url){let s=Zo(n.url);n.baseUrl=s,n.queryString=_S(n.url),n.filename=ir.filename(s),n.baseUrl=ir.dirname(s)}return Array.isArray(n.loaders)||(n.loaders=null),n}function VS(e,t){if(e&&!Array.isArray(e))return e;let r;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){let n=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...n]:n}return r&&r.length?r:void 0}async function bs(e,t,r,n){t&&!Array.isArray(t)&&!bl(t)&&(n=void 0,r=t,t=void 0),e=await e,r=r||{};let s=Oi(e),o=VS(t,n),a=await RS(e,o,r);return a?(r=bS(r,a,o,s),n=zS({url:s,_parse:bs,loaders:o},r,n||null),await rV(a,e,r,n)):null}async function rV(e,t,r,n){if(R_(e),r=pl(e.options,r),gr(t)){let i=t,{ok:o,redirected:a,status:c,statusText:l,type:h,url:f}=i,u=Object.fromEntries(i.headers.entries());n.response={headers:u,ok:o,redirected:a,status:c,statusText:l,type:h,url:f}}t=await US(t,e,r);let s=e;if(s.parseTextSync&&typeof t=="string")return s.parseTextSync(t,r,n);if(O_(e,r))return await L_(e,t,r,n,bs);if(s.parseText&&typeof t=="string")return await s.parseText(t,r,n);if(s.parse)return await s.parse(t,r,n);throw Ae(!s.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}function HS(e){switch(e.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function Fn(e){let t=1/0,r=1/0,n=1/0,s=-1/0,i=-1/0,o=-1/0,a=e.POSITION?e.POSITION.value:[],c=a&&a.length;for(let l=0;l<c;l+=3){let h=a[l],f=a[l+1],u=a[l+2];t=h<t?h:t,r=f<r?f:r,n=u<n?u:n,s=h>s?h:s,i=f>i?f:i,o=u>o?u:o}return[[t,r,n],[s,i,o]]}function Z_(e,t,r){let n=HS(t.value),s=r||WS(t);return{name:e,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:n}]},nullable:!1,metadata:s}}function WS(e){let t={};return"byteOffset"in e&&(t.byteOffset=e.byteOffset.toString(10)),"byteStride"in e&&(t.byteStride=e.byteStride.toString(10)),"normalized"in e&&(t.normalized=e.normalized.toString()),t}async function se(e,t,r,n){let s,i;!Array.isArray(t)&&!bl(t)?(s=[],i=t,n=void 0):(s=t,i=r);let o=vd(i),a=e;return typeof e=="string"&&(a=await o(e)),mr(e)&&(a=await o(e)),Array.isArray(s)?await bs(a,s,i):await bs(a,s,i)}var GS="4.2.1";var nV=globalThis.loaders?.parseImageNode,J_=typeof Image<"u",Q_=typeof ImageBitmap<"u",sV=Boolean(nV),tx=Bn?!0:sV;function jS(e){switch(e){case"auto":return Q_||J_||tx;case"imagebitmap":return Q_;case"image":return J_;case"data":return tx;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}function qS(){if(Q_)return"imagebitmap";if(J_)return"image";if(tx)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function XS(e){let t=iV(e);if(!t)throw new Error("Not an image");return t}function wl(e){switch(XS(e)){case"data":return e;case"image":case"imagebitmap":let t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw new Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}function iV(e){return typeof ImageBitmap<"u"&&e instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&e instanceof Image?"image":e&&typeof e=="object"&&e.data&&e.width&&e.height?"data":null}var oV=/^data:image\/svg\+xml/,aV=/\.svg((\?|#).*)?$/;function wd(e){return e&&(oV.test(e)||aV.test(e))}function YS(e,t){if(wd(t)){let n=new TextDecoder().decode(e);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(n=unescape(encodeURIComponent(n)))}catch(i){throw new Error(i.message)}return`data:image/svg+xml;base64,${btoa(n)}`}return ex(e,t)}function ex(e,t){if(wd(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function Cd(e,t,r){let n=YS(e,r),s=self.URL||self.webkitURL,i=typeof n!="string"&&s.createObjectURL(n);try{return await cV(i||n,t)}finally{i&&s.revokeObjectURL(i)}}async function cV(e,t){let r=new Image;return r.src=e,t.image&&t.image.decode&&r.decode?(await r.decode(),r):await new Promise((n,s)=>{try{r.onload=()=>n(r),r.onerror=i=>{let o=i instanceof Error?i.message:"error";s(new Error(o))}}catch(i){s(i)}})}var lV={},$S=!0;async function KS(e,t,r){let n;wd(r)?n=await Cd(e,t,r):n=ex(e,r);let s=t&&t.imagebitmap;return await hV(n,s)}async function hV(e,t=null){if((fV(t)||!$S)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(r){console.warn(r),$S=!1}return await createImageBitmap(e)}function fV(e){for(let t in e||lV)return!1;return!0}function ZS(e){return!gV(e,"ftyp",4)||!(e[8]&96)?null:uV(e)}function uV(e){switch(dV(e,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function dV(e,t,r){return String.fromCharCode(...e.slice(t,r))}function pV(e){return[...e].map(t=>t.charCodeAt(0))}function gV(e,t,r=0){let n=pV(t);for(let s=0;s<n.length;++s)if(n[s]!==e[s+r])return!1;return!0}var an=!1,Cl=!0;function Li(e){let t=Pl(e);return _V(t)||AV(t)||xV(t)||yV(t)||mV(t)}function mV(e){let t=new Uint8Array(e instanceof DataView?e.buffer:e),r=ZS(t);return r?{mimeType:r.mimeType,width:0,height:0}:null}function _V(e){let t=Pl(e);return t.byteLength>=24&&t.getUint32(0,an)===2303741511?{mimeType:"image/png",width:t.getUint32(16,an),height:t.getUint32(20,an)}:null}function xV(e){let t=Pl(e);return t.byteLength>=10&&t.getUint32(0,an)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,Cl),height:t.getUint16(8,Cl)}:null}function yV(e){let t=Pl(e);return t.byteLength>=14&&t.getUint16(0,an)===16973&&t.getUint32(2,Cl)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,Cl),height:t.getUint32(22,Cl)}:null}function AV(e){let t=Pl(e);if(!(t.byteLength>=3&&t.getUint16(0,an)===65496&&t.getUint8(2)===255))return null;let{tableMarkers:n,sofMarkers:s}=TV(),i=2;for(;i+9<t.byteLength;){let o=t.getUint16(i,an);if(s.has(o))return{mimeType:"image/jpeg",height:t.getUint16(i+5,an),width:t.getUint16(i+7,an)};if(!n.has(o))return null;i+=2,i+=t.getUint16(i,an)}return null}function TV(){let e=new Set([65499,65476,65484,65501,65534]);for(let r=65504;r<65520;++r)e.add(r);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Pl(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}async function JS(e,t){let{mimeType:r}=Li(e)||{},n=globalThis.loaders?.parseImageNode;return nt(n),await n(e,r)}async function QS(e,t,r){t=t||{};let s=(t.image||{}).type||"auto",{url:i}=r||{},o=MV(s),a;switch(o){case"imagebitmap":a=await KS(e,t,i);break;case"image":a=await Cd(e,t,i);break;case"data":a=await JS(e,t);break;default:nt(!1)}return s==="data"&&(a=wl(a)),a}function MV(e){switch(e){case"auto":case"data":return qS();default:return jS(e),e}}var EV=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],bV=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],SV={image:{type:"auto",decode:!0}},cn={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:GS,mimeTypes:bV,extensions:EV,parse:QS,tests:[e=>Boolean(Li(new DataView(e)))],options:SV};var rx={};function nx(e){if(rx[e]===void 0){let t=Bn?wV(e):vV(e);rx[e]=t}return rx[e]}function vV(e){let t=["image/png","image/jpeg","image/gif"],r=globalThis.loaders?.imageFormatsNode||t,n=globalThis.loaders?.parseImageNode;return Boolean(n)&&r.includes(e)}function wV(e){switch(e){case"image/avif":case"image/webp":return CV(e);default:return!0}}function CV(e){try{return document.createElement("canvas").toDataURL(e).indexOf(`data:${e}`)===0}catch{return!1}}var PV=new Ke({id:"deck"}),k=PV;var sx={};function Pd(e){sx=e}function Gt(e,t,r,n){k.level>0&&sx[e]&&sx[e].call(null,t,r,n)}function RV(e){let t=e[0],r=e[e.length-1];return t==="{"&&r==="}"||t==="["&&r==="]"}var t3={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:RV,parseTextSync:JSON.parse};function IV(){let e="9.1.0",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw new Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);return t||(k.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:k,_registerLoggers:Pd},vl([t3,[cn,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}var Rd=IV();function Id(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}var ix={number:{type:"number",validate(e,t){return Number.isFinite(e)&&typeof t=="object"&&(t.max===void 0||e<=t.max)&&(t.min===void 0||e>=t.min)}},array:{type:"array",validate(e,t){return Array.isArray(e)||ArrayBuffer.isView(e)}}};function r3(e){let t={};for(let[r,n]of Object.entries(e))t[r]=OV(n);return t}function OV(e){let t=e3(e);if(t!=="object")return{value:e,...ix[t],type:t};if(typeof e=="object")return e?e.type!==void 0?{...e,...ix[e.type],type:e.type}:e.value===void 0?{type:"object",value:e}:(t=e3(e.value),{...e,...ix[t],type:t}):{type:"object",value:null};throw new Error("props")}function e3(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}var n3=`#ifdef MODULE_LOGDEPTH
    logdepth_adjustPosition(gl_Position);
  #endif
  `,s3=`#ifdef MODULE_MATERIAL
    fragColor = material_filterColor(fragColor);
  #endif
  
  #ifdef MODULE_LIGHTING
    fragColor = lighting_filterColor(fragColor);
  #endif
  
  #ifdef MODULE_FOG
    fragColor = fog_filterColor(fragColor);
  #endif
  
  #ifdef MODULE_PICKING
    fragColor = picking_filterHighlightColor(fragColor);
    fragColor = picking_filterPickingColor(fragColor);
  #endif
  
  #ifdef MODULE_LOGDEPTH
    logdepth_setFragDepth();
  #endif
  `;var LV={vertex:n3,fragment:s3},i3=/void\s+main\s*\([^)]*\)\s*\{\n?/,o3=/}\n?[^{}]*$/,ox=[],Rl="__LUMA_INJECT_DECLARATIONS__";function a3(e){let t={vertex:{},fragment:{}};for(let r in e){let n=e[r],s=NV(r);typeof n=="string"&&(n={order:0,injection:n}),t[s][r]=n}return t}function NV(e){let t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function Il(e,t,r,n=!1){let s=t==="vertex";for(let i in r){let o=r[i];o.sort((c,l)=>c.order-l.order),ox.length=o.length;for(let c=0,l=o.length;c<l;++c)ox[c]=o[c].injection;let a=`${ox.join(`
  `)}
  `;switch(i){case"vs:#decl":s&&(e=e.replace(Rl,a));break;case"vs:#main-start":s&&(e=e.replace(i3,c=>c+a));break;case"vs:#main-end":s&&(e=e.replace(o3,c=>a+c));break;case"fs:#decl":s||(e=e.replace(Rl,a));break;case"fs:#main-start":s||(e=e.replace(i3,c=>c+a));break;case"fs:#main-end":s||(e=e.replace(o3,c=>a+c));break;default:e=e.replace(i,c=>c+a)}}return e=e.replace(Rl,""),n&&(e=e.replace(/\}\s*$/,i=>i+LV[t])),e}function Ni(e){e.map(t=>Od(t))}function Od(e){if(e.instance)return;Ni(e.dependencies||[]);let{propTypes:t={},deprecations:r=[],inject:n={}}=e,s={normalizedInjections:a3(n),parsedDeprecations:BV(r)};t&&(s.propValidators=r3(t)),e.instance=s;let i={};t&&(i=Object.entries(t).reduce((o,[a,c])=>{let l=c?.value;return l&&(o[a]=l),o},{})),e.defaultUniforms={...e.defaultUniforms,...i}}function ax(e,t,r){e.deprecations?.forEach(n=>{n.regex?.test(t)&&(n.deprecated?r.deprecated(n.old,n.new)():r.removed(n.old,n.new)())})}function BV(e){return e.forEach(t=>{switch(t.type){case"function":t.regex=new RegExp(`\\b${t.old}\\(`);break;default:t.regex=new RegExp(`${t.type} ${t.old};`)}}),e}function Qo(e){Ni(e);let t={},r={};c3({modules:e,level:0,moduleMap:t,moduleDepth:r});let n=Object.keys(r).sort((s,i)=>r[i]-r[s]).map(s=>t[s]);return Ni(n),n}function c3(e){let{modules:t,level:r,moduleMap:n,moduleDepth:s}=e;if(r>=5)throw new Error("Possible loop in shader dependency graph");for(let i of t)n[i.name]=i,(s[i.name]===void 0||s[i.name]<r)&&(s[i.name]=r);for(let i of t)i.dependencies&&c3({modules:i.dependencies,level:r+1,moduleMap:n,moduleDepth:s})}function l3(e){switch(e?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
  // Apple optimizes away the calculation necessary for emulated fp64
  #define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
  #define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
  // Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
  #define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
  `;case"nvidia":return`#define NVIDIA_GPU
  // Nvidia optimizes away the calculation necessary for emulated fp64
  #define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
  `;case"intel":return`#define INTEL_GPU
  // Intel optimizes away the calculation necessary for emulated fp64
  #define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
  // Intel's built-in 'tan' function doesn't have acceptable precision
  #define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
  // Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
  #define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
  `;case"amd":return`#define AMD_GPU
  `;default:return`#define DEFAULT_GPU
  // Prevent driver from optimizing away the calculation necessary for emulated fp64
  #define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
  // Headless Chrome's software shader 'tan' function doesn't have acceptable precision
  #define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
  // If the GPU doesn't have full 32 bits precision, will causes overflow
  #define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
  `}}function f3(e,t){if(Number(e.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return e=h3(e,FV),e;case"fragment":return e=h3(e,DV),e;default:throw new Error(t)}}var u3=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
  `],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],FV=[...u3,[cx("attribute"),"in $1"],[cx("varying"),"out $1"]],DV=[...u3,[cx("varying"),"in $1"]];function h3(e,t){for(let[r,n]of t)e=e.replace(r,n);return e}function cx(e){return new RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function lx(e,t){let r="";for(let n in e){let s=e[n];if(r+=`void ${s.signature} {
  `,s.header&&(r+=`  ${s.header}`),t[n]){let i=t[n];i.sort((o,a)=>o.order-a.order);for(let o of i)r+=`  ${o.injection}
  `}s.footer&&(r+=`  ${s.footer}`),r+=`}
  `}return r}function hx(e){let t={vertex:{},fragment:{}};for(let r of e){let n,s;typeof r!="string"?(n=r,s=n.hook):(n={},s=r),s=s.trim();let[i,o]=s.split(":"),a=s.replace(/\(.+/,""),c=Object.assign(n,{signature:o});switch(i){case"vs":t.vertex[a]=c;break;case"fs":t.fragment[a]=c;break;default:throw new Error(i)}}return t}function d3(e,t){return{name:kV(e,t),language:"glsl",version:UV(e)}}function kV(e,t="unnamed"){let n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function UV(e){let t=100,r=e.match(/[^\s]+/g);if(r&&r.length>=2&&r[0]==="#version"){let n=parseInt(r[1],10);Number.isFinite(n)&&(t=n)}if(t!==100&&t!==300)throw new Error(`Invalid GLSL version ${t}`);return t}var g3=`
  
  ${Rl}
  `,zV=`precision highp float;
  `;function m3(e){let t=Qo(e.modules||[]);return{source:VV(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:x3(t)}}function _3(e){let{vs:t,fs:r}=e,n=Qo(e.modules||[]);return{vs:p3(e.platformInfo,{...e,source:t,stage:"vertex",modules:n}),fs:p3(e.platformInfo,{...e,source:r,stage:"fragment",modules:n}),getUniforms:x3(n)}}function VV(e,t){let{source:r,stage:n,modules:s,hookFunctions:i=[],inject:o={},log:a}=t;Id(typeof r=="string","shader source must be a string");let c=r,l="",h=hx(i),f={},u={},d={};for(let g in o){let m=typeof o[g]=="string"?{injection:o[g],order:0}:o[g],_=/^(v|f)s:(#)?([\w-]+)$/.exec(g);if(_){let y=_[2],x=_[3];y?x==="decl"?u[g]=[m]:d[g]=[m]:f[g]=[m]}else d[g]=[m]}let p=s;for(let g of p){a&&ax(g,c,a);let m=y3(g,"wgsl");l+=m;let _=g.injections?.[n]||{};for(let y in _){let x=/^(v|f)s:#([\w-]+)$/.exec(y);if(x){let M=x[2]==="decl"?u:d;M[y]=M[y]||[],M[y].push(_[y])}else f[y]=f[y]||[],f[y].push(_[y])}}return l+=g3,l=Il(l,n,u),l+=lx(h[n],f),l+=c,l=Il(l,n,d),l}function p3(e,t){let{id:r,source:n,stage:s,language:i="glsl",modules:o,defines:a={},hookFunctions:c=[],inject:l={},prologue:h=!0,log:f}=t;Id(typeof n=="string","shader source must be a string");let u=i==="glsl"?d3(n).version:-1,d=e.shaderLanguageVersion,p=u===100?"#version 100":"#version 300 es",m=n.split(`
  `).slice(1).join(`
  `),_={};o.forEach(w=>{Object.assign(_,w.defines)}),Object.assign(_,a);let y="";switch(i){case"wgsl":break;case"glsl":y=h?`${p}
  
  // ----- PROLOGUE -------------------------
  ${HV({id:r,source:n,stage:s})}
  ${`#define SHADER_TYPE_${s.toUpperCase()}`}
  
  ${l3(e)}
  ${s==="fragment"?zV:""}
  
  // ----- APPLICATION DEFINES -------------------------
  
  ${WV(_)}
  
  `:`${p}
  `;break}let x=hx(c),A={},M={},E={};for(let w in l){let v=typeof l[w]=="string"?{injection:l[w],order:0}:l[w],b=/^(v|f)s:(#)?([\w-]+)$/.exec(w);if(b){let T=b[2],I=b[3];T?I==="decl"?M[w]=[v]:E[w]=[v]:A[w]=[v]}else E[w]=[v]}for(let w of o){f&&ax(w,m,f);let v=y3(w,s);y+=v;let b=w.instance?.normalizedInjections[s]||{};for(let T in b){let I=/^(v|f)s:#([\w-]+)$/.exec(T);if(I){let B=I[2]==="decl"?M:E;B[T]=B[T]||[],B[T].push(b[T])}else A[T]=A[T]||[],A[T].push(b[T])}}return y+="// ----- MAIN SHADER SOURCE -------------------------",y+=g3,y=Il(y,s,M),y+=lx(x[s],A),y+=m,y=Il(y,s,E),i==="glsl"&&u!==d&&(y=f3(y,s)),y.trim()}function x3(e){return function(r){let n={};for(let s of e){let i=s.getUniforms?.(r,n);Object.assign(n,i)}return n}}function HV(e){let{id:t,source:r,stage:n}=e;return t&&r.indexOf("SHADER_NAME")===-1?`
  #define SHADER_NAME ${t}_${n}`:""}function WV(e={}){let t="";for(let r in e){let n=e[r];(n||Number.isFinite(n))&&(t+=`#define ${r.toUpperCase()} ${e[r]}
  `)}return t}function y3(e,t){let r;switch(t){case"vertex":r=e.vs||"";break;case"fragment":r=e.fs||"";break;case"wgsl":r=e.source||"";break;default:Id(!1)}if(!e.name)throw new Error("Shader module must have a name");let n=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),s=`// ----- MODULE ${e.name} ---------------
  
  `;return t!=="wgsl"&&(s+=`#define MODULE_${n}
  `),s+=`${r}
  `,s}var GV=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,jV=/^\s*\#\s*endif\s*$/;function A3(e,t){let r=e.split(`
  `),n=[],s=!0,i=null;for(let o of r){let a=o.match(GV),c=o.match(jV);a?(i=a[1],s=Boolean(t?.defines?.[i])):c?s=!0:s&&n.push(o)}return n.join(`
  `)}var ta=class{_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return ta.defaultShaderAssembler=ta.defaultShaderAssembler||new ta,ta.defaultShaderAssembler}addDefaultModule(t){this._defaultModules.find(r=>r.name===(typeof t=="string"?t:t.name))||this._defaultModules.push(t)}removeDefaultModule(t){let r=typeof t=="string"?t:t.name;this._defaultModules=this._defaultModules.filter(n=>n.name!==r)}addShaderHook(t,r){r&&(t=Object.assign(r,{hook:t})),this._hookFunctions.push(t)}assembleWGSLShader(t){let r=this._getModuleList(t.modules),n=this._hookFunctions,{source:s,getUniforms:i}=m3({...t,source:t.source,modules:r,hookFunctions:n});return{source:t.platformInfo.shaderLanguage==="wgsl"?A3(s):s,getUniforms:i,modules:r}}assembleGLSLShaderPair(t){let r=this._getModuleList(t.modules),n=this._hookFunctions;return{..._3({...t,vs:t.vs,fs:t.fs,modules:r,hookFunctions:n}),modules:r}}_getModuleList(t=[]){let r=new Array(this._defaultModules.length+t.length),n={},s=0;for(let i=0,o=this._defaultModules.length;i<o;++i){let a=this._defaultModules[i],c=a.name;r[s++]=a,n[c]=!0}for(let i=0,o=t.length;i<o;++i){let a=t[i],c=a.name;n[c]||(r[s++]=a,n[c]=!0)}return r.length=s,Ni(r),r}},Ss=ta;H(Ss,"defaultShaderAssembler");var qV=`out vec4 transform_output;
  void main() {
    transform_output = vec4(0);
  }`,XV=`#version 300 es
  ${qV}`;function Ol(e){let{input:t,inputChannels:r,output:n}=e||{};if(!t)return XV;if(!r)throw new Error("inputChannels");let s=YV(r),i=T3(t,r);return`#version 300 es
  in ${s} ${t};
  out vec4 ${n};
  void main() {
    ${n} = ${i};
  }`}function YV(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${e}`)}}function T3(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw new Error(`invalid channels: ${t}`)}}var fx=class{stats=new Map;getStats(t){return this.get(t)}get(t){return this.stats.has(t)||this.stats.set(t,new we({id:t})),this.stats.get(t)}},Ld=new fx;var F=new Ke({id:"luma.gl"});var ux={};function vs(e="id"){ux[e]=ux[e]||1;let t=ux[e]++;return`${e}-${t}`}var Z=class{toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(t,r,n){if(!t)throw new Error("no device");this._device=t,this.props=$V(r,n);let s=this.props.id!=="undefined"?this.props.id:vs(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(t){this._attachedResources.add(t)}detachResource(t){this._attachedResources.delete(t)}destroyAttachedResource(t){this._attachedResources.delete(t)&&t.destroy()}destroyAttachedResources(){for(let t of Object.values(this._attachedResources))t.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){let t=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];t.get(`${r}s Active`).decrementCount()}trackAllocatedMemory(t,r=this[Symbol.toStringTag]){let n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(t),n.get(`${r} Memory`).addCount(t),this.allocatedBytes=t}trackDeallocatedMemory(t=this[Symbol.toStringTag]){let r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").subtractCount(this.allocatedBytes),r.get(`${t} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){let t=this._device.statsManager.getStats("Resource Counts"),r=this[Symbol.toStringTag];t.get("Resources Created").incrementCount(),t.get(`${r}s Created`).incrementCount(),t.get(`${r}s Active`).incrementCount()}};H(Z,"defaultProps",{id:"undefined",handle:void 0,userData:void 0});function $V(e,t){let r={...t};for(let n in e)e[n]!==void 0&&(r[n]=e[n]);return r}var Ll=class extends Z{get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(t,r){let n={...r};(r.usage||0)&Ll.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?n.indexType="uint32":r.data instanceof Uint16Array&&(n.indexType="uint16")),delete n.data,super(t,n,Ll.defaultProps),this.usage=n.usage||0,this.indexType=n.indexType,this.updateTimestamp=t.incrementTimestamp()}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,r){throw new Error("not implemented")}debugData=new ArrayBuffer(0);_setDebugData(t,r,n){let s=ArrayBuffer.isView(t)?t.buffer:t,i=Math.min(t?t.byteLength:n,Ll.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(i):r===0&&n===s.byteLength?this.debugData=s.slice(0,i):this.debugData=s.slice(r,r+i)}},K=Ll;H(K,"defaultProps",{...Z.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),H(K,"MAP_READ",1),H(K,"MAP_WRITE",2),H(K,"COPY_SRC",4),H(K,"COPY_DST",8),H(K,"INDEX",16),H(K,"VERTEX",32),H(K,"UNIFORM",64),H(K,"STORAGE",128),H(K,"INDIRECT",256),H(K,"QUERY_RESOLVE",512),H(K,"DEBUG_DATA_MAX_LENGTH",32);function Nd(e){let t=M3[e],r=KV(t),n=e.includes("norm"),s=!n&&!e.startsWith("float"),i=e.startsWith("s");return{dataType:M3[e],byteLength:r,integer:s,signed:i,normalized:n}}function KV(e){return ZV[e]}var M3={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},ZV={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4};var Ce="texture-compression-bc",Et="texture-compression-astc",ln="texture-compression-etc2",JV="texture-compression-etc1-webgl",Bd="texture-compression-pvrtc-webgl",dx="texture-compression-atc-webgl",Fd="float32-renderable-webgl",px="float16-renderable-webgl",QV="rgb9e5ufloat-renderable-webgl",gx="snorm8-renderable-webgl",Nl="norm16-renderable-webgl",mx="snorm16-renderable-webgl",Dd="float32-filterable",E3="float16-filterable-webgl";function kd(e){let t=t9[e];if(!t)throw new Error(`Unsupported texture format ${e}`);return t}var t9={r8unorm:{},r8snorm:{render:gx},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:gx},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:px,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:Nl},"r16snorm-webgl":{f:mx},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:gx},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:px,filter:E3},"rg16unorm-webgl":{render:Nl},"rg16snorm-webgl":{render:mx},r32uint:{},r32sint:{},r32float:{render:Fd,filter:Dd},rgb9e5ufloat:{channels:"rgb",packed:!0,render:QV},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:Fd},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:Nl},"rgb16snorm-webgl":{f:Nl},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:Dd},rgba16uint:{},rgba16sint:{},rgba16float:{render:px,filter:E3},"rgba16unorm-webgl":{render:Nl},"rgba16snorm-webgl":{render:mx},"rgb32float-webgl":{render:Fd,filter:Dd},rgba32uint:{},rgba32sint:{},rgba32float:{render:Fd,filter:Dd},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Ce},"bc1-rgb-unorm-srgb-webgl":{f:Ce},"bc1-rgba-unorm":{f:Ce},"bc1-rgba-unorm-srgb":{f:Ce},"bc2-rgba-unorm":{f:Ce},"bc2-rgba-unorm-srgb":{f:Ce},"bc3-rgba-unorm":{f:Ce},"bc3-rgba-unorm-srgb":{f:Ce},"bc4-r-unorm":{f:Ce},"bc4-r-snorm":{f:Ce},"bc5-rg-unorm":{f:Ce},"bc5-rg-snorm":{f:Ce},"bc6h-rgb-ufloat":{f:Ce},"bc6h-rgb-float":{f:Ce},"bc7-rgba-unorm":{f:Ce},"bc7-rgba-unorm-srgb":{f:Ce},"etc2-rgb8unorm":{f:ln},"etc2-rgb8unorm-srgb":{f:ln},"etc2-rgb8a1unorm":{f:ln},"etc2-rgb8a1unorm-srgb":{f:ln},"etc2-rgba8unorm":{f:ln},"etc2-rgba8unorm-srgb":{f:ln},"eac-r11unorm":{f:ln},"eac-r11snorm":{f:ln},"eac-rg11unorm":{f:ln},"eac-rg11snorm":{f:ln},"astc-4x4-unorm":{f:Et},"astc-4x4-unorm-srgb":{f:Et},"astc-5x4-unorm":{f:Et},"astc-5x4-unorm-srgb":{f:Et},"astc-5x5-unorm":{f:Et},"astc-5x5-unorm-srgb":{f:Et},"astc-6x5-unorm":{f:Et},"astc-6x5-unorm-srgb":{f:Et},"astc-6x6-unorm":{f:Et},"astc-6x6-unorm-srgb":{f:Et},"astc-8x5-unorm":{f:Et},"astc-8x5-unorm-srgb":{f:Et},"astc-8x6-unorm":{f:Et},"astc-8x6-unorm-srgb":{f:Et},"astc-8x8-unorm":{f:Et},"astc-8x8-unorm-srgb":{f:Et},"astc-10x5-unorm":{f:Et},"astc-10x5-unorm-srgb":{f:Et},"astc-10x6-unorm":{f:Et},"astc-10x6-unorm-srgb":{f:Et},"astc-10x8-unorm":{f:Et},"astc-10x8-unorm-srgb":{f:Et},"astc-10x10-unorm":{f:Et},"astc-10x10-unorm-srgb":{f:Et},"astc-12x10-unorm":{f:Et},"astc-12x10-unorm-srgb":{f:Et},"astc-12x12-unorm":{f:Et},"astc-12x12-unorm-srgb":{f:Et},"pvrtc-rgb4unorm-webgl":{f:Bd},"pvrtc-rgba4unorm-webgl":{f:Bd},"pvrtc-rbg2unorm-webgl":{f:Bd},"pvrtc-rgba2unorm-webgl":{f:Bd},"etc1-rbg-unorm-webgl":{f:JV},"atc-rgb-unorm-webgl":{f:dx},"atc-rgba-unorm-webgl":{f:dx},"atc-rgbai-unorm-webgl":{f:dx}};var e9=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],r9=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function _x(e){return e9.some(t=>e.startsWith(t))}function ea(e){let t=n9(e);if(_x(e)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;let n=s9(e);n&&(t.blockWidth=n.blockWidth,t.blockHeight=n.blockHeight)}let r=r9.exec(e);if(r){let[,n,s,i,o,a]=r,c=`${i}${s}`,l=Nd(c),h=l.byteLength*8,f=n.length,u=[h,f>=2?h:0,f>=3?h:0,f>=4?h:0];t={format:e,attachment:t.attachment,dataType:l.dataType,components:f,channels:n,integer:l.integer,signed:l.signed,normalized:l.normalized,bitsPerChannel:u,bytesPerPixel:l.byteLength*n.length,packed:t.packed,srgb:t.srgb},a==="-webgl"&&(t.webgl=!0),o==="-srgb"&&(t.srgb=!0)}return e.endsWith("-webgl")&&(t.webgl=!0),e.endsWith("-srgb")&&(t.srgb=!0),t}function n9(e){let t=kd(e),r=t.bytesPerPixel||1,n=t.bitsPerChannel||[8,8,8,8];return delete t.bitsPerChannel,delete t.bytesPerPixel,delete t.f,delete t.render,delete t.filter,delete t.blend,delete t.store,{...t,format:e,attachment:t.attachment||"color",channels:t.channels||"r",components:t.components||t.channels?.length||1,bytesPerPixel:r,bitsPerChannel:n,dataType:t.dataType||"uint8",srgb:t.srgb??!1,packed:t.packed??!1,webgl:t.webgl??!1,integer:t.integer??!1,signed:t.signed??!1,normalized:t.normalized??!1,compressed:t.compressed??!1}}function s9(e){let r=/.*-(\d+)x(\d+)-.*/.exec(e);if(r){let[,n,s]=r;return{blockWidth:Number(n),blockHeight:Number(s)}}return null}function b3(e){let t=kd(e),r={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},n=ea(e),s=e.startsWith("depth")||e.startsWith("stencil"),i=n?.signed,o=n?.integer,a=n?.webgl;return r.render&&=!i,r.filter&&=!s&&!i&&!o&&!a,r}var Bl=class{},Fl=class{features;disabledFeatures;constructor(t=[],r){this.features=new Set(t),this.disabledFeatures=r||{}}*[Symbol.iterator](){yield*this.features}has(t){return!this.disabledFeatures?.[t]&&this.features.has(t)}},xx=class{get[Symbol.toStringTag](){return"Device"}constructor(t){this.props={...xx.defaultProps,...t},this.id=this.props.id||vs(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=Ld;timestamp=0;_lumaData={};getTextureFormatCapabilities(t){let r=b3(t),n=o=>(typeof o=="string"?this.features.has(o):o)??!0,s=n(r.create),i={format:t,create:s,render:s&&n(r.render),filter:s&&n(r.filter),blend:s&&n(r.blend),store:s&&n(r.store)};return this._getDeviceSpecificTextureFormatCapabilities(i)}isTextureFormatSupported(t,r){return this.getTextureFormatCapabilities(t).create}isTextureFormatFilterable(t){return this.getTextureFormatCapabilities(t).filter}isTextureFormatRenderable(t){return this.getTextureFormatCapabilities(t).render}isTextureFormatCompressed(t){return _x(t)}loseDevice(){return!1}reportError(t){this.props.onError(t)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(t={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(t){this.props.onError(t)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(t,r){throw new Error("not implemented")}readPixelsToBufferWebGL(t,r){throw new Error("not implemented")}setParametersWebGL(t){throw new Error("not implemented")}getParametersWebGL(t){throw new Error("not implemented")}withParametersWebGL(t,r){throw new Error("not implemented")}clearWebGL(t){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}_normalizeBufferProps(t){(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});let r={...t};return(t.usage||0)&K.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?r.indexType="uint32":t.data instanceof Uint16Array?r.indexType="uint16":F.warn("indices buffer content must be of integer type")()),r}},Ze=xx;H(Ze,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:t=>F.error(t.message)(),_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:F.get("debug")||void 0,debugShaders:F.get("debug-shaders")||void 0,debugFramebuffers:Boolean(F.get("debug-framebuffers")),debugWebGL:Boolean(F.get("debug-webgl")),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});var i9=Ve()&&typeof document<"u",o9=()=>i9&&document.readyState==="complete",a9="set luma.log.level=1 (or higher) to trace rendering",S3="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",ra=class{stats=Ld;log=F;VERSION="9.1.0";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw F.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),F.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");F.error("This version of luma.gl has already been initialized")()}F.log(1,`${this.VERSION} - ${a9}`)(),globalThis.luma=this}registerAdapters(t){for(let r of t)this.preregisteredAdapters.set(r.type,r)}getSupportedAdapters(t=[]){let r=this.getAdapterMap(t);return Array.from(r).map(([,n])=>n).filter(n=>n.isSupported?.()).map(n=>n.type)}getBestAvailableAdapter(t=[]){let r=this.getAdapterMap(t);return r.get("webgpu")?.isSupported?.()?"webgpu":r.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(t){Object.assign(ra.defaultProps,t)}async createDevice(t={}){t={...ra.defaultProps,...t},t.waitForPageLoad&&await ra.pageLoaded;let r=this.getAdapterMap(t.adapters),n=t.type||"";n==="best-available"&&(n=this.getBestAvailableAdapter(t.adapters)||n);let o=await(this.getAdapterMap(t.adapters)||r).get(n)?.create?.(t);if(o)return o;throw new Error(S3)}async attachDevice(t){let r=this.getAdapterMap(t.adapters),n="";t.handle instanceof WebGL2RenderingContext&&(n="webgl"),t.createCanvasContext&&await ra.pageLoaded,t.handle===null&&(n="unknown");let i=await r.get(n)?.attach?.(null);if(i)return i;throw new Error(S3)}enforceWebGL2(t=!0,r=[]){let s=this.getAdapterMap(r).get("webgl");s||F.warn("enforceWebGL2: webgl adapter not found")(),s?.enforceWebGL2?.(t)}getAdapterMap(t=[]){let r=new Map(this.preregisteredAdapters);for(let n of t)r.set(n.type,n);return r}registerDevices(t){F.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(let r of t){let n=r.adapter;n&&this.preregisteredAdapters.set(n.type,n)}}},Dl=ra;H(Dl,"defaultProps",{...Ze.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),H(Dl,"pageLoaded",c9().then(()=>{F.probe(2,"DOM is loaded")()}));var ws=new Dl;function c9(){return o9()||typeof window>"u"?Promise.resolve():new Promise(e=>{window.addEventListener("load",()=>e())})}var kl=class{};var yx=class{id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(t){if(this.props={...yx.defaultProps,...t},t=this.props,!Ve()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(t.canvas)typeof t.canvas=="string"?this.canvas=h9(t.canvas):this.canvas=t.canvas;else{let r=f9(t),n=l9(t?.container||null);n.insertBefore(r,n.firstChild),this.canvas=r,t?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&t.autoResize&&(this.resizeObserver=new ResizeObserver(r=>{for(let n of r)n.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(t){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(t=t===void 0?this.props.useDevicePixels:t,!t||t<=0)?1:t===!0?typeof window<"u"&&window.devicePixelRatio||1:t}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":let t=this.getDevicePixelRatio(),r=this.canvas;return r.parentElement?[r.clientWidth*t,r.clientHeight*t]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){let[t,r]=this.getPixelSize();return t/r}cssToDeviceRatio(){try{let[t]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return r?t/r:1}catch{return 1}}cssToDevicePixels(t,r=!0){let n=this.cssToDeviceRatio(),[s,i]=this.getDrawingBufferSize();return u9(t,n,s,i,r)}setDevicePixelRatio(t,r={}){if(!this.htmlCanvas)return;let n="width"in r?r.width:this.htmlCanvas.clientWidth,s="height"in r?r.height:this.htmlCanvas.clientHeight;(!n||!s)&&(F.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,n=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);let i=this._canvasSizeInfo;if(i.clientWidth!==n||i.clientHeight!==s||i.devicePixelRatio!==t){let o=t,a=Math.floor(n*o),c=Math.floor(s*o);if(this.htmlCanvas.width=a,this.htmlCanvas.height=c,this.device.gl){let[h,f]=this.getDrawingBufferSize();(h!==a||f!==c)&&(o=Math.min(h/n,f/s),this.htmlCanvas.width=Math.floor(n*o),this.htmlCanvas.height=Math.floor(s*o),F.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=t}}}getDrawingBufferSize(){let t=this.device.gl;if(!t)throw new Error("canvas size");return[t.drawingBufferWidth,t.drawingBufferHeight]}_setAutoCreatedCanvasId(t){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=t)}},na=yx;H(na,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});function l9(e){if(typeof e=="string"){let t=document.getElementById(e);if(!t)throw new Error(`${e} is not an HTML element`);return t}else if(e)return e;return document.body}function h9(e){let t=document.getElementById(e);if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}function f9(e){let{width:t,height:r}=e,n=document.createElement("canvas");return n.id=vs("lumagl-auto-created-canvas"),n.width=t||1,n.height=r||1,n.style.width=Number.isFinite(t)?`${t}px`:"100%",n.style.height=Number.isFinite(r)?`${r}px`:"100%",n}function u9(e,t,r,n,s){let i=e,o=v3(i[0],t,r),a=w3(i[1],t,n,s),c=v3(i[0]+1,t,r),l=c===r-1?c:c-1;c=w3(i[1]+1,t,n,s);let h;return s?(c=c===0?c:c+1,h=a,a=c):h=c===n-1?c:c-1,{x:o,y:a,width:Math.max(l-o+1,1),height:Math.max(h-a+1,1)}}function v3(e,t,r){return Math.min(Math.round(e*t),r-1)}function w3(e,t,r,n){return n?Math.max(0,r-1-Math.round(e*t)):Math.min(Math.round(e*t),r-1)}var Dn=class extends Z{get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(t,r){if(r=Dn.normalizeProps(t,r),super(t,r,Dn.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){let n=Dn.getTextureDataSize(this.props.data);this.width=n?.width||1,this.height=n?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?Dn.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){let r=t?.data;return ArrayBuffer.isView(r)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return Dn.getTextureDataSize(t[0]);if(Dn.isExternalImage(t))return Dn.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){let n=Object.values(t)[0];return{width:n.width,height:n.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,r){let n;return ArrayBuffer.isView(t)?n=[{data:t,width:r.width,height:r.height}]:Array.isArray(t)?n=t:n=[t],n}static getMipLevelCount(t,r){return Math.floor(Math.log2(Math.max(t,r)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static normalizeProps(t,r){let n={...r},s=t?.props?._resourceDefaults?.texture||{};Object.assign(n,s);let{width:i,height:o}=n;return typeof i=="number"&&(n.width=Math.max(1,Math.ceil(i))),typeof o=="number"&&(n.height=Math.max(1,Math.ceil(o))),n}},Q=Dn;H(Q,"COPY_SRC",1),H(Q,"COPY_DST",2),H(Q,"TEXTURE",4),H(Q,"STORAGE",8),H(Q,"RENDER_ATTACHMENT",16),H(Q,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),H(Q,"defaultProps",{...Z.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),H(Q,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});var Ax=class extends Z{get[Symbol.toStringTag](){return"TextureView"}constructor(t,r){super(t,r,Ax.defaultProps)}},Cs=Ax;H(Cs,"defaultProps",{...Z.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});function P3(e,t,r){let n="",s=t.split(/\r?\n/),i=e.slice().sort((o,a)=>o.lineNum-a.lineNum);switch(r?.showSourceCode||"no"){case"all":let o=0;for(let a=1;a<=s.length;a++)for(n+=R3(s[a-1],a,r);i.length>o&&i[o].lineNum===a;){let c=i[o++];n+=C3(c,s,c.lineNum,{...r,inlineSource:!1})}return n;case"issues":case"no":for(let a of e)n+=C3(a,s,a.lineNum,{inlineSource:r?.showSourceCode!=="no"});return n}}function C3(e,t,r,n){if(n?.inlineSource){let i=d9(t,r),o=e.linePos>0?`${" ".repeat(e.linePos+5)}^^^
  `:"";return`
  ${i}${o}${e.type.toUpperCase()}: ${e.message}
  
  `}let s=e.type==="error"?"red":"#8B4000";return n?.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function d9(e,t,r){let n="";for(let s=t-2;s<=t;s++){let i=e[s-1];i!==void 0&&(n+=R3(i,t,r))}return n}function R3(e,t,r){let n=r?.html?g9(e):e;return`${p9(String(t),4)}: ${n}${r?.html?"<br/>":`
  `}`}function p9(e,t){let r="";for(let n=e.length;n<t;++n)r+=" ";return r+e}function g9(e){return e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}var Tx=class extends Z{get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(t,r){r={...r,debugShaders:r.debugShaders||t.props.debugShaders||"errors"},super(t,{id:m9(r),...r},Tx.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){let t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break;case"warnings":case"always":break}let r=await this.getCompilationInfo();t==="warnings"&&r?.length===0||this._displayShaderLog(r)}_displayShaderLog(t){if(typeof document>"u"||!document?.createElement)return;let r=I3(this.source),n=`${this.stage} ${r}`,s=P3(t,this.source,{showSourceCode:"all",html:!0}),i=this.getTranslatedSource();i&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${i}</pre></code>`);let o=document.createElement("Button");o.innerHTML=`
  <h1>Shader Compilation Error in ${n}</h1><br /><br />
  <code style="user-select:text;"><pre>
  ${s}
  </pre></code>`,o.style.top="10px",o.style.left="10px",o.style.position="absolute",o.style.zIndex="9999",o.style.width="100%",o.style.textAlign="left",document.body.appendChild(o),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),o.onclick=()=>{let c=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(c)}}},Ps=Tx;H(Ps,"defaultProps",{...Z.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});function m9(e){return I3(e.source)||e.id||vs(`unnamed ${e.stage}-shader`)}function I3(e,t="unnamed"){let n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return n?n[1]:t}var Ud=class extends Z{get[Symbol.toStringTag](){return"Sampler"}constructor(t,r){r=Ud.normalizeProps(t,r),super(t,r,Ud.defaultProps)}static normalizeProps(t,r){let n=t?.props?._resourceDefaults?.sampler||{};return{...r,...n}}},Rs=Ud;H(Rs,"defaultProps",{...Z.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});var Mx=class extends Z{get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(t,r={}){super(t,r,Mx.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(t){let r=this.colorAttachments.map(s=>s.texture.clone(t)),n=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:n})}resize(t){let r=!t;if(t){let[n,s]=Array.isArray(t)?t:[t.width,t.height];r=r||s!==this.height||n!==this.width,this.width=n,this.height=s}r&&(F.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,n)=>{if(typeof r=="string"){let s=this.createColorTexture(r,n);return this.attachResource(s),s.view}return r instanceof Q?r.view:r});let t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){let r=this.createDepthStencilTexture(t);this.attachResource(r),this.depthStencilAttachment=r.view}else t instanceof Q?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:Q.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Q.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,r){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){let s=this.colorAttachments[n].texture.clone({width:t,height:r});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){let n=this.depthStencilAttachment.texture.clone({width:t,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}this.updateAttachments()}},hn=Mx;H(hn,"defaultProps",{...Z.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});var Ex=class extends Z{get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(t,r){super(t,r,Ex.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(t){throw new Error("Use uniform blocks")}},Lr=Ex;H(Lr,"defaultProps",{...Z.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});var Bi=class extends Z{get[Symbol.toStringTag](){return"RenderPass"}constructor(t,r){r=Bi.normalizeProps(t,r),super(t,r,Bi.defaultProps)}static normalizeProps(t,r){return{...t.props._resourceDefaults?.renderPass,...r}}},kn=Bi;H(kn,"defaultClearColor",[0,0,0,1]),H(kn,"defaultClearDepth",1),H(kn,"defaultClearStencil",0),H(kn,"defaultProps",{...Z.defaultProps,framebuffer:null,parameters:void 0,clearColor:Bi.defaultClearColor,clearColors:void 0,clearDepth:Bi.defaultClearDepth,clearStencil:Bi.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});var bx=class extends Z{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(t,r){super(t,r,bx.defaultProps),this.shaderLayout=r.shaderLayout}},Fi=bx;H(Fi,"defaultProps",{...Z.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});var Sx=class extends Z{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,r){super(t,r,Sx.defaultProps)}},sa=Sx;H(sa,"defaultProps",{...Z.defaultProps,measureExecutionTime:void 0});var vx=class extends Z{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,r){super(t,r,vx.defaultProps)}},ia=vx;H(ia,"defaultProps",{...Z.defaultProps});function O3(e){let[t,r]=x9[e],n=t==="i32"||t==="u32",s=t!=="u32",i=y9[t]*r,o=_9(t,r);return{dataType:t,components:r,defaultVertexFormat:o,byteLength:i,integer:n,signed:s}}function _9(e,t){let r;switch(e){case"f32":r="float32";break;case"i32":r="sint32";break;case"u32":r="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return t===1?r:`${r}x${t}`}var x9={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},y9={f32:4,f16:2,i32:4,u32:4};function wx(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);let[r,n]=e.split("x"),s=r,i=n?parseInt(n):1,o=Nd(s),a={type:s,components:i,byteLength:o.byteLength*i,integer:o.integer,signed:o.signed,normalized:o.normalized};return t&&(a.webglOnly=!0),a}function zd(e,t){let r={};for(let n of e.attributes){let s=A9(e,t,n.name);s&&(r[n.name]=s)}return r}function L3(e,t,r=16){let n=zd(e,t),s=new Array(r).fill(null);for(let i of Object.values(n))s[i.location]=i;return s}function A9(e,t,r){let n=T9(e,r),s=M9(t,r);if(!n)return null;let i=O3(n.type),o=s?.vertexFormat||i.defaultVertexFormat,a=wx(o);return{attributeName:s?.attributeName||n.name,bufferName:s?.bufferName||n.name,location:n.location,shaderType:n.type,shaderDataType:i.dataType,shaderComponents:i.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:i.integer,stepMode:s?.stepMode||n.stepMode||"vertex",byteOffset:s?.byteOffset||0,byteStride:s?.byteStride||0}}function T9(e,t){let r=e.attributes.find(n=>n.name===t);return r||F.warn(`shader layout attribute "${t}" not present in shader`),r||null}function M9(e,t){E9(e);let r=b9(e,t);return r||(r=S9(e,t),r)?r:(F.warn(`layout for attribute "${t}" not present in buffer layout`),null)}function E9(e){for(let t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&F.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function b9(e,t){for(let r of e)if(r.format&&r.name===t)return{attributeName:r.name,bufferName:t,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}function S9(e,t){for(let r of e){let n=r.byteStride;if(typeof r.byteStride!="number")for(let i of r.attributes||[]){let o=wx(i.format);n+=o.byteLength}let s=r.attributes?.find(i=>i.attribute===t);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:n}}return null}var Cx=class extends Z{get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(t,r){super(t,r,Cx.defaultProps),this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);let{shaderLayout:n,bufferLayout:s}=r.renderPipeline||{};if(!n||!s)throw new Error("VertexArray");this.attributeInfos=L3(n,s,this.maxVertexAttributes)}setConstantWebGL(t,r){throw new Error("constant attributes not supported")}},oa=Cx;H(oa,"defaultProps",{...Z.defaultProps,renderPipeline:null});var Px=class extends Z{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,r){super(t,r,Px.defaultProps)}},aa=Px;H(aa,"defaultProps",{...Z.defaultProps,layout:void 0,buffers:{}});var Rx=class extends Z{get[Symbol.toStringTag](){return"QuerySet"}constructor(t,r){super(t,r,Rx.defaultProps)}},ca=Rx;H(ca,"defaultProps",{...Z.defaultProps,type:void 0,count:void 0});var v9={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function N3(e){return v9[e]}function B3(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}var Vd;function Ix(e){return(!Vd||Vd.byteLength<e)&&(Vd=new ArrayBuffer(e)),Vd}function Ox(e,t){let r=Ix(e.BYTES_PER_ELEMENT*t);return new e(r,0,t)}function w9(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function la(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":w9(e)}var F3=1024,Hd=class{layout={};byteLength;constructor(t){let r=0;for(let[s,i]of Object.entries(t)){let o=N3(i),{type:a,components:c}=o;r=B3(r,c);let l=r;r+=c,this.layout[s]={type:a,size:c,offset:l}}r+=(4-r%4)%4;let n=r*4;this.byteLength=Math.max(n,F3)}getData(t){let r=Math.max(this.byteLength,F3),n=Ix(r),s={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(let[i,o]of Object.entries(t)){let a=this.layout[i];if(!a){F.warn(`Supplied uniform value ${i} not present in uniform block layout`)();continue}let{type:c,size:l,offset:h}=a,f=s[c];if(l===1){if(typeof o!="number"&&typeof o!="boolean"){F.warn(`Supplied value for single component uniform ${i} is not a number: ${o}`)();continue}f[h]=Number(o)}else{if(!la(o)){F.warn(`Supplied value for multi component / array uniform ${i} is not a numeric array: ${o}`)();continue}f.set(o,h)}}return new Uint8Array(n)}has(t){return Boolean(this.layout[t])}get(t){return this.layout[t]}};function D3(e,t,r=16){if(e!==t)return!1;let n=e,s=t;if(!la(n))return!1;if(la(s)&&n.length===s.length){for(let i=0;i<n.length;++i)if(s[i]!==n[i])return!1}return!0}function k3(e){return la(e)?e.slice():e}var Wd=class{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(t){if(this.name=t?.name||"unnamed",t?.name&&t?.shaderLayout){let r=t?.shaderLayout.bindings?.find(s=>s.type==="uniform"&&s.name===t?.name);if(!r)throw new Error(t?.name);let n=r;for(let s of n.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(t){for(let[r,n]of Object.entries(t))this._setUniform(r,n),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${r}=${n}`)}setNeedsRedraw(t){this.needsRedraw=this.needsRedraw||t}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(t,r){D3(this.uniforms[t],r)||(this.uniforms[t]=k3(r),this.modifiedUniforms[t]=!0,this.modified=!0)}};var Ul=class{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(t){for(let[r,n]of Object.entries(t)){let s=r,i=new Hd(n.uniformTypes||{});this.uniformBufferLayouts.set(s,i);let o=new Wd({name:r});o.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(s,o)}}destroy(){for(let t of this.uniformBuffers.values())t.destroy()}setUniforms(t){for(let[r,n]of Object.entries(t))this.uniformBlocks.get(r)?.setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(t){return this.uniformBufferLayouts.get(t)?.byteLength||0}getUniformBufferData(t){let r=this.uniformBlocks.get(t)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(t)?.getData(r)}createUniformBuffer(t,r,n){n&&this.setUniforms(n);let s=this.getUniformBufferByteLength(r),i=t.createBuffer({usage:K.UNIFORM|K.COPY_DST,byteLength:s}),o=this.getUniformBufferData(r);return i.write(o),i}getManagedUniformBuffer(t,r){if(!this.uniformBuffers.get(r)){let n=this.getUniformBufferByteLength(r),s=t.createBuffer({usage:K.UNIFORM|K.COPY_DST,byteLength:n});this.uniformBuffers.set(r,s)}return this.uniformBuffers.get(r)}updateUniformBuffers(){let t=!1;for(let r of this.uniformBlocks.keys()){let n=this.updateUniformBuffer(r);t||=n}return t&&F.log(3,`UniformStore.updateUniformBuffers(): ${t}`)(),t}updateUniformBuffer(t){let r=this.uniformBlocks.get(t),n=this.uniformBuffers.get(t),s=!1;if(n&&r?.needsRedraw){s||=r.needsRedraw;let i=this.getUniformBufferData(t);n=this.uniformBuffers.get(t),n?.write(i);let o=this.uniformBlocks.get(t)?.getAllUniforms();F.log(4,`Writing to uniform buffer ${String(t)}`,i,o)()}return s}};function Gd(e){let t=ArrayBuffer.isView(e)?e.constructor:e;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(t.constructor.name)}}function zl(e){switch(e){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(e)}}function Lx(e,t,r){if(!t||t>4)throw new Error(`size ${t}`);let n=t,s=Gd(e);if(s==="uint8"&&r&&n===1)return"unorm8-webgl";if(s==="uint8"&&r&&n===3)return"unorm8x3-webgl";if(s==="uint8"||s==="sint8"){if(n===1||n===3)throw new Error(`size: ${t}`);return r&&(s=s.replace("int","norm")),`${s}x${n}`}if(s==="uint16"||s==="sint16"){if(n===1||n===3)throw new Error(`size: ${t}`);return r&&(s=s.replace("int","norm")),`${s}x${n}`}return n===1?s:`${s}x${n}`}var Di=class{bufferLayouts;constructor(t){this.bufferLayouts=t}getBufferLayout(t){return this.bufferLayouts.find(r=>r.name===t)||null}getAttributeNamesForBuffer(t){return t.attributes?t.attributes?.map(r=>r.attribute):[t.name]}mergeBufferLayouts(t,r){let n=[...t];for(let s of r){let i=n.findIndex(o=>o.name===s.name);i<0?n.push(s):n[i]=s}return n}};var Nx=class{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}},Nr=class{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(t){throw new Error("Cannot evaluate node")}evaluateString(t){return this.evaluate(t).toString()}search(t){}searchBlock(t,r){if(t){r(da.instance);for(let n of t)n instanceof Array?this.searchBlock(n,r):n.search(r);r(pa.instance)}}},da=class extends Nr{};da.instance=new da;var pa=class extends Nr{};pa.instance=new pa;var Pt=class extends Nr{constructor(){super()}},Hl=class extends Pt{constructor(t,r,n,s,i,o){super(),this.calls=new Set,this.name=t,this.args=r,this.returnType=n,this.body=s,this.startLine=i,this.endLine=o}get astNodeType(){return"function"}search(t){this.searchBlock(this.body,t)}},Bx=class extends Pt{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}search(t){this.expression.search(t)}},Fx=class extends Pt{constructor(t,r){super(),this.condition=t,this.body=r}get astNodeType(){return"while"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}},Dx=class extends Pt{constructor(t){super(),this.body=t}get astNodeType(){return"continuing"}search(t){this.searchBlock(this.body,t)}},kx=class extends Pt{constructor(t,r,n,s){super(),this.init=t,this.condition=r,this.increment=n,this.body=s}get astNodeType(){return"for"}search(t){var r,n,s;(r=this.init)===null||r===void 0||r.search(t),(n=this.condition)===null||n===void 0||n.search(t),(s=this.increment)===null||s===void 0||s.search(t),this.searchBlock(this.body,t)}},zn=class extends Pt{constructor(t,r,n,s,i){super(),this.name=t,this.type=r,this.storage=n,this.access=s,this.value=i}get astNodeType(){return"var"}search(t){var r;t(this),(r=this.value)===null||r===void 0||r.search(t)}},jd=class extends Pt{constructor(t,r,n){super(),this.name=t,this.type=r,this.value=n}get astNodeType(){return"override"}search(t){var r;(r=this.value)===null||r===void 0||r.search(t)}},Wl=class extends Pt{constructor(t,r,n,s,i){super(),this.name=t,this.type=r,this.storage=n,this.access=s,this.value=i}get astNodeType(){return"let"}search(t){var r;t(this),(r=this.value)===null||r===void 0||r.search(t)}},qd=class extends Pt{constructor(t,r,n,s,i){super(),this.name=t,this.type=r,this.storage=n,this.access=s,this.value=i}get astNodeType(){return"const"}evaluate(t){return this.value.evaluate(t)}search(t){var r;t(this),(r=this.value)===null||r===void 0||r.search(t)}},ga;(function(e){e.increment="++",e.decrement="--"})(ga||(ga={}));(function(e){function t(r){let n=r;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return e[n]}e.parse=t})(ga||(ga={}));var Ux=class extends Pt{constructor(t,r){super(),this.operator=t,this.variable=r}get astNodeType(){return"increment"}search(t){this.variable.search(t)}},Gl;(function(e){e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="})(Gl||(Gl={}));(function(e){function t(r){let n=r;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}e.parse=t})(Gl||(Gl={}));var zx=class extends Pt{constructor(t,r,n){super(),this.operator=t,this.variable=r,this.value=n}get astNodeType(){return"assign"}search(t){this.variable.search(t),this.value.search(t)}},Xd=class extends Pt{constructor(t,r){super(),this.name=t,this.args=r}get astNodeType(){return"call"}search(t){for(let r of this.args)r.search(t);t(this)}},Vx=class extends Pt{constructor(t,r){super(),this.body=t,this.continuing=r}get astNodeType(){return"loop"}},Hx=class extends Pt{constructor(t,r){super(),this.condition=t,this.body=r}get astNodeType(){return"body"}},Wx=class extends Pt{constructor(t,r,n,s){super(),this.condition=t,this.body=r,this.elseif=n,this.else=s}get astNodeType(){return"if"}search(t){this.condition.search(t),this.searchBlock(this.body,t),this.searchBlock(this.elseif,t),this.searchBlock(this.else,t)}},Gx=class extends Pt{constructor(t){super(),this.value=t}get astNodeType(){return"return"}search(t){var r;(r=this.value)===null||r===void 0||r.search(t)}},jx=class extends Pt{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}},qx=class extends Pt{constructor(t){super(),this.extensions=t}get astNodeType(){return"requires"}},Xx=class extends Pt{constructor(t,r){super(),this.severity=t,this.rule=r}get astNodeType(){return"diagnostic"}},Yd=class extends Pt{constructor(t,r){super(),this.name=t,this.type=r}get astNodeType(){return"alias"}},Yx=class extends Pt{constructor(){super()}get astNodeType(){return"discard"}},$x=class extends Pt{constructor(){super()}get astNodeType(){return"break"}},Kx=class extends Pt{constructor(){super()}get astNodeType(){return"continue"}},Vn=class extends Pt{constructor(t){super(),this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}},Un=class extends Vn{constructor(t,r,n,s){super(t),this.members=r,this.startLine=n,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let r=0;r<this.members.length;r++)if(this.members[r].name==t)return r;return-1}},$d=class extends Vn{constructor(t,r,n){super(t),this.format=r,this.access=n}get astNodeType(){return"template"}},Zx=class extends Vn{constructor(t,r,n,s){super(t),this.storage=r,this.type=n,this.access=s}get astNodeType(){return"pointer"}},Kd=class extends Vn{constructor(t,r,n,s){super(t),this.attributes=r,this.format=n,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}},ki=class extends Vn{constructor(t,r,n){super(t),this.format=r,this.access=n}get astNodeType(){return"sampler"}},or=class extends Nr{constructor(){super()}},Zd=class extends or{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}},Os=class extends or{constructor(t,r){super(),this.type=t,this.args=r}get astNodeType(){return"createExpr"}search(t){t(this);for(let r of this.args)r.search(t)}},Jd=class extends or{constructor(t,r){super(),this.name=t,this.args=r}get astNodeType(){return"callExpr"}evaluate(t){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(t));case"acos":return Math.acos(this.args[0].evaluate(t));case"acosh":return Math.acosh(this.args[0].evaluate(t));case"asin":return Math.asin(this.args[0].evaluate(t));case"asinh":return Math.asinh(this.args[0].evaluate(t));case"atan":return Math.atan(this.args[0].evaluate(t));case"atan2":return Math.atan2(this.args[0].evaluate(t),this.args[1].evaluate(t));case"atanh":return Math.atanh(this.args[0].evaluate(t));case"ceil":return Math.ceil(this.args[0].evaluate(t));case"clamp":return Math.min(Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t)),this.args[2].evaluate(t));case"cos":return Math.cos(this.args[0].evaluate(t));case"degrees":return this.args[0].evaluate(t)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(t)-this.args[1].evaluate(t),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(t));case"exp2":return Math.pow(2,this.args[0].evaluate(t));case"floor":return Math.floor(this.args[0].evaluate(t));case"fma":return this.args[0].evaluate(t)*this.args[1].evaluate(t)+this.args[2].evaluate(t);case"fract":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(t));case"log":return Math.log(this.args[0].evaluate(t));case"log2":return Math.log2(this.args[0].evaluate(t));case"max":return Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t));case"min":return Math.min(this.args[0].evaluate(t),this.args[1].evaluate(t));case"mix":return this.args[0].evaluate(t)*(1-this.args[2].evaluate(t))+this.args[1].evaluate(t)*this.args[2].evaluate(t);case"modf":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"pow":return Math.pow(this.args[0].evaluate(t),this.args[1].evaluate(t));case"radians":return this.args[0].evaluate(t)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(t));case"sign":return Math.sign(this.args[0].evaluate(t));case"sin":return Math.sin(this.args[0].evaluate(t));case"sinh":return Math.sinh(this.args[0].evaluate(t));case"saturate":return Math.min(Math.max(this.args[0].evaluate(t),0),1);case"smoothstep":return this.args[0].evaluate(t)*this.args[0].evaluate(t)*(3-2*this.args[0].evaluate(t));case"sqrt":return Math.sqrt(this.args[0].evaluate(t));case"step":return this.args[0].evaluate(t)<this.args[1].evaluate(t)?0:1;case"tan":return Math.tan(this.args[0].evaluate(t));case"tanh":return Math.tanh(this.args[0].evaluate(t));case"trunc":return Math.trunc(this.args[0].evaluate(t));default:throw new Error("Non const function: "+this.name)}}search(t){for(let r of this.args)r.search(t);t(this)}},jl=class extends or{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}search(t){t(this),this.postfix&&this.postfix.search(t)}evaluate(t){let r=t.constants.get(this.name);if(!r)throw new Error("Cannot evaluate node");return r.evaluate(t)}},Qd=class extends or{constructor(t,r){super(),this.name=t,this.initializer=r}get astNodeType(){return"constExpr"}evaluate(t){var r,n;if(this.initializer instanceof Os){let s=(r=this.postfix)===null||r===void 0?void 0:r.evaluateString(t),i=(n=this.initializer.type)===null||n===void 0?void 0:n.name,o=t.structs.get(i),a=o?.getMemberIndex(s);if(a!=-1)return this.initializer.args[a].evaluate(t);console.log(a)}return this.initializer.evaluate(t)}search(t){this.initializer.search(t)}},tp=class extends or{constructor(t){super(),this.value=t}get astNodeType(){return"literalExpr"}evaluate(){return this.value}},Jx=class extends or{constructor(t,r){super(),this.type=t,this.value=r}get astNodeType(){return"bitcastExpr"}search(t){this.value.search(t)}},Qx=class extends or{constructor(t,r){super(),this.type=t,this.args=r}get astNodeType(){return"typecastExpr"}evaluate(t){return this.args[0].evaluate(t)}search(t){this.searchBlock(this.args,t)}},ep=class extends or{constructor(t){super(),this.contents=t}get astNodeType(){return"groupExpr"}evaluate(t){return this.contents[0].evaluate(t)}search(t){this.searchBlock(this.contents,t)}},ty=class extends or{constructor(t){super(),this.index=t}search(t){this.index.search(t)}},rp=class extends or{constructor(){super()}},ey=class extends rp{constructor(t,r){super(),this.operator=t,this.right=r}get astNodeType(){return"unaryOp"}evaluate(t){switch(this.operator){case"+":return this.right.evaluate(t);case"-":return-this.right.evaluate(t);case"!":return this.right.evaluate(t)?0:1;case"~":return~this.right.evaluate(t);default:throw new Error("Unknown unary operator: "+this.operator)}}search(t){this.right.search(t)}},_r=class extends rp{constructor(t,r,n){super(),this.operator=t,this.left=r,this.right=n}get astNodeType(){return"binaryOp"}evaluate(t){switch(this.operator){case"+":return this.left.evaluate(t)+this.right.evaluate(t);case"-":return this.left.evaluate(t)-this.right.evaluate(t);case"*":return this.left.evaluate(t)*this.right.evaluate(t);case"/":return this.left.evaluate(t)/this.right.evaluate(t);case"%":return this.left.evaluate(t)%this.right.evaluate(t);case"==":return this.left.evaluate(t)==this.right.evaluate(t)?1:0;case"!=":return this.left.evaluate(t)!=this.right.evaluate(t)?1:0;case"<":return this.left.evaluate(t)<this.right.evaluate(t)?1:0;case">":return this.left.evaluate(t)>this.right.evaluate(t)?1:0;case"<=":return this.left.evaluate(t)<=this.right.evaluate(t)?1:0;case">=":return this.left.evaluate(t)>=this.right.evaluate(t)?1:0;case"&&":return this.left.evaluate(t)&&this.right.evaluate(t)?1:0;case"||":return this.left.evaluate(t)||this.right.evaluate(t)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(t){this.left.search(t),this.right.search(t)}},np=class extends Nr{constructor(){super()}},ry=class extends np{constructor(t,r){super(),this.selector=t,this.body=r}get astNodeType(){return"case"}search(t){this.searchBlock(this.body,t)}},ny=class extends np{constructor(t){super(),this.body=t}get astNodeType(){return"default"}search(t){this.searchBlock(this.body,t)}},sy=class extends Nr{constructor(t,r,n){super(),this.name=t,this.type=r,this.attributes=n}get astNodeType(){return"argument"}},iy=class extends Nr{constructor(t,r){super(),this.condition=t,this.body=r}get astNodeType(){return"elseif"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}},oy=class extends Nr{constructor(t,r,n){super(),this.name=t,this.type=r,this.attributes=n}get astNodeType(){return"member"}},ay=class extends Nr{constructor(t,r){super(),this.name=t,this.value=r}get astNodeType(){return"attribute"}},O,R;(function(e){e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"})(R||(R={}));var P=class{constructor(t,r,n){this.name=t,this.type=r,this.rule=n}toString(){return this.name}},S=class{};O=S;S.none=new P("",R.reserved,"");S.eof=new P("EOF",R.token,"");S.reserved={asm:new P("asm",R.reserved,"asm"),bf16:new P("bf16",R.reserved,"bf16"),do:new P("do",R.reserved,"do"),enum:new P("enum",R.reserved,"enum"),f16:new P("f16",R.reserved,"f16"),f64:new P("f64",R.reserved,"f64"),handle:new P("handle",R.reserved,"handle"),i8:new P("i8",R.reserved,"i8"),i16:new P("i16",R.reserved,"i16"),i64:new P("i64",R.reserved,"i64"),mat:new P("mat",R.reserved,"mat"),premerge:new P("premerge",R.reserved,"premerge"),regardless:new P("regardless",R.reserved,"regardless"),typedef:new P("typedef",R.reserved,"typedef"),u8:new P("u8",R.reserved,"u8"),u16:new P("u16",R.reserved,"u16"),u64:new P("u64",R.reserved,"u64"),unless:new P("unless",R.reserved,"unless"),using:new P("using",R.reserved,"using"),vec:new P("vec",R.reserved,"vec"),void:new P("void",R.reserved,"void")};S.keywords={array:new P("array",R.keyword,"array"),atomic:new P("atomic",R.keyword,"atomic"),bool:new P("bool",R.keyword,"bool"),f32:new P("f32",R.keyword,"f32"),i32:new P("i32",R.keyword,"i32"),mat2x2:new P("mat2x2",R.keyword,"mat2x2"),mat2x3:new P("mat2x3",R.keyword,"mat2x3"),mat2x4:new P("mat2x4",R.keyword,"mat2x4"),mat3x2:new P("mat3x2",R.keyword,"mat3x2"),mat3x3:new P("mat3x3",R.keyword,"mat3x3"),mat3x4:new P("mat3x4",R.keyword,"mat3x4"),mat4x2:new P("mat4x2",R.keyword,"mat4x2"),mat4x3:new P("mat4x3",R.keyword,"mat4x3"),mat4x4:new P("mat4x4",R.keyword,"mat4x4"),ptr:new P("ptr",R.keyword,"ptr"),sampler:new P("sampler",R.keyword,"sampler"),sampler_comparison:new P("sampler_comparison",R.keyword,"sampler_comparison"),struct:new P("struct",R.keyword,"struct"),texture_1d:new P("texture_1d",R.keyword,"texture_1d"),texture_2d:new P("texture_2d",R.keyword,"texture_2d"),texture_2d_array:new P("texture_2d_array",R.keyword,"texture_2d_array"),texture_3d:new P("texture_3d",R.keyword,"texture_3d"),texture_cube:new P("texture_cube",R.keyword,"texture_cube"),texture_cube_array:new P("texture_cube_array",R.keyword,"texture_cube_array"),texture_multisampled_2d:new P("texture_multisampled_2d",R.keyword,"texture_multisampled_2d"),texture_storage_1d:new P("texture_storage_1d",R.keyword,"texture_storage_1d"),texture_storage_2d:new P("texture_storage_2d",R.keyword,"texture_storage_2d"),texture_storage_2d_array:new P("texture_storage_2d_array",R.keyword,"texture_storage_2d_array"),texture_storage_3d:new P("texture_storage_3d",R.keyword,"texture_storage_3d"),texture_depth_2d:new P("texture_depth_2d",R.keyword,"texture_depth_2d"),texture_depth_2d_array:new P("texture_depth_2d_array",R.keyword,"texture_depth_2d_array"),texture_depth_cube:new P("texture_depth_cube",R.keyword,"texture_depth_cube"),texture_depth_cube_array:new P("texture_depth_cube_array",R.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new P("texture_depth_multisampled_2d",R.keyword,"texture_depth_multisampled_2d"),texture_external:new P("texture_external",R.keyword,"texture_external"),u32:new P("u32",R.keyword,"u32"),vec2:new P("vec2",R.keyword,"vec2"),vec3:new P("vec3",R.keyword,"vec3"),vec4:new P("vec4",R.keyword,"vec4"),bitcast:new P("bitcast",R.keyword,"bitcast"),block:new P("block",R.keyword,"block"),break:new P("break",R.keyword,"break"),case:new P("case",R.keyword,"case"),continue:new P("continue",R.keyword,"continue"),continuing:new P("continuing",R.keyword,"continuing"),default:new P("default",R.keyword,"default"),diagnostic:new P("diagnostic",R.keyword,"diagnostic"),discard:new P("discard",R.keyword,"discard"),else:new P("else",R.keyword,"else"),enable:new P("enable",R.keyword,"enable"),fallthrough:new P("fallthrough",R.keyword,"fallthrough"),false:new P("false",R.keyword,"false"),fn:new P("fn",R.keyword,"fn"),for:new P("for",R.keyword,"for"),function:new P("function",R.keyword,"function"),if:new P("if",R.keyword,"if"),let:new P("let",R.keyword,"let"),const:new P("const",R.keyword,"const"),loop:new P("loop",R.keyword,"loop"),while:new P("while",R.keyword,"while"),private:new P("private",R.keyword,"private"),read:new P("read",R.keyword,"read"),read_write:new P("read_write",R.keyword,"read_write"),return:new P("return",R.keyword,"return"),requires:new P("requires",R.keyword,"requires"),storage:new P("storage",R.keyword,"storage"),switch:new P("switch",R.keyword,"switch"),true:new P("true",R.keyword,"true"),alias:new P("alias",R.keyword,"alias"),type:new P("type",R.keyword,"type"),uniform:new P("uniform",R.keyword,"uniform"),var:new P("var",R.keyword,"var"),override:new P("override",R.keyword,"override"),workgroup:new P("workgroup",R.keyword,"workgroup"),write:new P("write",R.keyword,"write"),r8unorm:new P("r8unorm",R.keyword,"r8unorm"),r8snorm:new P("r8snorm",R.keyword,"r8snorm"),r8uint:new P("r8uint",R.keyword,"r8uint"),r8sint:new P("r8sint",R.keyword,"r8sint"),r16uint:new P("r16uint",R.keyword,"r16uint"),r16sint:new P("r16sint",R.keyword,"r16sint"),r16float:new P("r16float",R.keyword,"r16float"),rg8unorm:new P("rg8unorm",R.keyword,"rg8unorm"),rg8snorm:new P("rg8snorm",R.keyword,"rg8snorm"),rg8uint:new P("rg8uint",R.keyword,"rg8uint"),rg8sint:new P("rg8sint",R.keyword,"rg8sint"),r32uint:new P("r32uint",R.keyword,"r32uint"),r32sint:new P("r32sint",R.keyword,"r32sint"),r32float:new P("r32float",R.keyword,"r32float"),rg16uint:new P("rg16uint",R.keyword,"rg16uint"),rg16sint:new P("rg16sint",R.keyword,"rg16sint"),rg16float:new P("rg16float",R.keyword,"rg16float"),rgba8unorm:new P("rgba8unorm",R.keyword,"rgba8unorm"),rgba8unorm_srgb:new P("rgba8unorm_srgb",R.keyword,"rgba8unorm_srgb"),rgba8snorm:new P("rgba8snorm",R.keyword,"rgba8snorm"),rgba8uint:new P("rgba8uint",R.keyword,"rgba8uint"),rgba8sint:new P("rgba8sint",R.keyword,"rgba8sint"),bgra8unorm:new P("bgra8unorm",R.keyword,"bgra8unorm"),bgra8unorm_srgb:new P("bgra8unorm_srgb",R.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new P("rgb10a2unorm",R.keyword,"rgb10a2unorm"),rg11b10float:new P("rg11b10float",R.keyword,"rg11b10float"),rg32uint:new P("rg32uint",R.keyword,"rg32uint"),rg32sint:new P("rg32sint",R.keyword,"rg32sint"),rg32float:new P("rg32float",R.keyword,"rg32float"),rgba16uint:new P("rgba16uint",R.keyword,"rgba16uint"),rgba16sint:new P("rgba16sint",R.keyword,"rgba16sint"),rgba16float:new P("rgba16float",R.keyword,"rgba16float"),rgba32uint:new P("rgba32uint",R.keyword,"rgba32uint"),rgba32sint:new P("rgba32sint",R.keyword,"rgba32sint"),rgba32float:new P("rgba32float",R.keyword,"rgba32float"),static_assert:new P("static_assert",R.keyword,"static_assert")};S.tokens={decimal_float_literal:new P("decimal_float_literal",R.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new P("hex_float_literal",R.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new P("int_literal",R.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new P("uint_literal",R.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new P("ident",R.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new P("and",R.token,"&"),and_and:new P("and_and",R.token,"&&"),arrow:new P("arrow ",R.token,"->"),attr:new P("attr",R.token,"@"),forward_slash:new P("forward_slash",R.token,"/"),bang:new P("bang",R.token,"!"),bracket_left:new P("bracket_left",R.token,"["),bracket_right:new P("bracket_right",R.token,"]"),brace_left:new P("brace_left",R.token,"{"),brace_right:new P("brace_right",R.token,"}"),colon:new P("colon",R.token,":"),comma:new P("comma",R.token,","),equal:new P("equal",R.token,"="),equal_equal:new P("equal_equal",R.token,"=="),not_equal:new P("not_equal",R.token,"!="),greater_than:new P("greater_than",R.token,">"),greater_than_equal:new P("greater_than_equal",R.token,">="),shift_right:new P("shift_right",R.token,">>"),less_than:new P("less_than",R.token,"<"),less_than_equal:new P("less_than_equal",R.token,"<="),shift_left:new P("shift_left",R.token,"<<"),modulo:new P("modulo",R.token,"%"),minus:new P("minus",R.token,"-"),minus_minus:new P("minus_minus",R.token,"--"),period:new P("period",R.token,"."),plus:new P("plus",R.token,"+"),plus_plus:new P("plus_plus",R.token,"++"),or:new P("or",R.token,"|"),or_or:new P("or_or",R.token,"||"),paren_left:new P("paren_left",R.token,"("),paren_right:new P("paren_right",R.token,")"),semicolon:new P("semicolon",R.token,";"),star:new P("star",R.token,"*"),tilde:new P("tilde",R.token,"~"),underscore:new P("underscore",R.token,"_"),xor:new P("xor",R.token,"^"),plus_equal:new P("plus_equal",R.token,"+="),minus_equal:new P("minus_equal",R.token,"-="),times_equal:new P("times_equal",R.token,"*="),division_equal:new P("division_equal",R.token,"/="),modulo_equal:new P("modulo_equal",R.token,"%="),and_equal:new P("and_equal",R.token,"&="),or_equal:new P("or_equal",R.token,"|="),xor_equal:new P("xor_equal",R.token,"^="),shift_right_equal:new P("shift_right_equal",R.token,">>="),shift_left_equal:new P("shift_left_equal",R.token,"<<=")};S.simpleTokens={"@":O.tokens.attr,"{":O.tokens.brace_left,"}":O.tokens.brace_right,":":O.tokens.colon,",":O.tokens.comma,"(":O.tokens.paren_left,")":O.tokens.paren_right,";":O.tokens.semicolon};S.literalTokens={"&":O.tokens.and,"&&":O.tokens.and_and,"->":O.tokens.arrow,"/":O.tokens.forward_slash,"!":O.tokens.bang,"[":O.tokens.bracket_left,"]":O.tokens.bracket_right,"=":O.tokens.equal,"==":O.tokens.equal_equal,"!=":O.tokens.not_equal,">":O.tokens.greater_than,">=":O.tokens.greater_than_equal,">>":O.tokens.shift_right,"<":O.tokens.less_than,"<=":O.tokens.less_than_equal,"<<":O.tokens.shift_left,"%":O.tokens.modulo,"-":O.tokens.minus,"--":O.tokens.minus_minus,".":O.tokens.period,"+":O.tokens.plus,"++":O.tokens.plus_plus,"|":O.tokens.or,"||":O.tokens.or_or,"*":O.tokens.star,"~":O.tokens.tilde,_:O.tokens.underscore,"^":O.tokens.xor,"+=":O.tokens.plus_equal,"-=":O.tokens.minus_equal,"*=":O.tokens.times_equal,"/=":O.tokens.division_equal,"%=":O.tokens.modulo_equal,"&=":O.tokens.and_equal,"|=":O.tokens.or_equal,"^=":O.tokens.xor_equal,">>=":O.tokens.shift_right_equal,"<<=":O.tokens.shift_left_equal};S.regexTokens={decimal_float_literal:O.tokens.decimal_float_literal,hex_float_literal:O.tokens.hex_float_literal,int_literal:O.tokens.int_literal,uint_literal:O.tokens.uint_literal,ident:O.tokens.ident};S.storage_class=[O.keywords.function,O.keywords.private,O.keywords.workgroup,O.keywords.uniform,O.keywords.storage];S.access_mode=[O.keywords.read,O.keywords.write,O.keywords.read_write];S.sampler_type=[O.keywords.sampler,O.keywords.sampler_comparison];S.sampled_texture_type=[O.keywords.texture_1d,O.keywords.texture_2d,O.keywords.texture_2d_array,O.keywords.texture_3d,O.keywords.texture_cube,O.keywords.texture_cube_array];S.multisampled_texture_type=[O.keywords.texture_multisampled_2d];S.storage_texture_type=[O.keywords.texture_storage_1d,O.keywords.texture_storage_2d,O.keywords.texture_storage_2d_array,O.keywords.texture_storage_3d];S.depth_texture_type=[O.keywords.texture_depth_2d,O.keywords.texture_depth_2d_array,O.keywords.texture_depth_cube,O.keywords.texture_depth_cube_array,O.keywords.texture_depth_multisampled_2d];S.texture_external_type=[O.keywords.texture_external];S.any_texture_type=[...O.sampled_texture_type,...O.multisampled_texture_type,...O.storage_texture_type,...O.depth_texture_type,...O.texture_external_type];S.texel_format=[O.keywords.r8unorm,O.keywords.r8snorm,O.keywords.r8uint,O.keywords.r8sint,O.keywords.r16uint,O.keywords.r16sint,O.keywords.r16float,O.keywords.rg8unorm,O.keywords.rg8snorm,O.keywords.rg8uint,O.keywords.rg8sint,O.keywords.r32uint,O.keywords.r32sint,O.keywords.r32float,O.keywords.rg16uint,O.keywords.rg16sint,O.keywords.rg16float,O.keywords.rgba8unorm,O.keywords.rgba8unorm_srgb,O.keywords.rgba8snorm,O.keywords.rgba8uint,O.keywords.rgba8sint,O.keywords.bgra8unorm,O.keywords.bgra8unorm_srgb,O.keywords.rgb10a2unorm,O.keywords.rg11b10float,O.keywords.rg32uint,O.keywords.rg32sint,O.keywords.rg32float,O.keywords.rgba16uint,O.keywords.rgba16sint,O.keywords.rgba16float,O.keywords.rgba32uint,O.keywords.rgba32sint,O.keywords.rgba32float];S.const_literal=[O.tokens.int_literal,O.tokens.uint_literal,O.tokens.decimal_float_literal,O.tokens.hex_float_literal,O.keywords.true,O.keywords.false];S.literal_or_ident=[O.tokens.ident,O.tokens.int_literal,O.tokens.uint_literal,O.tokens.decimal_float_literal,O.tokens.hex_float_literal];S.element_count_expression=[O.tokens.int_literal,O.tokens.uint_literal,O.tokens.ident];S.template_types=[O.keywords.vec2,O.keywords.vec3,O.keywords.vec4,O.keywords.mat2x2,O.keywords.mat2x3,O.keywords.mat2x4,O.keywords.mat3x2,O.keywords.mat3x3,O.keywords.mat3x4,O.keywords.mat4x2,O.keywords.mat4x3,O.keywords.mat4x4,O.keywords.atomic,O.keywords.bitcast,...O.any_texture_type];S.attribute_name=[O.tokens.ident,O.keywords.block,O.keywords.diagnostic];S.assignment_operators=[O.tokens.equal,O.tokens.plus_equal,O.tokens.minus_equal,O.tokens.times_equal,O.tokens.division_equal,O.tokens.modulo_equal,O.tokens.and_equal,O.tokens.or_equal,O.tokens.xor_equal,O.tokens.shift_right_equal,O.tokens.shift_left_equal];S.increment_operators=[O.tokens.plus_plus,O.tokens.minus_minus];var sp=class{constructor(t,r,n){this.type=t,this.lexeme=r,this.line=n}toString(){return this.lexeme}isTemplateType(){return S.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==S.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}},cy=class{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=t??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new sp(S.eof,"",this._line)),this._tokens}scanToken(){let t=this._advance();if(t==`
  `)return this._line++,!0;if(this._isWhitespace(t))return!0;if(t=="/"){if(this._peekAhead()=="/"){for(;t!=`
  `;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(t=this._advance(),t==`
  `)this._line++;else if(t=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else t=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}let r=S.simpleTokens[t];if(r)return this._addToken(r),!0;let n=S.none,s=this._isAlpha(t),i=t==="_";if(this._isAlphaNumeric(t)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)t+=this._advance(),o=this._peekAhead()}if(s){let o=S.keywords[t];if(o)return this._addToken(o),!0}if(s||i)return this._addToken(S.tokens.ident),!0;for(;;){let o=this._findType(t),a=this._peekAhead();if(t==">"&&(a==">"||a=="=")){let c=!1,l=this._tokens.length-1;for(let h=0;h<5&&l>=0&&S.assignment_operators.indexOf(this._tokens[l].type)===-1;++h,--l)if(this._tokens[l].type===S.tokens.less_than){l>0&&this._tokens[l-1].isArrayOrTemplateType()&&(c=!0);break}if(c)return this._addToken(o),!0}if(o===S.none){let c=t,l=0,h=2;for(let f=0;f<h;++f)if(c+=this._peekAhead(f),o=this._findType(c),o!==S.none){l=f;break}if(o===S.none)return n===S.none?!1:(this._current--,this._addToken(n),!0);t=c,this._current+=l+1}if(n=o,this._isAtEnd())break;t+=this._advance()}return n===S.none?!1:(this._addToken(n),!0)}_findType(t){for(let n in S.regexTokens){let s=S.regexTokens[n];if(this._match(t,s.rule))return s}let r=S.literalTokens[t];return r||S.none}_match(t,r){let n=r.exec(t);return n&&n.index==0&&n[0]==t}_isAtEnd(){return this._current>=this._source.length}_isAlpha(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}_isAlphaNumeric(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||t=="_"||t>="0"&&t<="9"}_isWhitespace(t){return t==" "||t=="	"||t=="\r"}_advance(t=0){let r=this._source[this._current];return t=t||0,t++,this._current+=t,r}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){let r=this._source.substring(this._start,this._current);this._tokens.push(new sp(t,r,this._line))}},ly=class{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new Nx,this._deferArrayCountEval=[]}parse(t){this._initialize(t),this._deferArrayCountEval.length=0;let r=[];for(;!this._isAtEnd();){let n=this._global_decl_or_directive();if(!n)break;r.push(n)}if(this._deferArrayCountEval.length>0){for(let n of this._deferArrayCountEval){let s=n.arrayType,i=n.countNode;if(i instanceof jl){let a=i.name,c=this._context.constants.get(a);if(c)try{let l=c.evaluate(this._context);s.count=l}catch{}}}this._deferArrayCountEval.length=0}return r}_initialize(t){if(t)if(typeof t=="string"){let r=new cy(t);this._tokens=r.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_error(t,r){return{token:t,message:r,toString:function(){return`${r}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==S.eof}_match(t){if(t instanceof P)return this._check(t)?(this._advance(),!0):!1;for(let r=0,n=t.length;r<n;++r){let s=t[r];if(this._check(s))return this._advance(),!0}return!1}_consume(t,r){if(this._check(t))return this._advance();throw this._error(this._peek(),r)}_check(t){if(this._isAtEnd())return!1;let r=this._peek();if(t instanceof Array){let n=r.type;return t.indexOf(n)!=-1}return r.type==t}_advance(){var t,r;return this._currentLine=(r=(t=this._peek())===null||t===void 0?void 0:t.line)!==null&&r!==void 0?r:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(S.tokens.semicolon)&&!this._isAtEnd(););if(this._match(S.keywords.alias)){let r=this._type_alias();return this._consume(S.tokens.semicolon,"Expected ';'"),r}if(this._match(S.keywords.diagnostic)){let r=this._diagnostic();return this._consume(S.tokens.semicolon,"Expected ';'"),r}if(this._match(S.keywords.requires)){let r=this._requires_directive();return this._consume(S.tokens.semicolon,"Expected ';'"),r}if(this._match(S.keywords.enable)){let r=this._enable_directive();return this._consume(S.tokens.semicolon,"Expected ';'"),r}let t=this._attribute();if(this._check(S.keywords.var)){let r=this._global_variable_decl();return r!=null&&(r.attributes=t),this._consume(S.tokens.semicolon,"Expected ';'."),r}if(this._check(S.keywords.override)){let r=this._override_variable_decl();return r!=null&&(r.attributes=t),this._consume(S.tokens.semicolon,"Expected ';'."),r}if(this._check(S.keywords.let)){let r=this._global_let_decl();return r!=null&&(r.attributes=t),this._consume(S.tokens.semicolon,"Expected ';'."),r}if(this._check(S.keywords.const)){let r=this._global_const_decl();return r!=null&&(r.attributes=t),this._consume(S.tokens.semicolon,"Expected ';'."),r}if(this._check(S.keywords.struct)){let r=this._struct_decl();return r!=null&&(r.attributes=t),r}if(this._check(S.keywords.fn)){let r=this._function_decl();return r!=null&&(r.attributes=t),r}return null}_function_decl(){if(!this._match(S.keywords.fn))return null;let t=this._currentLine,r=this._consume(S.tokens.ident,"Expected function name.").toString();this._consume(S.tokens.paren_left,"Expected '(' for function arguments.");let n=[];if(!this._check(S.tokens.paren_right))do{if(this._check(S.tokens.paren_right))break;let a=this._attribute(),c=this._consume(S.tokens.ident,"Expected argument name.").toString();this._consume(S.tokens.colon,"Expected ':' for argument type.");let l=this._attribute(),h=this._type_decl();h!=null&&(h.attributes=l,n.push(new sy(c,h,a)))}while(this._match(S.tokens.comma));this._consume(S.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(S.tokens.arrow)){let a=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=a)}let i=this._compound_statement(),o=this._currentLine;return new Hl(r,n,s,i,t,o)}_compound_statement(){let t=[];for(this._consume(S.tokens.brace_left,"Expected '{' for block.");!this._check(S.tokens.brace_right);){let r=this._statement();r!==null&&t.push(r)}return this._consume(S.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(S.tokens.semicolon)&&!this._isAtEnd(););if(this._check(S.tokens.attr)&&this._attribute(),this._check(S.keywords.if))return this._if_statement();if(this._check(S.keywords.switch))return this._switch_statement();if(this._check(S.keywords.loop))return this._loop_statement();if(this._check(S.keywords.for))return this._for_statement();if(this._check(S.keywords.while))return this._while_statement();if(this._check(S.keywords.continuing))return this._continuing_statement();if(this._check(S.keywords.static_assert))return this._static_assert_statement();if(this._check(S.tokens.brace_left))return this._compound_statement();let t=null;return this._check(S.keywords.return)?t=this._return_statement():this._check([S.keywords.var,S.keywords.let,S.keywords.const])?t=this._variable_statement():this._match(S.keywords.discard)?t=new Yx:this._match(S.keywords.break)?t=new $x:this._match(S.keywords.continue)?t=new Kx:t=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),t!=null&&this._consume(S.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(S.keywords.static_assert))return null;let t=this._optional_paren_expression();return new Bx(t)}_while_statement(){if(!this._match(S.keywords.while))return null;let t=this._optional_paren_expression();this._check(S.tokens.attr)&&this._attribute();let r=this._compound_statement();return new Fx(t,r)}_continuing_statement(){if(!this._match(S.keywords.continuing))return null;let t=this._compound_statement();return new Dx(t)}_for_statement(){if(!this._match(S.keywords.for))return null;this._consume(S.tokens.paren_left,"Expected '('.");let t=this._check(S.tokens.semicolon)?null:this._for_init();this._consume(S.tokens.semicolon,"Expected ';'.");let r=this._check(S.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(S.tokens.semicolon,"Expected ';'.");let n=this._check(S.tokens.paren_right)?null:this._for_increment();this._consume(S.tokens.paren_right,"Expected ')'."),this._check(S.tokens.attr)&&this._attribute();let s=this._compound_statement();return new kx(t,r,n,s)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(S.keywords.var)){let t=this._variable_decl();if(t===null)throw this._error(this._peek(),"Variable declaration expected.");let r=null;return this._match(S.tokens.equal)&&(r=this._short_circuit_or_expression()),new zn(t.name,t.type,t.storage,t.access,r)}if(this._match(S.keywords.let)){let t=this._consume(S.tokens.ident,"Expected name for let.").toString(),r=null;if(this._match(S.tokens.colon)){let s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(S.tokens.equal,"Expected '=' for let.");let n=this._short_circuit_or_expression();return new Wl(t,r,null,null,n)}if(this._match(S.keywords.const)){let t=this._consume(S.tokens.ident,"Expected name for const.").toString(),r=null;if(this._match(S.tokens.colon)){let s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(S.tokens.equal,"Expected '=' for const.");let n=this._short_circuit_or_expression();return new qd(t,r,null,null,n)}return null}_increment_decrement_statement(){let t=this._current,r=this._unary_expression();if(r==null)return null;if(!this._check(S.increment_operators))return this._current=t,null;let n=this._consume(S.increment_operators,"Expected increment operator");return new Ux(n.type===S.tokens.plus_plus?ga.increment:ga.decrement,r)}_assignment_statement(){let t=null;if(this._check(S.tokens.brace_right))return null;let r=this._match(S.tokens.underscore);if(r||(t=this._unary_expression()),!r&&t==null)return null;let n=this._consume(S.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return new zx(Gl.parse(n.lexeme),t,s)}_func_call_statement(){if(!this._check(S.tokens.ident))return null;let t=this._current,r=this._consume(S.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=t,null):new Xd(r.lexeme,n)}_loop_statement(){if(!this._match(S.keywords.loop))return null;this._check(S.tokens.attr)&&this._attribute(),this._consume(S.tokens.brace_left,"Expected '{' for loop.");let t=[],r=this._statement();for(;r!==null;){if(Array.isArray(r))for(let s of r)t.push(s);else t.push(r);r=this._statement()}let n=null;return this._match(S.keywords.continuing)&&(n=this._compound_statement()),this._consume(S.tokens.brace_right,"Expected '}' for loop."),new Vx(t,n)}_switch_statement(){if(!this._match(S.keywords.switch))return null;let t=this._optional_paren_expression();this._check(S.tokens.attr)&&this._attribute(),this._consume(S.tokens.brace_left,"Expected '{' for switch.");let r=this._switch_body();if(r==null||r.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(S.tokens.brace_right,"Expected '}' for switch."),new Hx(t,r)}_switch_body(){let t=[];if(this._match(S.keywords.case)){let r=this._case_selectors();this._match(S.tokens.colon),this._check(S.tokens.attr)&&this._attribute(),this._consume(S.tokens.brace_left,"Exected '{' for switch case.");let n=this._case_body();this._consume(S.tokens.brace_right,"Exected '}' for switch case."),t.push(new ry(r,n))}if(this._match(S.keywords.default)){this._match(S.tokens.colon),this._check(S.tokens.attr)&&this._attribute(),this._consume(S.tokens.brace_left,"Exected '{' for switch default.");let r=this._case_body();this._consume(S.tokens.brace_right,"Exected '}' for switch default."),t.push(new ny(r))}if(this._check([S.keywords.default,S.keywords.case])){let r=this._switch_body();t.push(r[0])}return t}_case_selectors(){let t=[this._shift_expression()];for(;this._match(S.tokens.comma);)t.push(this._shift_expression());return t}_case_body(){if(this._match(S.keywords.fallthrough))return this._consume(S.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(t==null)return[];t instanceof Array||(t=[t]);let r=this._case_body();return r.length==0?t:[...t,r[0]]}_if_statement(){if(!this._match(S.keywords.if))return null;let t=this._optional_paren_expression();this._check(S.tokens.attr)&&this._attribute();let r=this._compound_statement(),n=[];this._match_elseif()&&(this._check(S.tokens.attr)&&this._attribute(),n=this._elseif_statement(n));let s=null;return this._match(S.keywords.else)&&(this._check(S.tokens.attr)&&this._attribute(),s=this._compound_statement()),new Wx(t,r,n,s)}_match_elseif(){return this._tokens[this._current].type===S.keywords.else&&this._tokens[this._current+1].type===S.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(t=[]){let r=this._optional_paren_expression(),n=this._compound_statement();return t.push(new iy(r,n)),this._match_elseif()&&(this._check(S.tokens.attr)&&this._attribute(),this._elseif_statement(t)),t}_return_statement(){if(!this._match(S.keywords.return))return null;let t=this._short_circuit_or_expression();return new Gx(t)}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(S.tokens.or_or);)t=new _r(this._previous().toString(),t,this._short_circuit_and_expr());return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(S.tokens.and_and);)t=new _r(this._previous().toString(),t,this._inclusive_or_expression());return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(S.tokens.or);)t=new _r(this._previous().toString(),t,this._exclusive_or_expression());return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(S.tokens.xor);)t=new _r(this._previous().toString(),t,this._and_expression());return t}_and_expression(){let t=this._equality_expression();for(;this._match(S.tokens.and);)t=new _r(this._previous().toString(),t,this._equality_expression());return t}_equality_expression(){let t=this._relational_expression();return this._match([S.tokens.equal_equal,S.tokens.not_equal])?new _r(this._previous().toString(),t,this._relational_expression()):t}_relational_expression(){let t=this._shift_expression();for(;this._match([S.tokens.less_than,S.tokens.greater_than,S.tokens.less_than_equal,S.tokens.greater_than_equal]);)t=new _r(this._previous().toString(),t,this._shift_expression());return t}_shift_expression(){let t=this._additive_expression();for(;this._match([S.tokens.shift_left,S.tokens.shift_right]);)t=new _r(this._previous().toString(),t,this._additive_expression());return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([S.tokens.plus,S.tokens.minus]);)t=new _r(this._previous().toString(),t,this._multiplicative_expression());return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([S.tokens.star,S.tokens.forward_slash,S.tokens.modulo]);)t=new _r(this._previous().toString(),t,this._unary_expression());return t}_unary_expression(){return this._match([S.tokens.minus,S.tokens.bang,S.tokens.tilde,S.tokens.star,S.tokens.and])?new ey(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){let t=this._primary_expression(),r=this._postfix_expression();return r&&(t.postfix=r),t}_postfix_expression(){if(this._match(S.tokens.bracket_left)){let t=this._short_circuit_or_expression();this._consume(S.tokens.bracket_right,"Expected ']'.");let r=new ty(t),n=this._postfix_expression();return n&&(r.postfix=n),r}if(this._match(S.tokens.period)){let t=this._consume(S.tokens.ident,"Expected member name."),r=this._postfix_expression(),n=new Zd(t.lexeme);return r&&(n.postfix=r),n}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_primary_expression(){if(this._match(S.tokens.ident)){let n=this._previous().toString();if(this._check(S.tokens.paren_left)){let s=this._argument_expression_list(),i=this._getStruct(n);return i!=null?new Os(i,s):new Jd(n,s)}if(this._context.constants.has(n)){let s=this._context.constants.get(n);return new Qd(n,s.value)}return new jl(n)}if(this._match(S.const_literal))return new tp(parseFloat(this._previous().toString()));if(this._check(S.tokens.paren_left))return this._paren_expression();if(this._match(S.keywords.bitcast)){this._consume(S.tokens.less_than,"Expected '<'.");let n=this._type_decl();this._consume(S.tokens.greater_than,"Expected '>'.");let s=this._paren_expression();return new Jx(n,s)}let t=this._type_decl(),r=this._argument_expression_list();return new Qx(t,r)}_argument_expression_list(){if(!this._match(S.tokens.paren_left))return null;let t=[];do{if(this._check(S.tokens.paren_right))break;let r=this._short_circuit_or_expression();t.push(r)}while(this._match(S.tokens.comma));return this._consume(S.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(S.tokens.paren_left);let t=this._short_circuit_or_expression();return this._match(S.tokens.paren_right),new ep([t])}_paren_expression(){this._consume(S.tokens.paren_left,"Expected '('.");let t=this._short_circuit_or_expression();return this._consume(S.tokens.paren_right,"Expected ')'."),new ep([t])}_struct_decl(){if(!this._match(S.keywords.struct))return null;let t=this._currentLine,r=this._consume(S.tokens.ident,"Expected name for struct.").toString();this._consume(S.tokens.brace_left,"Expected '{' for struct body.");let n=[];for(;!this._check(S.tokens.brace_right);){let o=this._attribute(),a=this._consume(S.tokens.ident,"Expected variable name.").toString();this._consume(S.tokens.colon,"Expected ':' for struct member type.");let c=this._attribute(),l=this._type_decl();l!=null&&(l.attributes=c),this._check(S.tokens.brace_right)?this._match(S.tokens.comma):this._consume(S.tokens.comma,"Expected ',' for struct member."),n.push(new oy(a,l,o))}this._consume(S.tokens.brace_right,"Expected '}' after struct body.");let s=this._currentLine,i=new Un(r,n,t,s);return this._context.structs.set(r,i),i}_global_variable_decl(){let t=this._variable_decl();return t&&this._match(S.tokens.equal)&&(t.value=this._const_expression()),t}_override_variable_decl(){let t=this._override_decl();return t&&this._match(S.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){if(!this._match(S.keywords.const))return null;let t=this._consume(S.tokens.ident,"Expected variable name"),r=null;if(this._match(S.tokens.colon)){let i=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=i)}let n=null;if(this._match(S.tokens.equal)){let i=this._short_circuit_or_expression();if(i instanceof Os)n=i;else if(i instanceof Qd&&i.initializer instanceof Os)n=i.initializer;else try{let o=i.evaluate(this._context);n=new tp(o)}catch{n=i}}let s=new qd(t.toString(),r,"","",n);return this._context.constants.set(s.name,s),s}_global_let_decl(){if(!this._match(S.keywords.let))return null;let t=this._consume(S.tokens.ident,"Expected variable name"),r=null;if(this._match(S.tokens.colon)){let s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}let n=null;return this._match(S.tokens.equal)&&(n=this._const_expression()),new Wl(t.toString(),r,"","",n)}_const_expression(){if(this._match(S.const_literal))return new Zd(this._previous().toString());let t=this._type_decl();this._consume(S.tokens.paren_left,"Expected '('.");let r=[];for(;!this._check(S.tokens.paren_right)&&(r.push(this._const_expression()),!!this._check(S.tokens.comma));)this._advance();return this._consume(S.tokens.paren_right,"Expected ')'."),new Os(t,r)}_variable_decl(){if(!this._match(S.keywords.var))return null;let t="",r="";this._match(S.tokens.less_than)&&(t=this._consume(S.storage_class,"Expected storage_class.").toString(),this._match(S.tokens.comma)&&(r=this._consume(S.access_mode,"Expected access_mode.").toString()),this._consume(S.tokens.greater_than,"Expected '>'."));let n=this._consume(S.tokens.ident,"Expected variable name"),s=null;if(this._match(S.tokens.colon)){let i=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=i)}return new zn(n.toString(),s,t,r,null)}_override_decl(){if(!this._match(S.keywords.override))return null;let t=this._consume(S.tokens.ident,"Expected variable name"),r=null;if(this._match(S.tokens.colon)){let n=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=n)}return new jd(t.toString(),r,null)}_diagnostic(){this._consume(S.tokens.paren_left,"Expected '('");let t=this._consume(S.tokens.ident,"Expected severity control name.");this._consume(S.tokens.comma,"Expected ','");let r=this._consume(S.tokens.ident,"Expected diagnostic rule name.");return this._consume(S.tokens.paren_right,"Expected ')'"),new Xx(t.toString(),r.toString())}_enable_directive(){let t=this._consume(S.tokens.ident,"identity expected.");return new jx(t.toString())}_requires_directive(){let t=[this._consume(S.tokens.ident,"identity expected.").toString()];for(;this._match(S.tokens.comma);){let r=this._consume(S.tokens.ident,"identity expected.");t.push(r.toString())}return new qx(t)}_type_alias(){let t=this._consume(S.tokens.ident,"identity expected.");this._consume(S.tokens.equal,"Expected '=' for type alias.");let r=this._type_decl();if(r===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let n=new Yd(t.toString(),r);return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([S.tokens.ident,...S.texel_format,S.keywords.bool,S.keywords.f32,S.keywords.i32,S.keywords.u32])){let n=this._advance(),s=n.toString();return this._context.structs.has(s)?this._context.structs.get(s):this._context.aliases.has(s)?this._context.aliases.get(s).type:new Vn(n.toString())}let t=this._texture_sampler_types();if(t)return t;if(this._check(S.template_types)){let n=this._advance().toString(),s=null,i=null;return this._match(S.tokens.less_than)&&(s=this._type_decl(),i=null,this._match(S.tokens.comma)&&(i=this._consume(S.access_mode,"Expected access_mode for pointer").toString()),this._consume(S.tokens.greater_than,"Expected '>' for type.")),new $d(n,s,i)}if(this._match(S.keywords.ptr)){let n=this._previous().toString();this._consume(S.tokens.less_than,"Expected '<' for pointer.");let s=this._consume(S.storage_class,"Expected storage_class for pointer");this._consume(S.tokens.comma,"Expected ',' for pointer.");let i=this._type_decl(),o=null;return this._match(S.tokens.comma)&&(o=this._consume(S.access_mode,"Expected access_mode for pointer").toString()),this._consume(S.tokens.greater_than,"Expected '>' for pointer."),new Zx(n,s.toString(),i,o)}let r=this._attribute();if(this._match(S.keywords.array)){let n=null,s=-1,i=this._previous(),o=null;if(this._match(S.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let c="";if(this._match(S.tokens.comma)){o=this._shift_expression();try{c=o.evaluate(this._context).toString(),o=null}catch{c="1"}}this._consume(S.tokens.greater_than,"Expected '>' for array."),s=c?parseInt(c):0}let a=new Kd(i.toString(),r,n,s);return o&&this._deferArrayCountEval.push({arrayType:a,countNode:o}),a}return null}_texture_sampler_types(){if(this._match(S.sampler_type))return new ki(this._previous().toString(),null,null);if(this._match(S.depth_texture_type))return new ki(this._previous().toString(),null,null);if(this._match(S.sampled_texture_type)||this._match(S.multisampled_texture_type)){let t=this._previous();this._consume(S.tokens.less_than,"Expected '<' for sampler type.");let r=this._type_decl();return this._consume(S.tokens.greater_than,"Expected '>' for sampler type."),new ki(t.toString(),r,null)}if(this._match(S.storage_texture_type)){let t=this._previous();this._consume(S.tokens.less_than,"Expected '<' for sampler type.");let r=this._consume(S.texel_format,"Invalid texel format.").toString();this._consume(S.tokens.comma,"Expected ',' after texel format.");let n=this._consume(S.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(S.tokens.greater_than,"Expected '>' for sampler type."),new ki(t.toString(),r,n)}return null}_attribute(){let t=[];for(;this._match(S.tokens.attr);){let r=this._consume(S.attribute_name,"Expected attribute name"),n=new ay(r.toString(),null);if(this._match(S.tokens.paren_left)){if(n.value=this._consume(S.literal_or_ident,"Expected attribute value").toString(),this._check(S.tokens.comma)){this._advance();do{let s=this._consume(S.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(s)}while(this._match(S.tokens.comma))}this._consume(S.tokens.paren_right,"Expected ')'")}t.push(n)}return t.length==0?null:t}},Ls=class{constructor(t,r){this.name=t,this.attributes=r,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}},ip=class{constructor(t,r,n){this.name=t,this.type=r,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},ha=class extends Ls{constructor(t,r){super(t,r),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}},Vl=class extends Ls{constructor(t,r){super(t,r),this.count=0,this.stride=0}get isArray(){return!0}},op=class extends Ls{constructor(t,r,n,s){super(t,n),this.format=r,this.access=s}get isTemplate(){return!0}},Is;(function(e){e[e.Uniform=0]="Uniform",e[e.Storage=1]="Storage",e[e.Texture=2]="Texture",e[e.Sampler=3]="Sampler",e[e.StorageTexture=4]="StorageTexture"})(Is||(Is={}));var fa=class{constructor(t,r,n,s,i,o,a){this.name=t,this.type=r,this.group=n,this.binding=s,this.attributes=i,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}},hy=class{constructor(t,r){this.name=t,this.type=r}},ua=class{constructor(t,r){this.align=t,this.size=r}},fy=class{constructor(t,r,n,s){this.name=t,this.type=r,this.locationType=n,this.location=s,this.interpolation=null}},ap=class{constructor(t,r,n,s){this.name=t,this.type=r,this.locationType=n,this.location=s}},uy=class{constructor(t,r=null){this.stage=null,this.inputs=[],this.outputs=[],this.resources=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=t,this.stage=r}},dy=class{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}},py=class{constructor(t,r,n,s){this.name=t,this.type=r,this.attributes=n,this.id=s}},gy=class{constructor(t){this.resources=null,this.inUse=!1,this.info=null,this.node=t}},xr=class{constructor(t){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new dy,this.functions=[],this._types=new Map,this._functions=new Map,t&&this.update(t)}_isStorageTexture(t){return t.name=="texture_storage_1d"||t.name=="texture_storage_2d"||t.name=="texture_storage_2d_array"||t.name=="texture_storage_3d"}update(t){let n=new ly().parse(t);for(let s of n)s instanceof Hl&&this._functions.set(s.name,new gy(s));for(let s of n)if(s instanceof Un){let i=this._getTypeInfo(s,null);i instanceof ha&&this.structs.push(i)}for(let s of n){if(s instanceof Yd){this.aliases.push(this._getAliasInfo(s));continue}if(s instanceof jd){let i=s,o=this._getAttributeNum(i.attributes,"id",0),a=i.type!=null?this._getTypeInfo(i.type,i.attributes):null;this.overrides.push(new py(i.name,a,i.attributes,o));continue}if(this._isUniformVar(s)){let i=s,o=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),c=this._getTypeInfo(i.type,i.attributes),l=new fa(i.name,c,o,a,i.attributes,Is.Uniform,i.access);this.uniforms.push(l);continue}if(this._isStorageVar(s)){let i=s,o=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),c=this._getTypeInfo(i.type,i.attributes),l=this._isStorageTexture(c),h=new fa(i.name,c,o,a,i.attributes,l?Is.StorageTexture:Is.Storage,i.access);this.storage.push(h);continue}if(this._isTextureVar(s)){let i=s,o=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),c=this._getTypeInfo(i.type,i.attributes),l=this._isStorageTexture(c),h=new fa(i.name,c,o,a,i.attributes,l?Is.StorageTexture:Is.Texture,i.access);l?this.storage.push(h):this.textures.push(h);continue}if(this._isSamplerVar(s)){let i=s,o=this._getAttributeNum(i.attributes,"group",0),a=this._getAttributeNum(i.attributes,"binding",0),c=this._getTypeInfo(i.type,i.attributes),l=new fa(i.name,c,o,a,i.attributes,Is.Sampler,i.access);this.samplers.push(l);continue}if(s instanceof Hl){let i=this._getAttribute(s,"vertex"),o=this._getAttribute(s,"fragment"),a=this._getAttribute(s,"compute"),c=i||o||a,l=new uy(s.name,c?.name);l.startLine=s.startLine,l.endLine=s.endLine,this.functions.push(l),this._functions.get(s.name).info=l,c&&(this._functions.get(s.name).inUse=!0,l.inUse=!0,l.resources=this._findResources(s,!!c),l.inputs=this._getInputs(s.args),l.outputs=this._getOutputs(s.returnType),this.entry[c.name].push(l));continue}}for(let s of this._functions.values())s.info&&(s.info.inUse=s.inUse,this._addCalls(s.node,s.info.calls));for(let s of this.uniforms)this._markStructsInUse(s.type);for(let s of this.storage)this._markStructsInUse(s.type)}_markStructsInUse(t){if(t.isStruct){t.inUse=!0;for(let r of t.members)this._markStructsInUse(r.type)}else if(t.isArray)this._markStructsInUse(t.format);else if(t.isTemplate)this._markStructsInUse(t.format);else{let r=this._getAlias(t.name);r&&this._markStructsInUse(r)}}_addCalls(t,r){var n;for(let s of t.calls){let i=(n=this._functions.get(s.name))===null||n===void 0?void 0:n.info;i&&r.add(i)}}findResource(t,r){for(let n of this.uniforms)if(n.group==t&&n.binding==r)return n;for(let n of this.storage)if(n.group==t&&n.binding==r)return n;for(let n of this.textures)if(n.group==t&&n.binding==r)return n;for(let n of this.samplers)if(n.group==t&&n.binding==r)return n;return null}_findResource(t){for(let r of this.uniforms)if(r.name==t)return r;for(let r of this.storage)if(r.name==t)return r;for(let r of this.textures)if(r.name==t)return r;for(let r of this.samplers)if(r.name==t)return r;return null}_markStructsFromAST(t){let r=this._getTypeInfo(t,null);this._markStructsInUse(r)}_findResources(t,r){let n=[],s=this,i=[];return t.search(o=>{if(o instanceof da)i.push({});else if(o instanceof pa)i.pop();else if(o instanceof zn){let a=o;r&&a.type!==null&&this._markStructsFromAST(a.type),i.length>0&&(i[i.length-1][a.name]=a)}else if(o instanceof Os){let a=o;r&&a.type!==null&&this._markStructsFromAST(a.type)}else if(o instanceof Wl){let a=o;r&&a.type!==null&&this._markStructsFromAST(a.type),i.length>0&&(i[i.length-1][a.name]=a)}else if(o instanceof jl){let a=o;if(i.length>0&&i[i.length-1][a.name])return;let c=s._findResource(a.name);c&&n.push(c)}else if(o instanceof Jd){let a=o,c=s._functions.get(a.name);c&&(r&&(c.inUse=!0),t.calls.add(c.node),c.resources===null&&(c.resources=s._findResources(c.node,r)),n.push(...c.resources))}else if(o instanceof Xd){let a=o,c=s._functions.get(a.name);c&&(r&&(c.inUse=!0),t.calls.add(c.node),c.resources===null&&(c.resources=s._findResources(c.node,r)),n.push(...c.resources))}}),[...new Map(n.map(o=>[o.name,o])).values()]}getBindGroups(){let t=[];function r(n,s){n>=t.length&&(t.length=n+1),t[n]===void 0&&(t[n]=[]),s>=t[n].length&&(t[n].length=s+1)}for(let n of this.uniforms){r(n.group,n.binding);let s=t[n.group];s[n.binding]=n}for(let n of this.storage){r(n.group,n.binding);let s=t[n.group];s[n.binding]=n}for(let n of this.textures){r(n.group,n.binding);let s=t[n.group];s[n.binding]=n}for(let n of this.samplers){r(n.group,n.binding);let s=t[n.group];s[n.binding]=n}return t}_getOutputs(t,r=void 0){if(r===void 0&&(r=[]),t instanceof Un)this._getStructOutputs(t,r);else{let n=this._getOutputInfo(t);n!==null&&r.push(n)}return r}_getStructOutputs(t,r){for(let n of t.members)if(n.type instanceof Un)this._getStructOutputs(n.type,r);else{let s=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(s!==null){let i=this._getTypeInfo(n.type,n.type.attributes),o=this._parseInt(s.value),a=new ap(n.name,i,s.name,o);r.push(a)}}}_getOutputInfo(t){let r=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(r!==null){let n=this._getTypeInfo(t,t.attributes),s=this._parseInt(r.value);return new ap("",n,r.name,s)}return null}_getInputs(t,r=void 0){r===void 0&&(r=[]);for(let n of t)if(n.type instanceof Un)this._getStructInputs(n.type,r);else{let s=this._getInputInfo(n);s!==null&&r.push(s)}return r}_getStructInputs(t,r){for(let n of t.members)if(n.type instanceof Un)this._getStructInputs(n.type,r);else{let s=this._getInputInfo(n);s!==null&&r.push(s)}}_getInputInfo(t){let r=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(r!==null){let n=this._getAttribute(t,"interpolation"),s=this._getTypeInfo(t.type,t.attributes),i=this._parseInt(r.value),o=new fy(t.name,s,r.name,i);return n!==null&&(o.interpolation=this._parseString(n.value)),o}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);let r=parseInt(t);return isNaN(r)?t:r}_getAlias(t){for(let r of this.aliases)if(r.name==t)return r.type;return null}_getAliasInfo(t){return new hy(t.name,this._getTypeInfo(t.type,null))}_getTypeInfo(t,r){if(this._types.has(t))return this._types.get(t);if(t instanceof Kd){let s=t,i=this._getTypeInfo(s.format,s.attributes),o=new Vl(s.name,r);return o.format=i,o.count=s.count,this._types.set(t,o),this._updateTypeInfo(o),o}if(t instanceof Un){let s=t,i=new ha(s.name,r);i.startLine=s.startLine,i.endLine=s.endLine;for(let o of s.members){let a=this._getTypeInfo(o.type,o.attributes);i.members.push(new ip(o.name,a,o.attributes))}return this._types.set(t,i),this._updateTypeInfo(i),i}if(t instanceof ki){let s=t,i=s.format instanceof Vn,o=s.format?i?this._getTypeInfo(s.format,null):new Ls(s.format,null):null,a=new op(s.name,o,r,s.access);return this._types.set(t,a),this._updateTypeInfo(a),a}if(t instanceof $d){let s=t,i=s.format?this._getTypeInfo(s.format,null):null,o=new op(s.name,i,r,s.access);return this._types.set(t,o),this._updateTypeInfo(o),o}let n=new Ls(t.name,r);return this._types.set(t,n),this._updateTypeInfo(n),n}_updateTypeInfo(t){var r,n;let s=this._getTypeSize(t);if(t.size=(r=s?.size)!==null&&r!==void 0?r:0,t instanceof Vl){let i=this._getTypeSize(t.format);t.stride=(n=i?.size)!==null&&n!==void 0?n:0,this._updateTypeInfo(t.format)}t instanceof ha&&this._updateStructInfo(t)}_updateStructInfo(t){var r;let n=0,s=0,i=0,o=0;for(let a=0,c=t.members.length;a<c;++a){let l=t.members[a],h=this._getTypeSize(l);if(!h)continue;(r=this._getAlias(l.type.name))!==null&&r!==void 0||l.type;let f=h.align,u=h.size;n=this._roundUp(f,n+s),s=u,i=n,o=Math.max(o,f),l.offset=n,l.size=u,this._updateTypeInfo(l.type)}t.size=this._roundUp(o,i+s),t.align=o}_getTypeSize(t){var r;if(t==null)return null;let n=this._getAttributeNum(t.attributes,"size",0),s=this._getAttributeNum(t.attributes,"align",0);if(t instanceof ip&&(t=t.type),t instanceof Ls){let i=this._getAlias(t.name);i!==null&&(t=i)}{let i=xr._typeInfo[t.name];if(i!==void 0){let o=t.format==="f16"?2:1;return new ua(Math.max(s,i.align/o),Math.max(n,i.size/o))}}{let i=xr._typeInfo[t.name.substring(0,t.name.length-1)];if(i){let o=t.name[t.name.length-1]==="h"?2:1;return new ua(Math.max(s,i.align/o),Math.max(n,i.size/o))}}if(t instanceof Vl){let i=t,o=8,a=8,c=this._getTypeSize(i.format);c!==null&&(a=c.size,o=c.align);let l=i.count,h=this._getAttributeNum((r=t?.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(o,a));return a=l*h,n&&(a=n),new ua(Math.max(s,o),Math.max(n,a))}if(t instanceof ha){let i=0,o=0,a=0,c=0,l=0;for(let h of t.members){let f=this._getTypeSize(h.type);f!==null&&(i=Math.max(f.align,i),a=this._roundUp(f.align,a+c),c=f.size,l=a)}return o=this._roundUp(i,l+c),new ua(Math.max(s,i),Math.max(n,o))}return null}_isUniformVar(t){return t instanceof zn&&t.storage=="uniform"}_isStorageVar(t){return t instanceof zn&&t.storage=="storage"}_isTextureVar(t){return t instanceof zn&&t.type!==null&&xr._textureTypes.indexOf(t.type.name)!=-1}_isSamplerVar(t){return t instanceof zn&&t.type!==null&&xr._samplerTypes.indexOf(t.type.name)!=-1}_getAttribute(t,r){let n=t;if(!n||!n.attributes)return null;let s=n.attributes;for(let i of s)if(i.name==r)return i;return null}_getAttributeNum(t,r,n){if(t===null)return n;for(let s of t)if(s.name==r){let i=s!==null&&s.value!==null?s.value:n;return i instanceof Array&&(i=i[0]),typeof i=="number"?i:typeof i=="string"?parseInt(i):n}return n}_roundUp(t,r){return Math.ceil(r/t)*t}};xr._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};xr._textureTypes=S.any_texture_type.map(e=>e.name);xr._samplerTypes=S.sampler_type.map(e=>e.name);function my(e){let t={attributes:[],bindings:[]},r;try{r=C9(e)}catch(i){return F.error(i.message)(),t}for(let i of r.uniforms){let o=[];for(let a of i.type?.members||[])o.push({name:a.name,type:U3(a.type)});t.bindings.push({type:"uniform",name:i.name,group:i.group,location:i.binding,members:o})}for(let i of r.textures)t.bindings.push({type:"texture",name:i.name,group:i.group,location:i.binding});for(let i of r.samplers)t.bindings.push({type:"sampler",name:i.name,group:i.group,location:i.binding});let n=r.entry.vertex[0],s=n?.inputs.length||0;for(let i=0;i<s;i++){let o=n.inputs[i];if(o.locationType==="location"){let a=U3(o.type);t.attributes.push({name:o.name,location:Number(o.location),type:a})}}return t}function U3(e){return e.format?`${e.name}<${e.format.name}>`:e.name}function C9(e){try{return new xr(e)}catch(t){if(t instanceof Error)throw t;let r="WGSL parse error";throw typeof t=="object"&&t?.message&&(r+=`: ${t.message} `),typeof t=="object"&&t?.token&&(r+=t.token.line||""),new Error(r,{cause:t})}}var P9=1/Math.PI*180,R9=1/180*Math.PI,I9={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...I9}};var Rt=globalThis.mathgl.config;function ql(e,{precision:t=Rt.precision}={}){return e=O9(e),`${parseFloat(e.toPrecision(t))}`}function ar(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ma(e,t){return _y(e,r=>r*R9,t)}function Ns(e,t){return _y(e,r=>r*P9,t)}function ft(e,t,r){return _y(e,n=>Math.max(t,Math.min(r,n)))}function he(e,t,r){return ar(e)?e.map((n,s)=>he(n,t[s],r)):r*t+(1-r)*e}function kt(e,t,r){let n=Rt.EPSILON;r&&(Rt.EPSILON=r);try{if(e===t)return!0;if(ar(e)&&ar(t)){if(e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(!kt(e[s],t[s]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=Rt.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{Rt.EPSILON=n}}function O9(e){return Math.round(e/Rt.EPSILON)*Rt.EPSILON}function L9(e){return e.clone?e.clone():new Array(e.length)}function _y(e,t,r){if(ar(e)){let n=e;r=r||L9(n);for(let s=0;s<r.length&&s<n.length;++s){let i=typeof e=="number"?e:e[s];r[s]=t(i,s,r)}return r}return t(e)}var Bs=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,r=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+r];return this.check()}toArray(t=[],r=0){for(let n=0;n<this.ELEMENTS;++n)t[r+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:ar(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Rt)}formatString(t){let r="";for(let n=0;n<this.ELEMENTS;++n)r+=(n>0?", ":"")+ql(this[n],t);return`${t.printTypes?this.constructor.name:""}[${r}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!kt(this[r],t[r]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==t[r])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,r,n){if(n===void 0)return this.lerp(this,t,r);for(let s=0;s<this.ELEMENTS;++s){let i=t[s],o=typeof r=="number"?r:r[s];this[s]=i+n*(o-i)}return this.check()}min(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(t[r],this[r]);return this.check()}max(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(t[r],this[r]);return this.check()}clamp(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),r[n]);return this.check()}add(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]+=r[n];return this.check()}subtract(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]-=r[n];return this.check()}scale(t){if(typeof t=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;else for(let r=0;r<this.ELEMENTS&&r<t.length;++r)this[r]*=t[r];return this.check()}multiplyByScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}check(){if(Rt.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)t=t&&Number.isFinite(this[r]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=t;return this.check()}addScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),r);return this.check()}get elements(){return this}};function N9(e,t){if(e.length!==t)return!1;for(let r=0;r<e.length;++r)if(!Number.isFinite(e[r]))return!1;return!0}function at(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function Fs(e,t,r=""){if(Rt.debug&&!N9(e,t))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return e}function fn(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}var Ds=class extends Bs{get x(){return this[0]}set x(t){this[0]=at(t)}get y(){return this[1]}set y(t){this[1]=at(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*this[r];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let r=0;for(let n=0;n<this.ELEMENTS;++n){let s=this[n]-t[n];r+=s*s}return at(r)}dot(t){let r=0;for(let n=0;n<this.ELEMENTS;++n)r+=this[n]*t[n];return at(r)}normalize(){let t=this.magnitude();if(t!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t;return this.check()}multiply(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]*=r[n];return this.check()}divide(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]/=r[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return fn(t>=0&&t<this.ELEMENTS,"index is out of range"),at(this[t])}setComponent(t,r){return fn(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=r,this.check()}addVectors(t,r){return this.copy(t).add(r)}subVectors(t,r){return this.copy(t).subtract(r)}multiplyVectors(t,r){return this.copy(t).multiply(r)}addScaledVector(t,r){return this.add(new this.constructor(t).multiplyScalar(r))}};var ie={};Bt(ie,{add:()=>U9,angle:()=>eH,ceil:()=>z9,clone:()=>B9,copy:()=>D9,create:()=>z3,cross:()=>Z9,dist:()=>hH,distance:()=>G3,div:()=>lH,divide:()=>W3,dot:()=>K9,equals:()=>iH,exactEquals:()=>sH,floor:()=>V9,forEach:()=>dH,fromValues:()=>F9,inverse:()=>Y9,len:()=>oH,length:()=>q3,lerp:()=>J9,max:()=>W9,min:()=>H9,mul:()=>cH,multiply:()=>H3,negate:()=>X9,normalize:()=>$9,random:()=>Q9,rotate:()=>tH,round:()=>G9,scale:()=>j9,scaleAndAdd:()=>q9,set:()=>k9,sqrDist:()=>fH,sqrLen:()=>uH,squaredDistance:()=>j3,squaredLength:()=>X3,str:()=>nH,sub:()=>aH,subtract:()=>V3,transformMat2:()=>xy,transformMat2d:()=>yy,transformMat3:()=>Xl,transformMat4:()=>Yl,zero:()=>rH});var bt=typeof Float32Array<"u"?Float32Array:Array,un=Math.random;function yr(e){return e>=0?Math.round(e):e%.5===0?Math.floor(e):Math.round(e)}var mxt=Math.PI/180;function z3(){let e=new bt(2);return bt!=Float32Array&&(e[0]=0,e[1]=0),e}function B9(e){let t=new bt(2);return t[0]=e[0],t[1]=e[1],t}function F9(e,t){let r=new bt(2);return r[0]=e,r[1]=t,r}function D9(e,t){return e[0]=t[0],e[1]=t[1],e}function k9(e,t,r){return e[0]=t,e[1]=r,e}function U9(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function V3(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function H3(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function W3(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function z9(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function V9(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function H9(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function W9(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function G9(e,t){return e[0]=yr(t[0]),e[1]=yr(t[1]),e}function j9(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function q9(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e}function G3(e,t){let r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function j3(e,t){let r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function q3(e){let t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function X3(e){let t=e[0],r=e[1];return t*t+r*r}function X9(e,t){return e[0]=-t[0],e[1]=-t[1],e}function Y9(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function $9(e,t){let r=t[0],n=t[1],s=r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e}function K9(e,t){return e[0]*t[0]+e[1]*t[1]}function Z9(e,t,r){let n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e}function J9(e,t,r,n){let s=t[0],i=t[1];return e[0]=s+n*(r[0]-s),e[1]=i+n*(r[1]-i),e}function Q9(e,t){t=t===void 0?1:t;let r=un()*2*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e}function xy(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[2]*s,e[1]=r[1]*n+r[3]*s,e}function yy(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[2]*s+r[4],e[1]=r[1]*n+r[3]*s+r[5],e}function Xl(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[3]*s+r[6],e[1]=r[1]*n+r[4]*s+r[7],e}function Yl(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[4]*s+r[12],e[1]=r[1]*n+r[5]*s+r[13],e}function tH(e,t,r,n){let s=t[0]-r[0],i=t[1]-r[1],o=Math.sin(n),a=Math.cos(n);return e[0]=s*a-i*o+r[0],e[1]=s*o+i*a+r[1],e}function eH(e,t){let r=e[0],n=e[1],s=t[0],i=t[1],o=Math.sqrt((r*r+n*n)*(s*s+i*i)),a=o&&(r*s+n*i)/o;return Math.acos(Math.min(Math.max(a,-1),1))}function rH(e){return e[0]=0,e[1]=0,e}function nH(e){return`vec2(${e[0]}, ${e[1]})`}function sH(e,t){return e[0]===t[0]&&e[1]===t[1]}function iH(e,t){let r=e[0],n=e[1],s=t[0],i=t[1];return Math.abs(r-s)<=1e-6*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-i)<=1e-6*Math.max(1,Math.abs(n),Math.abs(i))}var oH=q3,aH=V3,cH=H3,lH=W3,hH=G3,fH=j3,uH=X3,dH=function(){let e=z3();return function(t,r,n,s,i,o){let a,c;for(r||(r=2),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],i(e,e,o),t[a]=e[0],t[a+1]=e[1];return t}}();function cp(e,t,r){let n=t[0],s=t[1],i=r[3]*n+r[7]*s||1;return e[0]=(r[0]*n+r[4]*s)/i,e[1]=(r[1]*n+r[5]*s)/i,e}function lp(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[3]*n+r[7]*s+r[11]*i||1;return e[0]=(r[0]*n+r[4]*s+r[8]*i)/o,e[1]=(r[1]*n+r[5]*s+r[9]*i)/o,e[2]=(r[2]*n+r[6]*s+r[10]*i)/o,e}function Y3(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[2]*s,e[1]=r[1]*n+r[3]*s,e[2]=t[2],e}function $3(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[2]*s,e[1]=r[1]*n+r[3]*s,e[2]=t[2],e[3]=t[3],e}function hp(e,t,r){let n=t[0],s=t[1],i=t[2];return e[0]=r[0]*n+r[3]*s+r[6]*i,e[1]=r[1]*n+r[4]*s+r[7]*i,e[2]=r[2]*n+r[5]*s+r[8]*i,e[3]=t[3],e}var Ui=class extends Ds{constructor(t=0,r=0){super(2),ar(t)&&arguments.length===1?this.copy(t):(Rt.debug&&(at(t),at(r)),this[0]=t,this[1]=r)}set(t,r){return this[0]=t,this[1]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return Rt.debug&&(at(t.x),at(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Yl(this,this,t),this.check()}transformAsVector(t){return cp(this,this,t),this.check()}transformByMatrix3(t){return Xl(this,this,t),this.check()}transformByMatrix2x3(t){return yy(this,this,t),this.check()}transformByMatrix2(t){return xy(this,this,t),this.check()}};var pe={};Bt(pe,{add:()=>_H,angle:()=>by,bezier:()=>RH,ceil:()=>xH,clone:()=>pH,copy:()=>gH,create:()=>fp,cross:()=>zi,dist:()=>UH,distance:()=>Q3,div:()=>kH,divide:()=>J3,dot:()=>$l,equals:()=>BH,exactEquals:()=>NH,floor:()=>yH,forEach:()=>HH,fromValues:()=>dp,hermite:()=>PH,inverse:()=>vH,len:()=>Sy,length:()=>up,lerp:()=>wH,max:()=>TH,min:()=>AH,mul:()=>DH,multiply:()=>Z3,negate:()=>SH,normalize:()=>Ay,random:()=>IH,rotateX:()=>Ty,rotateY:()=>My,rotateZ:()=>Ey,round:()=>MH,scale:()=>EH,scaleAndAdd:()=>bH,set:()=>mH,slerp:()=>CH,sqrDist:()=>zH,sqrLen:()=>VH,squaredDistance:()=>tv,squaredLength:()=>ev,str:()=>LH,sub:()=>FH,subtract:()=>K3,transformMat3:()=>Kl,transformMat4:()=>Vi,transformQuat:()=>Zl,zero:()=>OH});function fp(){let e=new bt(3);return bt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function pH(e){let t=new bt(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function up(e){let t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function dp(e,t,r){let n=new bt(3);return n[0]=e,n[1]=t,n[2]=r,n}function gH(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function mH(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function _H(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function K3(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Z3(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function J3(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function xH(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function yH(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function AH(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function TH(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function MH(e,t){return e[0]=yr(t[0]),e[1]=yr(t[1]),e[2]=yr(t[2]),e}function EH(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function bH(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function Q3(e,t){let r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(r*r+n*n+s*s)}function tv(e,t){let r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2];return r*r+n*n+s*s}function ev(e){let t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function SH(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function vH(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Ay(e,t){let r=t[0],n=t[1],s=t[2],i=r*r+n*n+s*s;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function $l(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function zi(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[0],a=r[1],c=r[2];return e[0]=s*c-i*a,e[1]=i*o-n*c,e[2]=n*a-s*o,e}function wH(e,t,r,n){let s=t[0],i=t[1],o=t[2];return e[0]=s+n*(r[0]-s),e[1]=i+n*(r[1]-i),e[2]=o+n*(r[2]-o),e}function CH(e,t,r,n){let s=Math.acos(Math.min(Math.max($l(t,r),-1),1)),i=Math.sin(s),o=Math.sin((1-n)*s)/i,a=Math.sin(n*s)/i;return e[0]=o*t[0]+a*r[0],e[1]=o*t[1]+a*r[1],e[2]=o*t[2]+a*r[2],e}function PH(e,t,r,n,s,i){let o=i*i,a=o*(2*i-3)+1,c=o*(i-2)+i,l=o*(i-1),h=o*(3-2*i);return e[0]=t[0]*a+r[0]*c+n[0]*l+s[0]*h,e[1]=t[1]*a+r[1]*c+n[1]*l+s[1]*h,e[2]=t[2]*a+r[2]*c+n[2]*l+s[2]*h,e}function RH(e,t,r,n,s,i){let o=1-i,a=o*o,c=i*i,l=a*o,h=3*i*a,f=3*c*o,u=c*i;return e[0]=t[0]*l+r[0]*h+n[0]*f+s[0]*u,e[1]=t[1]*l+r[1]*h+n[1]*f+s[1]*u,e[2]=t[2]*l+r[2]*h+n[2]*f+s[2]*u,e}function IH(e,t){t=t===void 0?1:t;let r=un()*2*Math.PI,n=un()*2-1,s=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*s,e[1]=Math.sin(r)*s,e[2]=n*t,e}function Vi(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[3]*n+r[7]*s+r[11]*i+r[15];return o=o||1,e[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/o,e[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/o,e[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/o,e}function Kl(e,t,r){let n=t[0],s=t[1],i=t[2];return e[0]=n*r[0]+s*r[3]+i*r[6],e[1]=n*r[1]+s*r[4]+i*r[7],e[2]=n*r[2]+s*r[5]+i*r[8],e}function Zl(e,t,r){let n=r[0],s=r[1],i=r[2],o=r[3],a=t[0],c=t[1],l=t[2],h=s*l-i*c,f=i*a-n*l,u=n*c-s*a,d=s*u-i*f,p=i*h-n*u,g=n*f-s*h,m=o*2;return h*=m,f*=m,u*=m,d*=2,p*=2,g*=2,e[0]=a+h+d,e[1]=c+f+p,e[2]=l+u+g,e}function Ty(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[0],i[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),i[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function My(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),i[1]=s[1],i[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function Ey(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),i[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),i[2]=s[2],e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function by(e,t){let r=e[0],n=e[1],s=e[2],i=t[0],o=t[1],a=t[2],c=Math.sqrt((r*r+n*n+s*s)*(i*i+o*o+a*a)),l=c&&$l(e,t)/c;return Math.acos(Math.min(Math.max(l,-1),1))}function OH(e){return e[0]=0,e[1]=0,e[2]=0,e}function LH(e){return`vec3(${e[0]}, ${e[1]}, ${e[2]})`}function NH(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function BH(e,t){let r=e[0],n=e[1],s=e[2],i=t[0],o=t[1],a=t[2];return Math.abs(r-i)<=1e-6*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-o)<=1e-6*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-a)<=1e-6*Math.max(1,Math.abs(s),Math.abs(a))}var FH=K3,DH=Z3,kH=J3,UH=Q3,zH=tv,Sy=up,VH=ev,HH=function(){let e=fp();return function(t,r,n,s,i,o){let a,c;for(r||(r=3),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}}();var vy=[0,0,0],pp,D=class extends Ds{static get ZERO(){return pp||(pp=new D(0,0,0),Object.freeze(pp)),pp}constructor(t=0,r=0,n=0){super(-0,-0,-0),arguments.length===1&&ar(t)?this.copy(t):(Rt.debug&&(at(t),at(r),at(n)),this[0]=t,this[1]=r,this[2]=n)}set(t,r,n){return this[0]=t,this[1]=r,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return Rt.debug&&(at(t.x),at(t.y),at(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=at(t)}angle(t){return by(this,t)}cross(t){return zi(this,this,t),this.check()}rotateX({radians:t,origin:r=vy}){return Ty(this,this,r,t),this.check()}rotateY({radians:t,origin:r=vy}){return My(this,this,r,t),this.check()}rotateZ({radians:t,origin:r=vy}){return Ey(this,this,r,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Vi(this,this,t),this.check()}transformAsVector(t){return lp(this,this,t),this.check()}transformByMatrix3(t){return Kl(this,this,t),this.check()}transformByMatrix2(t){return Y3(this,this,t),this.check()}transformByQuaternion(t){return Zl(this,this,t),this.check()}};var gp,xa=class extends Ds{static get ZERO(){return gp||(gp=new xa(0,0,0,0),Object.freeze(gp)),gp}constructor(t=0,r=0,n=0,s=0){super(-0,-0,-0,-0),ar(t)&&arguments.length===1?this.copy(t):(Rt.debug&&(at(t),at(r),at(n),at(s)),this[0]=t,this[1]=r,this[2]=n,this[3]=s)}set(t,r,n,s){return this[0]=t,this[1]=r,this[2]=n,this[3]=s,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return Rt.debug&&(at(t.x),at(t.y),at(t.z),at(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=at(t)}get w(){return this[3]}set w(t){this[3]=at(t)}transform(t){return Vi(this,this,t),this.check()}transformByMatrix3(t){return hp(this,this,t),this.check()}transformByMatrix2(t){return $3(this,this,t),this.check()}transformByQuaternion(t){return Zl(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}};var ya=class extends Bs{toString(){let t="[";if(Rt.printRowMajor){t+="row-major:";for(let r=0;r<this.RANK;++r)for(let n=0;n<this.RANK;++n)t+=` ${this[n*this.RANK+r]}`}else{t+="column-major:";for(let r=0;r<this.ELEMENTS;++r)t+=` ${this[r]}`}return t+="]",t}getElementIndex(t,r){return r*this.RANK+t}getElement(t,r){return this[r*this.RANK+t]}setElement(t,r,n){return this[r*this.RANK+t]=at(n),this}getColumn(t,r=new Array(this.RANK).fill(-0)){let n=t*this.RANK;for(let s=0;s<this.RANK;++s)r[s]=this[n+s];return r}setColumn(t,r){let n=t*this.RANK;for(let s=0;s<this.RANK;++s)this[n+s]=r[s];return this}};function rv(){let e=new bt(9);return bt!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function nv(e,t){if(e===t){let r=t[1],n=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function sv(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=t[4],a=t[5],c=t[6],l=t[7],h=t[8],f=h*o-a*l,u=-h*i+a*c,d=l*i-o*c,p=r*f+n*u+s*d;return p?(p=1/p,e[0]=f*p,e[1]=(-h*n+s*l)*p,e[2]=(a*n-s*o)*p,e[3]=u*p,e[4]=(h*r-s*c)*p,e[5]=(-a*r+s*i)*p,e[6]=d*p,e[7]=(-l*r+n*c)*p,e[8]=(o*r-n*i)*p,e):null}function iv(e){let t=e[0],r=e[1],n=e[2],s=e[3],i=e[4],o=e[5],a=e[6],c=e[7],l=e[8];return t*(l*i-o*c)+r*(-l*s+o*a)+n*(c*s-i*a)}function wy(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=r[0],d=r[1],p=r[2],g=r[3],m=r[4],_=r[5],y=r[6],x=r[7],A=r[8];return e[0]=u*n+d*o+p*l,e[1]=u*s+d*a+p*h,e[2]=u*i+d*c+p*f,e[3]=g*n+m*o+_*l,e[4]=g*s+m*a+_*h,e[5]=g*i+m*c+_*f,e[6]=y*n+x*o+A*l,e[7]=y*s+x*a+A*h,e[8]=y*i+x*c+A*f,e}function ov(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=r[0],d=r[1];return e[0]=n,e[1]=s,e[2]=i,e[3]=o,e[4]=a,e[5]=c,e[6]=u*n+d*o+l,e[7]=u*s+d*a+h,e[8]=u*i+d*c+f,e}function av(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=Math.sin(r),d=Math.cos(r);return e[0]=d*n+u*o,e[1]=d*s+u*a,e[2]=d*i+u*c,e[3]=d*o-u*n,e[4]=d*a-u*s,e[5]=d*c-u*i,e[6]=l,e[7]=h,e[8]=f,e}function Cy(e,t,r){let n=r[0],s=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function cv(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=r+r,a=n+n,c=s+s,l=r*o,h=n*o,f=n*a,u=s*o,d=s*a,p=s*c,g=i*o,m=i*a,_=i*c;return e[0]=1-f-p,e[3]=h-_,e[6]=u+m,e[1]=h+_,e[4]=1-l-p,e[7]=d-g,e[2]=u-m,e[5]=d+g,e[8]=1-l-f,e}var Py;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"})(Py||(Py={}));var GH=Object.freeze([1,0,0,0,1,0,0,0,1]),Ut=class extends ya{static get IDENTITY(){return qH()}static get ZERO(){return jH()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Py}constructor(t,...r){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):r.length>0?this.copy([t,...r]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(GH)}fromObject(t){return this.check()}fromQuaternion(t){return cv(this,t),this.check()}set(t,r,n,s,i,o,a,c,l){return this[0]=t,this[1]=r,this[2]=n,this[3]=s,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this.check()}setRowMajor(t,r,n,s,i,o,a,c,l){return this[0]=t,this[1]=s,this[2]=a,this[3]=r,this[4]=i,this[5]=c,this[6]=n,this[7]=o,this[8]=l,this.check()}determinant(){return iv(this)}transpose(){return nv(this,this),this.check()}invert(){return sv(this,this),this.check()}multiplyLeft(t){return wy(this,t,this),this.check()}multiplyRight(t){return wy(this,this,t),this.check()}rotate(t){return av(this,this,t),this.check()}scale(t){return Array.isArray(t)?Cy(this,this,t):Cy(this,this,[t,t]),this.check()}translate(t){return ov(this,this,t),this.check()}transform(t,r){let n;switch(t.length){case 2:n=Xl(r||[-0,-0],t,this);break;case 3:n=Kl(r||[-0,-0,-0],t,this);break;case 4:n=hp(r||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Fs(n,t.length),n}transformVector(t,r){return this.transform(t,r)}transformVector2(t,r){return this.transform(t,r)}transformVector3(t,r){return this.transform(t,r)}},mp,_p=null;function jH(){return mp||(mp=new Ut([0,0,0,0,0,0,0,0,0]),Object.freeze(mp)),mp}function qH(){return _p||(_p=new Ut,Object.freeze(_p)),_p}var jt={};Bt(jt,{add:()=>_W,adjoint:()=>JH,clone:()=>YH,copy:()=>$H,create:()=>XH,decompose:()=>cW,determinant:()=>Oy,equals:()=>TW,exactEquals:()=>AW,frob:()=>mW,fromQuat:()=>Uy,fromQuat2:()=>iW,fromRotation:()=>eW,fromRotationTranslation:()=>hv,fromRotationTranslationScale:()=>lW,fromRotationTranslationScaleOrigin:()=>hW,fromScaling:()=>tW,fromTranslation:()=>QH,fromValues:()=>KH,fromXRotation:()=>rW,fromYRotation:()=>nW,fromZRotation:()=>sW,frustum:()=>zy,getRotation:()=>aW,getScaling:()=>fv,getTranslation:()=>oW,identity:()=>lv,invert:()=>Iy,lookAt:()=>Wy,mul:()=>MW,multiply:()=>Jl,multiplyScalar:()=>xW,multiplyScalarAndAdd:()=>yW,ortho:()=>Hy,orthoNO:()=>dv,orthoZO:()=>dW,perspective:()=>Vy,perspectiveFromFieldOfView:()=>uW,perspectiveNO:()=>uv,perspectiveZO:()=>fW,rotate:()=>By,rotateX:()=>Fy,rotateY:()=>Dy,rotateZ:()=>ky,scale:()=>Ny,set:()=>ZH,str:()=>gW,sub:()=>EW,subtract:()=>pv,targetTo:()=>pW,translate:()=>Ly,transpose:()=>Ry});function XH(){let e=new bt(16);return bt!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function YH(e){let t=new bt(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function $H(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function KH(e,t,r,n,s,i,o,a,c,l,h,f,u,d,p,g){let m=new bt(16);return m[0]=e,m[1]=t,m[2]=r,m[3]=n,m[4]=s,m[5]=i,m[6]=o,m[7]=a,m[8]=c,m[9]=l,m[10]=h,m[11]=f,m[12]=u,m[13]=d,m[14]=p,m[15]=g,m}function ZH(e,t,r,n,s,i,o,a,c,l,h,f,u,d,p,g,m){return e[0]=t,e[1]=r,e[2]=n,e[3]=s,e[4]=i,e[5]=o,e[6]=a,e[7]=c,e[8]=l,e[9]=h,e[10]=f,e[11]=u,e[12]=d,e[13]=p,e[14]=g,e[15]=m,e}function lv(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ry(e,t){if(e===t){let r=t[1],n=t[2],s=t[3],i=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=i,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Iy(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=t[4],a=t[5],c=t[6],l=t[7],h=t[8],f=t[9],u=t[10],d=t[11],p=t[12],g=t[13],m=t[14],_=t[15],y=r*a-n*o,x=r*c-s*o,A=r*l-i*o,M=n*c-s*a,E=n*l-i*a,w=s*l-i*c,v=h*g-f*p,b=h*m-u*p,T=h*_-d*p,I=f*m-u*g,N=f*_-d*g,B=u*_-d*m,C=y*B-x*N+A*I+M*T-E*b+w*v;return C?(C=1/C,e[0]=(a*B-c*N+l*I)*C,e[1]=(s*N-n*B-i*I)*C,e[2]=(g*w-m*E+_*M)*C,e[3]=(u*E-f*w-d*M)*C,e[4]=(c*T-o*B-l*b)*C,e[5]=(r*B-s*T+i*b)*C,e[6]=(m*A-p*w-_*x)*C,e[7]=(h*w-u*A+d*x)*C,e[8]=(o*N-a*T+l*v)*C,e[9]=(n*T-r*N-i*v)*C,e[10]=(p*E-g*A+_*y)*C,e[11]=(f*A-h*E-d*y)*C,e[12]=(a*b-o*I-c*v)*C,e[13]=(r*I-n*b+s*v)*C,e[14]=(g*x-p*M-m*y)*C,e[15]=(h*M-f*x+u*y)*C,e):null}function JH(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=t[4],a=t[5],c=t[6],l=t[7],h=t[8],f=t[9],u=t[10],d=t[11],p=t[12],g=t[13],m=t[14],_=t[15],y=r*a-n*o,x=r*c-s*o,A=r*l-i*o,M=n*c-s*a,E=n*l-i*a,w=s*l-i*c,v=h*g-f*p,b=h*m-u*p,T=h*_-d*p,I=f*m-u*g,N=f*_-d*g,B=u*_-d*m;return e[0]=a*B-c*N+l*I,e[1]=s*N-n*B-i*I,e[2]=g*w-m*E+_*M,e[3]=u*E-f*w-d*M,e[4]=c*T-o*B-l*b,e[5]=r*B-s*T+i*b,e[6]=m*A-p*w-_*x,e[7]=h*w-u*A+d*x,e[8]=o*N-a*T+l*v,e[9]=n*T-r*N-i*v,e[10]=p*E-g*A+_*y,e[11]=f*A-h*E-d*y,e[12]=a*b-o*I-c*v,e[13]=r*I-n*b+s*v,e[14]=g*x-p*M-m*y,e[15]=h*M-f*x+u*y,e}function Oy(e){let t=e[0],r=e[1],n=e[2],s=e[3],i=e[4],o=e[5],a=e[6],c=e[7],l=e[8],h=e[9],f=e[10],u=e[11],d=e[12],p=e[13],g=e[14],m=e[15],_=t*o-r*i,y=t*a-n*i,x=r*a-n*o,A=l*p-h*d,M=l*g-f*d,E=h*g-f*p,w=t*E-r*M+n*A,v=i*E-o*M+a*A,b=l*x-h*y+f*_,T=d*x-p*y+g*_;return c*w-s*v+m*b-u*T}function Jl(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=t[9],d=t[10],p=t[11],g=t[12],m=t[13],_=t[14],y=t[15],x=r[0],A=r[1],M=r[2],E=r[3];return e[0]=x*n+A*a+M*f+E*g,e[1]=x*s+A*c+M*u+E*m,e[2]=x*i+A*l+M*d+E*_,e[3]=x*o+A*h+M*p+E*y,x=r[4],A=r[5],M=r[6],E=r[7],e[4]=x*n+A*a+M*f+E*g,e[5]=x*s+A*c+M*u+E*m,e[6]=x*i+A*l+M*d+E*_,e[7]=x*o+A*h+M*p+E*y,x=r[8],A=r[9],M=r[10],E=r[11],e[8]=x*n+A*a+M*f+E*g,e[9]=x*s+A*c+M*u+E*m,e[10]=x*i+A*l+M*d+E*_,e[11]=x*o+A*h+M*p+E*y,x=r[12],A=r[13],M=r[14],E=r[15],e[12]=x*n+A*a+M*f+E*g,e[13]=x*s+A*c+M*u+E*m,e[14]=x*i+A*l+M*d+E*_,e[15]=x*o+A*h+M*p+E*y,e}function Ly(e,t,r){let n=r[0],s=r[1],i=r[2],o,a,c,l,h,f,u,d,p,g,m,_;return t===e?(e[12]=t[0]*n+t[4]*s+t[8]*i+t[12],e[13]=t[1]*n+t[5]*s+t[9]*i+t[13],e[14]=t[2]*n+t[6]*s+t[10]*i+t[14],e[15]=t[3]*n+t[7]*s+t[11]*i+t[15]):(o=t[0],a=t[1],c=t[2],l=t[3],h=t[4],f=t[5],u=t[6],d=t[7],p=t[8],g=t[9],m=t[10],_=t[11],e[0]=o,e[1]=a,e[2]=c,e[3]=l,e[4]=h,e[5]=f,e[6]=u,e[7]=d,e[8]=p,e[9]=g,e[10]=m,e[11]=_,e[12]=o*n+h*s+p*i+t[12],e[13]=a*n+f*s+g*i+t[13],e[14]=c*n+u*s+m*i+t[14],e[15]=l*n+d*s+_*i+t[15]),e}function Ny(e,t,r){let n=r[0],s=r[1],i=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function By(e,t,r,n){let s=n[0],i=n[1],o=n[2],a=Math.sqrt(s*s+i*i+o*o),c,l,h,f,u,d,p,g,m,_,y,x,A,M,E,w,v,b,T,I,N,B,C,V;return a<1e-6?null:(a=1/a,s*=a,i*=a,o*=a,l=Math.sin(r),c=Math.cos(r),h=1-c,f=t[0],u=t[1],d=t[2],p=t[3],g=t[4],m=t[5],_=t[6],y=t[7],x=t[8],A=t[9],M=t[10],E=t[11],w=s*s*h+c,v=i*s*h+o*l,b=o*s*h-i*l,T=s*i*h-o*l,I=i*i*h+c,N=o*i*h+s*l,B=s*o*h+i*l,C=i*o*h-s*l,V=o*o*h+c,e[0]=f*w+g*v+x*b,e[1]=u*w+m*v+A*b,e[2]=d*w+_*v+M*b,e[3]=p*w+y*v+E*b,e[4]=f*T+g*I+x*N,e[5]=u*T+m*I+A*N,e[6]=d*T+_*I+M*N,e[7]=p*T+y*I+E*N,e[8]=f*B+g*C+x*V,e[9]=u*B+m*C+A*V,e[10]=d*B+_*C+M*V,e[11]=p*B+y*C+E*V,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function Fy(e,t,r){let n=Math.sin(r),s=Math.cos(r),i=t[4],o=t[5],a=t[6],c=t[7],l=t[8],h=t[9],f=t[10],u=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*s+l*n,e[5]=o*s+h*n,e[6]=a*s+f*n,e[7]=c*s+u*n,e[8]=l*s-i*n,e[9]=h*s-o*n,e[10]=f*s-a*n,e[11]=u*s-c*n,e}function Dy(e,t,r){let n=Math.sin(r),s=Math.cos(r),i=t[0],o=t[1],a=t[2],c=t[3],l=t[8],h=t[9],f=t[10],u=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*s-l*n,e[1]=o*s-h*n,e[2]=a*s-f*n,e[3]=c*s-u*n,e[8]=i*n+l*s,e[9]=o*n+h*s,e[10]=a*n+f*s,e[11]=c*n+u*s,e}function ky(e,t,r){let n=Math.sin(r),s=Math.cos(r),i=t[0],o=t[1],a=t[2],c=t[3],l=t[4],h=t[5],f=t[6],u=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*s+l*n,e[1]=o*s+h*n,e[2]=a*s+f*n,e[3]=c*s+u*n,e[4]=l*s-i*n,e[5]=h*s-o*n,e[6]=f*s-a*n,e[7]=u*s-c*n,e}function QH(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function tW(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function eW(e,t,r){let n=r[0],s=r[1],i=r[2],o=Math.sqrt(n*n+s*s+i*i),a,c,l;return o<1e-6?null:(o=1/o,n*=o,s*=o,i*=o,c=Math.sin(t),a=Math.cos(t),l=1-a,e[0]=n*n*l+a,e[1]=s*n*l+i*c,e[2]=i*n*l-s*c,e[3]=0,e[4]=n*s*l-i*c,e[5]=s*s*l+a,e[6]=i*s*l+n*c,e[7]=0,e[8]=n*i*l+s*c,e[9]=s*i*l-n*c,e[10]=i*i*l+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function rW(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function nW(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function sW(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function hv(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=n+n,c=s+s,l=i+i,h=n*a,f=n*c,u=n*l,d=s*c,p=s*l,g=i*l,m=o*a,_=o*c,y=o*l;return e[0]=1-(d+g),e[1]=f+y,e[2]=u-_,e[3]=0,e[4]=f-y,e[5]=1-(h+g),e[6]=p+m,e[7]=0,e[8]=u+_,e[9]=p-m,e[10]=1-(h+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function iW(e,t){let r=new bt(3),n=-t[0],s=-t[1],i=-t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=n*n+s*s+i*i+o*o;return f>0?(r[0]=(a*o+h*n+c*i-l*s)*2/f,r[1]=(c*o+h*s+l*n-a*i)*2/f,r[2]=(l*o+h*i+a*s-c*n)*2/f):(r[0]=(a*o+h*n+c*i-l*s)*2,r[1]=(c*o+h*s+l*n-a*i)*2,r[2]=(l*o+h*i+a*s-c*n)*2),hv(e,t,r),e}function oW(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function fv(e,t){let r=t[0],n=t[1],s=t[2],i=t[4],o=t[5],a=t[6],c=t[8],l=t[9],h=t[10];return e[0]=Math.sqrt(r*r+n*n+s*s),e[1]=Math.sqrt(i*i+o*o+a*a),e[2]=Math.sqrt(c*c+l*l+h*h),e}function aW(e,t){let r=new bt(3);fv(r,t);let n=1/r[0],s=1/r[1],i=1/r[2],o=t[0]*n,a=t[1]*s,c=t[2]*i,l=t[4]*n,h=t[5]*s,f=t[6]*i,u=t[8]*n,d=t[9]*s,p=t[10]*i,g=o+h+p,m=0;return g>0?(m=Math.sqrt(g+1)*2,e[3]=.25*m,e[0]=(f-d)/m,e[1]=(u-c)/m,e[2]=(a-l)/m):o>h&&o>p?(m=Math.sqrt(1+o-h-p)*2,e[3]=(f-d)/m,e[0]=.25*m,e[1]=(a+l)/m,e[2]=(u+c)/m):h>p?(m=Math.sqrt(1+h-o-p)*2,e[3]=(u-c)/m,e[0]=(a+l)/m,e[1]=.25*m,e[2]=(f+d)/m):(m=Math.sqrt(1+p-o-h)*2,e[3]=(a-l)/m,e[0]=(u+c)/m,e[1]=(f+d)/m,e[2]=.25*m),e}function cW(e,t,r,n){t[0]=n[12],t[1]=n[13],t[2]=n[14];let s=n[0],i=n[1],o=n[2],a=n[4],c=n[5],l=n[6],h=n[8],f=n[9],u=n[10];r[0]=Math.sqrt(s*s+i*i+o*o),r[1]=Math.sqrt(a*a+c*c+l*l),r[2]=Math.sqrt(h*h+f*f+u*u);let d=1/r[0],p=1/r[1],g=1/r[2],m=s*d,_=i*p,y=o*g,x=a*d,A=c*p,M=l*g,E=h*d,w=f*p,v=u*g,b=m+A+v,T=0;return b>0?(T=Math.sqrt(b+1)*2,e[3]=.25*T,e[0]=(M-w)/T,e[1]=(E-y)/T,e[2]=(_-x)/T):m>A&&m>v?(T=Math.sqrt(1+m-A-v)*2,e[3]=(M-w)/T,e[0]=.25*T,e[1]=(_+x)/T,e[2]=(E+y)/T):A>v?(T=Math.sqrt(1+A-m-v)*2,e[3]=(E-y)/T,e[0]=(_+x)/T,e[1]=.25*T,e[2]=(M+w)/T):(T=Math.sqrt(1+v-m-A)*2,e[3]=(_-x)/T,e[0]=(E+y)/T,e[1]=(M+w)/T,e[2]=.25*T),e}function lW(e,t,r,n){let s=t[0],i=t[1],o=t[2],a=t[3],c=s+s,l=i+i,h=o+o,f=s*c,u=s*l,d=s*h,p=i*l,g=i*h,m=o*h,_=a*c,y=a*l,x=a*h,A=n[0],M=n[1],E=n[2];return e[0]=(1-(p+m))*A,e[1]=(u+x)*A,e[2]=(d-y)*A,e[3]=0,e[4]=(u-x)*M,e[5]=(1-(f+m))*M,e[6]=(g+_)*M,e[7]=0,e[8]=(d+y)*E,e[9]=(g-_)*E,e[10]=(1-(f+p))*E,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function hW(e,t,r,n,s){let i=t[0],o=t[1],a=t[2],c=t[3],l=i+i,h=o+o,f=a+a,u=i*l,d=i*h,p=i*f,g=o*h,m=o*f,_=a*f,y=c*l,x=c*h,A=c*f,M=n[0],E=n[1],w=n[2],v=s[0],b=s[1],T=s[2],I=(1-(g+_))*M,N=(d+A)*M,B=(p-x)*M,C=(d-A)*E,V=(1-(u+_))*E,rt=(m+y)*E,J=(p+x)*w,St=(m-y)*w,ht=(1-(u+g))*w;return e[0]=I,e[1]=N,e[2]=B,e[3]=0,e[4]=C,e[5]=V,e[6]=rt,e[7]=0,e[8]=J,e[9]=St,e[10]=ht,e[11]=0,e[12]=r[0]+v-(I*v+C*b+J*T),e[13]=r[1]+b-(N*v+V*b+St*T),e[14]=r[2]+T-(B*v+rt*b+ht*T),e[15]=1,e}function Uy(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=r+r,a=n+n,c=s+s,l=r*o,h=n*o,f=n*a,u=s*o,d=s*a,p=s*c,g=i*o,m=i*a,_=i*c;return e[0]=1-f-p,e[1]=h+_,e[2]=u-m,e[3]=0,e[4]=h-_,e[5]=1-l-p,e[6]=d+g,e[7]=0,e[8]=u+m,e[9]=d-g,e[10]=1-l-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function zy(e,t,r,n,s,i,o){let a=1/(r-t),c=1/(s-n),l=1/(i-o);return e[0]=i*2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i*2*c,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(s+n)*c,e[10]=(o+i)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*l,e[15]=0,e}function uv(e,t,r,n,s){let i=1/Math.tan(t/2);if(e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0){let o=1/(n-s);e[10]=(s+n)*o,e[14]=2*s*n*o}else e[10]=-1,e[14]=-2*n;return e}var Vy=uv;function fW(e,t,r,n,s){let i=1/Math.tan(t/2);if(e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0){let o=1/(n-s);e[10]=s*o,e[14]=s*n*o}else e[10]=-1,e[14]=-n;return e}function uW(e,t,r,n){let s=Math.tan(t.upDegrees*Math.PI/180),i=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),c=2/(o+a),l=2/(s+i);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-((o-a)*c*.5),e[9]=(s-i)*l*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function dv(e,t,r,n,s,i,o){let a=1/(t-r),c=1/(n-s),l=1/(i-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*a,e[13]=(s+n)*c,e[14]=(o+i)*l,e[15]=1,e}var Hy=dv;function dW(e,t,r,n,s,i,o){let a=1/(t-r),c=1/(n-s),l=1/(i-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=l,e[11]=0,e[12]=(t+r)*a,e[13]=(s+n)*c,e[14]=i*l,e[15]=1,e}function Wy(e,t,r,n){let s,i,o,a,c,l,h,f,u,d,p=t[0],g=t[1],m=t[2],_=n[0],y=n[1],x=n[2],A=r[0],M=r[1],E=r[2];return Math.abs(p-A)<1e-6&&Math.abs(g-M)<1e-6&&Math.abs(m-E)<1e-6?lv(e):(f=p-A,u=g-M,d=m-E,s=1/Math.sqrt(f*f+u*u+d*d),f*=s,u*=s,d*=s,i=y*d-x*u,o=x*f-_*d,a=_*u-y*f,s=Math.sqrt(i*i+o*o+a*a),s?(s=1/s,i*=s,o*=s,a*=s):(i=0,o=0,a=0),c=u*a-d*o,l=d*i-f*a,h=f*o-u*i,s=Math.sqrt(c*c+l*l+h*h),s?(s=1/s,c*=s,l*=s,h*=s):(c=0,l=0,h=0),e[0]=i,e[1]=c,e[2]=f,e[3]=0,e[4]=o,e[5]=l,e[6]=u,e[7]=0,e[8]=a,e[9]=h,e[10]=d,e[11]=0,e[12]=-(i*p+o*g+a*m),e[13]=-(c*p+l*g+h*m),e[14]=-(f*p+u*g+d*m),e[15]=1,e)}function pW(e,t,r,n){let s=t[0],i=t[1],o=t[2],a=n[0],c=n[1],l=n[2],h=s-r[0],f=i-r[1],u=o-r[2],d=h*h+f*f+u*u;d>0&&(d=1/Math.sqrt(d),h*=d,f*=d,u*=d);let p=c*u-l*f,g=l*h-a*u,m=a*f-c*h;return d=p*p+g*g+m*m,d>0&&(d=1/Math.sqrt(d),p*=d,g*=d,m*=d),e[0]=p,e[1]=g,e[2]=m,e[3]=0,e[4]=f*m-u*g,e[5]=u*p-h*m,e[6]=h*g-f*p,e[7]=0,e[8]=h,e[9]=f,e[10]=u,e[11]=0,e[12]=s,e[13]=i,e[14]=o,e[15]=1,e}function gW(e){return`mat4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]}, ${e[4]}, ${e[5]}, ${e[6]}, ${e[7]}, ${e[8]}, ${e[9]}, ${e[10]}, ${e[11]}, ${e[12]}, ${e[13]}, ${e[14]}, ${e[15]})`}function mW(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]+e[4]*e[4]+e[5]*e[5]+e[6]*e[6]+e[7]*e[7]+e[8]*e[8]+e[9]*e[9]+e[10]*e[10]+e[11]*e[11]+e[12]*e[12]+e[13]*e[13]+e[14]*e[14]+e[15]*e[15])}function _W(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function pv(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function xW(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function yW(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function AW(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function TW(e,t){let r=e[0],n=e[1],s=e[2],i=e[3],o=e[4],a=e[5],c=e[6],l=e[7],h=e[8],f=e[9],u=e[10],d=e[11],p=e[12],g=e[13],m=e[14],_=e[15],y=t[0],x=t[1],A=t[2],M=t[3],E=t[4],w=t[5],v=t[6],b=t[7],T=t[8],I=t[9],N=t[10],B=t[11],C=t[12],V=t[13],rt=t[14],J=t[15];return Math.abs(r-y)<=1e-6*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-x)<=1e-6*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(s-A)<=1e-6*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(i-M)<=1e-6*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(o-E)<=1e-6*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(a-w)<=1e-6*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(c-v)<=1e-6*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(l-b)<=1e-6*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(h-T)<=1e-6*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(f-I)<=1e-6*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(u-N)<=1e-6*Math.max(1,Math.abs(u),Math.abs(N))&&Math.abs(d-B)<=1e-6*Math.max(1,Math.abs(d),Math.abs(B))&&Math.abs(p-C)<=1e-6*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(g-V)<=1e-6*Math.max(1,Math.abs(g),Math.abs(V))&&Math.abs(m-rt)<=1e-6*Math.max(1,Math.abs(m),Math.abs(rt))&&Math.abs(_-J)<=1e-6*Math.max(1,Math.abs(_),Math.abs(J))}var MW=Jl,EW=pv;var He={};Bt(He,{add:()=>Gy,ceil:()=>bW,clone:()=>mv,copy:()=>xv,create:()=>gv,cross:()=>OW,dist:()=>zW,distance:()=>Ev,div:()=>UW,divide:()=>Mv,dot:()=>Xy,equals:()=>FW,exactEquals:()=>Sv,floor:()=>SW,forEach:()=>GW,fromValues:()=>_v,inverse:()=>IW,len:()=>HW,length:()=>xp,lerp:()=>Yy,max:()=>wW,min:()=>vW,mul:()=>kW,multiply:()=>Tv,negate:()=>RW,normalize:()=>qy,random:()=>LW,round:()=>CW,scale:()=>jy,scaleAndAdd:()=>PW,set:()=>yv,sqrDist:()=>VW,sqrLen:()=>WW,squaredDistance:()=>bv,squaredLength:()=>yp,str:()=>BW,sub:()=>DW,subtract:()=>Av,transformMat4:()=>$y,transformQuat:()=>Ky,zero:()=>NW});function gv(){let e=new bt(4);return bt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function mv(e){let t=new bt(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function _v(e,t,r,n){let s=new bt(4);return s[0]=e,s[1]=t,s[2]=r,s[3]=n,s}function xv(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function yv(e,t,r,n,s){return e[0]=t,e[1]=r,e[2]=n,e[3]=s,e}function Gy(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function Av(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function Tv(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function Mv(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function bW(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function SW(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function vW(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e}function wW(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e}function CW(e,t){return e[0]=yr(t[0]),e[1]=yr(t[1]),e[2]=yr(t[2]),e[3]=yr(t[3]),e}function jy(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function PW(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e}function Ev(e,t){let r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2],i=t[3]-e[3];return Math.sqrt(r*r+n*n+s*s+i*i)}function bv(e,t){let r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2],i=t[3]-e[3];return r*r+n*n+s*s+i*i}function xp(e){let t=e[0],r=e[1],n=e[2],s=e[3];return Math.sqrt(t*t+r*r+n*n+s*s)}function yp(e){let t=e[0],r=e[1],n=e[2],s=e[3];return t*t+r*r+n*n+s*s}function RW(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function IW(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function qy(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=r*r+n*n+s*s+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=n*o,e[2]=s*o,e[3]=i*o,e}function Xy(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function OW(e,t,r,n){let s=r[0]*n[1]-r[1]*n[0],i=r[0]*n[2]-r[2]*n[0],o=r[0]*n[3]-r[3]*n[0],a=r[1]*n[2]-r[2]*n[1],c=r[1]*n[3]-r[3]*n[1],l=r[2]*n[3]-r[3]*n[2],h=t[0],f=t[1],u=t[2],d=t[3];return e[0]=f*l-u*c+d*a,e[1]=-(h*l)+u*o-d*i,e[2]=h*c-f*o+d*s,e[3]=-(h*a)+f*i-u*s,e}function Yy(e,t,r,n){let s=t[0],i=t[1],o=t[2],a=t[3];return e[0]=s+n*(r[0]-s),e[1]=i+n*(r[1]-i),e[2]=o+n*(r[2]-o),e[3]=a+n*(r[3]-a),e}function LW(e,t){t=t===void 0?1:t;let r,n,s,i,o,a;do r=un()*2-1,n=un()*2-1,o=r*r+n*n;while(o>=1);do s=un()*2-1,i=un()*2-1,a=s*s+i*i;while(a>=1);let c=Math.sqrt((1-o)/a);return e[0]=t*r,e[1]=t*n,e[2]=t*s*c,e[3]=t*i*c,e}function $y(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3];return e[0]=r[0]*n+r[4]*s+r[8]*i+r[12]*o,e[1]=r[1]*n+r[5]*s+r[9]*i+r[13]*o,e[2]=r[2]*n+r[6]*s+r[10]*i+r[14]*o,e[3]=r[3]*n+r[7]*s+r[11]*i+r[15]*o,e}function Ky(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[0],a=r[1],c=r[2],l=r[3],h=l*n+a*i-c*s,f=l*s+c*n-o*i,u=l*i+o*s-a*n,d=-o*n-a*s-c*i;return e[0]=h*l+d*-o+f*-c-u*-a,e[1]=f*l+d*-a+u*-o-h*-c,e[2]=u*l+d*-c+h*-a-f*-o,e[3]=t[3],e}function NW(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function BW(e){return`vec4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}function Sv(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function FW(e,t){let r=e[0],n=e[1],s=e[2],i=e[3],o=t[0],a=t[1],c=t[2],l=t[3];return Math.abs(r-o)<=1e-6*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-a)<=1e-6*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(s-c)<=1e-6*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(i-l)<=1e-6*Math.max(1,Math.abs(i),Math.abs(l))}var DW=Av,kW=Tv,UW=Mv,zW=Ev,VW=bv,HW=xp,WW=yp,GW=function(){let e=gv();return function(t,r,n,s,i,o){let a,c;for(r||(r=4),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}();var Qy;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(Qy||(Qy={}));var jW=45*Math.PI/180,qW=1,Zy=.1,Jy=500,XW=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),$=class extends ya{static get IDENTITY(){return $W()}static get ZERO(){return YW()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Qy}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,r,n,s,i,o,a,c,l,h,f,u,d,p,g,m){return this[0]=t,this[1]=r,this[2]=n,this[3]=s,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this[9]=h,this[10]=f,this[11]=u,this[12]=d,this[13]=p,this[14]=g,this[15]=m,this.check()}setRowMajor(t,r,n,s,i,o,a,c,l,h,f,u,d,p,g,m){return this[0]=t,this[1]=i,this[2]=l,this[3]=d,this[4]=r,this[5]=o,this[6]=h,this[7]=p,this[8]=n,this[9]=a,this[10]=f,this[11]=g,this[12]=s,this[13]=c,this[14]=u,this[15]=m,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(XW)}fromObject(t){return this.check()}fromQuaternion(t){return Uy(this,t),this.check()}frustum(t){let{left:r,right:n,bottom:s,top:i,near:o=Zy,far:a=Jy}=t;return a===1/0?KW(this,r,n,s,i,o):zy(this,r,n,s,i,o,a),this.check()}lookAt(t){let{eye:r,center:n=[0,0,0],up:s=[0,1,0]}=t;return Wy(this,r,n,s),this.check()}ortho(t){let{left:r,right:n,bottom:s,top:i,near:o=Zy,far:a=Jy}=t;return Hy(this,r,n,s,i,o,a),this.check()}orthographic(t){let{fovy:r=jW,aspect:n=qW,focalDistance:s=1,near:i=Zy,far:o=Jy}=t;vv(r);let a=r/2,c=s*Math.tan(a),l=c*n;return this.ortho({left:-l,right:l,bottom:-c,top:c,near:i,far:o})}perspective(t){let{fovy:r=45*Math.PI/180,aspect:n=1,near:s=.1,far:i=500}=t;return vv(r),Vy(this,r,n,s,i),this.check()}determinant(){return Oy(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let n=this.getScale(r),s=1/n[0],i=1/n[1],o=1/n[2];return t[0]=this[0]*s,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*s,t[5]=this[5]*i,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*s,t[9]=this[9]*i,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let n=this.getScale(r),s=1/n[0],i=1/n[1],o=1/n[2];return t[0]=this[0]*s,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=this[4]*s,t[4]=this[5]*i,t[5]=this[6]*o,t[6]=this[8]*s,t[7]=this[9]*i,t[8]=this[10]*o,t}transpose(){return Ry(this,this),this.check()}invert(){return Iy(this,this),this.check()}multiplyLeft(t){return Jl(this,t,this),this.check()}multiplyRight(t){return Jl(this,this,t),this.check()}rotateX(t){return Fy(this,this,t),this.check()}rotateY(t){return Dy(this,this,t),this.check()}rotateZ(t){return ky(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,r){return By(this,this,t,r),this.check()}scale(t){return Ny(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return Ly(this,this,t),this.check()}transform(t,r){return t.length===4?(r=$y(r||[-0,-0,-0,-0],t,this),Fs(r,4),r):this.transformAsPoint(t,r)}transformAsPoint(t,r){let{length:n}=t,s;switch(n){case 2:s=Yl(r||[-0,-0],t,this);break;case 3:s=Vi(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Fs(s,t.length),s}transformAsVector(t,r){let n;switch(t.length){case 2:n=cp(r||[-0,-0],t,this);break;case 3:n=lp(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Fs(n,t.length),n}transformPoint(t,r){return this.transformAsPoint(t,r)}transformVector(t,r){return this.transformAsPoint(t,r)}transformDirection(t,r){return this.transformAsVector(t,r)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,r,n){return this.identity().translate([t,r,n])}},Ap,Tp;function YW(){return Ap||(Ap=new $([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Ap)),Ap}function $W(){return Tp||(Tp=new $,Object.freeze(Tp)),Tp}function vv(e){if(e>Math.PI*2)throw Error("expected radians")}function KW(e,t,r,n,s,i){let o=2*i/(r-t),a=2*i/(s-n),c=(r+t)/(r-t),l=(s+n)/(s-n),h=-1,f=-1,u=-2*i;return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=c,e[9]=l,e[10]=h,e[11]=f,e[12]=0,e[13]=0,e[14]=u,e[15]=0,e}function wv(){let e=new bt(4);return bt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Cv(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function t2(e,t,r){r=r*.5;let n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function e2(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=r[0],c=r[1],l=r[2],h=r[3];return e[0]=n*h+o*a+s*l-i*c,e[1]=s*h+o*c+i*a-n*l,e[2]=i*h+o*l+n*c-s*a,e[3]=o*h-n*a-s*c-i*l,e}function Pv(e,t,r){r*=.5;let n=t[0],s=t[1],i=t[2],o=t[3],a=Math.sin(r),c=Math.cos(r);return e[0]=n*c+o*a,e[1]=s*c+i*a,e[2]=i*c-s*a,e[3]=o*c-n*a,e}function Rv(e,t,r){r*=.5;let n=t[0],s=t[1],i=t[2],o=t[3],a=Math.sin(r),c=Math.cos(r);return e[0]=n*c-i*a,e[1]=s*c+o*a,e[2]=i*c+n*a,e[3]=o*c-s*a,e}function Iv(e,t,r){r*=.5;let n=t[0],s=t[1],i=t[2],o=t[3],a=Math.sin(r),c=Math.cos(r);return e[0]=n*c+s*a,e[1]=s*c-n*a,e[2]=i*c+o*a,e[3]=o*c-i*a,e}function Ov(e,t){let r=t[0],n=t[1],s=t[2];return e[0]=r,e[1]=n,e[2]=s,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-s*s)),e}function Ql(e,t,r,n){let s=t[0],i=t[1],o=t[2],a=t[3],c=r[0],l=r[1],h=r[2],f=r[3],u,d,p,g,m;return u=s*c+i*l+o*h+a*f,u<0&&(u=-u,c=-c,l=-l,h=-h,f=-f),1-u>1e-6?(d=Math.acos(u),m=Math.sin(d),p=Math.sin((1-n)*d)/m,g=Math.sin(n*d)/m):(p=1-n,g=n),e[0]=p*s+g*c,e[1]=p*i+g*l,e[2]=p*o+g*h,e[3]=p*a+g*f,e}function Lv(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=r*r+n*n+s*s+i*i,a=o?1/o:0;return e[0]=-r*a,e[1]=-n*a,e[2]=-s*a,e[3]=i*a,e}function Nv(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function r2(e,t){let r=t[0]+t[4]+t[8],n;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[s*3+s]&&(s=2);let i=(s+1)%3,o=(s+2)%3;n=Math.sqrt(t[s*3+s]-t[i*3+i]-t[o*3+o]+1),e[s]=.5*n,n=.5/n,e[3]=(t[i*3+o]-t[o*3+i])*n,e[i]=(t[i*3+s]+t[s*3+i])*n,e[o]=(t[o*3+s]+t[s*3+o])*n}return e}var Bv=Gy;var Fv=jy,Dv=Xy,kv=Yy,Uv=xp;var zv=yp;var Vv=qy;var Hv=function(){let e=fp(),t=dp(1,0,0),r=dp(0,1,0);return function(n,s,i){let o=$l(s,i);return o<-.999999?(zi(e,t,s),Sy(e)<1e-6&&zi(e,r,s),Ay(e,e),t2(n,e,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(zi(e,s,i),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+o,Vv(n,n))}}(),eyt=function(){let e=wv(),t=wv();return function(r,n,s,i,o,a){return Ql(e,n,o,a),Ql(t,s,i,a),Ql(r,e,t,2*a*(1-a)),r}}(),ryt=function(){let e=rv();return function(t,r,n,s){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=s[0],e[4]=s[1],e[7]=s[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],Vv(t,r2(t,e))}}();var ZW=[0,0,0,1],ks=class extends Bs{constructor(t=0,r=0,n=0,s=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,r,n,s)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,r,n,s){return this[0]=t,this[1]=r,this[2]=n,this[3]=s,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return r2(this,t),this.check()}fromAxisRotation(t,r){return t2(this,t,r),this.check()}identity(){return Cv(this),this.check()}setAxisAngle(t,r){return this.fromAxisRotation(t,r)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=at(t)}get y(){return this[1]}set y(t){this[1]=at(t)}get z(){return this[2]}set z(t){this[2]=at(t)}get w(){return this[3]}set w(t){this[3]=at(t)}len(){return Uv(this)}lengthSquared(){return zv(this)}dot(t){return Dv(this,t)}rotationTo(t,r){return Hv(this,t,r),this.check()}add(t){return Bv(this,this,t),this.check()}calculateW(){return Ov(this,this),this.check()}conjugate(){return Nv(this,this),this.check()}invert(){return Lv(this,this),this.check()}lerp(t,r,n){return n===void 0?this.lerp(this,t,r):(kv(this,t,r,n),this.check())}multiplyRight(t){return e2(this,this,t),this.check()}multiplyLeft(t){return e2(this,t,this),this.check()}normalize(){let t=this.len(),r=t>0?1/t:0;return this[0]=this[0]*r,this[1]=this[1]*r,this[2]=this[2]*r,this[3]=this[3]*r,t===0&&(this[3]=1),this.check()}rotateX(t){return Pv(this,this,t),this.check()}rotateY(t){return Rv(this,this,t),this.check()}rotateZ(t){return Iv(this,this,t),this.check()}scale(t){return Fv(this,this,t),this.check()}slerp(t,r,n){let s,i,o;switch(arguments.length){case 1:({start:s=ZW,target:i,ratio:o}=t);break;case 2:s=this,i=t,o=r;break;default:s=t,i=r,o=n}return Ql(this,s,i,o),this.check()}transformVector4(t,r=new xa){return Ky(r,t,this),Fs(r,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,r){return this.setAxisAngle(t,r)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}};var Wv=1e-6,JW=6371e3,Br=class{constructor({phi:t=0,theta:r=0,radius:n=1,bearing:s,pitch:i,altitude:o,radiusScale:a=JW}={}){this.phi=t,this.theta=r,this.radius=n||o||1,this.radiusScale=a||1,s!==void 0&&(this.bearing=s),i!==void 0&&(this.pitch=i),this.check()}toString(){return this.formatString(Rt)}formatString({printTypes:t=!1}){let r=ql;return`${t?"Spherical":""}[rho:${r(this.radius)},theta:${r(this.theta)},phi:${r(this.phi)}]`}equals(t){return kt(this.radius,t.radius)&&kt(this.theta,t.theta)&&kt(this.phi,t.phi)}exactEquals(t){return this.radius===t.radius&&this.theta===t.theta&&this.phi===t.phi}get bearing(){return 180-Ns(this.phi)}set bearing(t){this.phi=Math.PI-ma(t)}get pitch(){return Ns(this.theta)}set pitch(t){this.theta=ma(t)}get longitude(){return Ns(this.phi)}get latitude(){return Ns(this.theta)}get lng(){return Ns(this.phi)}get lat(){return Ns(this.theta)}get z(){return(this.radius-1)*this.radiusScale}set(t,r,n){return this.radius=t,this.phi=r,this.theta=n,this.check()}clone(){return new Br().copy(this)}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this.check()}fromLngLatZ([t,r,n]){return this.radius=1+n/this.radiusScale,this.phi=ma(r),this.theta=ma(t),this.check()}fromVector3(t){return this.radius=up(t),this.radius>0&&(this.theta=Math.atan2(t[0],t[1]),this.phi=Math.acos(ft(t[2]/this.radius,-1,1))),this.check()}toVector3(){return new D(0,0,this.radius).rotateX({radians:this.theta}).rotateZ({radians:this.phi})}makeSafe(){return this.phi=Math.max(Wv,Math.min(Math.PI-Wv,this.phi)),this}check(){if(!Number.isFinite(this.phi)||!Number.isFinite(this.theta)||!(this.radius>0))throw new Error("SphericalCoordinates: some fields set to invalid numbers");return this}};var Aa={};Bt(Aa,{EPSILON1:()=>QW,EPSILON10:()=>cG,EPSILON11:()=>lG,EPSILON12:()=>hG,EPSILON13:()=>fG,EPSILON14:()=>uG,EPSILON15:()=>dG,EPSILON16:()=>pG,EPSILON17:()=>gG,EPSILON18:()=>mG,EPSILON19:()=>_G,EPSILON2:()=>tG,EPSILON20:()=>xG,EPSILON3:()=>eG,EPSILON4:()=>rG,EPSILON5:()=>nG,EPSILON6:()=>sG,EPSILON7:()=>iG,EPSILON8:()=>oG,EPSILON9:()=>aG,PI_OVER_FOUR:()=>AG,PI_OVER_SIX:()=>TG,PI_OVER_TWO:()=>yG,TWO_PI:()=>MG});var QW=.1,tG=.01,eG=.001,rG=1e-4,nG=1e-5,sG=1e-6,iG=1e-7,oG=1e-8,aG=1e-9,cG=1e-10,lG=1e-11,hG=1e-12,fG=1e-13,uG=1e-14,dG=1e-15,pG=1e-16,gG=1e-17,mG=1e-18,_G=1e-19,xG=1e-20,yG=Math.PI/2,AG=Math.PI/4,TG=Math.PI/6,MG=Math.PI*2;function Mp(e,t=[],r=0){let n=Math.fround(e),s=e-n;return t[r]=n,t[r+1]=s,t}function n2(e){return e-Math.fround(e)}function s2(e){let t=new Float32Array(32);for(let r=0;r<4;++r)for(let n=0;n<4;++n){let s=r*4+n;Mp(e[n*4+r],t,s*2)}return t}var EG=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  
  // All these functions are for substituting tan() function from Intel GPU only
  const float TWO_PI = 6.2831854820251465;
  const float PI_2 = 1.5707963705062866;
  const float PI_16 = 0.1963495463132858;
  
  const float SIN_TABLE_0 = 0.19509032368659973;
  const float SIN_TABLE_1 = 0.3826834261417389;
  const float SIN_TABLE_2 = 0.5555702447891235;
  const float SIN_TABLE_3 = 0.7071067690849304;
  
  const float COS_TABLE_0 = 0.9807852506637573;
  const float COS_TABLE_1 = 0.9238795042037964;
  const float COS_TABLE_2 = 0.8314695954322815;
  const float COS_TABLE_3 = 0.7071067690849304;
  
  const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
  const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
  const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
  const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!
  
  float sin_taylor_fp32(float a) {
    float r, s, t, x;
  
    if (a == 0.0) {
      return 0.0;
    }
  
    x = -a * a;
    s = a;
    r = a;
  
    r = r * x;
    t = r * INVERSE_FACTORIAL_3;
    s = s + t;
  
    r = r * x;
    t = r * INVERSE_FACTORIAL_5;
    s = s + t;
  
    r = r * x;
    t = r * INVERSE_FACTORIAL_7;
    s = s + t;
  
    r = r * x;
    t = r * INVERSE_FACTORIAL_9;
    s = s + t;
  
    return s;
  }
  
  void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
    if (a == 0.0) {
      sin_t = 0.0;
      cos_t = 1.0;
    }
    sin_t = sin_taylor_fp32(a);
    cos_t = sqrt(1.0 - sin_t * sin_t);
  }
  
  float tan_taylor_fp32(float a) {
      float sin_a;
      float cos_a;
  
      if (a == 0.0) {
          return 0.0;
      }
  
      // 2pi range reduction
      float z = floor(a / TWO_PI);
      float r = a - TWO_PI * z;
  
      float t;
      float q = floor(r / PI_2 + 0.5);
      int j = int(q);
  
      if (j < -2 || j > 2) {
          return 1.0 / 0.0;
      }
  
      t = r - PI_2 * q;
  
      q = floor(t / PI_16 + 0.5);
      int k = int(q);
      int abs_k = int(abs(float(k)));
  
      if (abs_k > 4) {
          return 1.0 / 0.0;
      } else {
          t = t - PI_16 * q;
      }
  
      float u = 0.0;
      float v = 0.0;
  
      float sin_t, cos_t;
      float s, c;
      sincos_taylor_fp32(t, sin_t, cos_t);
  
      if (k == 0) {
          s = sin_t;
          c = cos_t;
      } else {
          if (abs(float(abs_k) - 1.0) < 0.5) {
              u = COS_TABLE_0;
              v = SIN_TABLE_0;
          } else if (abs(float(abs_k) - 2.0) < 0.5) {
              u = COS_TABLE_1;
              v = SIN_TABLE_1;
          } else if (abs(float(abs_k) - 3.0) < 0.5) {
              u = COS_TABLE_2;
              v = SIN_TABLE_2;
          } else if (abs(float(abs_k) - 4.0) < 0.5) {
              u = COS_TABLE_3;
              v = SIN_TABLE_3;
          }
          if (k > 0) {
              s = u * sin_t + v * cos_t;
              c = u * cos_t - v * sin_t;
          } else {
              s = u * sin_t - v * cos_t;
              c = u * cos_t + v * sin_t;
          }
      }
  
      if (j == 0) {
          sin_a = s;
          cos_a = c;
      } else if (j == 1) {
          sin_a = c;
          cos_a = -s;
      } else if (j == -1) {
          sin_a = -c;
          cos_a = s;
      } else {
          sin_a = -s;
          cos_a = -c;
      }
      return sin_a / cos_a;
  }
  #endif
  
  float tan_fp32(float a) {
  #ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
    return tan_taylor_fp32(a);
  #else
    return tan(a);
  #endif
  }
  `,i2={name:"fp32",vs:EG};var Gv=`
  uniform fp64arithmeticUniforms {
    uniform float ONE;
  } fp64;
  
  /*
  About LUMA_FP64_CODE_ELIMINATION_WORKAROUND
  
  The purpose of this workaround is to prevent shader compilers from
  optimizing away necessary arithmetic operations by swapping their sequences
  or transform the equation to some 'equivalent' form.
  
  The method is to multiply an artifical variable, ONE, which will be known to
  the compiler to be 1 only at runtime. The whole expression is then represented
  as a polynomial with respective to ONE. In the coefficients of all terms, only one a
  and one b should appear
  
  err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
  */
  
  // Divide float number to high and low floats to extend fraction bits
  vec2 split(float a) {
    const float SPLIT = 4097.0;
    float t = a * SPLIT;
  #if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
    float a_hi = t * fp64.ONE - (t - a);
    float a_lo = a * fp64.ONE - a_hi;
  #else
    float a_hi = t - (t - a);
    float a_lo = a - a_hi;
  #endif
    return vec2(a_hi, a_lo);
  }
  
  // Divide float number again when high float uses too many fraction bits
  vec2 split2(vec2 a) {
    vec2 b = split(a.x);
    b.y += a.y;
    return b;
  }
  
  // Special sum operation when a > b
  vec2 quickTwoSum(float a, float b) {
  #if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
    float sum = (a + b) * fp64.ONE;
    float err = b - (sum - a) * fp64.ONE;
  #else
    float sum = a + b;
    float err = b - (sum - a);
  #endif
    return vec2(sum, err);
  }
  
  // General sum operation
  vec2 twoSum(float a, float b) {
    float s = (a + b);
  #if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
    float v = (s * fp64.ONE - a) * fp64.ONE;
    float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
  #else
    float v = s - a;
    float err = (a - (s - v)) + (b - v);
  #endif
    return vec2(s, err);
  }
  
  vec2 twoSub(float a, float b) {
    float s = (a - b);
  #if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
    float v = (s * fp64.ONE - a) * fp64.ONE;
    float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
  #else
    float v = s - a;
    float err = (a - (s - v)) - (b + v);
  #endif
    return vec2(s, err);
  }
  
  vec2 twoSqr(float a) {
    float prod = a * a;
    vec2 a_fp64 = split(a);
  #if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
    float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
      a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
  #else
    float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
  #endif
    return vec2(prod, err);
  }
  
  vec2 twoProd(float a, float b) {
    float prod = a * b;
    vec2 a_fp64 = split(a);
    vec2 b_fp64 = split(b);
    float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
      a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
    return vec2(prod, err);
  }
  
  vec2 sum_fp64(vec2 a, vec2 b) {
    vec2 s, t;
    s = twoSum(a.x, b.x);
    t = twoSum(a.y, b.y);
    s.y += t.x;
    s = quickTwoSum(s.x, s.y);
    s.y += t.y;
    s = quickTwoSum(s.x, s.y);
    return s;
  }
  
  vec2 sub_fp64(vec2 a, vec2 b) {
    vec2 s, t;
    s = twoSub(a.x, b.x);
    t = twoSub(a.y, b.y);
    s.y += t.x;
    s = quickTwoSum(s.x, s.y);
    s.y += t.y;
    s = quickTwoSum(s.x, s.y);
    return s;
  }
  
  vec2 mul_fp64(vec2 a, vec2 b) {
    vec2 prod = twoProd(a.x, b.x);
    // y component is for the error
    prod.y += a.x * b.y;
  #if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
    prod = split2(prod);
  #endif
    prod = quickTwoSum(prod.x, prod.y);
    prod.y += a.y * b.x;
  #if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
    prod = split2(prod);
  #endif
    prod = quickTwoSum(prod.x, prod.y);
    return prod;
  }
  
  vec2 div_fp64(vec2 a, vec2 b) {
    float xn = 1.0 / b.x;
  #if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
    vec2 yn = mul_fp64(a, vec2(xn, 0));
  #else
    vec2 yn = a * xn;
  #endif
    float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
    vec2 prod = twoProd(xn, diff);
    return sum_fp64(yn, prod);
  }
  
  vec2 sqrt_fp64(vec2 a) {
    if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
    if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
  
    float x = 1.0 / sqrt(a.x);
    float yn = a.x * x;
  #if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
    vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
  #else
    vec2 yn_sqr = twoSqr(yn);
  #endif
    float diff = sub_fp64(a, yn_sqr).x;
    vec2 prod = twoProd(x * 0.5, diff);
  #if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
    return sum_fp64(split(yn), prod);
  #else
    return sum_fp64(vec2(yn, 0.0), prod);
  #endif
  }
  `;var jv=`const vec2 E_FP64 = vec2(2.7182817459106445e+00, 8.254840366817007e-08);
  const vec2 LOG2_FP64 = vec2(0.6931471824645996e+00, -1.9046542121259336e-09);
  const vec2 PI_FP64 = vec2(3.1415927410125732, -8.742278012618954e-8);
  const vec2 TWO_PI_FP64 = vec2(6.2831854820251465, -1.7484556025237907e-7);
  const vec2 PI_2_FP64 = vec2(1.5707963705062866, -4.371139006309477e-8);
  const vec2 PI_4_FP64 = vec2(0.7853981852531433, -2.1855695031547384e-8);
  const vec2 PI_16_FP64 = vec2(0.19634954631328583, -5.463923757886846e-9);
  const vec2 PI_16_2_FP64 = vec2(0.39269909262657166, -1.0927847515773692e-8);
  const vec2 PI_16_3_FP64 = vec2(0.5890486240386963, -1.4906100798128818e-9);
  const vec2 PI_180_FP64 = vec2(0.01745329238474369, 1.3519960498364902e-10);
  
  const vec2 SIN_TABLE_0_FP64 = vec2(0.19509032368659973, -1.6704714833615242e-9);
  const vec2 SIN_TABLE_1_FP64 = vec2(0.3826834261417389, 6.22335089017767e-9);
  const vec2 SIN_TABLE_2_FP64 = vec2(0.5555702447891235, -1.1769521357507529e-8);
  const vec2 SIN_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617041793133e-8);
  
  const vec2 COS_TABLE_0_FP64 = vec2(0.9807852506637573, 2.9739473106360492e-8);
  const vec2 COS_TABLE_1_FP64 = vec2(0.9238795042037964, 2.8307490351764386e-8);
  const vec2 COS_TABLE_2_FP64 = vec2(0.8314695954322815, 1.6870263741530778e-8);
  const vec2 COS_TABLE_3_FP64 = vec2(0.7071067690849304, 1.2101617152815436e-8);
  
  const vec2 INVERSE_FACTORIAL_3_FP64 = vec2(1.666666716337204e-01, -4.967053879312289e-09); // 1/3!
  const vec2 INVERSE_FACTORIAL_4_FP64 = vec2(4.16666679084301e-02, -1.2417634698280722e-09); // 1/4!
  const vec2 INVERSE_FACTORIAL_5_FP64 = vec2(8.333333767950535e-03, -4.34617203337595e-10); // 1/5!
  const vec2 INVERSE_FACTORIAL_6_FP64 = vec2(1.3888889225199819e-03, -3.3631094437103215e-11); // 1/6!
  const vec2 INVERSE_FACTORIAL_7_FP64 = vec2(1.9841270113829523e-04,  -2.725596874933456e-12); // 1/7!
  const vec2 INVERSE_FACTORIAL_8_FP64 = vec2(2.4801587642286904e-05, -3.406996025904184e-13); // 1/8!
  const vec2 INVERSE_FACTORIAL_9_FP64 = vec2(2.75573188446287533e-06, 3.7935713937038186e-14); // 1/9!
  const vec2 INVERSE_FACTORIAL_10_FP64 = vec2(2.755731998149713e-07, -7.575112367869873e-15); // 1/10!
  
  float nint(float d) {
      if (d == floor(d)) return d;
      return floor(d + 0.5);
  }
  
  vec2 nint_fp64(vec2 a) {
      float hi = nint(a.x);
      float lo;
      vec2 tmp;
      if (hi == a.x) {
          lo = nint(a.y);
          tmp = quickTwoSum(hi, lo);
      } else {
          lo = 0.0;
          if (abs(hi - a.x) == 0.5 && a.y < 0.0) {
              hi -= 1.0;
          }
          tmp = vec2(hi, lo);
      }
      return tmp;
  }
  
  /* k_power controls how much range reduction we would like to have
  Range reduction uses the following method:
  assume a = k_power * r + m * log(2), k and m being integers.
  Set k_power = 4 (we can choose other k to trade accuracy with performance.
  we only need to calculate exp(r) and using exp(a) = 2^m * exp(r)^k_power;
  */
  
  vec2 exp_fp64(vec2 a) {
    // We need to make sure these two numbers match
    // as bit-wise shift is not available in GLSL 1.0
    const int k_power = 4;
    const float k = 16.0;
  
    const float inv_k = 1.0 / k;
  
    if (a.x <= -88.0) return vec2(0.0, 0.0);
    if (a.x >= 88.0) return vec2(1.0 / 0.0, 1.0 / 0.0);
    if (a.x == 0.0 && a.y == 0.0) return vec2(1.0, 0.0);
    if (a.x == 1.0 && a.y == 0.0) return E_FP64;
  
    float m = floor(a.x / LOG2_FP64.x + 0.5);
    vec2 r = sub_fp64(a, mul_fp64(LOG2_FP64, vec2(m, 0.0))) * inv_k;
    vec2 s, t, p;
  
    p = mul_fp64(r, r);
    s = sum_fp64(r, p * 0.5);
    p = mul_fp64(p, r);
    t = mul_fp64(p, INVERSE_FACTORIAL_3_FP64);
  
    s = sum_fp64(s, t);
    p = mul_fp64(p, r);
    t = mul_fp64(p, INVERSE_FACTORIAL_4_FP64);
  
    s = sum_fp64(s, t);
    p = mul_fp64(p, r);
    t = mul_fp64(p, INVERSE_FACTORIAL_5_FP64);
  
    // s = sum_fp64(s, t);
    // p = mul_fp64(p, r);
    // t = mul_fp64(p, INVERSE_FACTORIAL_6_FP64);
  
    // s = sum_fp64(s, t);
    // p = mul_fp64(p, r);
    // t = mul_fp64(p, INVERSE_FACTORIAL_7_FP64);
  
    s = sum_fp64(s, t);
  
  
    // At this point, s = exp(r) - 1; but after following 4 recursions, we will get exp(r) ^ 512 - 1.
    for (int i = 0; i < k_power; i++) {
      s = sum_fp64(s * 2.0, mul_fp64(s, s));
    }
  
  #if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
    s = sum_fp64(s, vec2(fp64.ONE, 0.0));
  #else
    s = sum_fp64(s, vec2(1.0, 0.0));
  #endif
  
    return s * pow(2.0, m);
  //   return r;
  }
  
  vec2 log_fp64(vec2 a)
  {
    if (a.x == 1.0 && a.y == 0.0) return vec2(0.0, 0.0);
    if (a.x <= 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);
    vec2 x = vec2(log(a.x), 0.0);
    vec2 s;
  #if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
    s = vec2(fp64.ONE, 0.0);
  #else
    s = vec2(1.0, 0.0);
  #endif
  
    x = sub_fp64(sum_fp64(x, mul_fp64(a, exp_fp64(-x))), s);
    return x;
  }
  
  vec2 sin_taylor_fp64(vec2 a) {
    vec2 r, s, t, x;
  
    if (a.x == 0.0 && a.y == 0.0) {
      return vec2(0.0, 0.0);
    }
  
    x = -mul_fp64(a, a);
    s = a;
    r = a;
  
    r = mul_fp64(r, x);
    t = mul_fp64(r, INVERSE_FACTORIAL_3_FP64);
    s = sum_fp64(s, t);
  
    r = mul_fp64(r, x);
    t = mul_fp64(r, INVERSE_FACTORIAL_5_FP64);
    s = sum_fp64(s, t);
  
    /* keep the following commented code in case we need them
    for extra accuracy from the Taylor expansion*/
  
    // r = mul_fp64(r, x);
    // t = mul_fp64(r, INVERSE_FACTORIAL_7_FP64);
    // s = sum_fp64(s, t);
  
    // r = mul_fp64(r, x);
    // t = mul_fp64(r, INVERSE_FACTORIAL_9_FP64);
    // s = sum_fp64(s, t);
  
    return s;
  }
  
  vec2 cos_taylor_fp64(vec2 a) {
    vec2 r, s, t, x;
  
    if (a.x == 0.0 && a.y == 0.0) {
      return vec2(1.0, 0.0);
    }
  
    x = -mul_fp64(a, a);
    r = x;
    s = sum_fp64(vec2(1.0, 0.0), r * 0.5);
  
    r = mul_fp64(r, x);
    t = mul_fp64(r, INVERSE_FACTORIAL_4_FP64);
    s = sum_fp64(s, t);
  
    r = mul_fp64(r, x);
    t = mul_fp64(r, INVERSE_FACTORIAL_6_FP64);
    s = sum_fp64(s, t);
  
    /* keep the following commented code in case we need them
    for extra accuracy from the Taylor expansion*/
  
    // r = mul_fp64(r, x);
    // t = mul_fp64(r, INVERSE_FACTORIAL_8_FP64);
    // s = sum_fp64(s, t);
  
    // r = mul_fp64(r, x);
    // t = mul_fp64(r, INVERSE_FACTORIAL_10_FP64);
    // s = sum_fp64(s, t);
  
    return s;
  }
  
  void sincos_taylor_fp64(vec2 a, out vec2 sin_t, out vec2 cos_t) {
    if (a.x == 0.0 && a.y == 0.0) {
      sin_t = vec2(0.0, 0.0);
      cos_t = vec2(1.0, 0.0);
    }
  
    sin_t = sin_taylor_fp64(a);
    cos_t = sqrt_fp64(sub_fp64(vec2(1.0, 0.0), mul_fp64(sin_t, sin_t)));
  }
  
  vec2 sin_fp64(vec2 a) {
      if (a.x == 0.0 && a.y == 0.0) {
          return vec2(0.0, 0.0);
      }
  
      // 2pi range reduction
      vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));
      vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));
  
      vec2 t;
      float q = floor(r.x / PI_2_FP64.x + 0.5);
      int j = int(q);
  
      if (j < -2 || j > 2) {
          return vec2(0.0 / 0.0, 0.0 / 0.0);
      }
  
      t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));
  
      q = floor(t.x / PI_16_FP64.x + 0.5);
      int k = int(q);
  
      if (k == 0) {
          if (j == 0) {
              return sin_taylor_fp64(t);
          } else if (j == 1) {
              return cos_taylor_fp64(t);
          } else if (j == -1) {
              return -cos_taylor_fp64(t);
          } else {
              return -sin_taylor_fp64(t);
          }
      }
  
      int abs_k = int(abs(float(k)));
  
      if (abs_k > 4) {
          return vec2(0.0 / 0.0, 0.0 / 0.0);
      } else {
          t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));
      }
  
      vec2 u = vec2(0.0, 0.0);
      vec2 v = vec2(0.0, 0.0);
  
  #if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
      if (abs(float(abs_k) - 1.0) < 0.5) {
          u = COS_TABLE_0_FP64;
          v = SIN_TABLE_0_FP64;
      } else if (abs(float(abs_k) - 2.0) < 0.5) {
          u = COS_TABLE_1_FP64;
          v = SIN_TABLE_1_FP64;
      } else if (abs(float(abs_k) - 3.0) < 0.5) {
          u = COS_TABLE_2_FP64;
          v = SIN_TABLE_2_FP64;
      } else if (abs(float(abs_k) - 4.0) < 0.5) {
          u = COS_TABLE_3_FP64;
          v = SIN_TABLE_3_FP64;
      }
  #else
      if (abs_k == 1) {
          u = COS_TABLE_0_FP64;
          v = SIN_TABLE_0_FP64;
      } else if (abs_k == 2) {
          u = COS_TABLE_1_FP64;
          v = SIN_TABLE_1_FP64;
      } else if (abs_k == 3) {
          u = COS_TABLE_2_FP64;
          v = SIN_TABLE_2_FP64;
      } else if (abs_k == 4) {
          u = COS_TABLE_3_FP64;
          v = SIN_TABLE_3_FP64;
      }
  #endif
  
      vec2 sin_t, cos_t;
      sincos_taylor_fp64(t, sin_t, cos_t);
  
  
  
      vec2 result = vec2(0.0, 0.0);
      if (j == 0) {
          if (k > 0) {
              result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
          } else {
              result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
          }
      } else if (j == 1) {
          if (k > 0) {
              result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
          } else {
              result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
          }
      } else if (j == -1) {
          if (k > 0) {
              result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));
          } else {
              result = -sum_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));
          }
      } else {
          if (k > 0) {
              result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
          } else {
              result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));
          }
      }
  
      return result;
  }
  
  vec2 cos_fp64(vec2 a) {
      if (a.x == 0.0 && a.y == 0.0) {
          return vec2(1.0, 0.0);
      }
  
      // 2pi range reduction
      vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));
      vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));
  
      vec2 t;
      float q = floor(r.x / PI_2_FP64.x + 0.5);
      int j = int(q);
  
      if (j < -2 || j > 2) {
          return vec2(0.0 / 0.0, 0.0 / 0.0);
      }
  
      t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));
  
      q = floor(t.x / PI_16_FP64.x + 0.5);
      int k = int(q);
  
      if (k == 0) {
          if (j == 0) {
              return cos_taylor_fp64(t);
          } else if (j == 1) {
              return -sin_taylor_fp64(t);
          } else if (j == -1) {
              return sin_taylor_fp64(t);
          } else {
              return -cos_taylor_fp64(t);
          }
      }
  
      int abs_k = int(abs(float(k)));
  
      if (abs_k > 4) {
          return vec2(0.0 / 0.0, 0.0 / 0.0);
      } else {
          t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));
      }
  
      vec2 u = vec2(0.0, 0.0);
      vec2 v = vec2(0.0, 0.0);
  
  #if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
      if (abs(float(abs_k) - 1.0) < 0.5) {
          u = COS_TABLE_0_FP64;
          v = SIN_TABLE_0_FP64;
      } else if (abs(float(abs_k) - 2.0) < 0.5) {
          u = COS_TABLE_1_FP64;
          v = SIN_TABLE_1_FP64;
      } else if (abs(float(abs_k) - 3.0) < 0.5) {
          u = COS_TABLE_2_FP64;
          v = SIN_TABLE_2_FP64;
      } else if (abs(float(abs_k) - 4.0) < 0.5) {
          u = COS_TABLE_3_FP64;
          v = SIN_TABLE_3_FP64;
      }
  #else
      if (abs_k == 1) {
          u = COS_TABLE_0_FP64;
          v = SIN_TABLE_0_FP64;
      } else if (abs_k == 2) {
          u = COS_TABLE_1_FP64;
          v = SIN_TABLE_1_FP64;
      } else if (abs_k == 3) {
          u = COS_TABLE_2_FP64;
          v = SIN_TABLE_2_FP64;
      } else if (abs_k == 4) {
          u = COS_TABLE_3_FP64;
          v = SIN_TABLE_3_FP64;
      }
  #endif
  
      vec2 sin_t, cos_t;
      sincos_taylor_fp64(t, sin_t, cos_t);
  
      vec2 result = vec2(0.0, 0.0);
      if (j == 0) {
          if (k > 0) {
              result = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
          } else {
              result = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
          }
      } else if (j == 1) {
          if (k > 0) {
              result = -sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
          } else {
              result = sub_fp64(mul_fp64(v, cos_t), mul_fp64(u, sin_t));
          }
      } else if (j == -1) {
          if (k > 0) {
              result = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
          } else {
              result = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
          }
      } else {
          if (k > 0) {
              result = sub_fp64(mul_fp64(v, sin_t), mul_fp64(u, cos_t));
          } else {
              result = -sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
          }
      }
  
      return result;
  }
  
  vec2 tan_fp64(vec2 a) {
      vec2 sin_a;
      vec2 cos_a;
  
      if (a.x == 0.0 && a.y == 0.0) {
          return vec2(0.0, 0.0);
      }
  
      // 2pi range reduction
      vec2 z = nint_fp64(div_fp64(a, TWO_PI_FP64));
      vec2 r = sub_fp64(a, mul_fp64(TWO_PI_FP64, z));
  
      vec2 t;
      float q = floor(r.x / PI_2_FP64.x + 0.5);
      int j = int(q);
  
  
      if (j < -2 || j > 2) {
          return vec2(0.0 / 0.0, 0.0 / 0.0);
      }
  
      t = sub_fp64(r, mul_fp64(PI_2_FP64, vec2(q, 0.0)));
  
      q = floor(t.x / PI_16_FP64.x + 0.5);
      int k = int(q);
      int abs_k = int(abs(float(k)));
  
      // We just can't get PI/16 * 3.0 very accurately.
      // so let's just store it
      if (abs_k > 4) {
          return vec2(0.0 / 0.0, 0.0 / 0.0);
      } else {
          t = sub_fp64(t, mul_fp64(PI_16_FP64, vec2(q, 0.0)));
      }
  
  
      vec2 u = vec2(0.0, 0.0);
      vec2 v = vec2(0.0, 0.0);
  
      vec2 sin_t, cos_t;
      vec2 s, c;
      sincos_taylor_fp64(t, sin_t, cos_t);
  
      if (k == 0) {
          s = sin_t;
          c = cos_t;
      } else {
  #if defined(NVIDIA_FP64_WORKAROUND) || defined(INTEL_FP64_WORKAROUND)
          if (abs(float(abs_k) - 1.0) < 0.5) {
              u = COS_TABLE_0_FP64;
              v = SIN_TABLE_0_FP64;
          } else if (abs(float(abs_k) - 2.0) < 0.5) {
              u = COS_TABLE_1_FP64;
              v = SIN_TABLE_1_FP64;
          } else if (abs(float(abs_k) - 3.0) < 0.5) {
              u = COS_TABLE_2_FP64;
              v = SIN_TABLE_2_FP64;
          } else if (abs(float(abs_k) - 4.0) < 0.5) {
              u = COS_TABLE_3_FP64;
              v = SIN_TABLE_3_FP64;
          }
  #else
          if (abs_k == 1) {
              u = COS_TABLE_0_FP64;
              v = SIN_TABLE_0_FP64;
          } else if (abs_k == 2) {
              u = COS_TABLE_1_FP64;
              v = SIN_TABLE_1_FP64;
          } else if (abs_k == 3) {
              u = COS_TABLE_2_FP64;
              v = SIN_TABLE_2_FP64;
          } else if (abs_k == 4) {
              u = COS_TABLE_3_FP64;
              v = SIN_TABLE_3_FP64;
          }
  #endif
          if (k > 0) {
              s = sum_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
              c = sub_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
          } else {
              s = sub_fp64(mul_fp64(u, sin_t), mul_fp64(v, cos_t));
              c = sum_fp64(mul_fp64(u, cos_t), mul_fp64(v, sin_t));
          }
      }
  
      if (j == 0) {
          sin_a = s;
          cos_a = c;
      } else if (j == 1) {
          sin_a = c;
          cos_a = -s;
      } else if (j == -1) {
          sin_a = -c;
          cos_a = s;
      } else {
          sin_a = -s;
          cos_a = -c;
      }
      return div_fp64(sin_a, cos_a);
  }
  
  vec2 radians_fp64(vec2 degree) {
    return mul_fp64(degree, PI_180_FP64);
  }
  
  vec2 mix_fp64(vec2 a, vec2 b, float x) {
    vec2 range = sub_fp64(b, a);
    return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
  }
  
  // Vector functions
  // vec2 functions
  void vec2_sum_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
      out_val[0] = sum_fp64(a[0], b[0]);
      out_val[1] = sum_fp64(a[1], b[1]);
  }
  
  void vec2_sub_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
      out_val[0] = sub_fp64(a[0], b[0]);
      out_val[1] = sub_fp64(a[1], b[1]);
  }
  
  void vec2_mul_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
      out_val[0] = mul_fp64(a[0], b[0]);
      out_val[1] = mul_fp64(a[1], b[1]);
  }
  
  void vec2_div_fp64(vec2 a[2], vec2 b[2], out vec2 out_val[2]) {
      out_val[0] = div_fp64(a[0], b[0]);
      out_val[1] = div_fp64(a[1], b[1]);
  }
  
  void vec2_mix_fp64(vec2 x[2], vec2 y[2], float a, out vec2 out_val[2]) {
    vec2 range[2];
    vec2_sub_fp64(y, x, range);
    vec2 portion[2];
    portion[0] = range[0] * a;
    portion[1] = range[1] * a;
    vec2_sum_fp64(x, portion, out_val);
  }
  
  vec2 vec2_length_fp64(vec2 x[2]) {
    return sqrt_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])));
  }
  
  void vec2_normalize_fp64(vec2 x[2], out vec2 out_val[2]) {
    vec2 length = vec2_length_fp64(x);
    vec2 length_vec2[2];
    length_vec2[0] = length;
    length_vec2[1] = length;
  
    vec2_div_fp64(x, length_vec2, out_val);
  }
  
  vec2 vec2_distance_fp64(vec2 x[2], vec2 y[2]) {
    vec2 diff[2];
    vec2_sub_fp64(x, y, diff);
    return vec2_length_fp64(diff);
  }
  
  vec2 vec2_dot_fp64(vec2 a[2], vec2 b[2]) {
    vec2 v[2];
  
    v[0] = mul_fp64(a[0], b[0]);
    v[1] = mul_fp64(a[1], b[1]);
  
    return sum_fp64(v[0], v[1]);
  }
  
  // vec3 functions
  void vec3_sub_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {
    for (int i = 0; i < 3; i++) {
      out_val[i] = sum_fp64(a[i], b[i]);
    }
  }
  
  void vec3_sum_fp64(vec2 a[3], vec2 b[3], out vec2 out_val[3]) {
    for (int i = 0; i < 3; i++) {
      out_val[i] = sum_fp64(a[i], b[i]);
    }
  }
  
  vec2 vec3_length_fp64(vec2 x[3]) {
    return sqrt_fp64(sum_fp64(sum_fp64(mul_fp64(x[0], x[0]), mul_fp64(x[1], x[1])),
      mul_fp64(x[2], x[2])));
  }
  
  vec2 vec3_distance_fp64(vec2 x[3], vec2 y[3]) {
    vec2 diff[3];
    vec3_sub_fp64(x, y, diff);
    return vec3_length_fp64(diff);
  }
  
  // vec4 functions
  void vec4_fp64(vec4 a, out vec2 out_val[4]) {
    out_val[0].x = a[0];
    out_val[0].y = 0.0;
  
    out_val[1].x = a[1];
    out_val[1].y = 0.0;
  
    out_val[2].x = a[2];
    out_val[2].y = 0.0;
  
    out_val[3].x = a[3];
    out_val[3].y = 0.0;
  }
  
  void vec4_scalar_mul_fp64(vec2 a[4], vec2 b, out vec2 out_val[4]) {
    out_val[0] = mul_fp64(a[0], b);
    out_val[1] = mul_fp64(a[1], b);
    out_val[2] = mul_fp64(a[2], b);
    out_val[3] = mul_fp64(a[3], b);
  }
  
  void vec4_sum_fp64(vec2 a[4], vec2 b[4], out vec2 out_val[4]) {
    for (int i = 0; i < 4; i++) {
      out_val[i] = sum_fp64(a[i], b[i]);
    }
  }
  
  void vec4_dot_fp64(vec2 a[4], vec2 b[4], out vec2 out_val) {
    vec2 v[4];
  
    v[0] = mul_fp64(a[0], b[0]);
    v[1] = mul_fp64(a[1], b[1]);
    v[2] = mul_fp64(a[2], b[2]);
    v[3] = mul_fp64(a[3], b[3]);
  
    out_val = sum_fp64(sum_fp64(v[0], v[1]), sum_fp64(v[2], v[3]));
  }
  
  void mat4_vec4_mul_fp64(vec2 b[16], vec2 a[4], out vec2 out_val[4]) {
    vec2 tmp[4];
  
    for (int i = 0; i < 4; i++)
    {
      for (int j = 0; j < 4; j++)
      {
        tmp[j] = b[j + i * 4];
      }
      vec4_dot_fp64(a, tmp, out_val[i]);
    }
  }
  `;var bG={ONE:1},Ep={name:"fp64arithmetic",vs:Gv,defaultUniforms:bG,uniformTypes:{ONE:"f32"},fp64ify:Mp,fp64LowPart:n2,fp64ifyMatrix4:s2},bp={name:"fp64",vs:jv,dependencies:[Ep],fp64ify:Mp,fp64LowPart:n2,fp64ifyMatrix4:s2};var SG=[0,1,1,1],vG=`uniform pickingUniforms {
    float isActive;
    float isAttribute;
    float isHighlightActive;
    float useFloatColors;
    vec3 highlightedObjectColor;
    vec4 highlightColor;
  } picking;
  
  out vec4 picking_vRGBcolor_Avalid;
  
  // Normalize unsigned byte color to 0-1 range
  vec3 picking_normalizeColor(vec3 color) {
    return picking.useFloatColors > 0.5 ? color : color / 255.0;
  }
  
  // Normalize unsigned byte color to 0-1 range
  vec4 picking_normalizeColor(vec4 color) {
    return picking.useFloatColors > 0.5 ? color : color / 255.0;
  }
  
  bool picking_isColorZero(vec3 color) {
    return dot(color, vec3(1.0)) < 0.00001;
  }
  
  bool picking_isColorValid(vec3 color) {
    return dot(color, vec3(1.0)) > 0.00001;
  }
  
  // Check if this vertex is highlighted 
  bool isVertexHighlighted(vec3 vertexColor) {
    vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
    return
      bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
  }
  
  // Set the current picking color
  void picking_setPickingColor(vec3 pickingColor) {
    pickingColor = picking_normalizeColor(pickingColor);
  
    if (bool(picking.isActive)) {
      // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
      picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
  
      if (!bool(picking.isAttribute)) {
        // Stores the picking color so that the fragment shader can render it during picking
        picking_vRGBcolor_Avalid.rgb = pickingColor;
      }
    } else {
      // Do the comparison with selected item color in vertex shader as it should mean fewer compares
      picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
    }
  }
  
  void picking_setPickingAttribute(float value) {
    if (bool(picking.isAttribute)) {
      picking_vRGBcolor_Avalid.r = value;
    }
  }
  
  void picking_setPickingAttribute(vec2 value) {
    if (bool(picking.isAttribute)) {
      picking_vRGBcolor_Avalid.rg = value;
    }
  }
  
  void picking_setPickingAttribute(vec3 value) {
    if (bool(picking.isAttribute)) {
      picking_vRGBcolor_Avalid.rgb = value;
    }
  }
  `,wG=`uniform pickingUniforms {
    float isActive;
    float isAttribute;
    float isHighlightActive;
    float useFloatColors;
    vec3 highlightedObjectColor;
    vec4 highlightColor;
  } picking;
  
  in vec4 picking_vRGBcolor_Avalid;
  
  /*
   * Returns highlight color if this item is selected.
   */
  vec4 picking_filterHighlightColor(vec4 color) {
    // If we are still picking, we don't highlight
    if (picking.isActive > 0.5) {
      return color;
    }
  
    bool selected = bool(picking_vRGBcolor_Avalid.a);
  
    if (selected) {
      // Blend in highlight color based on its alpha value
      float highLightAlpha = picking.highlightColor.a;
      float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
      float highLightRatio = highLightAlpha / blendedAlpha;
  
      vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
      return vec4(blendedRGB, blendedAlpha);
    } else {
      return color;
    }
  }
  
  /*
   * Returns picking color if picking enabled else unmodified argument.
   */
  vec4 picking_filterPickingColor(vec4 color) {
    if (bool(picking.isActive)) {
      if (picking_vRGBcolor_Avalid.a == 0.0) {
        discard;
      }
      return picking_vRGBcolor_Avalid;
    }
    return color;
  }
  
  /*
   * Returns picking color if picking is enabled if not
   * highlight color if this item is selected, otherwise unmodified argument.
   */
  vec4 picking_filterColor(vec4 color) {
    vec4 highlightColor = picking_filterHighlightColor(color);
    return picking_filterPickingColor(highlightColor);
  }
  `,Sp={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:SG},vs:vG,fs:wG,getUniforms:CG};function CG(e={},t){let r={};if(e.highlightedObjectColor!==void 0)if(e.highlightedObjectColor===null)r.isHighlightActive=!1;else{r.isHighlightActive=!0;let n=e.highlightedObjectColor.slice(0,3);r.highlightedObjectColor=n}if(e.highlightColor){let n=Array.from(e.highlightColor,s=>s/255);Number.isFinite(n[3])||(n[3]=1),r.highlightColor=n}return e.isActive!==void 0&&(r.isActive=Boolean(e.isActive),r.isAttribute=Boolean(e.isAttribute)),e.useFloatColors!==void 0&&(r.useFloatColors=Boolean(e.useFloatColors)),r}var o2=`precision highp int;
  
  // #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
  struct AmbientLight {
    vec3 color;
  };
  
  struct PointLight {
    vec3 color;
    vec3 position;
    vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
  };
  
  struct DirectionalLight {
    vec3 color;
    vec3 direction;
  };
  
  uniform lightingUniforms {
    int enabled;
    int lightType;
  
    int directionalLightCount;
    int pointLightCount;
  
    vec3 ambientColor;
  
    vec3 lightColor0;
    vec3 lightPosition0;
    vec3 lightDirection0;
    vec3 lightAttenuation0;
  
    vec3 lightColor1;
    vec3 lightPosition1;
    vec3 lightDirection1;
    vec3 lightAttenuation1;
  
    vec3 lightColor2;
    vec3 lightPosition2;
    vec3 lightDirection2;
    vec3 lightAttenuation2;
  } lighting;
  
  PointLight lighting_getPointLight(int index) {
    switch (index) {
      case 0:
        return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
      case 1:
        return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
      case 2:
      default:  
        return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
    }
  }
  
  DirectionalLight lighting_getDirectionalLight(int index) {
    switch (index) {
      case 0:
        return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
      case 1:
        return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
      case 2:
      default:   
        return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
    }
  } 
  
  float getPointLightAttenuation(PointLight pointLight, float distance) {
    return pointLight.attenuation.x
         + pointLight.attenuation.y * distance
         + pointLight.attenuation.z * distance * distance;
  }
  
  // #endif
  `;var qv=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
  struct AmbientLight {
    color: vec3<f32>,
  };
  
  struct PointLight {
    color: vec3<f32>,
    position: vec3<f32>,
    attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
  };
  
  struct DirectionalLight {
    color: vec3<f32>,
    direction: vec3<f32>,
  };
  
  struct lightingUniforms {
    enabled: i32,
    poightCount: i32,
    directionalLightCount: i32,
  
    ambientColor: vec3<f32>,
  
    // TODO - support multiple lights by uncommenting arrays below
    lightType: i32,
    lightColor: vec3<f32>,
    lightDirection: vec3<f32>,
    lightPosition: vec3<f32>,
    lightAttenuation: vec3<f32>,
  
    // AmbientLight ambientLight;
    // PointLight pointLight[MAX_LIGHTS];
    // DirectionalLight directionalLight[MAX_LIGHTS];
  };
  
  // Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
  @binding(1) @group(0) var<uniform> lighting : lightingUniforms;
  
  fn lighting_getPointLight(index: i32) -> PointLight {
    return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
  }
  
  fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
    return DirectionalLight(lighting.lightColor, lighting.lightDirection);
  } 
  
  fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
    return pointLight.attenuation.x
         + pointLight.attenuation.y * distance
         + pointLight.attenuation.z * distance * distance;
  }
  `;var Xv=3,PG=255,th;(function(e){e[e.POINT=0]="POINT",e[e.DIRECTIONAL=1]="DIRECTIONAL"})(th||(th={}));var Hn={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:Xv},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:th.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:qv,vs:o2,fs:o2,getUniforms:RG};function RG(e,t={}){if(e=e&&{...e},!e)return{...Hn.defaultUniforms};e.lights&&(e={...e,...OG(e.lights),lights:void 0});let{ambientLight:r,pointLights:n,directionalLights:s}=e||{};if(!(r||n&&n.length>0||s&&s.length>0))return{...Hn.defaultUniforms,enabled:0};let o={...Hn.defaultUniforms,...t,...IG({ambientLight:r,pointLights:n,directionalLights:s})};return e.enabled!==void 0&&(o.enabled=e.enabled?1:0),o}function IG({ambientLight:e,pointLights:t=[],directionalLights:r=[]}){let n={};n.ambientLightColor=a2(e);let s=0;for(let i of t){n.lightType=th.POINT;let o=s;n[`lightColor${o}`]=a2(i),n[`lightPosition${o}`]=i.position,n[`lightAttenuation${o}`]=i.attenuation||[1,0,0],s++}for(let i of r){n.lightType=th.DIRECTIONAL;let o=s;n[`lightColor${o}`]=a2(i),n[`lightDirection${o}`]=i.direction,s++}return s>Xv&&F.warn("MAX_LIGHTS exceeded")(),n.directionalLightCount=r.length,n.pointLightCount=t.length,n}function OG(e){let t={pointLights:[],directionalLights:[]};for(let r of e||[])switch(r.type){case"ambient":t.ambientLight=r;break;case"directional":t.directionalLights?.push(r);break;case"point":t.pointLights?.push(r);break;default:}return t}function a2(e={}){let{color:t=[0,0,0],intensity:r=1}=e;return t.map(n=>n*r/PG)}var vp=`uniform phongMaterialUniforms {
    uniform float ambient;
    uniform float diffuse;
    uniform float shininess;
    uniform vec3  specularColor;
  } material;
  `,wp=`uniform phongMaterialUniforms {
    uniform float ambient;
    uniform float diffuse;
    uniform float shininess;
    uniform vec3  specularColor;
  } material;
  
  vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, material.shininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
  }
  
  vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
    vec3 lightColor = surfaceColor;
  
    if (lighting.enabled == 0) {
      return lightColor;
    }
  
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = material.ambient * surfaceColor * lighting.ambientColor;
  
    for (int i = 0; i < lighting.pointLightCount; i++) {
      PointLight pointLight = lighting_getPointLight(i);
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
    }
  
    int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
    for (int i = lighting.pointLightCount; i < totalLights; i++) {
      DirectionalLight directionalLight = lighting_getDirectionalLight(i);
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
    
    return lightColor;
  }
  `;var Us={props:{},name:"gouraudMaterial",vs:wp.replace("phongMaterial","gouraudMaterial"),fs:vp.replace("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[Hn],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){let t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(r=>r/255)),{...Us.defaultUniforms,...t}}};var Yv=`struct phongMaterialUniforms {
    ambient: f32,
    diffuse: f32,
    shininess: f32,
    specularColor: vec3<f32>,
  };
  
  @binding(2) @group(0) var<uniform> material : phongMaterialUniforms;
  
  fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
    let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
    var lambertian: f32 = dot(light_direction, normal_worldspace);
    var specular: f32 = 0.0;
    if (lambertian > 0.0) {
      let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, material.shininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
  }
  
  fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
    var lightColor: vec3<f32> = surfaceColor;
  
    if (lighting.enabled == 0) {
      return lightColor;
    }
  
    let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
    lightColor = material.ambient * surfaceColor * lighting.ambientColor;
  
    if (lighting.lightType == 0) {
      let pointLight: PointLight  = lighting_getPointLight(0);
      let light_position_worldspace: vec3<f32> = pointLight.position;
      let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    } else if (lighting.lightType == 1) {
      var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
    
    return lightColor;
    /*
    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting.pointLightCount) {
        break;
      }
      PointLight pointLight = lighting.pointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }
  
    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting.directionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting.directionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
    */
  }
  
  fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
    var lightColor = vec3<f32>(0, 0, 0);
    let surfaceColor = vec3<f32>(0, 0, 0);
  
    if (lighting.enabled == 0) {
      let view_direction = normalize(cameraPosition - position_worldspace);
  
      switch (lighting.lightType) {
        case 0, default: {
          let pointLight: PointLight = lighting_getPointLight(0);
          let light_position_worldspace: vec3<f32> = pointLight.position;
          let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
          lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
        }
        case 1: {
          let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
          lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
        }
      }
    }
    return lightColor;
  }
  `;var Ta={name:"phongMaterial",dependencies:[Hn],source:Yv,vs:vp,fs:wp,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){let t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(r=>r/255)),{...Ta.defaultUniforms,...t}}};var $v=`out vec3 pbr_vPosition;
  out vec2 pbr_vUV;
  
  #ifdef HAS_NORMALS
  # ifdef HAS_TANGENTS
  out mat3 pbr_vTBN;
  # else
  out vec3 pbr_vNormal;
  # endif
  #endif
  
  void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
  {
    vec4 pos = pbrProjection.modelMatrix * position;
    pbr_vPosition = vec3(pos.xyz) / pos.w;
  
  #ifdef HAS_NORMALS
  #ifdef HAS_TANGENTS
    vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
    vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
    vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
    pbr_vTBN = mat3(tangentW, bitangentW, normalW);
  #else // HAS_TANGENTS != 1
    pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
  #endif
  #endif
  
  #ifdef HAS_UV
    pbr_vUV = uv;
  #else
    pbr_vUV = vec2(0.,0.);
  #endif
  }
  `;var Kv=`precision highp float;
  
  uniform pbrMaterialUniforms {
    // Material is unlit
    bool unlit;
  
    // Base color map
    bool baseColorMapEnabled;
    vec4 baseColorFactor;
  
    bool normalMapEnabled;  
    float normalScale; // #ifdef HAS_NORMALMAP
  
    bool emissiveMapEnabled;
    vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP
  
    vec2 metallicRoughnessValues;
    bool metallicRoughnessMapEnabled;
  
    bool occlusionMapEnabled;
    float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
    
    bool alphaCutoffEnabled;
    float alphaCutoff; // #ifdef ALPHA_CUTOFF
    
    // IBL
    bool IBLenabled;
    vec2 scaleIBLAmbient; // #ifdef USE_IBL
    
    // debugging flags used for shader output of intermediate PBR variables
    // #ifdef PBR_DEBUG
    vec4 scaleDiffBaseMR;
    vec4 scaleFGDSpec;
    // #endif
  } pbrMaterial;
  
  // Samplers
  #ifdef HAS_BASECOLORMAP
  uniform sampler2D pbr_baseColorSampler;
  #endif
  #ifdef HAS_NORMALMAP
  uniform sampler2D pbr_normalSampler;
  #endif
  #ifdef HAS_EMISSIVEMAP
  uniform sampler2D pbr_emissiveSampler;
  #endif
  #ifdef HAS_METALROUGHNESSMAP
  uniform sampler2D pbr_metallicRoughnessSampler;
  #endif
  #ifdef HAS_OCCLUSIONMAP
  uniform sampler2D pbr_occlusionSampler;
  #endif
  #ifdef USE_IBL
  uniform samplerCube pbr_diffuseEnvSampler;
  uniform samplerCube pbr_specularEnvSampler;
  uniform sampler2D pbr_brdfLUT;
  #endif
  
  // Inputs from vertex shader
  
  in vec3 pbr_vPosition;
  in vec2 pbr_vUV;
  
  #ifdef HAS_NORMALS
  #ifdef HAS_TANGENTS
  in mat3 pbr_vTBN;
  #else
  in vec3 pbr_vNormal;
  #endif
  #endif
  
  // Encapsulate the various inputs used by the various functions in the shading equation
  // We store values in this struct to simplify the integration of alternative implementations
  // of the shading terms, outlined in the Readme.MD Appendix.
  struct PBRInfo {
    float NdotL;                  // cos angle between normal and light direction
    float NdotV;                  // cos angle between normal and view direction
    float NdotH;                  // cos angle between normal and half vector
    float LdotH;                  // cos angle between light direction and half vector
    float VdotH;                  // cos angle between view direction and half vector
    float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
    float metalness;              // metallic value at the surface
    vec3 reflectance0;            // full reflectance color (normal incidence angle)
    vec3 reflectance90;           // reflectance color at grazing angle
    float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
    vec3 diffuseColor;            // color contribution from diffuse lighting
    vec3 specularColor;           // color contribution from specular lighting
    vec3 n;                       // normal at surface point
    vec3 v;                       // vector from surface point to camera
  };
  
  const float M_PI = 3.141592653589793;
  const float c_MinRoughness = 0.04;
  
  vec4 SRGBtoLINEAR(vec4 srgbIn)
  {
  #ifdef MANUAL_SRGB
  #ifdef SRGB_FAST_APPROXIMATION
    vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
  #else // SRGB_FAST_APPROXIMATION
    vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
    vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
  #endif //SRGB_FAST_APPROXIMATION
    return vec4(linOut,srgbIn.w);;
  #else //MANUAL_SRGB
    return srgbIn;
  #endif //MANUAL_SRGB
  }
  
  // Find the normal for this fragment, pulling either from a predefined normal map
  // or from the interpolated mesh normal and tangent attributes.
  vec3 getNormal()
  {
    // Retrieve the tangent space matrix
  #ifndef HAS_TANGENTS
    vec3 pos_dx = dFdx(pbr_vPosition);
    vec3 pos_dy = dFdy(pbr_vPosition);
    vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
    vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
    vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);
  
  #ifdef HAS_NORMALS
    vec3 ng = normalize(pbr_vNormal);
  #else
    vec3 ng = cross(pos_dx, pos_dy);
  #endif
  
    t = normalize(t - ng * dot(ng, t));
    vec3 b = normalize(cross(ng, t));
    mat3 tbn = mat3(t, b, ng);
  #else // HAS_TANGENTS
    mat3 tbn = pbr_vTBN;
  #endif
  
  #ifdef HAS_NORMALMAP
    vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
    n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
  #else
    // The tbn matrix is linearly interpolated, so we need to re-normalize
    vec3 n = normalize(tbn[2].xyz);
  #endif
  
    return n;
  }
  
  // Calculation of the lighting contribution from an optional Image Based Light source.
  // Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
  // See our README.md on Environment Maps [3] for additional discussion.
  #ifdef USE_IBL
  vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
  {
    float mipCount = 9.0; // resolution of 512x512
    float lod = (pbrInfo.perceptualRoughness * mipCount);
    // retrieve a scale and bias to F0. See [1], Figure 3
    vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
      vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
    vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;
  
  #ifdef USE_TEX_LOD
    vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
  #else
    vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
  #endif
  
    vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
    vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);
  
    // For presentation, this allows us to disable IBL terms
    diffuse *= pbrMaterial.scaleIBLAmbient.x;
    specular *= pbrMaterial.scaleIBLAmbient.y;
  
    return diffuse + specular;
  }
  #endif
  
  // Basic Lambertian diffuse
  // Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
  // See also [1], Equation 1
  vec3 diffuse(PBRInfo pbrInfo)
  {
    return pbrInfo.diffuseColor / M_PI;
  }
  
  // The following equation models the Fresnel reflectance term of the spec equation (aka F())
  // Implementation of fresnel from [4], Equation 15
  vec3 specularReflection(PBRInfo pbrInfo)
  {
    return pbrInfo.reflectance0 +
      (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
      pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
  }
  
  // This calculates the specular geometric attenuation (aka G()),
  // where rougher material will reflect less light back to the viewer.
  // This implementation is based on [1] Equation 4, and we adopt their modifications to
  // alphaRoughness as input as originally proposed in [2].
  float geometricOcclusion(PBRInfo pbrInfo)
  {
    float NdotL = pbrInfo.NdotL;
    float NdotV = pbrInfo.NdotV;
    float r = pbrInfo.alphaRoughness;
  
    float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
    float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
    return attenuationL * attenuationV;
  }
  
  // The following equation(s) model the distribution of microfacet normals across
  // the area being drawn (aka D())
  // Implementation from "Average Irregularity Representation of a Roughened Surface
  // for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
  // Follows the distribution function recommended in the SIGGRAPH 2013 course notes
  // from EPIC Games [1], Equation 3.
  float microfacetDistribution(PBRInfo pbrInfo)
  {
    float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
    float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
    return roughnessSq / (M_PI * f * f);
  }
  
  void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
    pbrInfo.NdotL = 1.0;
    pbrInfo.NdotH = 0.0;
    pbrInfo.LdotH = 0.0;
    pbrInfo.VdotH = 1.0;
  }
  
  void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
    vec3 n = pbrInfo.n;
    vec3 v = pbrInfo.v;
    vec3 l = normalize(lightDirection);             // Vector from surface point to light
    vec3 h = normalize(l+v);                        // Half vector between both l and v
  
    pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
    pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
    pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
    pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
  }
  
  void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
    vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
    PBRInfo_setDirectionalLight(pbrInfo, light_direction);
  }
  
  vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
    // Calculate the shading terms for the microfacet specular shading model
    vec3 F = specularReflection(pbrInfo);
    float G = geometricOcclusion(pbrInfo);
    float D = microfacetDistribution(pbrInfo);
  
    // Calculation of analytical lighting contribution
    vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
    vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
    // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
    return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
  }
  
  vec4 pbr_filterColor(vec4 colorUnused)
  {
    // The albedo may be defined from a base texture or a flat color
  #ifdef HAS_BASECOLORMAP
    vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
  #else
    vec4 baseColor = pbrMaterial.baseColorFactor;
  #endif
  
  #ifdef ALPHA_CUTOFF
    if (baseColor.a < pbrMaterial.alphaCutoff) {
      discard;
    }
  #endif
  
    vec3 color = vec3(0, 0, 0);
  
    if(pbrMaterial.unlit){
      color.rgb = baseColor.rgb;
    }
    else{
      // Metallic and Roughness material properties are packed together
      // In glTF, these factors can be specified by fixed scalar values
      // or from a metallic-roughness map
      float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
      float metallic = pbrMaterial.metallicRoughnessValues.x;
  #ifdef HAS_METALROUGHNESSMAP
      // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
      // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
      vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
      perceptualRoughness = mrSample.g * perceptualRoughness;
      metallic = mrSample.b * metallic;
  #endif
      perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
      metallic = clamp(metallic, 0.0, 1.0);
      // Roughness is authored as perceptual roughness; as is convention,
      // convert to material roughness by squaring the perceptual roughness [2].
      float alphaRoughness = perceptualRoughness * perceptualRoughness;
  
      vec3 f0 = vec3(0.04);
      vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
      diffuseColor *= 1.0 - metallic;
      vec3 specularColor = mix(f0, baseColor.rgb, metallic);
  
      // Compute reflectance.
      float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);
  
      // For typical incident reflectance range (between 4% to 100%) set the grazing
      // reflectance to 100% for typical fresnel effect.
      // For very low reflectance range on highly diffuse objects (below 4%),
      // incrementally reduce grazing reflecance to 0%.
      float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
      vec3 specularEnvironmentR0 = specularColor.rgb;
      vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;
  
      vec3 n = getNormal();                          // normal at surface point
      vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera
  
      float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
      vec3 reflection = -normalize(reflect(v, n));
  
      PBRInfo pbrInfo = PBRInfo(
        0.0, // NdotL
        NdotV,
        0.0, // NdotH
        0.0, // LdotH
        0.0, // VdotH
        perceptualRoughness,
        metallic,
        specularEnvironmentR0,
        specularEnvironmentR90,
        alphaRoughness,
        diffuseColor,
        specularColor,
        n,
        v
      );
  
  
  #ifdef USE_LIGHTS
      // Apply ambient light
      PBRInfo_setAmbientLight(pbrInfo);
      color += calculateFinalColor(pbrInfo, lighting.ambientColor);
  
      // Apply directional light
      for(int i = 0; i < lighting.directionalLightCount; i++) {
        if (i < lighting.directionalLightCount) {
          PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
          color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
        }
      }
  
      // Apply point light
      for(int i = 0; i < lighting.pointLightCount; i++) {
        if (i < lighting.pointLightCount) {
          PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
          float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
          color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
        }
      }
  #endif
  
      // Calculate lighting contribution from image based lighting source (IBL)
  #ifdef USE_IBL
      if (pbrMaterial.IBLenabled) {
        color += getIBLContribution(pbrInfo, n, reflection);
      }
  #endif
  
   // Apply optional PBR terms for additional (optional) shading
  #ifdef HAS_OCCLUSIONMAP
      if (pbrMaterial.occlusionMapEnabled) {
        float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
        color = mix(color, color * ao, pbrMaterial.occlusionStrength);
      }
  #endif
  
  #ifdef HAS_EMISSIVEMAP
      if (pbrMaterial.emissiveMapEnabled) {
        vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
        color += emissive;
      }
  #endif
  
      // This section uses mix to override final color for reference app visualization
      // of various parameters in the lighting equation.
  #ifdef PBR_DEBUG
      // TODO: Figure out how to debug multiple lights
  
      // color = mix(color, F, pbr_scaleFGDSpec.x);
      // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
      // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
      // color = mix(color, specContrib, pbr_scaleFGDSpec.w);
  
      // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
      color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
      color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
      color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
  #endif
  
    }
  
    return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
  }
  `;var Zv=`uniform pbrProjectionUniforms {
    mat4 modelViewProjectionMatrix;
    mat4 modelMatrix;
    mat4 normalMatrix;
    vec3 camera;
  } pbrProjection;
  `,Jv={name:"pbrProjection",vs:Zv,fs:Zv,getUniforms:e=>e,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}};var Hi={props:{},uniforms:{},name:"pbrMaterial",dependencies:[Hn,Jv],vs:$v,fs:Kv,defines:{LIGHTING_FRAGMENT:1},getUniforms:e=>e,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}};var c2=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
  
  struct AmbientLight {
   vec3 color;
  };
  
  struct PointLight {
   vec3 color;
   vec3 position;
  
   // Constant-Linear-Exponential
   vec3 attenuation;
  };
  
  struct DirectionalLight {
    vec3 color;
    vec3 direction;
  };
  
  uniform AmbientLight lighting_uAmbientLight;
  uniform PointLight lighting_uPointLight[MAX_LIGHTS];
  uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
  uniform int lighting_uPointLightCount;
  uniform int lighting_uDirectionalLightCount;
  
  uniform bool lighting_uEnabled;
  
  float getPointLightAttenuation(PointLight pointLight, float distance) {
    return pointLight.attenuation.x
         + pointLight.attenuation.y * distance
         + pointLight.attenuation.z * distance * distance;
  }
  
  #endif
  `;var LG={lightSources:{}};function l2(e={}){let{color:t=[0,0,0],intensity:r=1}=e;return t.map(n=>n*r/255)}function NG({ambientLight:e,pointLights:t=[],directionalLights:r=[]}){let n={};return e?n["lighting_uAmbientLight.color"]=l2(e):n["lighting_uAmbientLight.color"]=[0,0,0],t.forEach((s,i)=>{n[`lighting_uPointLight[${i}].color`]=l2(s),n[`lighting_uPointLight[${i}].position`]=s.position,n[`lighting_uPointLight[${i}].attenuation`]=s.attenuation||[1,0,0]}),n.lighting_uPointLightCount=t.length,r.forEach((s,i)=>{n[`lighting_uDirectionalLight[${i}].color`]=l2(s),n[`lighting_uDirectionalLight[${i}].direction`]=s.direction}),n.lighting_uDirectionalLightCount=r.length,n}function Qv(e=LG){if("lightSources"in e){let{ambientLight:t,pointLights:r,directionalLights:n}=e.lightSources||{};return t||r&&r.length>0||n&&n.length>0?Object.assign({},NG({ambientLight:t,pointLights:r,directionalLights:n}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in e){let t={pointLights:[],directionalLights:[]};for(let r of e.lights||[])switch(r.type){case"ambient":t.ambientLight=r;break;case"directional":t.directionalLights?.push(r);break;case"point":t.pointLights?.push(r);break;default:}return Qv({lightSources:t})}return{}}var h2={name:"lights",vs:c2,fs:c2,getUniforms:Qv,defines:{MAX_LIGHTS:3}};var f2=`
  uniform float lighting_uAmbient;
  uniform float lighting_uDiffuse;
  uniform float lighting_uShininess;
  uniform vec3  lighting_uSpecularColor;
  
  vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
      vec3 halfway_direction = normalize(light_direction + view_direction);
      float lambertian = dot(light_direction, normal_worldspace);
      float specular = 0.0;
      if (lambertian > 0.0) {
        float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
        specular = pow(specular_angle, lighting_uShininess);
      }
      lambertian = max(lambertian, 0.0);
      return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
  }
  
  vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
    vec3 lightColor = surfaceColor;
  
    if (lighting_uEnabled) {
      vec3 view_direction = normalize(cameraPosition - position_worldspace);
      lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
  
      for (int i = 0; i < MAX_LIGHTS; i++) {
        if (i >= lighting_uPointLightCount) {
          break;
        }
        PointLight pointLight = lighting_uPointLight[i];
        vec3 light_position_worldspace = pointLight.position;
        vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
  
      for (int i = 0; i < MAX_LIGHTS; i++) {
        if (i >= lighting_uDirectionalLightCount) {
          break;
        }
        DirectionalLight directionalLight = lighting_uDirectionalLight[i];
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
    return lightColor;
  }
  
  vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
    vec3 lightColor = vec3(0, 0, 0);
    vec3 surfaceColor = vec3(0, 0, 0);
  
    if (lighting_uEnabled) {
      vec3 view_direction = normalize(cameraPosition - position_worldspace);
  
      for (int i = 0; i < MAX_LIGHTS; i++) {
        if (i >= lighting_uPointLightCount) {
          break;
        }
        PointLight pointLight = lighting_uPointLight[i];
        vec3 light_position_worldspace = pointLight.position;
        vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
  
      for (int i = 0; i < MAX_LIGHTS; i++) {
        if (i >= lighting_uDirectionalLightCount) {
          break;
        }
        DirectionalLight directionalLight = lighting_uDirectionalLight[i];
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
    return lightColor;
  }
  `;var BG={};function FG(e){let{ambient:t=.35,diffuse:r=.6,shininess:n=32,specularColor:s=[30,30,30]}=e;return{lighting_uAmbient:t,lighting_uDiffuse:r,lighting_uShininess:n,lighting_uSpecularColor:s.map(i=>i/255)}}function tw(e=BG){if(!("material"in e))return{};let{material:t}=e;return t?FG(t):{lighting_uEnabled:!1}}var Cp={name:"gouraud-lighting",dependencies:[h2],vs:f2,defines:{LIGHTING_VERTEX:1},getUniforms:tw},Pp={name:"phong-lighting",dependencies:[h2],fs:f2,defines:{LIGHTING_FRAGMENT:1},getUniforms:tw};var ew=`uniform layerUniforms {
    uniform float opacity;
  } layer;
  `,u2={name:"layer",vs:ew,fs:ew,getUniforms:e=>({opacity:Math.pow(e.opacity,.45454545454545453)}),uniformTypes:{opacity:"f32"}};var rw="#define SMOOTH_EDGE_RADIUS 0.5",DG=`
  ${rw}
  
  struct VertexGeometry {
    vec4 position;
    vec3 worldPosition;
    vec3 worldPositionAlt;
    vec3 normal;
    vec2 uv;
    vec3 pickingColor;
  } geometry = VertexGeometry(
    vec4(0.0, 0.0, 1.0, 0.0),
    vec3(0.0),
    vec3(0.0),
    vec3(0.0),
    vec2(0.0),
    vec3(0.0)
  );
  `,kG=`
  ${rw}
  
  struct FragmentGeometry {
    vec2 uv;
  } geometry;
  
  float smoothedge(float edge, float x) {
    return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
  }
  `,Rp={name:"geometry",vs:DG,fs:kG};var xt;(function(e){e[e.Start=1]="Start",e[e.Move=2]="Move",e[e.End=4]="End",e[e.Cancel=8]="Cancel"})(xt||(xt={}));var Ot;(function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Up=4]="Up",e[e.Down=8]="Down",e[e.Horizontal=3]="Horizontal",e[e.Vertical=12]="Vertical",e[e.All=15]="All"})(Ot||(Ot={}));var X;(function(e){e[e.Possible=1]="Possible",e[e.Began=2]="Began",e[e.Changed=4]="Changed",e[e.Ended=8]="Ended",e[e.Recognized=8]="Recognized",e[e.Cancelled=16]="Cancelled",e[e.Failed=32]="Failed"})(X||(X={}));var nw="compute",d2="auto",eh="manipulation",Wi="none",rh="pan-x",nh="pan-y";function p2(e){if(e.includes(Wi))return Wi;let t=e.includes(rh),r=e.includes(nh);return t&&r?Wi:t||r?t?rh:nh:e.includes(eh)?eh:d2}var sh=class{constructor(t,r){this.actions="",this.manager=t,this.set(r)}set(t){t===nw&&(t=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=t,this.actions=t)}update(){this.set(this.manager.options.touchAction)}compute(){let t=[];for(let r of this.manager.recognizers)r.options.enable&&(t=t.concat(r.getTouchAction()));return p2(t.join(" "))}};function Ma(e){return e.trim().split(/\s+/g)}function Ip(e,t,r){if(e)for(let n of Ma(t))e.addEventListener(n,r,!1)}function Op(e,t,r){if(e)for(let n of Ma(t))e.removeEventListener(n,r,!1)}function g2(e){return(e.ownerDocument||e).defaultView}function m2(e,t){let r=e;for(;r;){if(r===t)return!0;r=r.parentNode}return!1}function Lp(e){let t=e.length;if(t===1)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};let r=0,n=0,s=0;for(;s<t;)r+=e[s].clientX,n+=e[s].clientY,s++;return{x:Math.round(r/t),y:Math.round(n/t)}}function _2(e){let t=[],r=0;for(;r<e.pointers.length;)t[r]={clientX:Math.round(e.pointers[r].clientX),clientY:Math.round(e.pointers[r].clientY)},r++;return{timeStamp:Date.now(),pointers:t,center:Lp(t),deltaX:e.deltaX,deltaY:e.deltaY}}function Np(e,t){let r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)}function x2(e,t){let r=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.sqrt(r*r+n*n)}function sw(e,t){let r=t.x-e.x,n=t.y-e.y;return Math.atan2(n,r)*180/Math.PI}function y2(e,t){let r=t.clientX-e.clientX,n=t.clientY-e.clientY;return Math.atan2(n,r)*180/Math.PI}function Bp(e,t){return e===t?Ot.None:Math.abs(e)>=Math.abs(t)?e<0?Ot.Left:Ot.Right:t<0?Ot.Up:Ot.Down}function iw(e,t){let r=t.center,n=e.offsetDelta,s=e.prevDelta,i=e.prevInput;return(t.eventType===xt.Start||i?.eventType===xt.End)&&(s=e.prevDelta={x:i?.deltaX||0,y:i?.deltaY||0},n=e.offsetDelta={x:r.x,y:r.y}),{deltaX:s.x+(r.x-n.x),deltaY:s.y+(r.y-n.y)}}function Fp(e,t,r){return{x:t/e||0,y:r/e||0}}function ow(e,t){return x2(t[0],t[1])/x2(e[0],e[1])}function aw(e,t){return y2(t[1],t[0])-y2(e[1],e[0])}function cw(e,t){let r=e.lastInterval||t,n=t.timeStamp-r.timeStamp,s,i,o,a;if(t.eventType!==xt.Cancel&&(n>25||r.velocity===void 0)){let c=t.deltaX-r.deltaX,l=t.deltaY-r.deltaY,h=Fp(n,c,l);i=h.x,o=h.y,s=Math.abs(h.x)>Math.abs(h.y)?h.x:h.y,a=Bp(c,l),e.lastInterval=t}else s=r.velocity,i=r.velocityX,o=r.velocityY,a=r.direction;t.velocity=s,t.velocityX=i,t.velocityY=o,t.direction=a}function lw(e,t){let{session:r}=e,{pointers:n}=t,{length:s}=n;r.firstInput||(r.firstInput=_2(t)),s>1&&!r.firstMultiple?r.firstMultiple=_2(t):s===1&&(r.firstMultiple=!1);let{firstInput:i,firstMultiple:o}=r,a=o?o.center:i.center,c=t.center=Lp(n);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-i.timeStamp,t.angle=sw(a,c),t.distance=Np(a,c);let{deltaX:l,deltaY:h}=iw(r,t);t.deltaX=l,t.deltaY=h,t.offsetDirection=Bp(t.deltaX,t.deltaY);let f=Fp(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=f.x,t.overallVelocityY=f.y,t.overallVelocity=Math.abs(f.x)>Math.abs(f.y)?f.x:f.y,t.scale=o?ow(o.pointers,n):1,t.rotation=o?aw(o.pointers,n):0,t.maxPointers=r.prevInput?t.pointers.length>r.prevInput.maxPointers?t.pointers.length:r.prevInput.maxPointers:t.pointers.length;let u=e.element;return m2(t.srcEvent.target,u)&&(u=t.srcEvent.target),t.target=u,cw(r,t),t}function hw(e,t,r){let n=r.pointers.length,s=r.changedPointers.length,i=t&xt.Start&&n-s===0,o=t&(xt.End|xt.Cancel)&&n-s===0;r.isFirst=Boolean(i),r.isFinal=Boolean(o),i&&(e.session={}),r.eventType=t;let a=lw(e,r);e.emit("hammer.input",a),e.recognize(a),e.session.prevInput=a}var ih=class{constructor(t){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=r=>{this.manager.options.enable&&this.handler(r)},this.manager=t,this.element=t.element,this.target=t.options.inputTarget||t.element}callback(t,r){hw(this.manager,t,r)}init(){Ip(this.element,this.evEl,this.domHandler),Ip(this.target,this.evTarget,this.domHandler),Ip(g2(this.element),this.evWin,this.domHandler)}destroy(){Op(this.element,this.evEl,this.domHandler),Op(this.target,this.evTarget,this.domHandler),Op(g2(this.element),this.evWin,this.domHandler)}};var zG={pointerdown:xt.Start,pointermove:xt.Move,pointerup:xt.End,pointercancel:xt.Cancel,pointerout:xt.Cancel},VG="pointerdown",HG="pointermove pointerup pointercancel",oh=class extends ih{constructor(t){super(t),this.evEl=VG,this.evWin=HG,this.store=this.manager.session.pointerEvents=[],this.init()}handler(t){let{store:r}=this,n=!1,s=zG[t.type],i=t.pointerType,o=i==="touch",a=r.findIndex(c=>c.pointerId===t.pointerId);s&xt.Start&&(t.buttons||o)?a<0&&(r.push(t),a=r.length-1):s&(xt.End|xt.Cancel)&&(n=!0),!(a<0)&&(r[a]=t,this.callback(s,{pointers:r,changedPointers:[t],eventType:s,pointerType:i,srcEvent:t}),n&&r.splice(a,1))}};var WG=["","webkit","Moz","MS","ms","o"];function fw(e,t){let r=t[0].toUpperCase()+t.slice(1);for(let n of WG){let s=n?n+r:t;if(s in e)return s}}var GG=1,uw=2,dw={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}},ah=class{constructor(t,r){this.options={...dw,...r,cssProps:{...dw.cssProps,...r.cssProps},inputTarget:r.inputTarget||t},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new oh(this),this.touchAction=new sh(this,this.options.touchAction),this.toggleCssProps(!0)}set(t){return Object.assign(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this}stop(t){this.session.stopped=t?uw:GG}recognize(t){let{session:r}=this;if(r.stopped)return;this.session.prevented&&t.srcEvent.preventDefault();let n,{recognizers:s}=this,{curRecognizer:i}=r;(!i||i&&i.state&X.Recognized)&&(i=r.curRecognizer=null);let o=0;for(;o<s.length;)n=s[o],r.stopped!==uw&&(!i||n===i||n.canRecognizeWith(i))?n.recognize(t):n.reset(),!i&&n.state&(X.Began|X.Changed|X.Ended)&&(i=r.curRecognizer=n),o++}get(t){let{recognizers:r}=this;for(let n=0;n<r.length;n++)if(r[n].options.event===t)return r[n];return null}add(t){if(Array.isArray(t)){for(let n of t)this.add(n);return this}let r=this.get(t.options.event);return r&&this.remove(r),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t}remove(t){if(Array.isArray(t)){for(let n of t)this.remove(n);return this}let r=typeof t=="string"?this.get(t):t;if(r){let{recognizers:n}=this,s=n.indexOf(r);s!==-1&&(n.splice(s,1),this.touchAction.update())}return this}on(t,r){if(!t||!r)return;let{handlers:n}=this;for(let s of Ma(t))n[s]=n[s]||[],n[s].push(r)}off(t,r){if(!t)return;let{handlers:n}=this;for(let s of Ma(t))r?n[s]&&n[s].splice(n[s].indexOf(r),1):delete n[s]}emit(t,r){let n=this.handlers[t]&&this.handlers[t].slice();if(!n||!n.length)return;let s=r;s.type=t,s.preventDefault=function(){r.srcEvent.preventDefault()};let i=0;for(;i<n.length;)n[i](s),i++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(t){let{element:r}=this;if(r){for(let[n,s]of Object.entries(this.options.cssProps)){let i=fw(r.style,n);t?(this.oldCssProps[i]=r.style[i],r.style[i]=s):r.style[i]=this.oldCssProps[i]||""}t||(this.oldCssProps={})}}};var jG=1;function pw(){return jG++}function A2(e){return e&X.Cancelled?"cancel":e&X.Ended?"end":e&X.Changed?"move":e&X.Began?"start":""}var Wn=class{constructor(t){this.options=t,this.id=pw(),this.state=X.Possible,this.simultaneous={},this.requireFail=[]}set(t){return Object.assign(this.options,t),this.manager.touchAction.update(),this}recognizeWith(t){if(Array.isArray(t)){for(let s of t)this.recognizeWith(s);return this}let r;if(typeof t=="string"){if(r=this.manager.get(t),!r)throw new Error(`Cannot find recognizer ${t}`)}else r=t;let{simultaneous:n}=this;return n[r.id]||(n[r.id]=r,r.recognizeWith(this)),this}dropRecognizeWith(t){if(Array.isArray(t)){for(let n of t)this.dropRecognizeWith(n);return this}let r;return typeof t=="string"?r=this.manager.get(t):r=t,r&&delete this.simultaneous[r.id],this}requireFailure(t){if(Array.isArray(t)){for(let s of t)this.requireFailure(s);return this}let r;if(typeof t=="string"){if(r=this.manager.get(t),!r)throw new Error(`Cannot find recognizer ${t}`)}else r=t;let{requireFail:n}=this;return n.indexOf(r)===-1&&(n.push(r),r.requireFailure(this)),this}dropRequireFailure(t){if(Array.isArray(t)){for(let n of t)this.dropRequireFailure(n);return this}let r;if(typeof t=="string"?r=this.manager.get(t):r=t,r){let n=this.requireFail.indexOf(r);n>-1&&this.requireFail.splice(n,1)}return this}hasRequireFailures(){return Boolean(this.requireFail.find(t=>t.options.enable))}canRecognizeWith(t){return Boolean(this.simultaneous[t.id])}emit(t){if(!t)return;let{state:r}=this;r<X.Ended&&this.manager.emit(this.options.event+A2(r),t),this.manager.emit(this.options.event,t),t.additionalEvent&&this.manager.emit(t.additionalEvent,t),r>=X.Ended&&this.manager.emit(this.options.event+A2(r),t)}tryEmit(t){this.canEmit()?this.emit(t):this.state=X.Failed}canEmit(){let t=0;for(;t<this.requireFail.length;){if(!(this.requireFail[t].state&(X.Failed|X.Possible)))return!1;t++}return!0}recognize(t){let r={...t};if(!this.options.enable){this.reset(),this.state=X.Failed;return}this.state&(X.Recognized|X.Cancelled|X.Failed)&&(this.state=X.Possible),this.state=this.process(r),this.state&(X.Began|X.Changed|X.Ended|X.Cancelled)&&this.tryEmit(r)}getEventNames(){return[this.options.event]}reset(){}};var Gn=class extends Wn{attrTest(t){let r=this.options.pointers;return r===0||t.pointers.length===r}process(t){let{state:r}=this,{eventType:n}=t,s=r&(X.Began|X.Changed),i=this.attrTest(t);return s&&(n&xt.Cancel||!i)?r|X.Cancelled:s||i?n&xt.End?r|X.Ended:r&X.Began?r|X.Changed:X.Began:X.Failed}};var Gi=class extends Wn{constructor(t={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...t}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[eh]}process(t){let{options:r}=this,n=t.pointers.length===r.pointers,s=t.distance<r.threshold,i=t.deltaTime<r.time;if(this.reset(),t.eventType&xt.Start&&this.count===0)return this.failTimeout();if(s&&i&&n){if(t.eventType!==xt.End)return this.failTimeout();let o=this.pTime?t.timeStamp-this.pTime<r.interval:!0,a=!this.pCenter||Np(this.pCenter,t.center)<r.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,!a||!o?this.count=1:this.count+=1,this._input=t,this.count%r.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=X.Recognized,this.tryEmit(this._input)},r.interval),X.Began):X.Recognized}return X.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=X.Failed},this.options.interval),X.Failed}reset(){clearTimeout(this._timer)}emit(t){this.state===X.Recognized&&(t.tapCount=this.count,this.manager.emit(this.options.event,t))}};var qG=["","start","move","end","cancel","up","down","left","right"],zs=class extends Gn{constructor(t={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Ot.All,...t}),this.pX=null,this.pY=null}getTouchAction(){let{options:{direction:t}}=this,r=[];return t&Ot.Horizontal&&r.push(nh),t&Ot.Vertical&&r.push(rh),r}getEventNames(){return qG.map(t=>this.options.event+t)}directionTest(t){let{options:r}=this,n=!0,{distance:s}=t,{direction:i}=t,o=t.deltaX,a=t.deltaY;return i&r.direction||(r.direction&Ot.Horizontal?(i=o===0?Ot.None:o<0?Ot.Left:Ot.Right,n=o!==this.pX,s=Math.abs(t.deltaX)):(i=a===0?Ot.None:a<0?Ot.Up:Ot.Down,n=a!==this.pY,s=Math.abs(t.deltaY))),t.direction=i,n&&s>r.threshold&&Boolean(i&r.direction)}attrTest(t){return super.attrTest(t)&&(Boolean(this.state&X.Began)||!(this.state&X.Began)&&this.directionTest(t))}emit(t){this.pX=t.deltaX,this.pY=t.deltaY;let r=Ot[t.direction].toLowerCase();r&&(t.additionalEvent=this.options.event+r),super.emit(t)}};var XG=["","start","move","end","cancel","in","out"],Ea=class extends Gn{constructor(t={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...t})}getTouchAction(){return[Wi]}getEventNames(){return XG.map(t=>this.options.event+t)}attrTest(t){return super.attrTest(t)&&(Math.abs(t.scale-1)>this.options.threshold||Boolean(this.state&X.Began))}emit(t){if(t.scale!==1){let r=t.scale<1?"in":"out";t.additionalEvent=this.options.event+r}super.emit(t)}};var dn=class{constructor(t,r,n){this.element=t,this.callback=r,this.options=n}};var gw=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",jTt=typeof window<"u"?window:global;var ZG=gw.indexOf("firefox")!==-1,mw=4.000244140625,JG=40,QG=.25,Dp=class extends dn{constructor(t,r,n){super(t,r,{enable:!0,...n}),this.handleEvent=s=>{if(!this.options.enable)return;let i=s.deltaY;globalThis.WheelEvent&&(ZG&&s.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(i/=globalThis.devicePixelRatio),s.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(i*=JG)),i!==0&&i%mw===0&&(i=Math.floor(i/mw)),s.shiftKey&&i&&(i=i*QG),this.callback({type:"wheel",center:{x:s.clientX,y:s.clientY},delta:-i,srcEvent:s,pointerType:"mouse",target:s.target})},t.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(t,r){t==="wheel"&&(this.options.enable=r)}};var _w=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],kp=class extends dn{constructor(t,r,n){super(t,r,{enable:!0,...n}),this.handleEvent=i=>{this.handleOverEvent(i),this.handleOutEvent(i),this.handleEnterEvent(i),this.handleLeaveEvent(i),this.handleMoveEvent(i)},this.pressed=!1;let{enable:s}=this.options;this.enableMoveEvent=s,this.enableLeaveEvent=s,this.enableEnterEvent=s,this.enableOutEvent=s,this.enableOverEvent=s,_w.forEach(i=>t.addEventListener(i,this.handleEvent))}destroy(){_w.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){switch(t){case"pointermove":this.enableMoveEvent=r;break;case"pointerover":this.enableOverEvent=r;break;case"pointerout":this.enableOutEvent=r;break;case"pointerenter":this.enableEnterEvent=r;break;case"pointerleave":this.enableLeaveEvent=r;break;default:}}handleOverEvent(t){this.enableOverEvent&&t.type==="mouseover"&&this._emit("pointerover",t)}handleOutEvent(t){this.enableOutEvent&&t.type==="mouseout"&&this._emit("pointerout",t)}handleEnterEvent(t){this.enableEnterEvent&&t.type==="mouseenter"&&this._emit("pointerenter",t)}handleLeaveEvent(t){this.enableLeaveEvent&&t.type==="mouseleave"&&this._emit("pointerleave",t)}handleMoveEvent(t){if(this.enableMoveEvent)switch(t.type){case"mousedown":t.button>=0&&(this.pressed=!0);break;case"mousemove":t.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",t);break;case"mouseup":this.pressed=!1;break;default:}}_emit(t,r){this.callback({type:t,center:{x:r.clientX,y:r.clientY},srcEvent:r,pointerType:"mouse",target:r.target})}};var xw=["keydown","keyup"],Up=class extends dn{constructor(t,r,n){super(t,r,{enable:!0,tabIndex:0,...n}),this.handleEvent=s=>{let i=s.target||s.srcElement;i.tagName==="INPUT"&&i.type==="text"||i.tagName==="TEXTAREA"||(this.enableDownEvent&&s.type==="keydown"&&this.callback({type:"keydown",srcEvent:s,key:s.key,target:s.target}),this.enableUpEvent&&s.type==="keyup"&&this.callback({type:"keyup",srcEvent:s,key:s.key,target:s.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,t.tabIndex=this.options.tabIndex,t.style.outline="none",xw.forEach(s=>t.addEventListener(s,this.handleEvent))}destroy(){xw.forEach(t=>this.element.removeEventListener(t,this.handleEvent))}enableEventType(t,r){t==="keydown"&&(this.enableDownEvent=r),t==="keyup"&&(this.enableUpEvent=r)}};var zp=class extends dn{constructor(t,r,n){super(t,r,n),this.handleEvent=s=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:s.clientX,y:s.clientY},srcEvent:s,pointerType:"mouse",target:s.target})},t.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(t,r){t==="contextmenu"&&(this.options.enable=r)}};var t7={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4},e7=0,r7=1,n7=2,s7=1,i7=2,o7=4;function yw(e){let t=t7[e.srcEvent.type];if(!t)return null;let{buttons:r,button:n}=e.srcEvent,s=!1,i=!1,o=!1;return t===2?(s=Boolean(r&s7),i=Boolean(r&o7),o=Boolean(r&i7)):(s=n===e7,i=n===r7,o=n===n7),{leftButton:s,middleButton:i,rightButton:o}}function Aw(e,t){let r=e.center;if(!r)return null;let n=t.getBoundingClientRect(),s=n.width/t.offsetWidth||1,i=n.height/t.offsetHeight||1,o={x:(r.x-n.left-t.clientLeft)/s,y:(r.y-n.top-t.clientTop)/i};return{center:r,offsetCenter:o}}var a7={srcElement:"root",priority:0},Vp=class{constructor(t,r){this.handleEvent=n=>{if(this.isEmpty())return;let s=this._normalizeEvent(n),i=n.srcEvent.target;for(;i&&i!==s.rootElement;){if(this._emit(s,i),s.handled)return;i=i.parentNode}this._emit(s,"root")},this.eventManager=t,this.recognizerName=r,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(t,r,n,s=!1,i=!1){let{handlers:o,handlersByElement:a}=this,c={...a7,...n},l=a.get(c.srcElement);l||(l=[],a.set(c.srcElement,l));let h={type:t,handler:r,srcElement:c.srcElement,priority:c.priority};s&&(h.once=!0),i&&(h.passive=!0),o.push(h),this._active=this._active||!h.passive;let f=l.length-1;for(;f>=0&&!(l[f].priority>=h.priority);)f--;l.splice(f+1,0,h)}remove(t,r){let{handlers:n,handlersByElement:s}=this;for(let i=n.length-1;i>=0;i--){let o=n[i];if(o.type===t&&o.handler===r){n.splice(i,1);let a=s.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&s.delete(o.srcElement)}}this._active=n.some(i=>!i.passive)}_emit(t,r){let n=this.handlersByElement.get(r);if(n){let s=!1,i=()=>{t.handled=!0},o=()=>{t.handled=!0,s=!0},a=[];for(let c=0;c<n.length;c++){let{type:l,handler:h,once:f}=n[c];if(h({...t,type:l,stopPropagation:i,stopImmediatePropagation:o}),f&&a.push(n[c]),s)break}for(let c=0;c<a.length;c++){let{type:l,handler:h}=a[c];this.remove(l,h)}}}_normalizeEvent(t){let r=this.eventManager.getElement();return{...t,...yw(t),...Aw(t,r),preventDefault:()=>{t.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:r}}};function c7(e){if("recognizer"in e)return e;let t,r=Array.isArray(e)?[...e]:[e];if(typeof r[0]=="function"){let n=r.shift(),s=r.shift()||{};t=new n(s)}else t=r.shift();return{recognizer:t,recognizeWith:typeof r[0]=="string"?[r[0]]:r[0],requireFailure:typeof r[1]=="string"?[r[1]]:r[1]}}var ch=class{constructor(t=null,r={}){if(this._onBasicInput=n=>{this.manager.emit(n.srcEvent.type,n)},this._onOtherEvent=n=>{this.manager.emit(n.type,n)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...r},this.events=new Map,this.element=t,!!t){this.manager=new ah(t,this.options);for(let n of this.options.recognizers){let{recognizer:s,recognizeWith:i,requireFailure:o}=c7(n);this.manager.add(s),i&&s.recognizeWith(i),o&&s.requireFailure(o)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new Dp(t,this._onOtherEvent,{enable:!1}),this.moveInput=new kp(t,this._onOtherEvent,{enable:!1}),this.keyInput=new Up(t,this._onOtherEvent,{enable:!1,tabIndex:r.tabIndex}),this.contextmenuInput=new zp(t,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(t,r,n){this._addEventHandler(t,r,n,!1)}once(t,r,n){this._addEventHandler(t,r,n,!0)}watch(t,r,n){this._addEventHandler(t,r,n,!1,!0)}off(t,r){this._removeEventHandler(t,r)}_toggleRecognizer(t,r){let{manager:n}=this;if(!n)return;let s=n.get(t);s&&(s.set({enable:r}),n.touchAction.update()),this.wheelInput?.enableEventType(t,r),this.moveInput?.enableEventType(t,r),this.keyInput?.enableEventType(t,r),this.contextmenuInput?.enableEventType(t,r)}_addEventHandler(t,r,n,s,i){if(typeof t!="string"){n=r;for(let[l,h]of Object.entries(t))this._addEventHandler(l,h,n,s,i);return}let{manager:o,events:a}=this;if(!o)return;let c=a.get(t);if(!c){let l=this._getRecognizerName(t)||t;c=new Vp(this,l),a.set(t,c),o&&o.on(t,c.handleEvent)}c.add(t,r,n,s,i),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}_removeEventHandler(t,r){if(typeof t!="string"){for(let[i,o]of Object.entries(t))this._removeEventHandler(i,o);return}let{events:n}=this,s=n.get(t);if(s&&(s.remove(t,r),s.isEmpty())){let{recognizerName:i}=s,o=!1;for(let a of n.values())if(a.recognizerName===i&&!a.isEmpty()){o=!0;break}o||this._toggleRecognizer(i,!1)}}_getRecognizerName(t){return this.manager.recognizers.find(r=>r.getEventNames().includes(t))?.options.event}};var W={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(W,"IDENTITY",{get:()=>(k.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});var Pe={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Lt={common:0,meters:1,pixels:2},lh={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},T2={multipan:[zs,{threshold:10,direction:Ot.Vertical,pointers:2}],pinch:[Ea,{},null,["multipan"]],pan:[zs,{threshold:1},["pinch"],["multipan"]],dblclick:[Gi,{event:"dblclick",taps:2}],click:[Gi,{event:"click"},null,["dblclick"]]},Tw={DRAW:"draw",MASK:"mask",TERRAIN:"terrain"};var l7=Object.keys(W).map(e=>`const int COORDINATE_SYSTEM_${e} = ${W[e]};`).join(""),h7=Object.keys(Pe).map(e=>`const int PROJECTION_MODE_${e} = ${Pe[e]};`).join(""),f7=Object.keys(Lt).map(e=>`const int UNIT_${e.toUpperCase()} = ${Lt[e]};`).join(""),Mw=`${l7}
  ${h7}
  ${f7}
  uniform projectUniforms {
  bool wrapLongitude;
  int coordinateSystem;
  vec3 commonUnitsPerMeter;
  int projectionMode;
  float scale;
  vec3 commonUnitsPerWorldUnit;
  vec3 commonUnitsPerWorldUnit2;
  vec4 center;
  mat4 modelMatrix;
  mat4 viewProjectionMatrix;
  vec2 viewportSize;
  float devicePixelRatio;
  float focalDistance;
  vec3 cameraPosition;
  vec3 coordinateOrigin;
  vec3 commonOrigin;
  bool pseudoMeters;
  } project;
  const float TILE_SIZE = 512.0;
  const float PI = 3.1415926536;
  const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
  const vec3 ZERO_64_LOW = vec3(0.0);
  const float EARTH_RADIUS = 6370972.0;
  const float GLOBE_RADIUS = 256.0;
  float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
  }
  float project_size() {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
  project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
  project.pseudoMeters == false) {
  if (geometry.position.w == 0.0) {
  return project_size_at_latitude(geometry.worldPosition.y);
  }
  float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
  float y2 = y * y;
  float y4 = y2 * y2;
  float y6 = y4 * y2;
  return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
  }
  float project_size_at_latitude(float meters, float lat) {
  return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
  }
  float project_size(float meters) {
  return meters * project.commonUnitsPerMeter.z * project_size();
  }
  vec2 project_size(vec2 meters) {
  return meters * project.commonUnitsPerMeter.xy * project_size();
  }
  vec3 project_size(vec3 meters) {
  return meters * project.commonUnitsPerMeter * project_size();
  }
  vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
  }
  mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
  }
  bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
  transform = project_get_orientation_matrix(commonPosition);
  return true;
  }
  return false;
  }
  vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
  n = rotation * n;
  }
  return n;
  }
  vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
  }
  vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project.wrapLongitude) {
  x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
  radians(x) + PI,
  PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
  }
  vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3(
  sin(lambda) * cosPhi,
  -cos(lambda) * cosPhi,
  sin(phi)
  ) * D;
  }
  vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project.modelMatrix * position;
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
  if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
  return vec4(
  project_mercator_(position_world.xy),
  project_size_at_latitude(position_world.z, position_world.y),
  position_world.w
  );
  }
  if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
  position_world.xyz += project.coordinateOrigin;
  }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
  if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
  return vec4(
  project_globe_(position_world.xyz),
  position_world.w
  );
  }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
  if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
  if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
  return vec4(
  project_mercator_(position_world.xy) - project.commonOrigin.xy,
  project_size(position_world.z),
  position_world.w
  );
  }
  }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
  (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
  (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
  project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
  position_world.xyz -= project.coordinateOrigin;
  }
  return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
  }
  vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
  }
  vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
  }
  vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
  }
  vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
  }
  vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
  }
  vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
  }
  vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
  }
  float project_size_to_pixel(float meters) {
  return project_size(meters) * project.scale;
  }
  float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project.scale;
  return size;
  }
  float project_pixel_size(float pixels) {
  return pixels / project.scale;
  }
  vec2 project_pixel_size(vec2 pixels) {
  return pixels / project.scale;
  }
  `;function u7(e,t){if(e===t)return!0;if(Array.isArray(e)){let r=e.length;if(!t||t.length!==r)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}return!1}function Je(e){let t={},r;return n=>{for(let s in n)if(!u7(n[s],t[s])){r=e(n),t=n;break}return r}}var Ew=[0,0,0,0],d7=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],bw=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p7=[0,0,0],Sw=[0,0,0],g7=Je(_7);function M2(e,t,r=Sw){r.length<3&&(r=[r[0],r[1],0]);let n=r,s,i=!0;switch(t===W.LNGLAT_OFFSETS||t===W.METER_OFFSETS?s=r:s=e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case Pe.WEB_MERCATOR:(t===W.LNGLAT||t===W.CARTESIAN)&&(s=[0,0,0],i=!1);break;case Pe.WEB_MERCATOR_AUTO_OFFSET:t===W.LNGLAT?n=s:t===W.CARTESIAN&&(n=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],s=e.unprojectPosition(n),n[0]-=r[0],n[1]-=r[1],n[2]-=r[2]);break;case Pe.IDENTITY:n=e.position.map(Math.fround),n[2]=n[2]||0;break;case Pe.GLOBE:i=!1,s=null;break;default:i=!1}return{geospatialOrigin:s,shaderCoordinateOrigin:n,offsetMode:i}}function m7(e,t,r){let{viewMatrixUncentered:n,projectionMatrix:s}=e,{viewMatrix:i,viewProjectionMatrix:o}=e,a=Ew,c=Ew,l=e.cameraPosition,{geospatialOrigin:h,shaderCoordinateOrigin:f,offsetMode:u}=M2(e,t,r);return u&&(c=e.projectPosition(h||f),l=[l[0]-c[0],l[1]-c[1],l[2]-c[2]],c[3]=1,a=He.transformMat4([],c,o),i=n||i,o=jt.multiply([],s,i),o=jt.multiply([],o,d7)),{viewMatrix:i,viewProjectionMatrix:o,projectionCenter:a,originCommon:c,cameraPosCommon:l,shaderCoordinateOrigin:f,geospatialOrigin:h}}function Hp({viewport:e,devicePixelRatio:t=1,modelMatrix:r=null,coordinateSystem:n=W.DEFAULT,coordinateOrigin:s=Sw,autoWrapLongitude:i=!1}){n===W.DEFAULT&&(n=e.isGeospatial?W.LNGLAT:W.CARTESIAN);let o=g7({viewport:e,devicePixelRatio:t,coordinateSystem:n,coordinateOrigin:s});return o.wrapLongitude=i,o.modelMatrix=r||bw,o}function _7({viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:n}){let{projectionCenter:s,viewProjectionMatrix:i,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:c,geospatialOrigin:l}=m7(e,r,n),h=e.getDistanceScales(),f=[e.width*t,e.height*t],u=He.transformMat4([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,d={coordinateSystem:r,projectionMode:e.projectionMode,coordinateOrigin:c,commonOrigin:o.slice(0,3),center:s,pseudoMeters:Boolean(e._pseudoMeters),viewportSize:f,devicePixelRatio:t,focalDistance:u,commonUnitsPerMeter:h.unitsPerMeter,commonUnitsPerWorldUnit:h.unitsPerMeter,commonUnitsPerWorldUnit2:p7,scale:e.scale,wrapLongitude:!1,viewProjectionMatrix:i,modelMatrix:bw,cameraPosition:a};if(l){let p=e.getDistanceScales(l);switch(r){case W.METER_OFFSETS:d.commonUnitsPerWorldUnit=p.unitsPerMeter,d.commonUnitsPerWorldUnit2=p.unitsPerMeter2;break;case W.LNGLAT:case W.LNGLAT_OFFSETS:e._pseudoMeters||(d.commonUnitsPerMeter=p.unitsPerMeter),d.commonUnitsPerWorldUnit=p.unitsPerDegree,d.commonUnitsPerWorldUnit2=p.unitsPerDegree2;break;case W.CARTESIAN:d.commonUnitsPerWorldUnit=[1,1,p.unitsPerMeter[2]],d.commonUnitsPerWorldUnit2=[0,0,p.unitsPerMeter2[2]];break;default:break}}return d}var x7={};function y7(e=x7){return"viewport"in e?Hp(e):{}}var qt={name:"project",dependencies:[i2,Rp],vs:Mw,getUniforms:y7,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}};var A7=`
  vec4 project_position_to_clipspace(
    vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
  ) {
    vec3 projectedPosition = project_position(position, position64Low);
    mat3 rotation;
    if (project_needs_rotation(projectedPosition, rotation)) {
      // offset is specified as ENU
      // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
      offset = rotation * offset;
    }
    commonPosition = vec4(projectedPosition + offset, 1.0);
    return project_common_position_to_clipspace(commonPosition);
  }
  
  vec4 project_position_to_clipspace(
    vec3 position, vec3 position64Low, vec3 offset
  ) {
    vec4 commonPosition;
    return project_position_to_clipspace(position, position64Low, offset, commonPosition);
  }
  `,st={name:"project32",dependencies:[qt],vs:A7};function E2(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Vs(e,t){let r=He.transformMat4([],t,e);return He.scale(r,r,1/r[3]),r}function b2(e,t){let r=e%t;return r<0?t+r:r}function vw(e,t,r){return r*t+(1-r)*e}function hh(e,t,r){return e<t?t:e>r?r:e}function T7(e){return Math.log(e)*Math.LOG2E}var ba=Math.log2||T7;function Fr(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}var Dr=Math.PI,ww=Dr/4,Ar=Dr/180,S2=180/Dr,Sa=512,Wp=4003e4,Tr=85.051129,Cw=1.5;function fh(e){return Math.pow(2,e)}function Gp(e){return ba(e)}function Kt(e){let[t,r]=e;Fr(Number.isFinite(t)),Fr(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");let n=t*Ar,s=r*Ar,i=Sa*(n+Dr)/(2*Dr),o=Sa*(Dr+Math.log(Math.tan(ww+s*.5)))/(2*Dr);return[i,o]}function Te(e){let[t,r]=e,n=t/Sa*(2*Dr)-Dr,s=2*(Math.atan(Math.exp(r/Sa*(2*Dr)-Dr))-ww);return[n*S2,s*S2]}function uh(e){let{latitude:t}=e;Fr(Number.isFinite(t));let r=Math.cos(t*Ar);return Gp(Wp*r)-9}function ji(e){let t=Math.cos(e*Ar);return Sa/Wp/t}function va(e){let{latitude:t,longitude:r,highPrecision:n=!1}=e;Fr(Number.isFinite(t)&&Number.isFinite(r));let s=Sa,i=Math.cos(t*Ar),o=s/360,a=o/i,c=s/Wp/i,l={unitsPerMeter:[c,c,c],metersPerUnit:[1/c,1/c,1/c],unitsPerDegree:[o,a,c],degreesPerUnit:[1/o,1/a,1/c]};if(n){let h=Ar*Math.tan(t*Ar)/i,f=o*h/2,u=s/Wp*h,d=u/a*c;l.unitsPerDegree2=[0,f,u],l.unitsPerMeter2=[d,0,d]}return l}function dh(e,t){let[r,n,s]=e,[i,o,a]=t,{unitsPerMeter:c,unitsPerMeter2:l}=va({longitude:r,latitude:n,highPrecision:!0}),h=Kt(e);h[0]+=i*(c[0]+l[0]*o),h[1]+=o*(c[1]+l[1]*o);let f=Te(h),u=(s||0)+(a||0);return Number.isFinite(s)||Number.isFinite(a)?[f[0],f[1],u]:f}function jp(e){let{height:t,pitch:r,bearing:n,altitude:s,scale:i,center:o}=e,a=E2();jt.translate(a,a,[0,0,-s]),jt.rotateX(a,a,-r*Ar),jt.rotateZ(a,a,n*Ar);let c=i/t;return jt.scale(a,a,[c,c,c]),o&&jt.translate(a,a,pe.negate([],o)),a}function v2(e){let{width:t,height:r,altitude:n,pitch:s=0,offset:i,center:o,scale:a,nearZMultiplier:c=1,farZMultiplier:l=1}=e,{fovy:h=jn(Cw)}=e;n!==void 0&&(h=jn(n));let f=h*Ar,u=s*Ar,d=qn(h),p=d;o&&(p+=o[2]*a/Math.cos(u)/r);let g=f*(.5+(i?i[1]:0)/r),m=Math.sin(g)*p/Math.sin(hh(Math.PI/2-u-g,.01,Math.PI-.01)),_=Math.sin(u)*m+p,y=p*10,x=Math.min(_*l,y);return{fov:f,aspect:t/r,focalDistance:d,near:c,far:x}}function jn(e){return 2*Math.atan(.5/e)*S2}function qn(e){return .5/Math.tan(.5*e*Ar)}function wa(e,t){let[r,n,s=0]=e;return Fr(Number.isFinite(r)&&Number.isFinite(n)&&Number.isFinite(s)),Vs(t,[r,n,s,1])}function Mr(e,t,r=0){let[n,s,i]=e;if(Fr(Number.isFinite(n)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(i))return Vs(t,[n,s,i,1]);let o=Vs(t,[n,s,0,1]),a=Vs(t,[n,s,1,1]),c=o[2],l=a[2],h=c===l?0:((r||0)-c)/(l-c);return ie.lerp([],o,a,h)}function qp(e){let{width:t,height:r,bounds:n,minExtent:s=0,maxZoom:i=24,offset:o=[0,0]}=e,[[a,c],[l,h]]=n,f=M7(e.padding),u=Kt([a,hh(h,-Tr,Tr)]),d=Kt([l,hh(c,-Tr,Tr)]),p=[Math.max(Math.abs(d[0]-u[0]),s),Math.max(Math.abs(d[1]-u[1]),s)],g=[t-f.left-f.right-Math.abs(o[0])*2,r-f.top-f.bottom-Math.abs(o[1])*2];Fr(g[0]>0&&g[1]>0);let m=g[0]/p[0],_=g[1]/p[1],y=(f.right-f.left)/2/m,x=(f.top-f.bottom)/2/_,A=[(d[0]+u[0])/2+y,(d[1]+u[1])/2+x],M=Te(A),E=Math.min(i,ba(Math.abs(Math.min(m,_))));return Fr(Number.isFinite(E)),{longitude:M[0],latitude:M[1],zoom:E}}function M7(e=0){return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(Fr(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}var Pw=Math.PI/180;function Xp(e,t=0){let{width:r,height:n,unproject:s}=e,i={targetZ:t},o=s([0,n],i),a=s([r,n],i),c,l,h=e.fovy?.5*e.fovy*Pw:Math.atan(.5/e.altitude),f=(90-e.pitch)*Pw;return h>f-.01?(c=Rw(e,0,t),l=Rw(e,r,t)):(c=s([0,0],i),l=s([r,0],i)),[o,a,l,c]}function Rw(e,t,r){let{pixelUnprojectionMatrix:n}=e,s=Vs(n,[t,0,1,1]),i=Vs(n,[t,e.height,1,1]),a=(r*e.distanceScales.unitsPerMeter[2]-s[2])/(i[2]-s[2]),c=ie.lerp([],s,i,a),l=Te(c);return l.push(r),l}var Iw=512;function w2(e){let{width:t,height:r,pitch:n=0}=e,{longitude:s,latitude:i,zoom:o,bearing:a=0}=e;(s<-180||s>180)&&(s=b2(s+180,360)-180),(a<-180||a>180)&&(a=b2(a+180,360)-180);let c=ba(r/Iw);if(o<=c)o=c,i=0;else{let l=r/2/Math.pow(2,o),h=Te([0,l])[1];if(i<h)i=h;else{let f=Te([0,Iw-l])[1];i>f&&(i=f)}}return{width:t,height:r,longitude:s,latitude:i,zoom:o,pitch:n,bearing:a}}var Ow=.01,b7=["longitude","latitude","zoom"],Lw={curve:1.414,speed:1.2};function C2(e,t,r,n){let{startZoom:s,startCenterXY:i,uDelta:o,w0:a,u1:c,S:l,rho:h,rho2:f,r0:u}=Nw(e,t,n);if(c<Ow){let A={};for(let M of b7){let E=e[M],w=t[M];A[M]=vw(E,w,r)}return A}let d=r*l,p=Math.cosh(u)/Math.cosh(u+h*d),g=a*((Math.cosh(u)*Math.tanh(u+h*d)-Math.sinh(u))/f)/c,m=1/p,_=s+Gp(m),y=ie.scale([],o,g);ie.add(y,y,i);let x=Te(y);return{longitude:x[0],latitude:x[1],zoom:_}}function P2(e,t,r){let n={...Lw,...r},{screenSpeed:s,speed:i,maxDuration:o}=n,{S:a,rho:c}=Nw(e,t,n),l=1e3*a,h;return Number.isFinite(s)?h=l/(s/c):h=l/i,Number.isFinite(o)&&h>o?0:h}function Nw(e,t,r){r=Object.assign({},Lw,r);let n=r.curve,s=e.zoom,i=[e.longitude,e.latitude],o=fh(s),a=t.zoom,c=[t.longitude,t.latitude],l=fh(a-s),h=Kt(i),f=Kt(c),u=ie.sub([],f,h),d=Math.max(e.width,e.height),p=d/l,g=ie.length(u)*o,m=Math.max(g,Ow),_=n*n,y=(p*p-d*d+_*_*m*m)/(2*d*_*m),x=(p*p-d*d-_*_*m*m)/(2*p*_*m),A=Math.log(Math.sqrt(y*y+1)-y),M=Math.log(Math.sqrt(x*x+1)-x),E=(M-A)/n;return{startZoom:s,startCenterXY:h,uDelta:u,w0:d,u1:g,S:E,rho:n,rho2:_,r0:A,r1:M}}var Bw=`
  uniform shadowUniforms {
    bool drawShadowMap;
    bool useShadowMap;
    vec4 color;
    highp int lightId;
    float lightCount;
    mat4 viewProjectionMatrix0;
    mat4 viewProjectionMatrix1;
    vec4 projectCenter0;
    vec4 projectCenter1;
  } shadow;
  `,v7=`
  const int max_lights = 2;
  
  out vec3 shadow_vPosition[max_lights];
  
  vec4 shadow_setVertexPosition(vec4 position_commonspace) {
    mat4 viewProjectionMatrices[max_lights];
    viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
    viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
    vec4 projectCenters[max_lights];
    projectCenters[0] = shadow.projectCenter0;
    projectCenters[1] = shadow.projectCenter1;
  
    if (shadow.drawShadowMap) {
      return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
    }
    if (shadow.useShadowMap) {
      for (int i = 0; i < max_lights; i++) {
        if(i < int(shadow.lightCount)) {
          vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
          shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
        }
      }
    }
    return gl_Position;
  }
  `,w7=`
  ${Bw}
  ${v7}
  `,C7=`
  const int max_lights = 2;
  uniform sampler2D shadow_uShadowMap0;
  uniform sampler2D shadow_uShadowMap1;
  
  in vec3 shadow_vPosition[max_lights];
  
  const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
  const vec4 bitUnpackShift = 1.0 / bitPackShift;
  const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);
  
  float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
    vec4 rgbaDepth = texture(shadowMap, position.xy);
  
    float z = dot(rgbaDepth, bitUnpackShift);
    return smoothstep(0.001, 0.01, position.z - z);
  }
  
  vec4 shadow_filterShadowColor(vec4 color) {
    if (shadow.drawShadowMap) {
      vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
      rgbaDepth -= rgbaDepth.gbaa * bitMask;
      return rgbaDepth;
    }
    if (shadow.useShadowMap) {
      float shadowAlpha = 0.0;
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
      if(shadow.lightCount > 1.0) {
        shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
      }
      shadowAlpha *= shadow.color.a / shadow.lightCount;
      float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);
  
      return vec4(
        mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
        blendedAlpha
      );
    }
    return color;
  }
  `,P7=`
  ${Bw}
  ${C7}
  `,R7=Je(B7),I7=Je(F7),O7=[0,0,0,1],L7=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function N7(e,t){let[r,n,s]=e,i=Mr([r,n,s],t);return Number.isFinite(s)?i:[i[0],i[1],0]}function B7({viewport:e,center:t}){return new $(e.viewProjectionMatrix).invert().transform(t)}function F7({viewport:e,shadowMatrices:t}){let r=[],n=e.pixelUnprojectionMatrix,s=e.isGeospatial?void 0:1,i=[[0,0,s],[e.width,0,s],[0,e.height,s],[e.width,e.height,s],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(o=>N7(o,n));for(let o of t){let a=o.clone().translate(new D(e.center).negate()),c=i.map(h=>a.transform(h)),l=new $().ortho({left:Math.min(...c.map(h=>h[0])),right:Math.max(...c.map(h=>h[0])),bottom:Math.min(...c.map(h=>h[1])),top:Math.max(...c.map(h=>h[1])),near:Math.min(...c.map(h=>-h[2])),far:Math.max(...c.map(h=>-h[2]))});r.push(l.multiplyRight(o))}return r}function D7(e){let{shadowEnabled:t=!0,project:r}=e;if(!t||!r||!e.shadowMatrices||!e.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};let n=qt.getUniforms(r),s=R7({viewport:r.viewport,center:n.center}),i=[],o=I7({shadowMatrices:e.shadowMatrices,viewport:r.viewport}).slice();for(let c=0;c<e.shadowMatrices.length;c++){let l=o[c],h=l.clone().translate(new D(r.viewport.center).negate());n.coordinateSystem===W.LNGLAT&&n.projectionMode===Pe.WEB_MERCATOR?(o[c]=h,i[c]=s):(o[c]=l.clone().multiplyRight(L7),i[c]=h.transform(s))}let a={drawShadowMap:Boolean(e.drawToShadowMap),useShadowMap:e.shadowMaps?e.shadowMaps.length>0:!1,color:e.shadowColor||O7,lightId:e.shadowLightId||0,lightCount:e.shadowMatrices.length,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};for(let c=0;c<o.length;c++)a[`viewProjectionMatrix${c}`]=o[c],a[`projectCenter${c}`]=i[c];for(let c=0;c<2;c++)a[`shadow_uShadowMap${c}`]=e.shadowMaps&&e.shadowMaps[c]||e.dummyShadowMap;return a}var Ca={name:"shadow",dependencies:[qt],vs:w7,fs:P7,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
      position = shadow_setVertexPosition(geometry.position);
      `,"fs:DECKGL_FILTER_COLOR":`
      color = shadow_filterShadowColor(color);
      `},getUniforms:D7,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}};var Tt={...Sp,defaultUniforms:{...Sp.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
      // for picking depth values
      picking_setPickingAttribute(position.z / position.w);
    `,"vs:DECKGL_FILTER_COLOR":`
    picking_setPickingColor(geometry.pickingColor);
    `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
    // use highlight color if this fragment belongs to the selected object.
    color = picking_filterHighlightColor(color);
  
    // use picking color if rendering to picking FBO.
    color = picking_filterPickingColor(color);
      `}}};var k7=[Rp],U7=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function Yp(){let e=Ss.getDefaultShaderAssembler();for(let t of k7)e.addDefaultModule(t);for(let t of U7)e.addShaderHook(t);return e}var z7=[255,255,255],V7=1,H7=0,Pa=class{constructor(t={}){this.type="ambient";let{color:r=z7}=t,{intensity:n=V7}=t;this.id=t.id||`ambient-${H7++}`,this.color=r,this.intensity=n}};var W7=[255,255,255],G7=1,j7=[0,0,-1],q7=0,Xn=class{constructor(t={}){this.type="directional";let{color:r=W7}=t,{intensity:n=G7}=t,{direction:s=j7}=t,{_shadow:i=!1}=t;this.id=t.id||`directional-${q7++}`,this.color=r,this.intensity=n,this.type="directional",this.direction=new D(s).normalize().toArray(),this.shadow=i}getProjectedLight(t){return this}};var qi=class{constructor(t,r={id:"pass"}){let{id:n}=r;this.id=n,this.device=t,this.props={...r}}setProps(t){Object.assign(this.props,t)}render(t){}cleanup(){}};var Me=class extends qi{constructor(){super(...arguments),this._lastRenderIndex=-1}render(t){let[r,n]=this.device.canvasContext.getDrawingBufferSize(),s=t.clearCanvas??!0,i=t.clearColor??(s?[0,0,0,0]:!1),o=s?1:!1,a=s?0:!1,c=t.colorMask??15,l={viewport:[0,0,r,n]};t.colorMask&&(l.colorMask=c),t.scissorRect&&(l.scissorRect=t.scissorRect);let h=this.device.beginRenderPass({framebuffer:t.target,parameters:l,clearColor:i,clearDepth:o,clearStencil:a});try{return this._drawLayers(h,t)}finally{h.end()}}_drawLayers(t,r){let{target:n,shaderModuleProps:s,viewports:i,views:o,onViewportActive:a,clearStack:c=!0}=r;r.pass=r.pass||"unknown",c&&(this._lastRenderIndex=-1);let l=[];for(let h of i){let f=o&&o[h.id];a?.(h);let u=this._getDrawLayerParams(h,r),d=h.subViewports||[h];for(let p of d){let g=this._drawLayersInViewport(t,{target:n,shaderModuleProps:s,viewport:p,view:f,pass:r.pass,layers:r.layers},u);l.push(g)}}return l}_getDrawLayerParams(t,{layers:r,pass:n,isPicking:s=!1,layerFilter:i,cullRect:o,effects:a,shaderModuleProps:c},l=!1){let h=[],f=Dw(this._lastRenderIndex+1),u={layer:r[0],viewport:t,isPicking:s,renderPass:n,cullRect:o},d={};for(let p=0;p<r.length;p++){let g=r[p],m=this._shouldDrawLayer(g,u,i,d),_={shouldDrawLayer:m};m&&!l&&(_.shouldDrawLayer=!0,_.layerRenderIndex=f(g,m),_.shaderModuleProps=this._getShaderModuleProps(g,a,n,c),_.layerParameters={...g.context.deck?.props.parameters,...this.getLayerParameters(g,p,t)}),h[p]=_}return h}_drawLayersInViewport(t,{layers:r,shaderModuleProps:n,pass:s,target:i,viewport:o,view:a},c){let l=X7(this.device,{shaderModuleProps:n,target:i,viewport:o});if(a&&a.props.clear){let f=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.beginRenderPass({framebuffer:i,parameters:{viewport:l,scissorRect:l},clearColor:f.color?[0,0,0,0]:!1,clearDepth:f.depth?1:!1}).end()}let h={totalCount:r.length,visibleCount:0,compositeCount:0,pickableCount:0};t.setParameters({viewport:l});for(let f=0;f<r.length;f++){let u=r[f],d=c[f],{shouldDrawLayer:p}=d;if(p&&u.props.pickable&&h.pickableCount++,u.isComposite&&h.compositeCount++,u.isDrawable&&d.shouldDrawLayer){let{layerRenderIndex:g,shaderModuleProps:m,layerParameters:_}=d;h.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,g),m.project&&(m.project.viewport=o),u.context.renderPass=t;try{u._drawLayer({renderPass:t,shaderModuleProps:m,uniforms:{layerIndex:g},parameters:_})}catch(y){u.raiseError(y,`drawing ${u} to ${s}`)}}}return h}shouldDrawLayer(t){return!0}getShaderModuleProps(t,r,n){return null}getLayerParameters(t,r,n){return t.props.parameters}_shouldDrawLayer(t,r,n,s){if(!(t.props.visible&&this.shouldDrawLayer(t)))return!1;r.layer=t;let o=t.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(r))return!1;r.layer=o,o=o.parent}if(n){let a=r.layer.id;if(a in s||(s[a]=n(r)),!s[a])return!1}return t.activateViewport(r.viewport),!0}_getShaderModuleProps(t,r,n,s){let i=this.device.canvasContext.cssToDeviceRatio(),o=t.internalState?.propsInTransition||t.props,a={layer:o,picking:{isActive:!1},project:{viewport:t.context.viewport,devicePixelRatio:i,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:t.wrapLongitude}};if(r)for(let c of r)Fw(a,c.getShaderModuleProps?.(t,a));return Fw(a,this.getShaderModuleProps(t,r,a),s)}};function Dw(e=0,t={}){let r={},n=(s,i)=>{let o=s.props._offset,a=s.id,c=s.parent&&s.parent.id,l;if(c&&!(c in t)&&n(s.parent,!1),c in r){let h=r[c]=r[c]||Dw(t[c],t);l=h(s,i),r[a]=h}else Number.isFinite(o)?(l=o+(t[c]||0),r[a]=null):l=e;return i&&l>=e&&(e=l+1),t[a]=l,l};return n}function X7(e,{shaderModuleProps:t,target:r,viewport:n}){let s=t?.project?.devicePixelRatio??e.canvasContext.cssToDeviceRatio(),[,i]=e.canvasContext.getDrawingBufferSize(),o=r?r.height:i,a=n;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}function Fw(e,...t){for(let r of t)if(r)for(let n in r)e[n]?Object.assign(e[n],r[n]):e[n]=r[n];return e}var ph=class extends Me{constructor(t,r){super(t,r);let n=t.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),s=t.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=t.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[n],depthStencilAttachment:s})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(t){let r=this.fbo,n=this.device.canvasContext.cssToDeviceRatio(),s=t.viewports[0],i=s.width*n,o=s.height*n,a=[1,1,1,1];(i!==r.width||o!==r.height)&&r.resize({width:i,height:o}),super.render({...t,clearColor:a,target:r,pass:"shadow"})}getLayerParameters(t,r,n){return{...t.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(t){return t.props.shadowEnabled!==!1}getShaderModuleProps(t,r,n){return{shadow:{project:n.project,drawToShadowMap:!0}}}};var Y7={color:[255,255,255],intensity:1},kw=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],$7=[0,0,0,200/255],Hs=class{constructor(t={}){this.id="lighting-effect",this.shadowColor=$7,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(t)}setup(t){this.context=t;let{device:r,deck:n}=t;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(r),n._addDefaultShaderModule(Ca),this.dummyShadowMap=r.createTexture({width:1,height:1}))}setProps(t){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(let r in t){let n=t[r];switch(n.type){case"ambient":this.ambientLight=n;break;case"directional":this.directionalLights.push(n);break;case"point":this.pointLights.push(n);break;default:}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(r=>r.shadow),this.context&&this.setup(this.context),this.props=t}preRender({layers:t,layerFilter:r,viewports:n,onViewportActive:s,views:i}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:t,layerFilter:r,viewports:n,onViewportActive:s,views:i,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(t,r){let n=this.shadow?{project:r.project,shadowMaps:this.shadowPasses.map(o=>o.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},s={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:t})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:t}))},i=t.props.material;return{shadow:n,lighting:s,phongMaterial:i,gouraudMaterial:i}}cleanup(t){for(let r of this.shadowPasses)r.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,t.deck._removeDefaultShaderModule(Ca))}_calculateMatrices(){let t=[];for(let r of this.directionalLights){let n=new $().lookAt({eye:new D(r.direction).negate()});t.push(n)}return t}_createShadowPasses(t){for(let r=0;r<this.directionalLights.length;r++){let n=new ph(t);this.shadowPasses[r]=n}}_applyDefaultLights(){let{ambientLight:t,pointLights:r,directionalLights:n}=this;!t&&r.length===0&&n.length===0&&(this.ambientLight=new Pa(Y7),this.directionalLights.push(new Xn(kw[0]),new Xn(kw[1])))}};var R2=class{constructor(t={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(t)}setOptions(t){Object.assign(this.opts,t)}allocate(t,r,{size:n=1,type:s,padding:i=0,copy:o=!1,initialize:a=!1,maxCount:c}){let l=s||t&&t.constructor||Float32Array,h=r*n+i;if(ArrayBuffer.isView(t)){if(h<=t.length)return t;if(h*t.BYTES_PER_ELEMENT<=t.buffer.byteLength)return new l(t.buffer,0,h)}let f=1/0;c&&(f=c*n+i);let u=this._allocate(l,h,a,f);return t&&o?u.set(t):a||u.fill(0,0,4),this._release(t),u}release(t){this._release(t)}_allocate(t,r,n,s){let i=Math.max(Math.ceil(r*this.opts.overAlloc),1);i>s&&(i=s);let o=this._pool,a=t.BYTES_PER_ELEMENT*i,c=o.findIndex(l=>l.byteLength>=a);if(c>=0){let l=new t(o.splice(c,1)[0],0,i);return n&&l.fill(0),l}return new t(i)}_release(t){if(!ArrayBuffer.isView(t))return;let r=this._pool,{buffer:n}=t,{byteLength:s}=n,i=r.findIndex(o=>o.byteLength>=s);i<0?r.push(n):(i>0||r.length<this.opts.poolSize)&&r.splice(i,0,n),r.length>this.opts.poolSize&&r.shift()}},kr=new R2;function Ia(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Xi(e,t){let r=e%t;return r<0?t+r:r}function zw(e){return[e[12],e[13],e[14]]}function Vw(e){return{left:Ra(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:Ra(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:Ra(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:Ra(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:Ra(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:Ra(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}}var Uw=new D;function Ra(e,t,r,n){Uw.set(e,t,r);let s=Uw.len();return{distance:n/s,normal:new D(-e/s,-t/s,-r/s)}}function Oa(e){return e-Math.fround(e)}var gh;function $p(e,t){let{size:r=1,startIndex:n=0}=t,s=t.endIndex!==void 0?t.endIndex:e.length,i=(s-n)/r;gh=kr.allocate(gh,i,{type:Float32Array,size:r*2});let o=n,a=0;for(;o<s;){for(let c=0;c<r;c++){let l=e[o++];gh[a+c]=l,gh[a+c+r]=Oa(l)}a+=r*2}return gh.subarray(0,i*r*2)}function Hw(e){let t=null,r=!1;for(let n of e)n&&(t?(r||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],r=!0),t[0][0]=Math.min(t[0][0],n[0][0]),t[0][1]=Math.min(t[0][1],n[0][1]),t[1][0]=Math.max(t[1][0],n[1][0]),t[1][1]=Math.max(t[1][1],n[1][1])):t=n);return t}var K7=Math.PI/180,Z7=Ia(),Ww=[0,0,0],J7={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function Q7({width:e,height:t,orthographic:r,fovyRadians:n,focalDistance:s,padding:i,near:o,far:a}){let c=e/t,l=r?new $().orthographic({fovy:n,aspect:c,focalDistance:s,near:o,far:a}):new $().perspective({fovy:n,aspect:c,near:o,far:a});if(i){let{left:h=0,right:f=0,top:u=0,bottom:d=0}=i,p=ft((h+e-f)/2,0,e)-e/2,g=ft((u+t-d)/2,0,t)-t/2;l[8]-=p*2/e,l[9]+=g*2/t}return l}var La=class{constructor(t={}){this._frustumPlanes={},this.id=t.id||this.constructor.displayName||"viewport",this.x=t.x||0,this.y=t.y||0,this.width=t.width||1,this.height=t.height||1,this.zoom=t.zoom||0,this.padding=t.padding,this.distanceScales=t.distanceScales||J7,this.focalDistance=t.focalDistance||1,this.position=t.position||Ww,this.modelMatrix=t.modelMatrix||null;let{longitude:r,latitude:n}=t;this.isGeospatial=Number.isFinite(n)&&Number.isFinite(r),this._initProps(t),this._initMatrices(t),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Pe.WEB_MERCATOR:Pe.WEB_MERCATOR_AUTO_OFFSET:Pe.IDENTITY}equals(t){return t instanceof La?this===t?!0:t.width===this.width&&t.height===this.height&&t.scale===this.scale&&kt(t.projectionMatrix,this.projectionMatrix)&&kt(t.viewMatrix,this.viewMatrix):!1}project(t,{topLeft:r=!0}={}){let n=this.projectPosition(t),s=wa(n,this.pixelProjectionMatrix),[i,o]=s,a=r?o:this.height-o;return t.length===2?[i,a]:[i,a,s[2]]}unproject(t,{topLeft:r=!0,targetZ:n}={}){let[s,i,o]=t,a=r?i:this.height-i,c=n&&n*this.distanceScales.unitsPerMeter[2],l=Mr([s,a,o],this.pixelUnprojectionMatrix,c),[h,f,u]=this.unprojectPosition(l);return Number.isFinite(o)?[h,f,u]:Number.isFinite(n)?[h,f,n]:[h,f]}projectPosition(t){let[r,n]=this.projectFlat(t),s=(t[2]||0)*this.distanceScales.unitsPerMeter[2];return[r,n,s]}unprojectPosition(t){let[r,n]=this.unprojectFlat(t),s=(t[2]||0)*this.distanceScales.metersPerUnit[2];return[r,n,s]}projectFlat(t){if(this.isGeospatial){let r=Kt(t);return r[1]=ft(r[1],-318,830),r}return t}unprojectFlat(t){return this.isGeospatial?Te(t):t}getBounds(t={}){let r={targetZ:t.z||0},n=this.unproject([0,0],r),s=this.unproject([this.width,0],r),i=this.unproject([0,this.height],r),o=this.unproject([this.width,this.height],r);return[Math.min(n[0],s[0],i[0],o[0]),Math.min(n[1],s[1],i[1],o[1]),Math.max(n[0],s[0],i[0],o[0]),Math.max(n[1],s[1],i[1],o[1])]}getDistanceScales(t){return t&&this.isGeospatial?va({longitude:t[0],latitude:t[1],highPrecision:!0}):this.distanceScales}containsPixel({x:t,y:r,width:n=1,height:s=1}){return t<this.x+this.width&&this.x<t+n&&r<this.y+this.height&&this.y<r+s}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,Vw(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(t,r){return null}_initProps(t){let r=t.longitude,n=t.latitude;this.isGeospatial&&(Number.isFinite(t.zoom)||(this.zoom=uh({latitude:n})+Math.log2(this.focalDistance)),this.distanceScales=t.distanceScales||va({latitude:n,longitude:r}));let s=Math.pow(2,this.zoom);this.scale=s;let{position:i,modelMatrix:o}=t,a=Ww;if(i&&(a=o?new $(o).transformAsVector(i,[]):i),this.isGeospatial){let c=this.projectPosition([r,n,0]);this.center=new D(a).scale(this.distanceScales.unitsPerMeter).add(c)}else this.center=this.projectPosition(a)}_initMatrices(t){let{viewMatrix:r=Z7,projectionMatrix:n=null,orthographic:s=!1,fovyRadians:i,fovy:o=75,near:a=.1,far:c=1e3,padding:l=null,focalDistance:h=1}=t;this.viewMatrixUncentered=r,this.viewMatrix=new $().multiplyRight(r).translate(new D(this.center).negate()),this.projectionMatrix=n||Q7({width:this.width,height:this.height,orthographic:s,fovyRadians:i||o*K7,focalDistance:h,padding:l,near:a,far:c});let f=Ia();jt.multiply(f,f,this.projectionMatrix),jt.multiply(f,f,this.viewMatrix),this.viewProjectionMatrix=f,this.viewMatrixInverse=jt.invert([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=zw(this.viewMatrixInverse);let u=Ia(),d=Ia();jt.scale(u,u,[this.width/2,-this.height/2,1]),jt.translate(u,u,[1,-1,0]),jt.multiply(d,u,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=jt.invert(Ia(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||k.warn("Pixel project matrix not invertible")()}};La.displayName="Viewport";var oe=La;var Yi=class extends oe{constructor(t={}){let{latitude:r=0,longitude:n=0,zoom:s=0,pitch:i=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:c=1.01,nearZ:l,farZ:h,orthographic:f=!1,projectionMatrix:u,repeat:d=!1,worldOffset:p=0,position:g,padding:m,legacyMeterSizes:_=!1}=t,{width:y,height:x,altitude:A=1.5}=t,M=Math.pow(2,s);y=y||1,x=x||1;let E,w=null;if(u)A=u[5]/2,E=jn(A);else{t.fovy?(E=t.fovy,A=qn(E)):E=jn(A);let b;if(m){let{top:T=0,bottom:I=0}=m;b=[0,ft((T+x-I)/2,0,x)-x/2]}w=v2({width:y,height:x,scale:M,center:g&&[0,0,g[2]*ji(r)],offset:b,pitch:i,fovy:E,nearZMultiplier:a,farZMultiplier:c}),Number.isFinite(l)&&(w.near=l),Number.isFinite(h)&&(w.far=h)}let v=jp({height:x,pitch:i,bearing:o,scale:M,altitude:A});p&&(v=new $().translate([512*p,0,0]).multiplyLeft(v)),super({...t,width:y,height:x,viewMatrix:v,longitude:n,latitude:r,zoom:s,...w,fovy:E,focalDistance:A}),this.latitude=r,this.longitude=n,this.zoom=s,this.pitch=i,this.bearing=o,this.altitude=A,this.fovy=E,this.orthographic=f,this._subViewports=d?[]:null,this._pseudoMeters=_,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){let t=this.getBounds(),r=Math.floor((t[0]+180)/360),n=Math.ceil((t[2]-180)/360);for(let s=r;s<=n;s++){let i=s?new Yi({...this,worldOffset:s}):this;this._subViewports.push(i)}}return this._subViewports}projectPosition(t){if(this._pseudoMeters)return super.projectPosition(t);let[r,n]=this.projectFlat(t),s=(t[2]||0)*ji(t[1]);return[r,n,s]}unprojectPosition(t){if(this._pseudoMeters)return super.unprojectPosition(t);let[r,n]=this.unprojectFlat(t),s=(t[2]||0)/ji(n);return[r,n,s]}addMetersToLngLat(t,r){return dh(t,r)}panByPosition(t,r){let n=Mr(r,this.pixelUnprojectionMatrix),s=this.projectFlat(t),i=ie.add([],s,ie.negate([],n)),o=ie.add([],this.center,i),[a,c]=this.unprojectFlat(o);return{longitude:a,latitude:c}}getBounds(t={}){let r=Xp(this,t.z||0);return[Math.min(r[0][0],r[1][0],r[2][0],r[3][0]),Math.min(r[0][1],r[1][1],r[2][1],r[3][1]),Math.max(r[0][0],r[1][0],r[2][0],r[3][0]),Math.max(r[0][1],r[1][1],r[2][1],r[3][1])]}fitBounds(t,r={}){let{width:n,height:s}=this,{longitude:i,latitude:o,zoom:a}=qp({width:n,height:s,bounds:t,...r});return new Yi({width:n,height:s,longitude:i,latitude:o,zoom:a})}};Yi.displayName="WebMercatorViewport";var Re=Yi;var Gw=[0,0,0];function I2(e,t,r=!1){let n=t.projectPosition(e);if(r&&t instanceof Re){let[s,i,o=0]=e,a=t.getDistanceScales([s,i]);n[2]=o*a.unitsPerMeter[2]}return n}function tj(e){let{viewport:t,modelMatrix:r,coordinateOrigin:n}=e,{coordinateSystem:s,fromCoordinateSystem:i,fromCoordinateOrigin:o}=e;return s===W.DEFAULT&&(s=t.isGeospatial?W.LNGLAT:W.CARTESIAN),i===void 0&&(i=s),o===void 0&&(o=n),{viewport:t,coordinateSystem:s,coordinateOrigin:n,modelMatrix:r,fromCoordinateSystem:i,fromCoordinateOrigin:o}}function O2(e,{viewport:t,modelMatrix:r,coordinateSystem:n,coordinateOrigin:s,offsetMode:i}){let[o,a,c=0]=e;switch(r&&([o,a,c]=He.transformMat4([],[o,a,c,1],r)),n){case W.LNGLAT:return I2([o,a,c],t,i);case W.LNGLAT_OFFSETS:return I2([o+s[0],a+s[1],c+(s[2]||0)],t,i);case W.METER_OFFSETS:return I2(dh(s,[o,a,c]),t,i);case W.CARTESIAN:default:return t.isGeospatial?[o+s[0],a+s[1],c+s[2]]:t.projectPosition([o,a,c])}}function Kp(e,t){let{viewport:r,coordinateSystem:n,coordinateOrigin:s,modelMatrix:i,fromCoordinateSystem:o,fromCoordinateOrigin:a}=tj(t),{autoOffset:c=!0}=t,{geospatialOrigin:l=Gw,shaderCoordinateOrigin:h=Gw,offsetMode:f=!1}=c?M2(r,n,s):{},u=O2(e,{viewport:r,modelMatrix:i,coordinateSystem:o,coordinateOrigin:a,offsetMode:f});if(f){let d=r.projectPosition(l||h);pe.sub(u,u,d)}return u}var ej=[255,255,255],rj=1,nj=[1,0,0],sj=[0,0,1],ij=0,Na=class{constructor(t={}){this.type="point";let{color:r=ej}=t,{intensity:n=rj}=t,{position:s=sj}=t;this.id=t.id||`point-${ij++}`,this.color=r,this.intensity=n,this.type="point",this.position=s,this.attenuation=oj(t),this.projectedLight={...this}}getProjectedLight({layer:t}){let{projectedLight:r}=this,n=t.context.viewport,{coordinateSystem:s,coordinateOrigin:i}=t.props,o=Kp(this.position,{viewport:n,coordinateSystem:s,coordinateOrigin:i,fromCoordinateSystem:n.isGeospatial?W.LNGLAT:W.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return r.color=this.color,r.intensity=this.intensity,r.position=o,r}};function oj(e){return e.attenuation?e.attenuation:nj}var mh=class extends Na{getProjectedLight({layer:t}){let{projectedLight:r}=this,n=t.context.viewport,{coordinateSystem:s,coordinateOrigin:i,modelMatrix:o}=t.props,{cameraPosition:a}=Hp({viewport:n,modelMatrix:o,coordinateSystem:s,coordinateOrigin:i});return r.color=this.color,r.intensity=this.intensity,r.position=a,r}};var $i=Math.PI/180,aj=1e3*60*60*24,cj=2440588,lj=2451545,Zp=$i*23.4397,hj=357.5291,fj=.98560028,uj=280.147,dj=360.9856235;function jw(e,t,r){let n=$i*-r,s=$i*t,i=gj(e),o=Ej(i),a=Aj(i,n)-o.rightAscension;return{azimuth:xj(a,s,o.declination),altitude:yj(a,s,o.declination)}}function Jp(e,t,r){let{azimuth:n,altitude:s}=jw(e,t,r);return[Math.sin(n)*Math.cos(s),Math.cos(n)*Math.cos(s),-Math.sin(s)]}function pj(e){return(typeof e=="number"?e:e.getTime())/aj-.5+cj}function gj(e){return pj(e)-lj}function mj(e,t){let r=e;return Math.atan2(Math.sin(r)*Math.cos(Zp)-Math.tan(t)*Math.sin(Zp),Math.cos(r))}function _j(e,t){let r=e;return Math.asin(Math.sin(t)*Math.cos(Zp)+Math.cos(t)*Math.sin(Zp)*Math.sin(r))}function xj(e,t,r){let n=e,s=t,i=r;return Math.atan2(Math.sin(n),Math.cos(n)*Math.sin(s)-Math.tan(i)*Math.cos(s))}function yj(e,t,r){let n=e,s=t,i=r;return Math.asin(Math.sin(s)*Math.sin(i)+Math.cos(s)*Math.cos(i)*Math.cos(n))}function Aj(e,t){return $i*(uj+dj*e)-t}function Tj(e){return $i*(hj+fj*e)}function Mj(e){let t=e,r=$i*(1.9148*Math.sin(t)+.02*Math.sin(2*t)+3e-4*Math.sin(3*t)),n=$i*102.9372;return t+r+n+Math.PI}function Ej(e){let t=Tj(e),r=Mj(t);return{declination:_j(r,0),rightAscension:mj(r,0)}}var _h=class extends Xn{constructor(t){super(t),this.timestamp=t.timestamp}getProjectedLight({layer:t}){let{viewport:r}=t.context;if(r.resolution&&r.resolution>0){let[s,i,o]=Jp(this.timestamp,0,0);this.direction=[s,-o,i]}else{let{latitude:s,longitude:i}=r;this.direction=Jp(this.timestamp,s,i)}return this}};var bj=1,Sj=1,Ki=class{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(t){let{delay:r=0,duration:n=Number.POSITIVE_INFINITY,rate:s=1,repeat:i=1}=t,o=bj++,a={time:0,delay:r,duration:n,rate:s,repeat:i};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(t){this.channels.delete(t);for(let[r,n]of this.animations)n.channel===t&&this.detachAnimation(r)}isFinished(t){let r=this.channels.get(t);return r===void 0?!1:this.time>=r.delay+r.duration*r.repeat}getTime(t){if(t===void 0)return this.time;let r=this.channels.get(t);return r===void 0?-1:r.time}setTime(t){this.time=Math.max(0,t);let r=this.channels.values();for(let s of r)this._setChannelTime(s,this.time);let n=this.animations.values();for(let s of n){let{animation:i,channel:o}=s;i.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(t,r){let n=Sj++;return this.animations.set(n,{animation:t,channel:r}),t.setTime(this.getTime(r)),n}detachAnimation(t){this.animations.delete(t)}update(t){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=t),this.setTime(this.time+(t-this.lastEngineTime)),this.lastEngineTime=t)}_setChannelTime(t,r){let n=r-t.delay,s=t.duration*t.repeat;n>=s?t.time=t.duration*t.rate:(t.time=Math.max(0,n)%t.duration,t.time*=t.rate)}};function qw(e){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)}function Xw(e){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e)}var vj=0,wj={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:ws.stats.get(`animation-loop-${vj++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1},xh=class{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(t){if(this.props={...wj,...t},t=this.props,!t.device)throw new Error("No device provided");let{useDevicePixels:r=!0}=this.props;this.stats=t.stats||new we({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:t.autoResizeViewport,autoResizeDrawingBuffer:t.autoResizeDrawingBuffer,useDevicePixels:r}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(t){if(this.props.onError(t),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){let n=document.createElement("h1");n.innerHTML=t.message,n.style.position="absolute",n.style.top="20%",n.style.left="10px",n.style.color="black",n.style.backgroundColor="red",document.body.appendChild(n)}}setNeedsRedraw(t){return this.needsRedraw=this.needsRedraw||t,this}setProps(t){return"autoResizeViewport"in t&&(this.props.autoResizeViewport=t.autoResizeViewport||!1),"autoResizeDrawingBuffer"in t&&(this.props.autoResizeDrawingBuffer=t.autoResizeDrawingBuffer||!1),"useDevicePixels"in t&&(this.props.useDevicePixels=t.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let t;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(t!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(t){let r=t instanceof Error?t:new Error("Unknown error");throw this.props.onError(r),r}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(t){return this.timeline=t,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(t=>{this._resolveNextFrame=t})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(t){this.display&&(this.display.destroy(),this.display.animationLoop=null),t&&(t.animationLoop=this),this.display=t}_requestAnimationFrame(){this._running&&(this._animationFrameId=qw(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(Xw(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(t){if(this.display){this.display._renderFrame(t);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){let t=this.device?.canvasContext?.canvas;if(!this.device||!t)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:t,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;let{width:t,height:r,aspect:n}=this._getSizeAndAspect();(t!==this.animationProps.width||r!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=t,this.animationProps.height=r,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){let t=document.createElement("div");document.body.appendChild(t),t.style.position="relative";let r=document.createElement("div");r.style.position="absolute",r.style.left="10px",r.style.bottom="10px",r.style.width="300px",r.style.background="white",this.canvas instanceof HTMLCanvasElement&&t.appendChild(this.canvas),t.appendChild(r);let n=this.props.onAddHTML(r);n&&(r.innerHTML=n)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};let[t,r]=this.device?.canvasContext?.getPixelSize()||[1,1],n=1,s=this.device?.canvasContext?.canvas;return s&&s.clientHeight?n=s.clientWidth/s.clientHeight:t>0&&r>0&&(n=t/r),{width:t,height:r,aspect:n}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(t){t instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[t.offsetX,t.offsetY])}_onMouseleave(t){this._getAnimationProps()._mousePosition=null}};var L2={};function Ie(e="id"){L2[e]=L2[e]||1;let t=L2[e]++;return`${e}-${t}`}var Qp=class{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(t){if(this.id=t.id||Ie("geometry"),this.topology=t.topology,this.indices=t.indices||null,this.attributes=t.attributes,this.vertexCount=t.vertexCount,this.bufferLayout=t.bufferLayout||[],this.indices&&!(this.indices.usage&K.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(let t of Object.values(this.attributes))t.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(t){return t.byteLength/12}};function Yw(e,t){if(t instanceof Qp)return t;let r=Cj(e,t),{attributes:n,bufferLayout:s}=Pj(e,t);return new Qp({topology:t.topology||"triangle-list",bufferLayout:s,vertexCount:t.vertexCount,indices:r,attributes:n})}function Cj(e,t){if(!t.indices)return;let r=t.indices.value;return e.createBuffer({usage:K.INDEX,data:r})}function Pj(e,t){let r=[],n={};for(let[i,o]of Object.entries(t.attributes)){let a=i;switch(i){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}if(o){n[a]=e.createBuffer({data:o.value,id:`${i}-buffer`});let{value:c,size:l,normalized:h}=o;r.push({name:a,format:Lx(c,l,h)})}}let s=t._calculateVertexCount(t.attributes,t.indices);return{attributes:n,bufferLayout:r,vertexCount:s}}var N2=class{static getDefaultPipelineFactory(t){return t._lumaData.defaultPipelineFactory=t._lumaData.defaultPipelineFactory||new N2(t),t._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(t){this.device=t,this.destroyPolicy=t.props._factoryDestroyPolicy}createRenderPipeline(t){let r={...Lr.defaultProps,...t},n=this._hashRenderPipeline(r);if(!this._renderPipelineCache[n]){let s=this.device.createRenderPipeline({...r,id:r.id?`${r.id}-cached`:void 0});s.hash=n,this._renderPipelineCache[n]={pipeline:s,useCount:0}}return this._renderPipelineCache[n].useCount++,this._renderPipelineCache[n].pipeline}createComputePipeline(t){let r={...Fi.defaultProps,...t},n=this._hashComputePipeline(r);if(!this._computePipelineCache[n]){let s=this.device.createComputePipeline({...r,id:r.id?`${r.id}-cached`:void 0});s.hash=n,this._computePipelineCache[n]={pipeline:s,useCount:0}}return this._computePipelineCache[n].useCount++,this._computePipelineCache[n].pipeline}release(t){let r=t.hash,n=t instanceof Fi?this._computePipelineCache:this._renderPipelineCache;n[r].useCount--,n[r].useCount===0&&this.destroyPolicy==="unused"&&(n[r].pipeline.destroy(),delete n[r])}_hashComputePipeline(t){return`${this._getHash(t.shader.source)}`}_hashRenderPipeline(t){let r=t.vs?this._getHash(t.vs.source):0,n=t.fs?this._getHash(t.fs.source):0,s="-",i=this._getHash(JSON.stringify(t.bufferLayout));switch(this.device.type){case"webgl":return`${r}/${n}V${s}BL${i}`;default:let o=this._getHash(JSON.stringify(t.parameters));return`${r}/${n}V${s}T${t.topology}P${o}BL${i}`}}_getHash(t){return this._hashes[t]===void 0&&(this._hashes[t]=this._hashCounter++),this._hashes[t]}},yh=N2;H(yh,"defaultProps",{...Lr.defaultProps});var B2=class{static getDefaultShaderFactory(t){return t._lumaData.defaultShaderFactory||=new B2(t),t._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(t){this.device=t,this.destroyPolicy=t.props._factoryDestroyPolicy}createShader(t){let r=this._hashShader(t),n=this._cache[r];if(!n){let s=this.device.createShader({...t,id:t.id?`${t.id}-cached`:void 0});this._cache[r]=n={shader:s,useCount:0}}return n.useCount++,n.shader}release(t){let r=this._hashShader(t),n=this._cache[r];n&&(n.useCount--,n.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[r],n.shader.destroy()))}_hashShader(t){return`${t.stage}:${t.source}`}},Ah=B2;H(Ah,"defaultProps",{...Ps.defaultProps});function $w(e,t){let r={},n="Values";if(e.attributes.length===0&&!e.varyings?.length)return{"No attributes or varyings":{[n]:"N/A"}};for(let s of e.attributes)if(s){let i=`${s.location} ${s.name}: ${s.type}`;r[`in ${i}`]={[n]:s.stepMode||"vertex"}}for(let s of e.varyings||[]){let i=`${s.location} ${s.name}`;r[`out ${i}`]={[n]:JSON.stringify(s)}}return r}var ge=null,F2=null;function Kw(e,{id:t,minimap:r,opaque:n,top:s="0",left:i="0",rgbaScale:o=1}){ge||(ge=document.createElement("canvas"),ge.id=t,ge.title=t,ge.style.zIndex="100",ge.style.position="absolute",ge.style.top=s,ge.style.left=i,ge.style.border="blue 5px solid",ge.style.transform="scaleY(-1)",document.body.appendChild(ge),F2=ge.getContext("2d")),(ge.width!==e.width||ge.height!==e.height)&&(ge.width=e.width/2,ge.height=e.height/2,ge.style.width="400px",ge.style.height="400px");let a=e.device.readPixelsToArrayWebGL(e),c=F2?.createImageData(e.width,e.height);if(c){for(let h=0;h<a.length;h+=4)c.data[0+h+0]=a[h+0]*o,c.data[0+h+1]=a[h+1]*o,c.data[0+h+2]=a[h+2]*o,c.data[0+h+3]=n?255:a[h+3]*o;F2?.putImageData(c,0,0)}}function tg(e,t,r){if(e===t)return!0;if(!r||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!tg(e[n],t[n],r-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){let n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(let i of n)if(!t.hasOwnProperty(i)||!tg(e[i],t[i],r-1))return!1;return!0}return!1}function Zw(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Jw(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function Th(e){return Zw(e)||Jw(e)}function Rj(e){return Th(e)||typeof e=="number"||typeof e=="boolean"}function eg(e){let t={bindings:{},uniforms:{}};return Object.keys(e).forEach(r=>{let n=e[r];Rj(n)?t.uniforms[r]=n:t.bindings[r]=n}),t}var rg=class{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(t,r){Object.assign(this.options,r);let n=Qo(Object.values(t).filter(s=>s.dependencies));for(let s of n)t[s.name]=s;F.log(1,"Creating ShaderInputs with modules",Object.keys(t))(),this.modules=t,this.moduleUniforms={},this.moduleBindings={};for(let[s,i]of Object.entries(t))this._addModule(i),i.name&&s!==i.name&&!this.options.disableWarnings&&F.warn(`Module name: ${s} vs ${i.name}`)()}destroy(){}setProps(t){for(let r of Object.keys(t)){let n=r,s=t[n]||{},i=this.modules[n];if(!i){this.options.disableWarnings||F.warn(`Module ${r} not found`)();continue}let o=this.moduleUniforms[n],a=this.moduleBindings[n],c=i.getUniforms?.(s,o)||s,{uniforms:l,bindings:h}=eg(c);this.moduleUniforms[n]={...o,...l},this.moduleBindings[n]={...a,...h}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){let t={};for(let r of Object.values(this.moduleBindings))Object.assign(t,r);return t}getDebugTable(){let t={};for(let[r,n]of Object.entries(this.moduleUniforms))for(let[s,i]of Object.entries(n))t[`${r}.${s}`]={type:this.modules[r].uniformTypes?.[s],value:String(i)};return t}_addModule(t){let r=t.name;this.moduleUniforms[r]=t.defaultUniforms||{},this.moduleBindings[r]={}}};var Ij="";async function Qw(e,t){let r=new Image;return r.crossOrigin=t?.crossOrigin||"anonymous",r.src=e.startsWith("http")?e:Ij+e,await r.decode(),t?await createImageBitmap(r,t):await createImageBitmap(r)}var Ba=class{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(t,r){this.device=t,this.id=r.id||Ie("async-texture"),typeof r?.data=="string"&&r.dimension==="2d"&&(r={...r,data:Qw(r.data)}),this.ready=new Promise((n,s)=>{this.resolveReady=()=>{this.isReady=!0,n()},this.rejectReady=s}),this.initAsync(r)}async initAsync(t){let r,n,s=t.data,i=await tC(s).then(r,n);if(this.destroyed)return;let o={...t,data:i};this.texture=this.device.createTexture(o),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(t){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(t.width===this.texture.width&&t.height===this.texture.height)return!1;if(this.texture){let r=this.texture;this.texture=r.clone(t),r.destroy()}return!0}};async function tC(e){if(e=await e,Array.isArray(e))return await Promise.all(e.map(tC));if(e&&typeof e=="object"&&e.constructor===Object){let t=e,r=await Promise.all(Object.values(t)),n=Object.keys(t),s={};for(let i=0;i<n.length;i++)s[n[i]]=r[i];return s}return e}var Zi=2,Oj=1e4,k2=class{device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(t,r){this.props={...k2.defaultProps,...r},r=this.props,this.id=r.id||Ie("model"),this.device=t,Object.assign(this.userData,r.userData);let n=Object.fromEntries(this.props.modules?.map(c=>[c.name,c])||[]),s=r.shaderInputs||new rg(n,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(s);let i=Nj(t),o=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){this.props.shaderLayout||=my(this.props.source);let{source:c,getUniforms:l}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:i,...this.props,modules:o});this.source=c,this._getModuleUniforms=l}else{let{vs:c,fs:l,getUniforms:h}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:i,...this.props,modules:o});this.vs=c,this.fs=l,this._getModuleUniforms=h}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,r.geometry&&this.setGeometry(r.geometry),this.pipelineFactory=r.pipelineFactory||yh.getDefaultPipelineFactory(this.device),this.shaderFactory=r.shaderFactory||Ah.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=t.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in r&&(this.isInstanced=r.isInstanced),r.instanceCount&&this.setInstanceCount(r.instanceCount),r.vertexCount&&this.setVertexCount(r.vertexCount),r.indexBuffer&&this.setIndexBuffer(r.indexBuffer),r.attributes&&this.setAttributes(r.attributes),r.constantAttributes&&this.setConstantAttributes(r.constantAttributes),r.bindings&&this.setBindings(r.bindings),r.uniforms&&this.setUniformsWebGL(r.uniforms),r.moduleSettings&&this.updateModuleSettingsWebGL(r.moduleSettings),r.transformFeedback&&(this.transformFeedback=r.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");let t=this._needsRedraw;return this._needsRedraw=!1,t}setNeedsRedraw(t){this._needsRedraw||=t}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(t){let r=this._areBindingsLoading();if(r)return F.info(Zi,`>>> DRAWING ABORTED ${this.id}: ${r} not loaded`)(),!1;try{t.pushDebugGroup(`${this}.predraw(${t})`),this.predraw()}finally{t.popDebugGroup()}let n;try{t.pushDebugGroup(`${this}.draw(${t})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();let s=this._getBindings();this.pipeline.setBindings(s,{disableWarnings:this.props.disableWarnings}),D2(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);let{indexBuffer:i}=this.vertexArray,o=i?i.byteLength/(i.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:t,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{t.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(t),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(t){this._gpuGeometry?.destroy();let r=t&&Yw(this.device,t);if(r){this.setTopology(r.topology||"triangle-list");let n=new Di(this.bufferLayout);this.bufferLayout=n.mergeBufferLayouts(r.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(r)}this._gpuGeometry=r}setTopology(t){t!==this.topology&&(this.topology=t,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(t){let r=new Di(this.bufferLayout);this.bufferLayout=this._gpuGeometry?r.mergeBufferLayouts(t,this._gpuGeometry.bufferLayout):t,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(t){tg(t,this.parameters,2)||(this.parameters=t,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(t){this.instanceCount=t,this.isInstanced===void 0&&t>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(t){this.vertexCount=t,this.setNeedsRedraw("vertexCount")}setShaderInputs(t){this.shaderInputs=t,this._uniformStore=new Ul(this.shaderInputs.modules);for(let[r,n]of Object.entries(this.shaderInputs.modules))if(Lj(n)){let s=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=s}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(t){Object.assign(this.bindings,t),this.setNeedsRedraw("bindings")}setTransformFeedback(t){this.transformFeedback=t,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(t){this.vertexArray.setIndexBuffer(t),this.setNeedsRedraw("indexBuffer")}setAttributes(t,r){let n=r?.disableWarnings??this.props.disableWarnings;t.indices&&F.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();let s=new Di(this.bufferLayout);for(let[i,o]of Object.entries(t)){let a=s.getBufferLayout(i);if(!a){n||F.warn(`Model(${this.id}): Missing layout for buffer "${i}".`)();continue}let c=s.getAttributeNamesForBuffer(a),l=!1;for(let h of c){let f=this._attributeInfos[h];f&&(this.vertexArray.setBuffer(f.location,o),l=!0)}!l&&!n&&F.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${i}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(t,r){for(let[n,s]of Object.entries(t)){let i=this._attributeInfos[n];i?this.vertexArray.setConstantWebGL(i.location,s):(r?.disableWarnings??this.props.disableWarnings)||F.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${n}"`)()}this.setNeedsRedraw("constants")}setUniforms(t){this.setUniformsWebGL(t)}setUniformsWebGL(t){D2(t)||(this.pipeline.setUniformsWebGL(t),Object.assign(this.uniforms,t)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(t){let{bindings:r,uniforms:n}=eg(this._getModuleUniforms(t));Object.assign(this.bindings,r),Object.assign(this.uniforms,n),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(let t of Object.values(this.bindings))if(t instanceof Ba&&!t.isReady)return t.id;return!1}_getBindings(){let t={};for(let[r,n]of Object.entries(this.bindings))n instanceof Ba?n.isReady&&(t[r]=n.texture):t[r]=n;return t}_getBindingsUpdateTimestamp(){let t=0;for(let r of Object.values(this.bindings))r instanceof Cs?t=Math.max(t,r.texture.updateTimestamp):r instanceof K||r instanceof Q?t=Math.max(t,r.updateTimestamp):r instanceof Ba?t=r.texture?Math.max(t,r.texture.updateTimestamp):1/0:r instanceof Rs||(t=Math.max(t,r.buffer.updateTimestamp));return t}_setGeometryAttributes(t){let r={...t.attributes};for(let[n]of Object.entries(r))!this.pipeline.shaderLayout.attributes.find(s=>s.name===n)&&n!=="positions"&&delete r[n];this.vertexCount=t.vertexCount,this.setIndexBuffer(t.indices||null),this.setAttributes(t.attributes,{disableWarnings:!0}),this.setAttributes(r,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(t){this._pipelineNeedsUpdate||=t,this.setNeedsRedraw(t)}_updatePipeline(){if(this._pipelineNeedsUpdate){let t=null,r=null;this.pipeline&&(F.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),t=this.pipeline.vs,r=this.pipeline.fs),this._pipelineNeedsUpdate=!1;let n=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders}),s=null;this.source?s=n:this.fs&&(s=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:n,fs:s}),this._attributeInfos=zd(this.pipeline.shaderLayout,this.bufferLayout),t&&this.shaderFactory.release(t),r&&this.shaderFactory.release(r)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){let t=F.level>3?0:Oj;F.level<2||Date.now()-this._lastLogTime<t||(this._lastLogTime=Date.now(),this._logOpen=!0,F.group(Zi,`>>> DRAWING MODEL ${this.id}`,{collapsed:F.level<=2})())}_logDrawCallEnd(){if(this._logOpen){let t=$w(this.pipeline.shaderLayout,this.id);F.table(Zi,t)();let r=this.shaderInputs.getDebugTable();for(let[s,i]of Object.entries(this.uniforms))r[s]={value:i};F.table(Zi,r)();let n=this._getAttributeDebugTable();F.table(Zi,this._attributeInfos)(),F.table(Zi,n)(),F.groupEnd(Zi)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(t){let r=this.device.props.debugFramebuffers;if(this._drawCount++,!r)return;let n=t.props.framebuffer;n&&Kw(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){let t={};for(let[r,n]of Object.entries(this._attributeInfos)){let s=this.vertexArray.attributes[n.location];t[n.location]={name:r,type:n.shaderType,values:s?this._getBufferOrConstantValues(s,n.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){let{indexBuffer:r}=this.vertexArray,n=r.indexType==="uint32"?new Uint32Array(r.debugData):new Uint16Array(r.debugData);t.indices={name:"indices",type:r.indexType,values:n.toString()}}return t}_getBufferOrConstantValues(t,r){let n=zl(r);return(t instanceof K?new n(t.debugData):t).toString()}},Y=k2;H(Y,"defaultProps",{...Lr.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Ss.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});function Lj(e){return Boolean(e.uniformTypes&&!D2(e.uniformTypes))}function Nj(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}function D2(e){for(let t in e)return!1;return!0}var ng=class{device;model;transformFeedback;static isSupported(t){return t?.info?.type==="webgl"}constructor(t,r=ng.defaultProps){if(!ng.isSupported(t))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=t,this.model=new Y(this.device,{id:r.id||"buffer-transform-model",fs:r.fs||Ol(),topology:r.topology||"point-list",varyings:r.outputs||r.varyings,...r}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:r.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(t){t?.inputBuffers&&this.model.setAttributes(t.inputBuffers),t?.outputBuffers&&this.transformFeedback.setBuffers(t.outputBuffers);let r=this.device.beginRenderPass(t);this.model.draw(r),r.end()}getBuffer(t){return this.transformFeedback.getBuffer(t)}readAsync(t){let r=this.getBuffer(t);if(!r)throw new Error("BufferTransform#getBuffer");if(r instanceof K)return r.readAsync();let{buffer:n,byteOffset:s=0,byteLength:i=n.byteLength}=r;return n.readAsync(s,i)}},cr=ng;H(cr,"defaultProps",{...Y.defaultProps,outputs:void 0,feedbackBuffers:void 0});var Bj="transform_output",Ws=class{device;model;sampler;currentIndex=0;samplerTextureMap=null;bindings=[];resources={};constructor(t,r){this.device=t,this.sampler=t.createSampler({addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",minFilter:"nearest",magFilter:"nearest",mipmapFilter:"nearest"}),this.model=new Y(this.device,{id:r.id||"texture-transform-model",fs:r.fs||Ol({input:r.targetTextureVarying,inputChannels:r.targetTextureChannels,output:Bj}),vertexCount:r.vertexCount,...r}),this._initialize(r),Object.seal(this)}destroy(){this.model.destroy();for(let t of this.bindings)t.framebuffer?.destroy()}delete(){this.destroy()}run(t){let{framebuffer:r}=this.bindings[this.currentIndex],n=this.device.beginRenderPass({framebuffer:r,...t});this.model.draw(n),n.end()}getTargetTexture(){let{targetTexture:t}=this.bindings[this.currentIndex];return t}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}_initialize(t){this._updateBindings(t)}_updateBindings(t){this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],t)}_updateBinding(t,{sourceBuffers:r,sourceTextures:n,targetTexture:s}){if(t||(t={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(t.sourceTextures,n),Object.assign(t.sourceBuffers,r),s){t.targetTexture=s;let{width:i,height:o}=s;t.framebuffer&&t.framebuffer.destroy(),t.framebuffer=this.device.createFramebuffer({id:"transform-framebuffer",width:i,height:o,colorAttachments:[s]}),t.framebuffer.resize({width:i,height:o})}return t}_setSourceTextureParameters(){let t=this.currentIndex,{sourceTextures:r}=this.bindings[t];for(let n in r)r[n].sampler=this.sampler}};var it=class{id;topology;vertexCount;indices;attributes;userData={};constructor(t){let{attributes:r={},indices:n=null,vertexCount:s=null}=t;this.id=t.id||Ie("geometry"),this.topology=t.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(let[i,o]of Object.entries(r)){let a=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(a.value))throw new Error(`${this._print(i)}: must be typed array or object with value as typed array`);if((i==="POSITION"||i==="positions")&&!a.size&&(a.size=3),i==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=a}else this.attributes[i]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=s||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(t){return`Geometry ${this.id} attribute ${t}`}_setAttributes(t,r){return this}_calculateVertexCount(t,r){if(r)return r.value.length;let n=1/0;for(let s of Object.values(t)){let{value:i,size:o,constant:a}=s;!a&&i&&o!==void 0&&o>=1&&(n=Math.min(n,i.length/o))}return n}};var Fj=`struct VertexInputs {
    @location(0) clipSpacePosition: vec2<f32>,
    @location(1) texCoord: vec2<f32>,
    @location(2) coordinate: vec2<f32>  
  }
  
  struct FragmentInputs {
    @builtin(position) Position : vec4<f32>,
    @location(0) position : vec2<f32>,
    @location(1) coordinate : vec2<f32>,
    @location(2) uv : vec2<f32>
  };
  
  @vertex
  fn vertexMain(inputs: VertexInputs) -> FragmentInputs {
    var outputs: FragmentInputs;
    outputs.Position = vec4(inputs.clipSpacePosition, 0., 1.);
    outputs.position = inputs.clipSpacePosition;
    outputs.coordinate = inputs.coordinate;
    outputs.uv = inputs.texCoord;
    return outputs;
  }
  `,Dj=`#version 300 es
  in vec2 clipSpacePositions;
  in vec2 texCoords;
  in vec2 coordinates;
  
  out vec2 position;
  out vec2 coordinate;
  out vec2 uv;
  
  void main(void) {
    gl_Position = vec4(clipSpacePositions, 0., 1.);
    position = clipSpacePositions;
    coordinate = coordinates;
    uv = texCoords;
  }
  `,eC=[-1,-1,1,-1,-1,1,1,1],Mh=class extends Y{constructor(t,r){let n=eC.map(s=>s===-1?0:s);r.source&&(r={...r,source:`${Fj}
  ${r.source}`}),super(t,{id:r.id||Ie("clip-space"),...r,vs:Dj,vertexCount:4,geometry:new it({topology:"triangle-strip",vertexCount:4,attributes:{clipSpacePositions:{size:2,value:new Float32Array(eC)},texCoords:{size:2,value:new Float32Array(n)},coordinates:{size:2,value:new Float32Array(n)}}})})}};var Er=class{id;matrix=new $;display=!0;position=new D;rotation=new D;scale=new D(1,1,1);userData={};props={};constructor(t={}){let{id:r}=t;this.id=r||Ie(this.constructor.name),this._setScenegraphNodeProps(t)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(t){return this._setScenegraphNodeProps(t),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(t){return this.position=t,this}setRotation(t){return this.rotation=t,this}setScale(t){return this.scale=t,this}setMatrix(t,r=!0){r?this.matrix.copy(t):this.matrix=t}setMatrixComponents(t){let{position:r,rotation:n,scale:s,update:i=!0}=t;return r&&this.setPosition(r),n&&this.setRotation(n),s&&this.setScale(s),i&&this.updateMatrix(),this}updateMatrix(){let t=this.position,r=this.rotation,n=this.scale;return this.matrix.identity(),this.matrix.translate(t),this.matrix.rotateXYZ(r),this.matrix.scale(n),this}update(t={}){let{position:r,rotation:n,scale:s}=t;return r&&this.setPosition(r),n&&this.setRotation(n),s&&this.setScale(s),this.updateMatrix(),this}getCoordinateUniforms(t,r){r=r||this.matrix;let n=new $(t).multiplyRight(r),s=n.invert(),i=s.transpose();return{viewMatrix:t,modelMatrix:r,objectMatrix:r,worldMatrix:n,worldInverseMatrix:s,worldInverseTransposeMatrix:i}}_setScenegraphNodeProps(t){"position"in t&&this.setPosition(t.position),"rotation"in t&&this.setRotation(t.rotation),"scale"in t&&this.setScale(t.scale),"matrix"in t&&this.setMatrix(t.matrix),Object.assign(this.props,t)}};var lr=class extends Er{children;constructor(t={}){t=Array.isArray(t)?{children:t}:t;let{children:r=[]}=t;F.assert(r.every(n=>n instanceof Er),"every child must an instance of ScenegraphNode"),super(t),this.children=r}getBounds(){let t=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return this.traverse((r,{worldMatrix:n})=>{let s=r.getBounds();if(!s)return;let[i,o]=s,a=new D(i).add(o).divide([2,2,2]);n.transformAsPoint(a,a);let c=new D(o).subtract(i).divide([2,2,2]);n.transformAsVector(c,c);for(let l=0;l<8;l++){let h=new D(l&1?-1:1,l&2?-1:1,l&4?-1:1).multiply(c).add(a);for(let f=0;f<3;f++)t[0][f]=Math.min(t[0][f],h[f]),t[1][f]=Math.max(t[1][f],h[f])}}),Number.isFinite(t[0][0])?t:null}destroy(){this.children.forEach(t=>t.destroy()),this.removeAll(),super.destroy()}add(...t){for(let r of t)Array.isArray(r)?this.add(...r):this.children.push(r);return this}remove(t){let r=this.children,n=r.indexOf(t);return n>-1&&r.splice(n,1),this}removeAll(){return this.children=[],this}traverse(t,{worldMatrix:r=new $}={}){let n=new $(r).multiplyRight(this.matrix);for(let s of this.children)s instanceof lr?s.traverse(t,{worldMatrix:n}):t(s,{worldMatrix:n})}};var pn=class extends Er{model;bounds=null;managedResources;constructor(t){super(t),this.model=t.model,this.managedResources=t.managedResources||[],this.bounds=t.bounds||null,this.setProps(t)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(t=>t.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(t){return this.model.draw(t)}};var Yn=class extends it{constructor(t={}){let{id:r=Ie("cube-geometry"),indices:n=!0}=t;super(n?{...t,id:r,topology:"triangle-list",indices:{size:1,value:kj},attributes:{...jj,...t.attributes}}:{...t,id:r,topology:"triangle-list",indices:void 0,attributes:{...qj,...t.attributes}})}},kj=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),Uj=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),zj=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),Vj=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),Hj=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),Wj=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),Gj=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),jj={POSITION:{size:3,value:Uj},NORMAL:{size:3,value:zj},TEXCOORD_0:{size:2,value:Vj}},qj={POSITION:{size:3,value:Hj},TEXCOORD_0:{size:2,value:Wj},COLOR_0:{size:3,value:Gj}};var Eh=class extends it{constructor(t={}){let{id:r=Ie("sphere-geometry")}=t,{indices:n,attributes:s}=Xj(t);super({...t,id:r,topology:"triangle-list",indices:n,attributes:{...s,...t.attributes}})}};function Xj(e){let{nlat:t=10,nlong:r=10}=e,i=Math.PI-0,o=0,c=2*Math.PI-o,l=(t+1)*(r+1),h=(_,y,x,A,M)=>e.radius||1,f=new Float32Array(l*3),u=new Float32Array(l*3),d=new Float32Array(l*2),p=l>65535?Uint32Array:Uint16Array,g=new p(t*r*6);for(let _=0;_<=t;_++)for(let y=0;y<=r;y++){let x=y/r,A=_/t,M=y+_*(r+1),E=M*2,w=M*3,v=c*x,b=i*A,T=Math.sin(v),I=Math.cos(v),N=Math.sin(b),B=Math.cos(b),C=I*N,V=B,rt=T*N,J=h(C,V,rt,x,A);f[w+0]=J*C,f[w+1]=J*V,f[w+2]=J*rt,u[w+0]=C,u[w+1]=V,u[w+2]=rt,d[E+0]=x,d[E+1]=1-A}let m=r+1;for(let _=0;_<r;_++)for(let y=0;y<t;y++){let x=(_*t+y)*6;g[x+0]=y*m+_,g[x+1]=y*m+_+1,g[x+2]=(y+1)*m+_,g[x+3]=(y+1)*m+_,g[x+4]=y*m+_+1,g[x+5]=(y+1)*m+_+1}return{indices:{size:1,value:g},attributes:{POSITION:{size:3,value:f},NORMAL:{size:3,value:u},TEXCOORD_0:{size:2,value:d}}}}var Yj=`uniform screenUniforms {
    vec2 texSize;
  } screen;
  `,rC={name:"screen",fs:Yj,uniformTypes:{texSize:"vec2<f32>"}};var bh=class extends qi{constructor(t,r){super(t,r);let{module:n,fs:s,id:i}=r,o={depthWriteEnabled:!1,depthCompare:"always"};this.model=new Mh(t,{id:i,fs:s,modules:[n,rC],parameters:o})}render(t){this._renderPass(this.device,t)}delete(){this.model.destroy(),this.model=null}_renderPass(t,r){let{clearCanvas:n,inputBuffer:s,outputBuffer:i}=r,o=[s.width,s.height],a={texSrc:s.colorAttachments[0],texSize:o};this.model.shaderInputs.setProps({screen:a,...r.moduleProps});let c=this.device.beginRenderPass({framebuffer:i,parameters:{viewport:[0,0,...o]},clearColor:n?[0,0,0,0]:!1,clearDepth:1});this.model.draw(c),c.end()}};var Sh=class{constructor(t,r){this.id=`${t.name}-pass`,this.props=r,Od(t),this.module=t}setup({device:t}){this.passes=$j(t,this.module,this.id)}setProps(t){this.props=t}preRender(){}postRender(t){let r=this.passes,{target:n}=t,s=t.inputBuffer,i=t.swapBuffer;for(let o=0;o<r.length;o++){let a=o===r.length-1,c=n!==void 0&&a;c&&(i=n);let l=!c||Boolean(t.clearCanvas),h={},f=this.module.passes[o].uniforms;h[this.module.name]={...this.props,...f},r[o].render({clearCanvas:l,inputBuffer:s,outputBuffer:i,moduleProps:h});let u=i;i=s,s=u}return s}cleanup(){if(this.passes){for(let t of this.passes)t.delete();this.passes=void 0}}};function $j(e,t,r){return t.passes.map((n,s)=>{let i=Jj(t,n),o=`${r}-${s}`;return new bh(e,{id:o,module:t,fs:i})})}var nC=`#version 300 es
  uniform sampler2D texSrc;
  
  in vec2 position;
  in vec2 coordinate;
  in vec2 uv;
  
  out vec4 fragColor;
  `,Kj=e=>`${nC}
  void main() {
    fragColor = texture(texSrc, coordinate);
    fragColor = ${e}(fragColor, screen.texSize, coordinate);
  }
  `,Zj=e=>`${nC}
  void main() {
    fragColor = ${e}(texSrc, screen.texSize, coordinate);
  }
  `;function Jj(e,t){if(t.filter){let r=typeof t.filter=="string"?t.filter:`${e.name}_filterColor_ext`;return Kj(r)}if(t.sampler){let r=typeof t.sampler=="string"?t.sampler:`${e.name}_sampleColor`;return Zj(r)}return""}var Qj={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"},Ur=class extends Me{constructor(){super(...arguments),this._colorEncoderState=null}render(t){return"pickingFBO"in t?this._drawPickingBuffer(t):super.render(t)}_drawPickingBuffer({layers:t,layerFilter:r,views:n,viewports:s,onViewportActive:i,pickingFBO:o,deviceRect:{x:a,y:c,width:l,height:h},cullRect:f,effects:u,pass:d="picking",pickZ:p,shaderModuleProps:g}){this.pickZ=p;let m=this._resetColorEncoder(p),_=[a,c,l,h],y=super.render({target:o,layers:t,layerFilter:r,views:n,viewports:s,onViewportActive:i,cullRect:f,effects:u?.filter(A=>A.useInPicking),pass:d,isPicking:!0,shaderModuleProps:g,clearColor:[0,0,0,0],colorMask:15,scissorRect:_});return this._colorEncoderState=null,{decodePickingColor:m&&eq.bind(null,m),stats:y}}shouldDrawLayer(t){let{pickable:r,operation:n}=t.props;return r&&n.includes("draw")||n.includes("terrain")||n.includes("mask")}getShaderModuleProps(t,r,n){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(t,r,n){let s={...t.props.parameters},{pickable:i,operation:o}=t.props;return!this._colorEncoderState||o.includes("terrain")?s.blend=!1:i&&o.includes("draw")&&(Object.assign(s,Qj),s.blend=!0,s.blendColor=tq(this._colorEncoderState,t,n)),s}_resetColorEncoder(t){return this._colorEncoderState=t?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}};function tq(e,t,r){let{byLayer:n,byAlpha:s}=e,i,o=n.get(t);return o?(o.viewports.push(r),i=o.a):(i=n.size+1,i<=255?(o={a:i,layer:t,viewports:[r]},n.set(t,o),s[i]=o):(k.warn("Too many pickable layers, only picking the first 255")(),i=0)),[0,0,0,i/255]}function eq(e,t){let r=e.byAlpha[t[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(t)}}var Gs={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Fa=Symbol.for("component"),br=Symbol.for("propTypes"),sg=Symbol.for("deprecatedProps"),$n=Symbol.for("asyncPropDefaults"),gn=Symbol.for("asyncPropOriginal"),zr=Symbol.for("asyncPropResolved");function We(e,t=()=>!0){return Array.isArray(e)?sC(e,t,[]):t(e)?[e]:[]}function sC(e,t,r){let n=-1;for(;++n<e.length;){let s=e[n];Array.isArray(s)?sC(s,t,r):t(s)&&r.push(s)}return r}function ig({target:e,source:t,start:r=0,count:n=1}){let s=t.length,i=n*s,o=0;for(let a=r;o<s;o++)e[a++]=t[o];for(;o<i;)o<i-o?(e.copyWithin(r+o,r,r+o),o*=2):(e.copyWithin(r+o,r,r+i-o),o=i);return e}var vh=class{constructor(t,r,n){this._loadCount=0,this._subscribers=new Set,this.id=t,this.context=n,this.setData(r)}subscribe(t){this._subscribers.add(t)}unsubscribe(t){this._subscribers.delete(t)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(t,r){if(t===this._data&&!r)return;this._data=t;let n=++this._loadCount,s=t;typeof t=="string"&&(s=se(t)),s instanceof Promise?(this.isLoaded=!1,this._loader=s.then(i=>{this._loadCount===n&&(this.isLoaded=!0,this._error=void 0,this._content=i)}).catch(i=>{this._loadCount===n&&(this.isLoaded=!0,this._error=i||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=t);for(let i of this._subscribers)i.onChange(this.getData())}};var wh=class{constructor(t){this.protocol=t.protocol||"resource://",this._context={device:t.device,gl:t.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(t){return t.startsWith(this.protocol)?!0:t in this._resources}add({resourceId:t,data:r,forceUpdate:n=!1,persistent:s=!0}){let i=this._resources[t];i?i.setData(r,n):(i=new vh(t,r,this._context),this._resources[t]=i),i.persistent=s}remove(t){let r=this._resources[t];r&&(r.delete(),delete this._resources[t])}unsubscribe({consumerId:t}){let r=this._consumers[t];if(r){for(let n in r){let s=r[n],i=this._resources[s.resourceId];i&&i.unsubscribe(s)}delete this._consumers[t],this.prune()}}subscribe({resourceId:t,onChange:r,consumerId:n,requestId:s="default"}){let{_resources:i,protocol:o}=this;t.startsWith(o)&&(t=t.replace(o,""),i[t]||this.add({resourceId:t,data:null,persistent:!1}));let a=i[t];if(this._track(n,s,a,r),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(let t in this._resources)this._resources[t].delete()}_track(t,r,n,s){let i=this._consumers,o=i[t]=i[t]||{},a=o[r],c=a&&a.resourceId&&this._resources[a.resourceId];c&&(c.unsubscribe(a),this.prune()),n&&(a?(a.onChange=s,a.resourceId=n.id):a={onChange:s,resourceId:n.id},o[r]=a,n.subscribe(a))}_prune(){this._pruneRequest=null;for(let t of Object.keys(this._resources)){let r=this._resources[t];!r.persistent&&!r.inUse()&&(r.delete(),delete this._resources[t])}}};var rq="layerManager.setLayers",nq="layerManager.activateViewport",Ji=class{constructor(t,r){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{Gt(nq,this,a),a&&(this.context.viewport=a)};let{deck:n,stats:s,viewport:i,timeline:o}=r||{};this.layers=[],this.resourceManager=new wh({device:t,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:t,gl:t?.gl,deck:n,shaderAssembler:Yp(),defaultShaderModules:[u2],renderPass:void 0,stats:s||new we({id:"deck.gl"}),viewport:i||new oe({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new Ki,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(let t of this.layers)this._finalizeLayer(t)}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);for(let n of this.layers){let s=n.getNeedsRedraw(t);r=r||s}return r}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(t){this._needsRedraw=this._needsRedraw||t}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t}getLayers({layerIds:t}={}){return t?this.layers.filter(r=>t.find(n=>r.id.indexOf(n)===0)):this.layers}setProps(t){"debug"in t&&(this._debug=t.debug),"userData"in t&&(this.context.userData=t.userData),"layers"in t&&(this._nextLayers=t.layers),"onError"in t&&(this.context.onError=t.onError)}setLayers(t,r){Gt(rq,this,r,t),this._lastRenderedLayers=t;let n=We(t,Boolean);for(let s of n)s.context=this.context;this._updateLayers(this.layers,n)}updateLayers(){let t=this.needsUpdate();t&&(this.setNeedsRedraw(`updating layers: ${t}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,t)),this._nextLayers=null}addDefaultShaderModule(t){let{defaultShaderModules:r}=this.context;r.find(n=>n.name===t.name)||(r.push(t),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(t){let{defaultShaderModules:r}=this.context,n=r.findIndex(s=>s.name===t.name);n>=0&&(r.splice(n,1),this._defaultShaderModulesChanged=!0)}_handleError(t,r,n){n.raiseError(r,`${t} of ${n}`)}_updateLayers(t,r){let n={};for(let o of t)n[o.id]?k.warn(`Multiple old layers with same id ${o.id}`)():n[o.id]=o;if(this._defaultShaderModulesChanged){for(let o of t)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}let s=[];this._updateSublayersRecursively(r,n,s),this._finalizeOldLayers(n);let i=!1;for(let o of s)if(o.hasUniformTransition()){i=`Uniform transition in ${o}`;break}this._needsUpdate=i,this.layers=s}_updateSublayersRecursively(t,r,n){for(let s of t){s.context=this.context;let i=r[s.id];i===null&&k.warn(`Multiple new layers with same id ${s.id}`)(),r[s.id]=null;let o=null;try{this._debug&&i!==s&&s.validateProps(),i?(this._transferLayerState(i,s),this._updateLayer(s)):this._initializeLayer(s),n.push(s),o=s.isComposite?s.getSubLayers():null}catch(a){this._handleError("matching",a,s)}o&&this._updateSublayersRecursively(o,r,n)}}_finalizeOldLayers(t){for(let r in t){let n=t[r];n&&this._finalizeLayer(n)}}_initializeLayer(t){try{t._initialize(),t.lifecycle=Gs.INITIALIZED}catch(r){this._handleError("initialization",r,t)}}_transferLayerState(t,r){r._transferState(t),r.lifecycle=Gs.MATCHED,r!==t&&(t.lifecycle=Gs.AWAITING_GC)}_updateLayer(t){try{t._update()}catch(r){this._handleError("update",r,t)}}_finalizeLayer(t){this._needsRedraw=this._needsRedraw||`finalized ${t}`,t.lifecycle=Gs.AWAITING_FINALIZATION;try{t._finalize(),t.lifecycle=Gs.FINALIZED}catch(r){this._handleError("finalization",r,t)}}};function tt(e,t,r){if(e===t)return!0;if(!r||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!tt(e[n],t[n],r-1))return!1;return!0}if(Array.isArray(t))return!1;if(typeof e=="object"&&typeof t=="object"){let n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(let i of n)if(!t.hasOwnProperty(i)||!tt(e[i],t[i],r-1))return!1;return!0}return!1}var Ch=class{constructor(t){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=t.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=t.eventManager,this._eventCallbacks={onViewStateChange:t.onViewStateChange,onInteractionStateChange:t.onInteractionStateChange},Object.seal(this),this.setProps(t)}finalize(){for(let t in this.controllers){let r=this.controllers[t];r&&r.finalize()}this.controllers={}}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}setNeedsUpdate(t){this._needsUpdate=this._needsUpdate||t,this._needsRedraw=this._needsRedraw||t}updateViewStates(){for(let t in this.controllers){let r=this.controllers[t];r&&r.updateTransition()}}getViewports(t){return t?this._viewports.filter(r=>r.containsPixel(t)):this._viewports}getViews(){let t={};return this.views.forEach(r=>{t[r.id]=r}),t}getView(t){return this.views.find(r=>r.id===t)}getViewState(t){let r=typeof t=="string"?this.getView(t):t,n=r&&this.viewState[r.getViewStateId()]||this.viewState;return r?r.filterViewState(n):n}getViewport(t){return this._viewportMap[t]}unproject(t,r){let n=this.getViewports(),s={x:t[0],y:t[1]};for(let i=n.length-1;i>=0;--i){let o=n[i];if(o.containsPixel(s)){let a=t.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,r)}}return null}setProps(t){t.views&&this._setViews(t.views),t.viewState&&this._setViewState(t.viewState),("width"in t||"height"in t)&&this._setSize(t.width,t.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(t,r){(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,this.setNeedsUpdate("Size changed"))}_setViews(t){t=We(t,Boolean),this._diffViews(t,this.views)&&this.setNeedsUpdate("views changed"),this.views=t}_setViewState(t){t?(!tt(t,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=t):k.warn("missing `viewState` or `initialViewState`")()}_createController(t,r){let n=r.type;return new n({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:i=>this.getView(t.id)?.makeViewport({viewState:i,width:this.width,height:this.height})})}_updateController(t,r,n,s){let i=t.controller;if(i&&n){let o={...r,...i,id:t.id,x:n.x,y:n.y,width:n.width,height:n.height};return(!s||s.constructor!==i.type)&&(s=this._createController(t,o)),s&&s.setProps(o),s}return null}_rebuildViewports(){let{views:t}=this,r=this.controllers;this._viewports=[],this.controllers={};let n=!1;for(let s=t.length;s--;){let i=t[s],o=this.getViewState(i),a=i.makeViewport({viewState:o,width:this.width,height:this.height}),c=r[i.id],l=Boolean(i.controller);l&&!c&&(n=!0),(n||!l)&&c&&(c.finalize(),c=null),this.controllers[i.id]=this._updateController(i,o,a,c),a&&this._viewports.unshift(a)}for(let s in r){let i=r[s];i&&!this.controllers[s]&&i.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(t=>{t.id&&(this._viewportMap[t.id]=this._viewportMap[t.id]||t)})}_diffViews(t,r){return t.length!==r.length?!0:t.some((n,s)=>!t[s].equals(r[s]))}};var sq=/([0-9]+\.?[0-9]*)(%|px)/;function Kn(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":let t=sq.exec(e);if(t&&t.length>=3){let r=t[2]==="%",n=parseFloat(t[1]);return{position:r?n/100:n,relative:r}}default:throw new Error(`Could not parse position string ${e}`)}}function Zn(e,t){return e.relative?Math.round(e.position*t):e.position}var Ge=class{constructor(t){let{id:r,x:n=0,y:s=0,width:i="100%",height:o="100%",padding:a=null}=t;this.id=r||this.constructor.displayName||"view",this.props={...t,id:this.id},this._x=Kn(n),this._y=Kn(s),this._width=Kn(i),this._height=Kn(o),this._padding=a&&{left:Kn(a.left||0),right:Kn(a.right||0),top:Kn(a.top||0),bottom:Kn(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(t){return this===t?!0:this.constructor===t.constructor&&tt(this.props,t.props,2)}makeViewport({width:t,height:r,viewState:n}){n=this.filterViewState(n);let s=this.getDimensions({width:t,height:r});if(!s.height||!s.width)return null;let i=this.getViewportType(n);return new i({...n,...this.props,...s})}getViewStateId(){let{viewState:t}=this.props;return typeof t=="string"?t:t?.id||this.id}filterViewState(t){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;let r={...t};for(let n in this.props.viewState)n!=="id"&&(r[n]=this.props.viewState[n]);return r}return t}getDimensions({width:t,height:r}){let n={x:Zn(this._x,t),y:Zn(this._y,r),width:Zn(this._width,t),height:Zn(this._height,r)};return this._padding&&(n.padding={left:Zn(this._padding.left,t),top:Zn(this._padding.top,r),right:Zn(this._padding.right,t),bottom:Zn(this._padding.bottom,r)}),n}get controller(){let t=this.props.controller;return t?t===!0?{type:this.ControllerType}:typeof t=="function"?{type:t}:{type:this.ControllerType,...t}:null}};var Vr=class{constructor(t){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=t}get inProgress(){return this._inProgress}start(t){this.cancel(),this.settings=t,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){let{_timeline:t,settings:r}=this;this._handle=t.addChannel({delay:t.getTime(),duration:r.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}};var iC=()=>{},Ph={BREAK:1,SNAP_TO_END:2,IGNORE:3},iq=e=>e,oq=Ph.BREAK,Rh=class{constructor(t){this._onTransitionUpdate=r=>{let{time:n,settings:{interpolator:s,startProps:i,endProps:o,duration:a,easing:c}}=r,l=c(n/a),h=s.interpolateProps(i,o,l);this.propsInTransition=this.getControllerState({...this.props,...h}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=t.getControllerState,this.propsInTransition=null,this.transition=new Vr(t.timeline),this.onViewStateChange=t.onViewStateChange||iC,this.onStateChange=t.onStateChange||iC}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(t){let r=!1,n=this.props;if(this.props=t,!n||this._shouldIgnoreViewportChange(n,t))return!1;if(this._isTransitionEnabled(t)){let s=n;if(this.transition.inProgress){let{interruption:i,endProps:o}=this.transition.settings;s={...n,...i===Ph.SNAP_TO_END?o:this.propsInTransition||n}}this._triggerTransition(s,t),r=!0}else this.transition.cancel();return r}updateTransition(){this.transition.update()}_isTransitionEnabled(t){let{transitionDuration:r,transitionInterpolator:n}=t;return(r>0||r==="auto")&&Boolean(n)}_isUpdateDueToCurrentTransition(t){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(t,this.propsInTransition):!1}_shouldIgnoreViewportChange(t,r){return this.transition.inProgress?this.transition.settings.interruption===Ph.IGNORE||this._isUpdateDueToCurrentTransition(r):this._isTransitionEnabled(r)?r.transitionInterpolator.arePropsEqual(t,r):!0}_triggerTransition(t,r){let n=this.getControllerState(t),s=this.getControllerState(r).shortestPathFrom(n),i=r.transitionInterpolator,o=i.getDuration?i.getDuration(t,r):r.transitionDuration;if(o===0)return;let a=i.initializeProps(t,s);this.propsInTransition={};let c={duration:o,easing:r.transitionEasing||iq,interpolator:i,interruption:r.transitionInterruption||oq,startProps:a.start,endProps:a.end,onStart:r.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(r.onTransitionInterrupt),onEnd:this._onTransitionEnd(r.onTransitionEnd)};this.transition.start(c),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(t){return r=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),t?.(r)}}};function yt(e,t){if(!e)throw new Error(t||"deck.gl: assertion failed.")}var Jn=class{constructor(t){let{compare:r,extract:n,required:s}=t;this._propsToCompare=r,this._propsToExtract=n||r,this._requiredProps=s}arePropsEqual(t,r){for(let n of this._propsToCompare)if(!(n in t)||!(n in r)||!kt(t[n],r[n]))return!1;return!0}initializeProps(t,r){let n={},s={};for(let i of this._propsToExtract)(i in t||i in r)&&(n[i]=t[i],s[i]=r[i]);return this._checkRequiredProps(n),this._checkRequiredProps(s),{start:n,end:s}}getDuration(t,r){return r.transitionDuration}_checkRequiredProps(t){this._requiredProps&&this._requiredProps.forEach(r=>{let n=t[r];yt(Number.isFinite(n)||Array.isArray(n),`${r} is required for transition`)})}};var aq=["longitude","latitude","zoom","bearing","pitch"],cq=["longitude","latitude","zoom"],Ee=class extends Jn{constructor(t={}){let r=Array.isArray(t)?t:t.transitionProps,n=Array.isArray(t)?{}:t;n.transitionProps=Array.isArray(r)?{compare:r,required:r}:r||{compare:aq,required:cq},super(n.transitionProps),this.opts=n}initializeProps(t,r){let n=super.initializeProps(t,r),{makeViewport:s,around:i}=this.opts;if(s&&i){let o=s(t),a=s(r),c=o.unproject(i);n.start.around=i,Object.assign(n.end,{around:a.project(c),aroundPosition:c,width:r.width,height:r.height})}return n}interpolateProps(t,r,n){let s={};for(let i of this._propsToExtract)s[i]=he(t[i]||0,r[i]||0,n);if(r.aroundPosition&&this.opts.makeViewport){let i=this.opts.makeViewport({...r,...s});Object.assign(s,i.panByPosition(r.aroundPosition,he(t.around,r.around,n)))}return s}};var js={transitionDuration:0},lq=300,og=e=>1-(1-e)*(1-e),Da={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Qi={},je=class{constructor(t){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new Rh({...t,getControllerState:r=>new this.ControllerState(r),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=t.eventManager,this.onViewStateChange=t.onViewStateChange||(()=>{}),this.onStateChange=t.onStateChange||(()=>{}),this.makeViewport=t.makeViewport}set events(t){this.toggleEvents(this._customEvents,!1),this.toggleEvents(t,!0),this._customEvents=t,this.props&&this.setProps(this.props)}finalize(){for(let t in this._events)this._events[t]&&this.eventManager?.off(t,this.handleEvent);this.transitionManager.finalize()}handleEvent(t){this._controllerState=void 0;let r=this._eventStartBlocked;switch(t.type){case"panstart":return r?!1:this._onPanStart(t);case"panmove":return this._onPan(t);case"panend":return this._onPanEnd(t);case"pinchstart":return r?!1:this._onPinchStart(t);case"pinchmove":return this._onPinch(t);case"pinchend":return this._onPinchEnd(t);case"multipanstart":return r?!1:this._onMultiPanStart(t);case"multipanmove":return this._onMultiPan(t);case"multipanend":return this._onMultiPanEnd(t);case"dblclick":return this._onDoubleClick(t);case"wheel":return this._onWheel(t);case"keydown":return this._onKeyDown(t);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(t){let{x:r,y:n}=this.props,{offsetCenter:s}=t;return[s.x-r,s.y-n]}isPointInBounds(t,r){let{width:n,height:s}=this.props;if(r&&r.handled)return!1;let i=t[0]>=0&&t[0]<=n&&t[1]>=0&&t[1]<=s;return i&&r&&r.stopPropagation(),i}isFunctionKeyPressed(t){let{srcEvent:r}=t;return Boolean(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(t){let r=setTimeout(()=>{this._eventStartBlocked===r&&(this._eventStartBlocked=null)},t);this._eventStartBlocked=r}setProps(t){t.dragMode&&(this.dragMode=t.dragMode),this.props=t,"transitionInterpolator"in t||(t.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(t);let{inertia:r}=t;this.inertia=Number.isFinite(r)?r:r===!0?lq:0;let{scrollZoom:n=!0,dragPan:s=!0,dragRotate:i=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:c=!1,keyboard:l=!0}=t,h=Boolean(this.onViewStateChange);this.toggleEvents(Da.WHEEL,h&&n),this.toggleEvents(Da.PAN,h),this.toggleEvents(Da.PINCH,h&&(a||c)),this.toggleEvents(Da.MULTI_PAN,h&&c),this.toggleEvents(Da.DOUBLE_CLICK,h&&o),this.toggleEvents(Da.KEYBOARD,h&&l),this.scrollZoom=n,this.dragPan=s,this.dragRotate=i,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=c,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(t,r){this.eventManager&&t.forEach(n=>{this._events[n]!==r&&(this._events[n]=r,r?this.eventManager.on(n,this.handleEvent):this.eventManager.off(n,this.handleEvent))})}updateViewport(t,r=null,n={}){let s={...t.getViewportProps(),...r},i=this.controllerState!==t;if(this.state=t.getState(),this._setInteractionState(n),i){let o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:s,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(t){this.onViewStateChange({...t,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(t){Object.assign(this._interactionState,t),this.onStateChange(this._interactionState)}_onPanStart(t){let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.isFunctionKeyPressed(t)||t.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(n=!n);let s=this.controllerState[n?"panStart":"rotateStart"]({pos:r});return this._panMove=n,this.updateViewport(s,js,{isDragging:!0}),!0}_onPan(t){return this.isDragging()?this._panMove?this._onPanMove(t):this._onPanRotate(t):!1}_onPanEnd(t){return this.isDragging()?this._panMove?this._onPanMoveEnd(t):this._onPanRotateEnd(t):!1}_onPanMove(t){if(!this.dragPan)return!1;let r=this.getCenter(t),n=this.controllerState.pan({pos:r});return this.updateViewport(n,js,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(t){let{inertia:r}=this;if(this.dragPan&&r&&t.velocity){let n=this.getCenter(t),s=[n[0]+t.velocityX*r/2,n[1]+t.velocityY*r/2],i=this.controllerState.pan({pos:s}).panEnd();this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:og},{isDragging:!1,isPanning:!0})}else{let n=this.controllerState.panEnd();this.updateViewport(n,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(t){if(!this.dragRotate)return!1;let r=this.getCenter(t),n=this.controllerState.rotate({pos:r});return this.updateViewport(n,js,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(t){let{inertia:r}=this;if(this.dragRotate&&r&&t.velocity){let n=this.getCenter(t),s=[n[0]+t.velocityX*r/2,n[1]+t.velocityY*r/2],i=this.controllerState.rotate({pos:s}).rotateEnd();this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:og},{isDragging:!1,isRotating:!0})}else{let n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(t){if(!this.scrollZoom)return!1;let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;t.srcEvent.preventDefault();let{speed:n=.01,smooth:s=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:i}=t,o=2/(1+Math.exp(-Math.abs(i*n)));i<0&&o!==0&&(o=1/o);let a=this.controllerState.zoom({pos:r,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:r}),transitionDuration:s?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(t){let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.controllerState.rotateStart({pos:r});return this.updateViewport(n,js,{isDragging:!0}),!0}_onMultiPan(t){if(!this.touchRotate||!this.isDragging())return!1;let r=this.getCenter(t);r[0]-=t.deltaX;let n=this.controllerState.rotate({pos:r});return this.updateViewport(n,js,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(t){if(!this.isDragging())return!1;let{inertia:r}=this;if(this.touchRotate&&r&&t.velocityY){let n=this.getCenter(t),s=[n[0],n[1]+=t.velocityY*r/2],i=this.controllerState.rotate({pos:s});this.updateViewport(i,{...this._getTransitionProps(),transitionDuration:r,transitionEasing:og},{isDragging:!1,isRotating:!0}),this.blockEvents(r)}else{let n=this.controllerState.rotateEnd();this.updateViewport(n,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(t){let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.controllerState.zoomStart({pos:r}).rotateStart({pos:r});return Qi._startPinchRotation=t.rotation,Qi._lastPinchEvent=t,this.updateViewport(n,js,{isDragging:!0}),!0}_onPinch(t){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let r=this.controllerState;if(this.touchZoom){let{scale:n}=t,s=this.getCenter(t);r=r.zoom({pos:s,scale:n})}if(this.touchRotate){let{rotation:n}=t;r=r.rotate({deltaAngleX:Qi._startPinchRotation-n})}return this.updateViewport(r,js,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Qi._lastPinchEvent=t,!0}_onPinchEnd(t){if(!this.isDragging())return!1;let{inertia:r}=this,{_lastPinchEvent:n}=Qi;if(this.touchZoom&&r&&n&&t.scale!==n.scale){let s=this.getCenter(t),i=this.controllerState.rotateEnd(),o=Math.log2(t.scale),a=(o-Math.log2(n.scale))/(t.deltaTime-n.deltaTime),c=Math.pow(2,o+a*r/2);i=i.zoom({pos:s,scale:c}).zoomEnd(),this.updateViewport(i,{...this._getTransitionProps({around:s}),transitionDuration:r,transitionEasing:og},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(r)}else{let s=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(s,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Qi._startPinchRotation=null,Qi._lastPinchEvent=null,!0}_onDoubleClick(t){if(!this.doubleClickZoom)return!1;let r=this.getCenter(t);if(!this.isPointInBounds(r,t))return!1;let n=this.isFunctionKeyPressed(t),s=this.controllerState.zoom({pos:r,scale:n?.5:2});return this.updateViewport(s,this._getTransitionProps({around:r}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(t){if(!this.keyboard)return!1;let r=this.isFunctionKeyPressed(t),{zoomSpeed:n,moveSpeed:s,rotateSpeedX:i,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this,c,l={};switch(t.srcEvent.code){case"Minus":c=r?a.zoomOut(n).zoomOut(n):a.zoomOut(n),l.isZooming=!0;break;case"Equal":c=r?a.zoomIn(n).zoomIn(n):a.zoomIn(n),l.isZooming=!0;break;case"ArrowLeft":r?(c=a.rotateLeft(i),l.isRotating=!0):(c=a.moveLeft(s),l.isPanning=!0);break;case"ArrowRight":r?(c=a.rotateRight(i),l.isRotating=!0):(c=a.moveRight(s),l.isPanning=!0);break;case"ArrowUp":r?(c=a.rotateUp(o),l.isRotating=!0):(c=a.moveUp(s),l.isPanning=!0);break;case"ArrowDown":r?(c=a.rotateDown(o),l.isRotating=!0):(c=a.moveDown(s),l.isPanning=!0);break;default:return!1}return this.updateViewport(c,this._getTransitionProps(),l),!0}_getTransitionProps(t){let{transition:r}=this;return!r||!r.transitionInterpolator?js:t?{...r,transitionInterpolator:new Ee({...t,...r.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:r}};var Qn=class{constructor(t,r){this._viewportProps=this.applyConstraints(t),this._state=r}getViewportProps(){return this._viewportProps}getState(){return this._state}};var oC=5,hq=1.2,Ih=class extends Qn{constructor(t){let{width:r,height:n,latitude:s,longitude:i,zoom:o,bearing:a=0,pitch:c=0,altitude:l=1.5,position:h=[0,0,0],maxZoom:f=20,minZoom:u=0,maxPitch:d=60,minPitch:p=0,startPanLngLat:g,startZoomLngLat:m,startRotatePos:_,startBearing:y,startPitch:x,startZoom:A,normalize:M=!0}=t;yt(Number.isFinite(i)),yt(Number.isFinite(s)),yt(Number.isFinite(o)),super({width:r,height:n,latitude:s,longitude:i,zoom:o,bearing:a,pitch:c,altitude:l,maxZoom:f,minZoom:u,maxPitch:d,minPitch:p,normalize:M,position:h},{startPanLngLat:g,startZoomLngLat:m,startRotatePos:_,startBearing:y,startPitch:x,startZoom:A}),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanLngLat:this._unproject(t)})}pan({pos:t,startPos:r}){let n=this.getState().startPanLngLat||this._unproject(r);if(!n)return this;let i=this.makeViewport(this.getViewportProps()).panByPosition(n,t);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:r=0,deltaAngleY:n=0}){let{startRotatePos:s,startBearing:i,startPitch:o}=this.getState();if(!s||i===void 0||o===void 0)return this;let a;return t?a=this._getNewRotation(t,s,o,i):a={bearing:i+r,pitch:o+n},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:t}){return this._getUpdatedState({startZoomLngLat:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:r,scale:n}){let{startZoom:s,startZoomLngLat:i}=this.getState();if(i||(s=this.getViewportProps().zoom,i=this._unproject(r)||this._unproject(t)),!i)return this;let{maxZoom:o,minZoom:a}=this.getViewportProps(),c=s+Math.log2(n);c=ft(c,a,o);let l=this.makeViewport({...this.getViewportProps(),zoom:c});return this._getUpdatedState({zoom:c,...l.panByPosition(i,t)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(t=2){return this._zoomFromCenter(t)}zoomOut(t=2){return this._zoomFromCenter(1/t)}moveLeft(t=100){return this._panFromCenter([t,0])}moveRight(t=100){return this._panFromCenter([-t,0])}moveUp(t=100){return this._panFromCenter([0,t])}moveDown(t=100){return this._panFromCenter([0,-t])}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}shortestPathFrom(t){let r=t.getViewportProps(),n={...this.getViewportProps()},{bearing:s,longitude:i}=n;return Math.abs(s-r.bearing)>180&&(n.bearing=s<0?s+360:s-360),Math.abs(i-r.longitude)>180&&(n.longitude=i<0?i+360:i-360),n}applyConstraints(t){let{maxZoom:r,minZoom:n,zoom:s}=t;t.zoom=ft(s,n,r);let{maxPitch:i,minPitch:o,pitch:a}=t;t.pitch=ft(a,o,i);let{normalize:c=!0}=t;return c&&Object.assign(t,w2(t)),t}_zoomFromCenter(t){let{width:r,height:n}=this.getViewportProps();return this.zoom({pos:[r/2,n/2],scale:t})}_panFromCenter(t){let{width:r,height:n}=this.getViewportProps();return this.pan({startPos:[r/2,n/2],pos:[r/2+t[0],n/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}_unproject(t){let r=this.makeViewport(this.getViewportProps());return t&&r.unproject(t)}_getNewRotation(t,r,n,s){let i=t[0]-r[0],o=t[1]-r[1],a=t[1],c=r[1],{width:l,height:h}=this.getViewportProps(),f=i/l,u=0;o>0?Math.abs(h-c)>oC&&(u=o/(c-h)*hq):o<0&&c>oC&&(u=1-a/c),u=ft(u,-1,1);let{minPitch:d,maxPitch:p}=this.getViewportProps(),g=s+180*f,m=n;return u>0?m=n+u*(p-n):u<0&&(m=n-u*(d-n)),{pitch:m,bearing:g}}},to=class extends je{constructor(){super(...arguments),this.ControllerState=Ih,this.transition={transitionDuration:300,transitionInterpolator:new Ee({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(t){t.position=t.position||[0,0,0];let r=this.props;super.setProps(t),(!r||r.height!==t.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...t,...this.state}))}};var ag=class extends Ge{constructor(t={}){super(t)}getViewportType(){return Re}get ControllerType(){return to}};ag.displayName="MapView";var qs=ag;var fq=new Hs;function uq(e,t){let r=e.order??1/0,n=t.order??1/0;return r-n}var Oh=class{constructor(t){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=t,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(t){let r=this._defaultEffects;if(!r.find(n=>n.id===t.id)){let n=r.findIndex(s=>uq(s,t)>0);n<0?r.push(t):r.splice(n,0,t),t.setup(this._context),this._setEffects(this.effects)}}setProps(t){"effects"in t&&(tt(t.effects,this.effects,1)||this._setEffects(t.effects))}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}getEffects(){return this._resolvedEffects}_setEffects(t){let r={};for(let s of this.effects)r[s.id]=s;let n=[];for(let s of t){let i=r[s.id],o=s;i&&i!==s?i.setProps?(i.setProps(s.props),o=i):i.cleanup(this._context):i||s.setup(this._context),n.push(o),delete r[s.id]}for(let s in r)r[s].cleanup(this._context);this.effects=n,this._resolvedEffects=n.concat(this._defaultEffects),t.some(s=>s instanceof Hs)||this._resolvedEffects.push(fq),this._needsRedraw="effects changed"}finalize(){for(let t of this._resolvedEffects)t.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}};var Lh=class extends Me{shouldDrawLayer(t){let{operation:r}=t.props;return r.includes("draw")||r.includes("terrain")}};var dq="deckRenderer.renderLayers",eo=class{constructor(t){this.device=t,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new Lh(t),this.pickLayersPass=new Ur(t),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(t){this.layerFilter!==t.layerFilter&&(this.layerFilter=t.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==t.drawPickingColors&&(this.drawPickingColors=t.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(t){if(!t.viewports.length)return;let r=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,n={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...t};n.effects&&this._preRender(n.effects,n);let s=this.lastPostProcessEffect?this.renderBuffers[0]:n.target;this.lastPostProcessEffect&&(n.clearColor=[0,0,0,0],n.clearCanvas=!0);let i=r.render({...n,target:s});n.effects&&this._postRender(n.effects,n),this.renderCount++,Gt(dq,this,i,t)}needsRedraw(t={clearRedrawFlags:!1}){let r=this._needsRedraw;return t.clearRedrawFlags&&(this._needsRedraw=!1),r}finalize(){let{renderBuffers:t}=this;for(let r of t)r.delete();t.length=0}_preRender(t,r){this.lastPostProcessEffect=null,r.preRenderStats=r.preRenderStats||{};for(let n of t)r.preRenderStats[n.id]=n.preRender(r),n.postRender&&(this.lastPostProcessEffect=n.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){let{renderBuffers:t}=this,r=this.device.canvasContext.getDrawingBufferSize();t.length===0&&[0,1].map(n=>{let s=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});t.push(this.device.createFramebuffer({id:`deck-renderbuffer-${n}`,colorAttachments:[s]}))});for(let n of t)n.resize(r)}_postRender(t,r){let{renderBuffers:n}=this,s={...r,inputBuffer:n[0],swapBuffer:n[1]};for(let i of t)if(i.postRender){s.target=i.id===this.lastPostProcessEffect?r.target:void 0;let o=i.postRender(s);s.inputBuffer=o,s.swapBuffer=o===n[0]?n[1]:n[0]}}};var pq={pickedColor:null,pickedObjectIndex:-1};function aC({pickedColors:e,decodePickingColor:t,deviceX:r,deviceY:n,deviceRadius:s,deviceRect:i}){let{x:o,y:a,width:c,height:l}=i,h=s*s,f=-1,u=0;for(let d=0;d<l;d++){let p=d+a-n,g=p*p;if(g>h)u+=4*c;else for(let m=0;m<c;m++){if(e[u+3]-1>=0){let y=m+o-r,x=y*y+g;x<=h&&(h=x,f=u)}u+=4}}if(f>=0){let d=e.slice(f,f+4),p=t(d);if(p){let g=Math.floor(f/4/c),m=f/4-g*c;return{...p,pickedColor:d,pickedX:o+m,pickedY:a+g}}k.error("Picked non-existent layer. Is picking buffer corrupt?")()}return pq}function cC({pickedColors:e,decodePickingColor:t}){let r=new Map;if(e){for(let n=0;n<e.length;n+=4)if(e[n+3]-1>=0){let i=e.slice(n,n+4),o=i.join(",");if(!r.has(o)){let a=t(i);a?r.set(o,{...a,color:i}):k.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}function U2({pickInfo:e,viewports:t,pixelRatio:r,x:n,y:s,z:i}){let o=t[0];t.length>1&&(o=gq(e?.pickedViewports||t,{x:n,y:s}));let a;if(o){let c=[n-o.x,s-o.y];i!==void 0&&(c[2]=i),a=o.unproject(c)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:n,y:s,pixel:[n,s],coordinate:a,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:r}}function lC(e){let{pickInfo:t,lastPickedInfo:r,mode:n,layers:s}=e,{pickedColor:i,pickedLayer:o,pickedObjectIndex:a}=t,c=o?[o]:[];if(n==="hover"){let f=r.index,u=r.layerId,d=o?o.props.id:null;if(d!==u||a!==f){if(d!==u){let p=s.find(g=>g.props.id===u);p&&c.unshift(p)}r.layerId=d,r.index=a,r.info=null}}let l=U2(e),h=new Map;return h.set(null,l),c.forEach(f=>{let u={...l};f===o&&(u.color=i,u.index=a,u.picked=!0),u=z2({layer:f,info:u,mode:n});let d=u.layer;f===o&&n==="hover"&&(r.info=u),h.set(d.id,u),n==="hover"&&d.updateAutoHighlight(u)}),h}function z2({layer:e,info:t,mode:r}){for(;e&&t;){let n=t.layer||null;t.sourceLayer=n,t.layer=e,t=e.getPickingInfo({info:t,mode:r,sourceLayer:n}),e=e.parent}return t}function gq(e,t){for(let r=e.length-1;r>=0;r--){let n=e[r];if(n.containsPixel(t))return n}return e[0]}var Nh=class{constructor(t){this._pickable=!0,this.device=t,this.pickLayersPass=new Ur(t),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(t){"layerFilter"in t&&(this.layerFilter=t.layerFilter),"_pickable"in t&&(this._pickable=t._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(t){return this._pickClosestObject(t)}pickObjects(t){return this._pickVisibleObjects(t)}getLastPickedObject({x:t,y:r,layers:n,viewports:s},i=this.lastPickedInfo.info){let o=i&&i.layer&&i.layer.id,a=i&&i.viewport&&i.viewport.id,c=o?n.find(u=>u.id===o):null,l=a&&s.find(u=>u.id===a)||s[0],h=l&&l.unproject([t-l.x,r-l.y]);return{...i,...{x:t,y:r,viewport:l,coordinate:h,layer:c}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){let r=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=r}let{canvas:t}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:t.width,height:t.height}),this.depthFBO?.resize({width:t.width,height:t.height})}_getPickable(t){if(this._pickable===!1)return null;let r=t.filter(n=>this.pickLayersPass.shouldDrawLayer(n)&&!n.isComposite);return r.length?r:null}_pickClosestObject({layers:t,views:r,viewports:n,x:s,y:i,radius:o=0,depth:a=1,mode:c="query",unproject3D:l,onViewportActive:h,effects:f}){let u=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(t);if(!d||n.length===0)return{result:[],emptyInfo:U2({viewports:n,x:s,y:i,pixelRatio:u})};this._resizeBuffer();let p=this.device.canvasContext.cssToDevicePixels([s,i],!0),g=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],m=Math.round(o*u),{width:_,height:y}=this.pickingFBO,x=this._getPickingRect({deviceX:g[0],deviceY:g[1],deviceRadius:m,deviceWidth:_,deviceHeight:y}),A={x:s-o,y:i-o,width:o*2+1,height:o*2+1},M,E=[],w=new Set;for(let v=0;v<a;v++){let b;if(x){let I=this._drawAndSample({layers:d,views:r,viewports:n,onViewportActive:h,deviceRect:x,cullRect:A,effects:f,pass:`picking:${c}`});b=aC({...I,deviceX:g[0],deviceY:g[1],deviceRadius:m,deviceRect:x})}else b={pickedColor:null,pickedObjectIndex:-1};let T;if(b.pickedLayer&&l&&this.depthFBO){let{pickedColors:I}=this._drawAndSample({layers:[b.pickedLayer],views:r,viewports:n,onViewportActive:h,deviceRect:{x:b.pickedX,y:b.pickedY,width:1,height:1},cullRect:A,effects:f,pass:`picking:${c}:z`},!0);I[3]&&(T=I[0])}b.pickedLayer&&v+1<a&&(w.add(b.pickedLayer),b.pickedLayer.disablePickingIndex(b.pickedObjectIndex)),M=lC({pickInfo:b,lastPickedInfo:this.lastPickedInfo,mode:c,layers:d,viewports:n,x:s,y:i,z:T,pixelRatio:u});for(let I of M.values())I.layer&&E.push(I);if(!b.pickedColor)break}for(let v of w)v.restorePickingColors();return{result:E,emptyInfo:M.get(null)}}_pickVisibleObjects({layers:t,views:r,viewports:n,x:s,y:i,width:o=1,height:a=1,mode:c="query",maxObjects:l=null,onViewportActive:h,effects:f}){let u=this._getPickable(t);if(!u||n.length===0)return[];this._resizeBuffer();let d=this.device.canvasContext.cssToDeviceRatio(),p=this.device.canvasContext.cssToDevicePixels([s,i],!0),g=p.x,m=p.y+p.height,_=this.device.canvasContext.cssToDevicePixels([s+o,i+a],!0),y=_.x+_.width,x=_.y,A={x:g,y:x,width:y-g,height:m-x},M=this._drawAndSample({layers:u,views:r,viewports:n,onViewportActive:h,deviceRect:A,cullRect:{x:s,y:i,width:o,height:a},effects:f,pass:`picking:${c}`}),E=cC(M),w=new Map,v=[],b=Number.isFinite(l);for(let T=0;T<E.length&&!(b&&v.length>=l);T++){let I=E[T],N={color:I.pickedColor,layer:null,index:I.pickedObjectIndex,picked:!0,x:s,y:i,pixelRatio:d};N=z2({layer:I.pickedLayer,info:N,mode:c});let B=N.layer.id;w.has(B)||w.set(B,new Set);let C=w.get(B),V=N.object??N.index;C.has(V)||(C.add(V),v.push(N))}return v}_drawAndSample({layers:t,views:r,viewports:n,onViewportActive:s,deviceRect:i,cullRect:o,effects:a,pass:c},l=!1){let h=l?this.depthFBO:this.pickingFBO,f={layers:t,layerFilter:this.layerFilter,views:r,viewports:n,onViewportActive:s,pickingFBO:h,deviceRect:i,cullRect:o,effects:a,pass:c,pickZ:l,preRenderStats:{}};for(let y of a)y.useInPicking&&(f.preRenderStats[y.id]=y.preRender(f));let{decodePickingColor:u}=this.pickLayersPass.render(f),{x:d,y:p,width:g,height:m}=i,_=new(l?Float32Array:Uint8Array)(g*m*4);return this.device.readPixelsToArrayWebGL(h,{sourceX:d,sourceY:p,sourceWidth:g,sourceHeight:m,target:_}),{pickedColors:_,decodePickingColor:u}}_getPickingRect({deviceX:t,deviceY:r,deviceRadius:n,deviceWidth:s,deviceHeight:i}){let o=Math.max(0,t-n),a=Math.max(0,r-n),c=Math.min(s,t+n+1)-o,l=Math.min(i,r+n+1)-a;return c<=0||l<=0?null:{x:o,y:a,width:c,height:l}}};var mq={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},_q="top-left",hC="__root",cg=class{constructor({deck:t,parentElement:r}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=t,this.parentElement=r}getWidgets(){return this.resolvedWidgets}setProps(t){t.widgets&&!tt(t.widgets,this.widgets,1)&&this._setWidgets(t.widgets)}finalize(){for(let t of this.getWidgets())this._remove(t);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(let t in this.containers)this.containers[t].remove()}addDefault(t){this.defaultWidgets.find(r=>r.id===t.id)||(this._add(t),this.defaultWidgets.push(t),this._setWidgets(this.widgets))}_setWidgets(t){let r={};for(let n of this.resolvedWidgets)r[n.id]=n;this.resolvedWidgets.length=0;for(let n of this.defaultWidgets)r[n.id]=null,this.resolvedWidgets.push(n);for(let n of t){let s=r[n.id];s?s.viewId!==n.viewId||s.placement!==n.placement?(this._remove(s),this._add(n)):n!==s&&(s.setProps(n.props),n=s):this._add(n),r[n.id]=null,this.resolvedWidgets.push(n)}for(let n in r){let s=r[n];s&&this._remove(s)}this.widgets=t}_add(t){let{viewId:r=null,placement:n=_q}=t,s=t.onAdd({deck:this.deck,viewId:r});s&&this._getContainer(r,n).append(s),t._element=s}_remove(t){t.onRemove?.(),t._element&&t._element.remove(),t._element=void 0}_getContainer(t,r){let n=t||hC,s=this.containers[n];s||(s=document.createElement("div"),s.style.pointerEvents="none",s.style.position="absolute",s.style.overflow="hidden",this.parentElement?.append(s),this.containers[n]=s);let i=s.querySelector(`.${r}`);return i||(i=document.createElement("div"),i.className=r,i.style.position="absolute",i.style.zIndex="2",Object.assign(i.style,mq[r]),s.append(i)),i}_updateContainers(){let t=this.deck.width,r=this.deck.height;for(let n in this.containers){let s=this.lastViewports[n]||null,i=n===hC||s,o=this.containers[n];i?(o.style.display="block",o.style.left=`${s?s.x:0}px`,o.style.top=`${s?s.y:0}px`,o.style.width=`${s?s.width:t}px`,o.style.height=`${s?s.height:r}px`):o.style.display="none"}}onRedraw({viewports:t,layers:r}){let n=t.reduce((s,i)=>(s[i.id]=i,s),{});for(let s of this.getWidgets()){let{viewId:i}=s;if(i){let o=n[i];o&&(s.onViewportChange&&s.onViewportChange(o),s.onRedraw?.({viewports:[o],layers:r}))}else{if(s.onViewportChange)for(let o of t)s.onViewportChange(o);s.onRedraw?.({viewports:t,layers:r})}}this.lastViewports=n,this._updateContainers()}onHover(t,r){for(let n of this.getWidgets()){let{viewId:s}=n;(!s||s===t.viewport?.id)&&n.onHover?.(t,r)}}onEvent(t,r){let n=lh[r.type];if(n)for(let s of this.getWidgets()){let{viewId:i}=s;(!i||i===t.viewport?.id)&&s[n]?.(t,r)}}};var xq={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"},Bh=class{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:t}){let r=document.createElement("div");return r.className="deck-tooltip",Object.assign(r.style,xq),this.deck=t,this.element=r,r}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(t){this.isVisible&&t.id===this.lastViewport?.id&&t!==this.lastViewport&&this.setTooltip(null)}onHover(t){let{deck:r}=this,n=r&&r.props.getTooltip;if(!n)return;let s=n(t);this.lastViewport=t.viewport,this.setTooltip(s,t.x,t.y)}setTooltip(t,r,n){let s=this.element;if(s){if(typeof t=="string")s.innerText=t;else if(t)t.text&&(s.innerText=t.text),t.html&&(s.innerHTML=t.html),t.className&&(s.className=t.className);else{this.isVisible=!1,s.style.display="none";return}this.isVisible=!0,s.style.display="block",s.style.transform=`translate(${r}px, ${n}px)`,t&&typeof t=="object"&&"style"in t&&Object.assign(s.style,t.style)}}};var Xs;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e[e.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",e[e.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",e[e.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",e[e.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",e[e.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",e[e.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",e[e.LINE_WEBGL=6913]="LINE_WEBGL",e[e.FILL_WEBGL=6914]="FILL_WEBGL",e[e.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",e[e.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",e[e.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",e[e.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",e[e.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",e[e.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",e[e.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",e[e.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",e[e.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",e[e.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",e[e.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",e[e.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",e[e.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",e[e.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",e[e.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",e[e.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",e[e.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",e[e.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",e[e.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",e[e.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",e[e.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",e[e.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",e[e.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",e[e.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(Xs||(Xs={}));var Dh={[3042]:!1,[32773]:new Float32Array([0,0,0,0]),[32777]:32774,[34877]:32774,[32969]:1,[32968]:0,[32971]:1,[32970]:0,[3106]:new Float32Array([0,0,0,0]),[3107]:[!0,!0,!0,!0],[2884]:!1,[2885]:1029,[2929]:!1,[2931]:1,[2932]:513,[2928]:new Float32Array([0,1]),[2930]:!0,[3024]:!0,[35725]:null,[36006]:null,[36007]:null,[34229]:null,[34964]:null,[2886]:2305,[33170]:4352,[2849]:1,[32823]:!1,[32824]:0,[10752]:0,[32926]:!1,[32928]:!1,[32938]:1,[32939]:!1,[3089]:!1,[3088]:new Int32Array([0,0,1024,1024]),[2960]:!1,[2961]:0,[2968]:4294967295,[36005]:4294967295,[2962]:519,[2967]:0,[2963]:4294967295,[34816]:519,[36003]:0,[36004]:4294967295,[2964]:7680,[2965]:7680,[2966]:7680,[34817]:7680,[34818]:7680,[34819]:7680,[2978]:[0,0,1024,1024],[36389]:null,[36662]:null,[36663]:null,[35053]:null,[35055]:null,[35723]:4352,[36010]:null,[35977]:!1,[3333]:4,[3317]:4,[37440]:!1,[37441]:!1,[37443]:37444,[3330]:0,[3332]:0,[3331]:0,[3314]:0,[32878]:0,[3316]:0,[3315]:0,[32877]:0},ae=(e,t,r)=>t?e.enable(r):e.disable(r),fC=(e,t,r)=>e.hint(r,t),hr=(e,t,r)=>e.pixelStorei(r,t),uC=(e,t,r)=>{let n=r===36006?36009:36008;return e.bindFramebuffer(n,t)},Fh=(e,t,r)=>{let s={[34964]:34962,[36662]:36662,[36663]:36663,[35053]:35051,[35055]:35052}[r];e.bindBuffer(s,t)};function V2(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}var dC={[3042]:ae,[32773]:(e,t)=>e.blendColor(...t),[32777]:"blendEquation",[34877]:"blendEquation",[32969]:"blendFunc",[32968]:"blendFunc",[32971]:"blendFunc",[32970]:"blendFunc",[3106]:(e,t)=>e.clearColor(...t),[3107]:(e,t)=>e.colorMask(...t),[2884]:ae,[2885]:(e,t)=>e.cullFace(t),[2929]:ae,[2931]:(e,t)=>e.clearDepth(t),[2932]:(e,t)=>e.depthFunc(t),[2928]:(e,t)=>e.depthRange(...t),[2930]:(e,t)=>e.depthMask(t),[3024]:ae,[35723]:fC,[35725]:(e,t)=>e.useProgram(t),[36007]:(e,t)=>e.bindRenderbuffer(36161,t),[36389]:(e,t)=>e.bindTransformFeedback?.(36386,t),[34229]:(e,t)=>e.bindVertexArray(t),[36006]:uC,[36010]:uC,[34964]:Fh,[36662]:Fh,[36663]:Fh,[35053]:Fh,[35055]:Fh,[2886]:(e,t)=>e.frontFace(t),[33170]:fC,[2849]:(e,t)=>e.lineWidth(t),[32823]:ae,[32824]:"polygonOffset",[10752]:"polygonOffset",[35977]:ae,[32926]:ae,[32928]:ae,[32938]:"sampleCoverage",[32939]:"sampleCoverage",[3089]:ae,[3088]:(e,t)=>e.scissor(...t),[2960]:ae,[2961]:(e,t)=>e.clearStencil(t),[2968]:(e,t)=>e.stencilMaskSeparate(1028,t),[36005]:(e,t)=>e.stencilMaskSeparate(1029,t),[2962]:"stencilFuncFront",[2967]:"stencilFuncFront",[2963]:"stencilFuncFront",[34816]:"stencilFuncBack",[36003]:"stencilFuncBack",[36004]:"stencilFuncBack",[2964]:"stencilOpFront",[2965]:"stencilOpFront",[2966]:"stencilOpFront",[34817]:"stencilOpBack",[34818]:"stencilOpBack",[34819]:"stencilOpBack",[2978]:(e,t)=>e.viewport(...t),[34383]:ae,[10754]:ae,[12288]:ae,[12289]:ae,[12290]:ae,[12291]:ae,[12292]:ae,[12293]:ae,[12294]:ae,[12295]:ae,[3333]:hr,[3317]:hr,[37440]:hr,[37441]:hr,[37443]:hr,[3330]:hr,[3332]:hr,[3331]:hr,[3314]:hr,[32878]:hr,[3316]:hr,[3315]:hr,[32877]:hr,framebuffer:(e,t)=>{let r=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,r)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{let r=typeof t=="number"?[t,t]:t;e.blendEquationSeparate(...r)},blendFunc:(e,t)=>{let r=t?.length===2?[...t,...t]:t;e.blendFuncSeparate(...r)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(t[0],t[1]||!1),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{t=V2(t)?t:[t,t];let[r,n]=t;e.stencilMaskSeparate(1028,r),e.stencilMaskSeparate(1029,n)},stencilFunc:(e,t)=>{t=V2(t)&&t.length===3?[...t,...t]:t;let[r,n,s,i,o,a]=t;e.stencilFuncSeparate(1028,r,n,s),e.stencilFuncSeparate(1029,i,o,a)},stencilOp:(e,t)=>{t=V2(t)&&t.length===3?[...t,...t]:t;let[r,n,s,i,o,a]=t;e.stencilOpSeparate(1028,r,n,s),e.stencilOpSeparate(1029,i,o,a)},viewport:(e,t)=>e.viewport(...t)};function Xt(e,t,r){return t[e]!==void 0?t[e]:r[e]}var pC={blendEquation:(e,t,r)=>e.blendEquationSeparate(Xt(32777,t,r),Xt(34877,t,r)),blendFunc:(e,t,r)=>e.blendFuncSeparate(Xt(32969,t,r),Xt(32968,t,r),Xt(32971,t,r),Xt(32970,t,r)),polygonOffset:(e,t,r)=>e.polygonOffset(Xt(32824,t,r),Xt(10752,t,r)),sampleCoverage:(e,t,r)=>e.sampleCoverage(Xt(32938,t,r),Xt(32939,t,r)),stencilFuncFront:(e,t,r)=>e.stencilFuncSeparate(1028,Xt(2962,t,r),Xt(2967,t,r),Xt(2963,t,r)),stencilFuncBack:(e,t,r)=>e.stencilFuncSeparate(1029,Xt(34816,t,r),Xt(36003,t,r),Xt(36004,t,r)),stencilOpFront:(e,t,r)=>e.stencilOpSeparate(1028,Xt(2964,t,r),Xt(2965,t,r),Xt(2966,t,r)),stencilOpBack:(e,t,r)=>e.stencilOpSeparate(1029,Xt(34817,t,r),Xt(34818,t,r),Xt(34819,t,r))},H2={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,r)=>e({[t]:r}),hint:(e,t,r)=>e({[t]:r}),useProgram:(e,t)=>e({[35725]:t}),bindRenderbuffer:(e,t,r)=>e({[36007]:r}),bindTransformFeedback:(e,t,r)=>e({[36389]:r}),bindVertexArray:(e,t)=>e({[34229]:t}),bindFramebuffer:(e,t,r)=>{switch(t){case 36160:return e({[36006]:r,[36010]:r});case 36009:return e({[36006]:r});case 36008:return e({[36010]:r});default:return null}},bindBuffer:(e,t,r)=>{let n={[34962]:[34964],[36662]:[36662],[36663]:[36663],[35051]:[35053],[35052]:[35055]}[t];return n?e({[n]:r}):{valueChanged:!0}},blendColor:(e,t,r,n,s)=>e({[32773]:new Float32Array([t,r,n,s])}),blendEquation:(e,t)=>e({[32777]:t,[34877]:t}),blendEquationSeparate:(e,t,r)=>e({[32777]:t,[34877]:r}),blendFunc:(e,t,r)=>e({[32969]:t,[32968]:r,[32971]:t,[32970]:r}),blendFuncSeparate:(e,t,r,n,s)=>e({[32969]:t,[32968]:r,[32971]:n,[32970]:s}),clearColor:(e,t,r,n,s)=>e({[3106]:new Float32Array([t,r,n,s])}),clearDepth:(e,t)=>e({[2931]:t}),clearStencil:(e,t)=>e({[2961]:t}),colorMask:(e,t,r,n,s)=>e({[3107]:[t,r,n,s]}),cullFace:(e,t)=>e({[2885]:t}),depthFunc:(e,t)=>e({[2932]:t}),depthRange:(e,t,r)=>e({[2928]:new Float32Array([t,r])}),depthMask:(e,t)=>e({[2930]:t}),frontFace:(e,t)=>e({[2886]:t}),lineWidth:(e,t)=>e({[2849]:t}),polygonOffset:(e,t,r)=>e({[32824]:t,[10752]:r}),sampleCoverage:(e,t,r)=>e({[32938]:t,[32939]:r}),scissor:(e,t,r,n,s)=>e({[3088]:new Int32Array([t,r,n,s])}),stencilMask:(e,t)=>e({[2968]:t,[36005]:t}),stencilMaskSeparate:(e,t,r)=>e({[t===1028?2968:36005]:r}),stencilFunc:(e,t,r,n)=>e({[2962]:t,[2967]:r,[2963]:n,[34816]:t,[36003]:r,[36004]:n}),stencilFuncSeparate:(e,t,r,n,s)=>e({[t===1028?2962:34816]:r,[t===1028?2967:36003]:n,[t===1028?2963:36004]:s}),stencilOp:(e,t,r,n)=>e({[2964]:t,[2965]:r,[2966]:n,[34817]:t,[34818]:r,[34819]:n}),stencilOpSeparate:(e,t,r,n,s)=>e({[t===1028?2964:34817]:r,[t===1028?2965:34818]:n,[t===1028?2966:34819]:s}),viewport:(e,t,r,n,s)=>e({[2978]:[t,r,n,s]})},mn=(e,t)=>e.isEnabled(t),W2={[3042]:mn,[2884]:mn,[2929]:mn,[3024]:mn,[32823]:mn,[32926]:mn,[32928]:mn,[3089]:mn,[2960]:mn,[35977]:mn},gC=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Hr(e,t){if(yq(t))return;let r={};for(let s in t){let i=Number(s),o=dC[s];o&&(typeof o=="string"?r[o]=!0:o(e,t[s],i))}let n=e.state&&e.state.cache;if(n)for(let s in r){let i=pC[s];i(e,t,n)}}function lg(e,t=Dh){if(typeof t=="number"){let s=t,i=W2[s];return i?i(e,s):e.getParameter(s)}let r=Array.isArray(t)?t:Object.keys(t),n={};for(let s of r){let i=W2[s];n[s]=i?i(e,Number(s)):e.getParameter(Number(s))}return n}function mC(e){Hr(e,Dh)}function yq(e){for(let t in e)return!1;return!0}function _C(e,t){if(e===t)return!0;let r=Array.isArray(e)||ArrayBuffer.isView(e),n=Array.isArray(t)||ArrayBuffer.isView(t);if(r&&n&&e.length===t.length){for(let s=0;s<e.length;++s)if(e[s]!==t[s])return!1;return!0}return!1}var Wr=class{static get(t){return t.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(t,r){this.gl=t,this.log=r?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(t={}){this.stateStack.push({})}pop(){let t=this.stateStack[this.stateStack.length-1];Hr(this.gl,t),this.stateStack.pop()}trackState(t,r){if(this.cache=r.copyState?lg(t):Object.assign({},Dh),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,Tq(t);for(let n in H2){let s=H2[n];Aq(t,n,s)}xC(t,"getParameter"),xC(t,"isEnabled")}_updateCache(t){let r=!1,n,s=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(let i in t){let o=t[i],a=this.cache[i];_C(o,a)||(r=!0,n=a,s&&!(i in s)&&(s[i]=a),this.cache[i]=o)}return{valueChanged:r,oldValue:n}}};function xC(e,t){let r=e[t].bind(e);e[t]=function(s){if(s===void 0||gC.has(s))return r(s);let i=Wr.get(e);return s in i.cache||(i.cache[s]=r(s)),i.enable?i.cache[s]:r(s)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function Aq(e,t,r){if(!e[t])return;let n=e[t].bind(e);e[t]=function(...i){let o=Wr.get(e),{valueChanged:a,oldValue:c}=r(o._updateCache,...i);return a&&n(...i),c},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}function Tq(e){let t=e.useProgram.bind(e);e.useProgram=function(n){let s=Wr.get(e);s.program!==n&&(t(n),s.program=n)}}function yC(e,t,r){let n="",s={preserveDrawingBuffer:!0,...r},i=null;if(i||=e.getContext("webgl2",s),s.failIfMajorPerformanceCaveat&&(n||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),!i&&!r.failIfMajorPerformanceCaveat&&(s.failIfMajorPerformanceCaveat=!1,i=e.getContext("webgl2",s),i.luma||={},i.luma.softwareRenderer=!0),i||(i=e.getContext("webgl",{}),i&&(i=null,n||="Your browser only supports WebGL1")),!i)throw n||="Your browser does not support WebGL",new Error(`Failed to create WebGL context: ${n}`);let{onContextLost:o,onContextRestored:a}=t;return e.addEventListener("webglcontextlost",c=>o(c),!1),e.addEventListener("webglcontextrestored",c=>a(c),!1),i.luma||={},i}function _n(e,t,r){return r[t]===void 0&&(r[t]=e.getExtension(t)||null),r[t]}function AC(e,t){let r=e.getParameter(7936),n=e.getParameter(7937);_n(e,"WEBGL_debug_renderer_info",t);let s=t.WEBGL_debug_renderer_info,i=e.getParameter(s?s.UNMASKED_VENDOR_WEBGL:7936),o=e.getParameter(s?s.UNMASKED_RENDERER_WEBGL:7937),a=i||r,c=o||n,l=e.getParameter(7938),h=TC(a,c),f=Mq(a,c),u=Eq(a,c);return{type:"webgl",gpu:h,gpuType:u,gpuBackend:f,vendor:a,renderer:c,version:l,shadingLanguage:"glsl",shadingLanguageVersion:300}}function TC(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function Mq(e,t){return/Metal/i.exec(e)||/Metal/i.exec(t)?"metal":/ANGLE/i.exec(e)||/ANGLE/i.exec(t)?"opengl":"unknown"}function Eq(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(TC(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function hg(e){switch(e){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(e))}var kh="WEBGL_compressed_texture_s3tc",Uh="WEBGL_compressed_texture_s3tc_srgb",ka="EXT_texture_compression_rgtc",Ua="EXT_texture_compression_bptc",bq="WEBGL_compressed_texture_etc",Sq="WEBGL_compressed_texture_astc",vq="WEBGL_compressed_texture_etc1",wq="WEBGL_compressed_texture_pvrtc",Cq="WEBGL_compressed_texture_atc",MC="EXT_texture_norm16",EC="EXT_render_snorm",Pq="EXT_color_buffer_float",fg={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[EC],"norm16-renderable-webgl":[MC],"snorm16-renderable-webgl":[MC,EC],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[kh,Uh,ka,Ua],"texture-compression-bc5-webgl":[ka],"texture-compression-bc7-webgl":[Ua],"texture-compression-etc2":[bq],"texture-compression-astc":[Sq],"texture-compression-etc1-webgl":[vq],"texture-compression-pvrtc-webgl":[wq],"texture-compression-atc-webgl":[Cq]};function bC(e){return e in fg}function SC(e,t,r){return(fg[t]||[]).every(s=>_n(e,s,r))}var G2={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:Pq,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:kh},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Uh},"bc1-rgba-unorm":{gl:33777,x:kh},"bc1-rgba-unorm-srgb":{gl:35916,x:Uh},"bc2-rgba-unorm":{gl:33778,x:kh},"bc2-rgba-unorm-srgb":{gl:35918,x:Uh},"bc3-rgba-unorm":{gl:33779,x:kh},"bc3-rgba-unorm-srgb":{gl:35919,x:Uh},"bc4-r-unorm":{gl:36283,x:ka},"bc4-r-snorm":{gl:36284,x:ka},"bc5-rg-unorm":{gl:36285,x:ka},"bc5-rg-snorm":{gl:36286,x:ka},"bc6h-rgb-ufloat":{gl:36495,x:Ua},"bc6h-rgb-float":{gl:36494,x:Ua},"bc7-rgba-unorm":{gl:36492,x:Ua},"bc7-rgba-unorm-srgb":{gl:36493,x:Ua},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function vC(e,t,r){let n=t.create,s=G2[t.format];return s?.gl===void 0&&(n=!1),s?.x&&(n=n&&Boolean(_n(e,s.x,r))),{format:t.format,create:n&&t.create,render:n&&t.render,filter:n&&t.filter,blend:n&&t.blend,store:n&&t.store}}function ug(e){let t=G2[e],r=Iq(e),n=ea(e);return{internalFormat:r,format:t?.dataFormat||Rq(n.channels,n.integer,n.normalized,r),type:n.dataType?hg(n.dataType):t?.types?.[0]||5121,compressed:n.compressed||!1}}function wC(e){switch(ea(e).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${e}`)}}function Rq(e,t,r,n){if(n===6408||n===6407)return n;switch(e){case"r":return t&&!r?36244:6403;case"rg":return t&&!r?33320:33319;case"rgb":return t&&!r?36248:6407;case"rgba":return t&&!r?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function Iq(e){let r=G2[e]?.gl;if(r===void 0)throw new Error(`Unsupported texture format ${e}`);return r}var CC={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"},dg=class extends Fl{gl;extensions;testedFeatures=new Set;constructor(t,r,n){super([],n),this.gl=t,this.extensions=r,_n(t,"EXT_color_buffer_float",r)}*[Symbol.iterator](){let t=this.getFeatures();for(let r of t)this.has(r)&&(yield r);return[]}has(t){return this.disabledFeatures?.[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),bC(t)&&SC(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){let t=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(let r of t)this.has(r)}getFeatures(){return[...Object.keys(CC),...Object.keys(fg)]}getWebGLFeature(t){let r=CC[t];return Boolean(typeof r=="string"?_n(this.gl,r,this.extensions):r)}};var pg=class extends Bl{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(t){super(),this.gl=t}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}};var xn=class extends hn{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(t,r){super(t,r);let n=r.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),n||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){let t=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){let n=this.colorAttachments[r];if(n){let s=36064+r;this._attachTextureView(s,n)}}if(this.depthStencilAttachment){let r=wC(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){let r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${Lq(r)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,r){let{gl:n}=this.device,{texture:s}=r,i=r.props.baseMipLevel,o=r.props.baseArrayLayer;switch(n.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:n.framebufferTextureLayer(36160,t,s.handle,i,o);break;case 34067:let a=Oq(o);n.framebufferTexture2D(36160,t,a,s.handle,i);break;case 3553:n.framebufferTexture2D(36160,t,3553,s.handle,i);break;default:throw new Error("Illegal texture type")}n.bindTexture(s.glTarget,null)}};function Oq(e){return e<34069?e+34069:e}function Lq(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}var gg=class extends na{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(t,r){super(r),this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new xn(this.device,{handle:null}),this._framebuffer}update(){let t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){let r=this.getDevicePixelRatio(t?.useDevicePixels);this.setDevicePixelRatio(r,t);return}}commit(){}};async function mg(e,t){let r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");let n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",e),t&&(n.id=t),new Promise((s,i)=>{n.onload=s,n.onerror=o=>i(new Error(`Unable to load script '${e}': ${o}`)),r.appendChild(n)})}var Nq=1,fr=null,PC=!1,_g={debugSpectorJS:F.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function RC(e){if(!globalThis.SPECTOR)try{await mg(e.debugSpectorJSUrl||_g.debugSpectorJSUrl)}catch(t){F.warn(String(t))}}function IC(e){if(e={..._g,...e},!e.debugSpectorJS)return null;if(!fr&&globalThis.SPECTOR&&!globalThis.luma?.spector){F.probe(Nq,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();let{Spector:t}=globalThis.SPECTOR;fr=new t,globalThis.luma&&(globalThis.luma.spector=fr)}if(!fr)return null;if(PC||(PC=!0,fr.spyCanvases(),fr?.onCaptureStarted.add(t=>F.info("Spector capture started:",t)()),fr?.onCapture.add(t=>{F.info("Spector capture complete:",t)(),fr?.getResultUI(),fr?.resultView.display(),fr?.resultView.addCapture(t)})),e.gl){let t=e.gl,r=t.device;fr?.startCapture(e.gl,500),t.device=r,new Promise(n=>setTimeout(n,2e3)).then(n=>{F.info("Spector capture stopped after 2 seconds")(),fr?.stopCapture()})}return fr}var Bq="https://unpkg.com/webgl-debug@2.0.1/index.js";function LC(e){return e.luma=e.luma||{},e.luma}async function NC(){Ve()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await mg(Bq))}function BC(e,t={}){return t.debugWebGL||t.traceWebGL?Dq(e,t):Fq(e)}function Fq(e){let t=LC(e);return t.realContext?t.realContext:e}function Dq(e,t){if(!globalThis.WebGLDebugUtils)return F.warn("webgl-debug not loaded")(),e;let r=LC(e);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...Xs,...e});let n=globalThis.WebGLDebugUtils.makeDebugContext(e,kq.bind(null,t),Uq.bind(null,t));for(let o in Xs)!(o in n)&&typeof Xs[o]=="number"&&(n[o]=Xs[o]);class s{}Object.setPrototypeOf(n,Object.getPrototypeOf(e)),Object.setPrototypeOf(s,n);let i=Object.create(s);return r.realContext=e,r.debugContext=i,i.debug=!0,i}function OC(e,t){t=Array.from(t).map(n=>n===void 0?"undefined":n);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${e}(${r})`}function kq(e,t,r,n){n=Array.from(n).map(a=>a===void 0?"undefined":a);let s=globalThis.WebGLDebugUtils.glEnumToString(t),i=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,n),o=`${s} in gl.${r}(${i})`;F.error(o)();debugger}function Uq(e,t,r){let n="";F.level>=1&&(n=OC(t,r),e.traceWebGL&&F.log(1,n)());for(let s of r)if(s===void 0){n=n||OC(t,r);debugger}}var j2={};function FC(e="id"){j2[e]=j2[e]||1;let t=j2[e]++;return`${e}-${t}`}var Gr=class extends K{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(t,r={}){super(t,r),this.device=t,this.gl=this.device.gl;let n=typeof r=="object"?r.handle:void 0;this.handle=n||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=zq(this.props.usage),this.glUsage=Vq(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(t,r=0,n=t.byteLength+r){let s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,n,this.glUsage),this.gl.bufferSubData(s,r,t),this.gl.bindBuffer(s,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(t,r,n),this.trackAllocatedMemory(n)}_initWithByteLength(t){let r=t;t===0&&(r=new Float32Array(0));let n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,r,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,r,t.byteLength)}async readAsync(t=0,r){return this.readSyncWebGL(t,r)}readSyncWebGL(t=0,r){r=r??this.byteLength-t;let n=new Uint8Array(r),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,n,s,r),this.gl.bindBuffer(36662,null),this._setDebugData(n,t,r),n}};function zq(e){return e&K.INDEX?34963:e&K.VERTEX?34962:e&K.UNIFORM?35345:34962}function Vq(e){return e&K.INDEX||e&K.VERTEX?35044:e&K.UNIFORM?35048:35044}function kC(e){let t=e.split(/\r?\n/),r=[];for(let n of t){if(n.length<=1)continue;let s=n.split(":");if(s.length===2){let[f,u]=s;r.push({message:u.trim(),type:DC(f),lineNum:0,linePos:0});continue}let[i,o,a,...c]=s,l=parseInt(a,10);isNaN(l)&&(l=0);let h=parseInt(o,10);isNaN(h)&&(h=0),r.push({message:c.join(":").trim(),type:DC(i),lineNum:l,linePos:h})}return r}function DC(e){let t=["warning","error","info"],r=e.toLowerCase();return t.includes(r)?r:"info"}var xg=class extends Ps{device;handle;constructor(t,r){switch(super(t,r),this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){let t=this.device.gl.getShaderInfoLog(this.handle);return t?kC(t):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
  ${t}`;let{gl:r}=this.device;if(r.shaderSource(this.handle,t),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}F.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),F.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){let t=async s=>await new Promise(i=>setTimeout(i,s));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}let{gl:n}=this.device;for(;;){if(n.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}};function zC(e,t,r,n){if(jq(t))return n(e);let s=e;s.pushState();try{return Hq(e,t),Hr(s.gl,r),n(e)}finally{s.popState()}}function Hq(e,t){let r=e,{gl:n}=r;if(t.cullMode)switch(t.cullMode){case"none":n.disable(2884);break;case"front":n.enable(2884),n.cullFace(1028);break;case"back":n.enable(2884),n.cullFace(1029);break}if(t.frontFace&&n.frontFace(ro("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&e.features.has("depth-clip-control")&&n.enable(34383),t.depthBias!==void 0&&(n.enable(32823),n.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){let i=r.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=ro("provokingVertex",t.provokingVertex,{first:36429,last:36430});i?.provokingVertexWEBGL(o)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){let i=r.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=ro("polygonMode",t.polygonMode,{fill:6914,line:6913});i?.polygonModeWEBGL(1028,o),i?.polygonModeWEBGL(1029,o)}t.polygonOffsetLine&&n.enable(10754)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&n.enable(12288),t.clipDistance1&&n.enable(12289),t.clipDistance2&&n.enable(12290),t.clipDistance3&&n.enable(12291),t.clipDistance4&&n.enable(12292),t.clipDistance5&&n.enable(12293),t.clipDistance6&&n.enable(12294),t.clipDistance7&&n.enable(12295)),t.depthWriteEnabled!==void 0&&n.depthMask(Gq("depthWriteEnabled",t.depthWriteEnabled)),t.depthCompare&&(t.depthCompare!=="always"?n.enable(2929):n.disable(2929),n.depthFunc(Ag("depthCompare",t.depthCompare))),t.stencilWriteMask){let s=t.stencilWriteMask;n.stencilMaskSeparate(1028,s),n.stencilMaskSeparate(1029,s)}if(t.stencilReadMask&&F.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){let s=t.stencilReadMask||4294967295,i=Ag("depthCompare",t.stencilCompare);t.stencilCompare!=="always"?n.enable(2960):n.disable(2960),n.stencilFuncSeparate(1028,i,0,s),n.stencilFuncSeparate(1029,i,0,s)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){let s=q2("stencilPassOperation",t.stencilPassOperation),i=q2("stencilFailOperation",t.stencilFailOperation),o=q2("stencilDepthFailOperation",t.stencilDepthFailOperation);n.stencilOpSeparate(1028,i,o,s),n.stencilOpSeparate(1029,i,o,s)}switch(t.blend){case!0:n.enable(3042);break;case!1:n.disable(3042);break;default:}if(t.blendColorOperation||t.blendAlphaOperation){let s=UC("blendColorOperation",t.blendColorOperation||"add"),i=UC("blendAlphaOperation",t.blendAlphaOperation||"add");n.blendEquationSeparate(s,i);let o=yg("blendColorSrcFactor",t.blendColorSrcFactor||"one"),a=yg("blendColorDstFactor",t.blendColorDstFactor||"zero"),c=yg("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),l=yg("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");n.blendFuncSeparate(o,a,c,l)}}function Ag(e,t){return ro(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function q2(e,t){return ro(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function UC(e,t){return ro(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function yg(e,t){return ro(e,t,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function Wq(e,t){return`Illegal parameter ${t} for ${e}`}function ro(e,t,r){if(!(t in r))throw new Error(Wq(e,t));return r[t]}function Gq(e,t){return t}function jq(e){let t=!0;for(let r in e){t=!1;break}return t}function Tg(e){let t={};return e.addressModeU&&(t[10242]=X2(e.addressModeU)),e.addressModeV&&(t[10243]=X2(e.addressModeV)),e.addressModeW&&(t[32882]=X2(e.addressModeW)),e.magFilter&&(t[10240]=Y2(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=qq(e.minFilter||"linear",e.mipmapFilter)),e.lodMinClamp!==void 0&&(t[33082]=e.lodMinClamp),e.lodMaxClamp!==void 0&&(t[33083]=e.lodMaxClamp),e.type==="comparison-sampler"&&(t[34892]=34894),e.compare&&(t[34893]=Ag("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function X2(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Y2(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}function qq(e,t="none"){if(!t)return Y2(e);switch(t){case"none":return Y2(e);case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}var no=class extends Rs{device;handle;parameters;constructor(t,r){super(t,r),this.device=t,this.parameters=Tg(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(let[r,n]of Object.entries(t)){let s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,n);break;default:this.device.gl.samplerParameteri(this.handle,s,n);break}}}};var yn=class extends Cs{device;gl;handle;texture;constructor(t,r){super(t,{...Q.defaultProps,...r}),this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}};var Xq="Failed to deduce GL constant from typed array";function VC(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(Xq)}}function HC(e,t){let{clamped:r=!0}=t||{};switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function $2(e){switch(e){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function WC(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function so(e,t,r){if(Yq(t))return r(e);let{nocatch:n=!0}=t,s=Wr.get(e);s.push(),Hr(e,t);let i;if(n)i=r(e),s.pop();else try{i=r(e)}finally{s.pop()}return i}function Yq(e){for(let t in e)return!1;return!0}function GC(e,t,r){let{dimension:n,width:s,height:i,depth:o=0}=r,{glInternalFormat:a}=r,c=r.glTarget;switch(n){case"2d-array":case"3d":e.texStorage3D(c,t,a,s,i,o);break;default:e.texStorage2D(c,t,a,s,i)}}function K2(e,t,r,n){let{width:s,height:i}=n,{dimension:o,depth:a=0,mipLevel:c=0}=n,{x:l=0,y:h=0,z:f=0}=n,{glFormat:u,glType:d}=n,p=qC(n.glTarget,o,a),g=n.flipY?{[37440]:!0}:{};so(e,g,()=>{switch(o){case"2d-array":case"3d":e.bindTexture(p,t),e.texSubImage3D(p,c,l,h,f,s,i,a,u,d,r),e.bindTexture(p,null);break;case"2d":case"cube":e.bindTexture(p,t),e.texSubImage2D(p,c,l,h,s,i,u,d,r),e.bindTexture(p,null);break;default:throw new Error(o)}})}function Z2(e,t,r){let{dimension:n,width:s,height:i,depth:o=0,mipLevel:a=0,byteOffset:c=0}=r,{x:l=0,y:h=0,z:f=0}=r,{glFormat:u,glType:d,compressed:p}=r,g=qC(r.glTarget,n,o);switch(n){case"2d-array":case"3d":p?e.compressedTexSubImage3D(g,a,l,h,f,s,i,o,u,t,c):e.texSubImage3D(g,a,l,h,f,s,i,o,u,d,t,c);break;case"2d":case"cube":p?e.compressedTexSubImage2D(g,a,l,h,s,i,u,t,c):e.texSubImage2D(g,a,l,h,s,i,u,d,t,c);break;default:throw new Error(n)}}function jC(e){switch(e){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866;case"cube-array":break}throw new Error(e)}function qC(e,t,r){return t==="cube"?34069+r:e}function XC(e,t){let{sourceX:r=0,sourceY:n=0,sourceAttachment:s=0}=t||{},{target:i=null,sourceWidth:o,sourceHeight:a,sourceDepth:c,sourceFormat:l,sourceType:h}=t||{},{framebuffer:f,deleteFramebuffer:u}=$C(e),{gl:d,handle:p}=f;o||=f.width,a||=f.height;let g=f.colorAttachments[s]?.texture;if(!g)throw new Error(`Invalid framebuffer attachment ${s}`);c=g?.depth||1,l||=g?.glFormat||6408,h||=g?.glType||5121,i=Kq(i,h,l,o,a,c),h=h||VC(i);let m=d.bindFramebuffer(36160,p);return d.readBuffer(36064+s),d.readPixels(r,n,o,a,l,h,i),d.readBuffer(36064),d.bindFramebuffer(36160,m||null),u&&f.destroy(),i}function YC(e,t){let{target:r,sourceX:n=0,sourceY:s=0,sourceFormat:i=6408,targetByteOffset:o=0}=t||{},{sourceWidth:a,sourceHeight:c,sourceType:l}=t||{},{framebuffer:h,deleteFramebuffer:f}=$C(e);a=a||h.width,c=c||h.height;let u=h;l=l||5121;let d=r;if(!d){let g=$2(i),m=WC(l),_=o+a*c*g*m;d=u.device.createBuffer({byteLength:_})}let p=e.device.createCommandEncoder();return p.copyTextureToBuffer({sourceTexture:e,width:a,height:c,origin:[n,s],destinationBuffer:d,byteOffset:o}),p.destroy(),f&&h.destroy(),d}function $C(e){return e instanceof hn?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:$q(e),deleteFramebuffer:!0}}function $q(e,t){let{device:r,width:n,height:s,id:i}=e;return r.createFramebuffer({...t,id:`framebuffer-for-${i}`,width:n,height:s,colorAttachments:[e]})}function Kq(e,t,r,n,s,i){if(e)return e;t||=5121;let o=HC(t,{clamped:!1}),a=$2(r);return new o(n*s*a)}var An=class extends Q{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(t,r){super(t,r);let n={...this.props};n.data=r.data,this.device=t,this.gl=this.device.gl,this.glTarget=jC(this.props.dimension);let s=ug(this.props.format);this.glInternalFormat=s.internalFormat,this.glFormat=s.format,this.glType=s.type,this.compressed=s.compressed,this.mipmaps=Boolean(this.props.mipmaps),this._initialize(n),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:r,height:n}=t;if(!r||!n){let s=Q.getTextureDataSize(t.data);r=s?.width||1,n=s?.height||1}if(this.width=r,this.height=n,this.depth=t.depth,this.setSampler(t.sampler),this.view=new yn(this.device,{...this.props,texture:this}),this.bind(),GC(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new yn(this.device,{...t,texture:this})}setSampler(t={}){let r;t instanceof no?(this.sampler=t,r=t.props):(this.sampler=new no(this.device,t),r=t);let n=Tg(r);this._setSamplerParameters(n)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(F.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!t?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(n){F.warn(`Error generating mipmap for ${this}: ${n.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){let r=Q.getExternalImageSize(t.image),n={...Q.defaultCopyExternalImageOptions,...r,...t},{image:s,depth:i,mipLevel:o,x:a,y:c,z:l,flipY:h}=n,{width:f,height:u}=n,{dimension:d,glTarget:p,glFormat:g,glInternalFormat:m,glType:_}=this;if(f=Math.min(f,this.width-a),u=Math.min(u,this.height-c),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return K2(this.device.gl,this.handle,s,{dimension:d,mipLevel:o,x:a,y:c,z:l,width:f,height:u,depth:i,glFormat:g,glInternalFormat:m,glType:_,glTarget:p,flipY:h}),{width:n.width,height:n.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t,r=0){this.bind();let n=Q.normalizeTextureData(t,this);n.length>1&&this.props.mipmaps!==!1&&F.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<n.length;s++){let i=n[s];this._setMipLevel(r,s,i)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),Z2(this.device.gl,t,this),this.unbind())}setTextureCubeData(t,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(let n of Q.CubeFaces)this.setTextureCubeFaceData(t[n],n)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,r,n=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&F.warn(`${this.id} has mipmap and multiple LODs.`)();let s=Q.CubeFaces.indexOf(r);this.setTexture2DData(t,s)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){let{face:r,width:n,height:s,pixels:i,data:o,format:a=6408,type:c=5121}=t,{gl:l}=this,h=i||o;this.bind(),h instanceof Promise?h.then(f=>this.setImageDataForFace(Object.assign({},t,{face:r,data:f,pixels:f}))):this.width||this.height?l.texImage2D(r,0,a,n,s,0,a,c,h):l.texImage2D(r,0,a,a,c,h)}_getImageDataMap(t){for(let r=0;r<Q.CubeFaces.length;++r){let n=Q.CubeFaces[r];t[n]&&(t[34069+r]=t[n],delete t[n])}return t}_setSamplerParameters(t){F.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(let[r,n]of Object.entries(t)){let s=Number(r),i=n;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,i);break;case 10241:this.gl.texParameteri(this.glTarget,s,i);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,s,i);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,i);break;default:this.gl.texParameteri(this.glTarget,s,i);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,r,n,s=this.glTarget){if(Q.isExternalImage(n)){K2(this.device.gl,this.handle,n,{...this,depth:t,mipLevel:r,glTarget:s,flipY:this.props.flipY});return}if(Q.isTextureLevelData(n)){Z2(this.device.gl,n.data,{...this,depth:t,mipLevel:r,glTarget:s});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){let{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,this.handle),t}unbind(t){let{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,null),t}};var Zq=[1,2,4,8],Mg=class extends kn{device;glParameters;constructor(t,r){super(t,r),this.device=t;let n;if(!r?.parameters?.viewport)if(r?.framebuffer){let{width:s,height:i}=r.framebuffer;n=[0,0,s,i]}else{let[s,i]=t.getCanvasContext().getDrawingBufferSize();n=[0,0,s,i]}if(this.device.pushState(),this.setParameters({viewport:n,...this.props.parameters}),this.props.framebuffer){let s=this.props.framebuffer.colorAttachments.map((i,o)=>36064+o);this.device.gl.drawBuffers(s)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){let r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(r.viewport=t.viewport.slice(0,4),r.depthRange=[t.viewport[4],t.viewport[5]]):r.viewport=t.viewport),t.scissorRect&&(r.scissorTest=!0,r.scissor=t.scissorRect),t.blendConstant&&(r.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(r.colorMask=Zq.map(n=>Boolean(n&t.colorMask))),this.glParameters=r,Hr(this.device.gl,r)}beginOcclusionQuery(t){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){let t={...this.glParameters},r=0;this.props.clearColors&&this.props.clearColors.forEach((n,s)=>{n&&this.clearColorBuffer(s,n)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,t.clearStencil=this.props.clearStencil),r!==0&&so(this.device.gl,t,()=>{this.device.gl.clear(r)})}clearColorBuffer(t=0,r=[0,0,0,0]){so(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}};function KC(e){return Jq.includes(e)}var Jq=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],ZC={[5126]:[5126,1,"float","f32","float32"],[35664]:[5126,2,"vec2","vec2<f32>","float32x2"],[35665]:[5126,3,"vec3","vec3<f32>","float32x3"],[35666]:[5126,4,"vec4","vec4<f32>","float32x4"],[5124]:[5124,1,"int","i32","sint32"],[35667]:[5124,2,"ivec2","vec2<i32>","sint32x2"],[35668]:[5124,3,"ivec3","vec3<i32>","sint32x3"],[35669]:[5124,4,"ivec4","vec4<i32>","sint32x4"],[5125]:[5125,1,"uint","u32","uint32"],[36294]:[5125,2,"uvec2","vec2<u32>","uint32x2"],[36295]:[5125,3,"uvec3","vec3<u32>","uint32x3"],[36296]:[5125,4,"uvec4","vec4<u32>","uint32x4"],[35670]:[5126,1,"bool","f32","float32"],[35671]:[5126,2,"bvec2","vec2<f32>","float32x2"],[35672]:[5126,3,"bvec3","vec3<f32>","float32x3"],[35673]:[5126,4,"bvec4","vec4<f32>","float32x4"],[35674]:[5126,8,"mat2","mat2x2<f32>"],[35685]:[5126,8,"mat2x3","mat2x3<f32>"],[35686]:[5126,8,"mat2x4","mat2x4<f32>"],[35687]:[5126,12,"mat3x2","mat3x2<f32>"],[35675]:[5126,12,"mat3","mat3x3<f32>"],[35688]:[5126,12,"mat3x4","mat3x4<f32>"],[35689]:[5126,16,"mat4x2","mat4x2<f32>"],[35690]:[5126,16,"mat4x3","mat4x3<f32>"],[35676]:[5126,16,"mat4","mat4x4<f32>"]};function J2(e){let t=ZC[e];if(!t)throw new Error("uniform");let[r,n,,s]=t;return{format:s,components:n,glType:r}}function JC(e){let t=ZC[e];if(!t)throw new Error("attribute");let[,r,,n,s]=t;return{attributeType:n,vertexFormat:s,components:r}}function QC(e,t){let r={attributes:[],bindings:[]};r.attributes=Qq(e,t);let n=rX(e,t);for(let a of n){let c=a.uniforms.map(l=>({name:l.name,format:l.format,byteOffset:l.byteOffset,byteStride:l.byteStride,arrayLength:l.arrayLength}));r.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:c})}let s=eX(e,t),i=0;for(let a of s)if(KC(a.type)){let{viewDimension:c,sampleType:l}=sX(a.type);r.bindings.push({type:"texture",name:a.name,group:0,location:i,viewDimension:c,sampleType:l}),a.textureUnit=i,i+=1}s.length&&(r.uniforms=s);let o=tX(e,t);return o?.length&&(r.varyings=o),r}function Qq(e,t){let r=[],n=e.getProgramParameter(t,35721);for(let s=0;s<n;s++){let i=e.getActiveAttrib(t,s);if(!i)throw new Error("activeInfo");let{name:o,type:a}=i,c=e.getAttribLocation(t,o);if(c>=0){let{attributeType:l}=JC(a),h=/instance/i.test(o)?"instance":"vertex";r.push({name:o,location:c,stepMode:h,type:l})}}return r.sort((s,i)=>s.location-i.location),r}function tX(e,t){let r=[],n=e.getProgramParameter(t,35971);for(let s=0;s<n;s++){let i=e.getTransformFeedbackVarying(t,s);if(!i)throw new Error("activeInfo");let{name:o,type:a,size:c}=i,{glType:l,components:h}=J2(a),f={location:s,name:o,type:l,size:c*h};r.push(f)}return r.sort((s,i)=>s.location-i.location),r}function eX(e,t){let r=[],n=e.getProgramParameter(t,35718);for(let s=0;s<n;s++){let i=e.getActiveUniform(t,s);if(!i)throw new Error("activeInfo");let{name:o,size:a,type:c}=i,{name:l,isArray:h}=iX(o),f=e.getUniformLocation(t,l),u={location:f,name:l,size:a,type:c,isArray:h};if(r.push(u),u.size>1)for(let d=0;d<u.size;d++){let p=`${l}[${d}]`;f=e.getUniformLocation(t,p);let g={...u,name:p,location:f};r.push(g)}}return r}function rX(e,t){let r=(i,o)=>e.getActiveUniformBlockParameter(t,i,o),n=[],s=e.getProgramParameter(t,35382);for(let i=0;i<s;i++){let o={name:e.getActiveUniformBlockName(t,i)||"",location:r(i,35391),byteLength:r(i,35392),vertex:r(i,35396),fragment:r(i,35398),uniformCount:r(i,35394),uniforms:[]},a=r(i,35395)||[],c=e.getActiveUniforms(t,a,35383),l=e.getActiveUniforms(t,a,35384),h=e.getActiveUniforms(t,a,35387),f=e.getActiveUniforms(t,a,35388);for(let u=0;u<o.uniformCount;++u){let d=e.getActiveUniform(t,a[u]);if(!d)throw new Error("activeInfo");o.uniforms.push({name:d.name,format:J2(c[u]).format,type:c[u],arrayLength:l[u],byteOffset:h[u],byteStride:f[u]})}n.push(o)}return n.sort((i,o)=>i.location-o.location),n}var nX={[35678]:["2d","float"],[35680]:["cube","float"],[35679]:["3d","float"],[35682]:["3d","depth"],[36289]:["2d-array","float"],[36292]:["2d-array","depth"],[36293]:["cube","float"],[36298]:["2d","sint"],[36299]:["3d","sint"],[36300]:["cube","sint"],[36303]:["2d-array","uint"],[36306]:["2d","uint"],[36307]:["3d","uint"],[36308]:["cube","uint"],[36311]:["2d-array","uint"]};function sX(e){let t=nX[e];if(!t)throw new Error("sampler");let[r,n]=t;return{viewDimension:r,sampleType:n}}function iX(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};let r=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!r||r.length<2)throw new Error(`Failed to parse GLSL uniform name ${e}`);return{name:r[1],length:r[2]?1:0,isArray:Boolean(r[2])}}function tP(e,t,r,n){let s=e,i=n;i===!0&&(i=1),i===!1&&(i=0);let o=typeof i=="number"?[i]:i;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof n!="number")throw new Error("samplers must be set to integers");return e.uniform1i(t,n);case 5126:return e.uniform1fv(t,o);case 35664:return e.uniform2fv(t,o);case 35665:return e.uniform3fv(t,o);case 35666:return e.uniform4fv(t,o);case 5124:return e.uniform1iv(t,o);case 35667:return e.uniform2iv(t,o);case 35668:return e.uniform3iv(t,o);case 35669:return e.uniform4iv(t,o);case 35670:return e.uniform1iv(t,o);case 35671:return e.uniform2iv(t,o);case 35672:return e.uniform3iv(t,o);case 35673:return e.uniform4iv(t,o);case 5125:return s.uniform1uiv(t,o,1);case 36294:return s.uniform2uiv(t,o,2);case 36295:return s.uniform3uiv(t,o,3);case 36296:return s.uniform4uiv(t,o,4);case 35674:return e.uniformMatrix2fv(t,!1,o);case 35675:return e.uniformMatrix3fv(t,!1,o);case 35676:return e.uniformMatrix4fv(t,!1,o);case 35685:return s.uniformMatrix2x3fv(t,!1,o);case 35686:return s.uniformMatrix2x4fv(t,!1,o);case 35687:return s.uniformMatrix3x2fv(t,!1,o);case 35688:return s.uniformMatrix3x4fv(t,!1,o);case 35689:return s.uniformMatrix4x2fv(t,!1,o);case 35690:return s.uniformMatrix4x3fv(t,!1,o)}throw new Error("Illegal uniform")}function oX(e){return Th(e)!==null||typeof e=="number"||typeof e=="boolean"}function eP(e){let t={bindings:{},uniforms:{}};return Object.keys(e).forEach(r=>{let n=e[r];oX(n)?t.uniforms[r]=n:t.bindings[r]=n}),t}function rP(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(e)}}function nP(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(e)}}var sP=4,Eg=class extends Lr{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(t,r){super(t,r),this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;let{varyings:n,bufferMode:s=35981}=r;n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,s)),this._linkShaders(),F.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=QC(this.device.gl,this.handle),F.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=aX(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,r){for(let[n,s]of Object.entries(t)){let i=this.shaderLayout.bindings.find(o=>o.name===n)||this.shaderLayout.bindings.find(o=>o.name===`${n}Uniforms`);if(!i){let o=this.shaderLayout.bindings.map(a=>`"${a.name}"`).join(", ");r?.disableWarnings||F.warn(`No binding "${n}" in render pipeline "${this.id}", expected one of ${o}`,s)();continue}switch(s||F.warn(`Unsetting binding "${n}" in render pipeline "${this.id}"`)(),i.type){case"uniform":if(!(s instanceof Gr)&&!(s.buffer instanceof Gr))throw new Error("buffer value");break;case"texture":if(!(s instanceof yn||s instanceof An||s instanceof xn))throw new Error("texture value");break;case"sampler":F.warn(`Ignoring sampler ${n}`)();break;default:throw new Error(i.type)}this.bindings[n]=s}}draw(t){let{renderPass:r,parameters:n=this.props.parameters,topology:s=this.props.topology,vertexArray:i,vertexCount:o,instanceCount:a,isInstanced:c=!1,firstVertex:l=0,transformFeedback:h}=t,f=rP(s),u=Boolean(i.indexBuffer),d=i.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return F.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return F.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),i.bindBeforeRender(r),h&&h.begin(this.props.topology),this._applyBindings(),this._applyUniforms();let p=r;return zC(this.device,n,p.glParameters,()=>{u&&c?this.device.gl.drawElementsInstanced(f,o||0,d,l,a||0):u?this.device.gl.drawElements(f,o||0,d,l):c?this.device.gl.drawArraysInstanced(f,l,o||0,a||0):this.device.gl.drawArrays(f,l,o||0),h&&h.end()}),i.unbindAfterRender(r),!0}setUniformsWebGL(t){let{bindings:r}=eP(t);Object.keys(r).forEach(n=>{F.warn(`Unsupported value "${JSON.stringify(r[n])}" used in setUniforms() for key ${n}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){let{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),F.time(sP,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),F.timeEnd(sP,`linkProgram for ${this.id}`)(),F.level,!this.device.features.has("compilation-status-async-webgl")){let n=this._getLinkStatus();this._reportLinkStatus(n);return}F.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),F.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();let r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(t){switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break;case"success":break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break;case"success":break}let r=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${r}`)}}_getLinkStatus(){let{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){let t=async s=>await new Promise(i=>setTimeout(i,s));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}let{gl:n}=this.device;for(;;){if(n.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(let r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(F.warn(`Binding ${r.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;let{gl:t}=this.device;t.useProgram(this.handle);let r=0,n=0;for(let s of this.shaderLayout.bindings){let i=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!i)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":let{name:o}=s,a=t.getUniformBlockIndex(this.handle,o);if(a===4294967295)throw new Error(`Invalid uniform block name ${o}`);t.uniformBlockBinding(this.handle,n,a),i instanceof Gr?t.bindBufferBase(35345,n,i.handle):t.bindBufferRange(35345,n,i.buffer.handle,i.offset||0,i.size||i.buffer.byteLength-i.offset),n+=1;break;case"texture":if(!(i instanceof yn||i instanceof An||i instanceof xn))throw new Error("texture");let c;if(i instanceof yn)c=i.texture;else if(i instanceof An)c=i;else if(i instanceof xn&&i.colorAttachments[0]instanceof yn)F.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),c=i.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+r),t.bindTexture(c.glTarget,c.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(let t of this.shaderLayout.uniforms||[]){let{name:r,location:n,type:s,textureUnit:i}=t,o=this.uniforms[r]??i;o!==void 0&&tP(this.device.gl,n,s,o)}}};function aX(e,t){let r={...e,attributes:e.attributes.map(n=>({...n}))};for(let n of t?.attributes||[]){let s=r.attributes.find(i=>i.name===n.name);s?(s.type=n.type||s.type,s.stepMode=n.stepMode||s.stepMode):F.warn(`shader layout attribute ${n.name} not present in shader`)}return r}var bg=class extends ia{device;commands=[];constructor(t){super(t,{}),this.device=t}submitCommands(t=this.commands){for(let r of t)switch(r.name){case"copy-buffer-to-buffer":cX(this.device,r.options);break;case"copy-buffer-to-texture":lX(this.device,r.options);break;case"copy-texture-to-buffer":hX(this.device,r.options);break;case"copy-texture-to-texture":fX(this.device,r.options);break;default:throw new Error(r.name)}}};function cX(e,t){let r=t.sourceBuffer,n=t.destinationBuffer;e.gl.bindBuffer(36662,r.handle),e.gl.bindBuffer(36663,n.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}function lX(e,t){throw new Error("Not implemented")}function hX(e,t){let{sourceTexture:r,mipLevel:n=0,aspect:s="all",width:i=t.sourceTexture.width,height:o=t.sourceTexture.height,depthOrArrayLayers:a=0,origin:c=[0,0],destinationBuffer:l,byteOffset:h=0,bytesPerRow:f,rowsPerImage:u}=t;if(s!=="all")throw new Error("aspect not supported in WebGL");if(n!==0||a!==0||f||u)throw new Error("not implemented");let{framebuffer:d,destroyFramebuffer:p}=iP(r),g;try{let m=l,_=i||d.width,y=o||d.height,x=ug(d.colorAttachments[0].texture.props.format),A=x.format,M=x.type;e.gl.bindBuffer(35051,m.handle),g=e.gl.bindFramebuffer(36160,d.handle),e.gl.readPixels(c[0],c[1],_,y,A,M,h)}finally{e.gl.bindBuffer(35051,null),g!==void 0&&e.gl.bindFramebuffer(36160,g),p&&d.destroy()}}function fX(e,t){let{sourceTexture:r,destinationMipLevel:n=0,origin:s=[0,0],destinationOrigin:i=[0,0],destinationTexture:o}=t,{width:a=t.destinationTexture.width,height:c=t.destinationTexture.height}=t,{framebuffer:l,destroyFramebuffer:h}=iP(r),[f,u]=s,[d,p,g]=i,m=e.gl.bindFramebuffer(36160,l.handle),_=null,y;if(o instanceof An)_=o,a=Number.isFinite(a)?a:_.width,c=Number.isFinite(c)?c:_.height,_.bind(0),y=_.glTarget;else throw new Error("invalid destination");switch(y){case 3553:case 34067:e.gl.copyTexSubImage2D(y,n,d,p,f,u,a,c);break;case 35866:case 32879:e.gl.copyTexSubImage3D(y,n,d,p,g,f,u,a,c);break;default:}_&&_.unbind(),e.gl.bindFramebuffer(36160,m),h&&l.destroy()}function iP(e){if(e instanceof Q){let{width:t,height:r,id:n}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${n}`,width:t,height:r,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}var Sg=class extends sa{device;commandBuffer;constructor(t,r){super(t,r),this.device=t,this.commandBuffer=new bg(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,r,n){}};function oP(e){let{target:t,source:r,start:n=0,count:s=1}=e,i=r.length,o=s*i,a=0;for(let c=n;a<i;a++)t[c++]=r[a];for(;a<o;)a<o-a?(t.copyWithin(n+a,n,n+a),a*=2):(t.copyWithin(n+a,n,n+o-a),a=o);return e.target}var za=class extends oa{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(t){return T_()==="Chrome"}constructor(t,r){super(t,r),this.device=t,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){let r=t;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(t,r){let n=r;if(n.glTarget===34963)throw new Error("Use .setIndexBuffer()");let{size:s,type:i,stride:o,offset:a,normalized:c,integer:l,divisor:h}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,n.handle),l?this.device.gl.vertexAttribIPointer(t,s,i,o,a):this.device.gl.vertexAttribPointer(t,s,i,c,o,a),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,h||0),this.attributes[t]=n,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,r){this._enable(t,!1),this.attributes[t]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){let r=this.attributes[t];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(t,r)}}_getAccessor(t){let r=this.attributeInfos[t];if(!r)throw new Error(`Unknown attribute location ${t}`);let n=hg(r.bufferDataType);return{size:r.bufferComponents,type:n,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(t,r=!0){let s=za.isConstantAttributeZeroSupported(this.device)||t!==0;(r||s)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,r){let n=uX(r),s=n.byteLength*t,i=n.length*t;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let o=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),o=o||!dX(n,this.bufferValue),o){let a=Ox(r.constructor,i);oP({target:a,source:n,start:0,count:i}),this.buffer.write(a),this.bufferValue=r}return this.buffer}};function uX(e){return Array.isArray(e)?new Float32Array(e):e}function dX(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}var vg=class extends aa{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(t,r){super(t,r),this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(nP(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(let r in t)this.setBuffer(r,t[r])})}setBuffer(t,r){let n=this._getVaryingIndex(t),{buffer:s,byteLength:i,byteOffset:o}=this._getBufferRange(r);if(n<0){this.unusedBuffers[t]=s,F.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[n]={buffer:s,byteLength:i,byteOffset:o},this.bindOnUse||this._bindBuffer(n,s,o,i)}getBuffer(t){if(aP(t))return this.buffers[t]||null;let r=this._getVaryingIndex(t);return r>=0?this.buffers[r]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let r;return this._bound?r=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof Gr)return{buffer:t,byteOffset:0,byteLength:t.byteLength};let{buffer:r,byteOffset:n=0,byteLength:s=t.buffer.byteLength}=t;return{buffer:r,byteOffset:n,byteLength:s}}_getVaryingIndex(t){if(aP(t))return Number(t);for(let r of this.layout.varyings)if(t===r.name)return r.location;return-1}_bindBuffers(){for(let t in this.buffers){let{buffer:r,byteLength:n,byteOffset:s}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),r,s,n)}}_unbindBuffers(){for(let t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,r,n=0,s){let i=r&&r.handle;!i||s===void 0?this.gl.bindBufferBase(35982,t,i):this.gl.bindBufferRange(35982,t,i,n,s)}};function aP(e){return typeof e=="number"?Number.isInteger(e):/^\d+$/.test(e)}var wg=class extends ca{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(t,r){if(super(t,r),this.device=t,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;let t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((n,s)=>{let i=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):r++>t?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(i)};requestAnimationFrame(i)}),this._pollingPromise}};var be=class extends Ze{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(t){if(super({...t,id:t.id||FC("webgl-device")}),!t.createCanvasContext)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let r=t.createCanvasContext===!0?{}:t.createCanvasContext,n=r.canvas?.gl?.device;if(n)throw new Error(`WebGL context already attached to device ${n.id}`);this.canvasContext=new gg(this,r),this.lost=new Promise(h=>{this._resolveContextLost=h});let s={...t.webgl};r.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),t.powerPreference!==void 0&&(s.powerPreference=t.powerPreference);let o=this.props._handle||yC(this.canvasContext.canvas,{onContextLost:h=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:h=>console.log("WebGL context restored")},s);if(!o)throw new Error("WebGL context creation failed");if(n=o.device,n)throw new Error(`WebGL context already attached to device ${n.id}`);this.handle=o,this.gl=o,this.spectorJS=IC({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=AC(this.gl,this._extensions),this.limits=new pg(this.gl),this.features=new dg(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new Wr(this.gl,{log:(...h)=>F.log(1,...h)()}).trackState(this.gl,{copyState:!1});let c=t.debugWebGL||t.debug,l=t.debugWebGL;c&&(this.gl=BC(this.gl,{debugWebGL:c,traceWebGL:l}),F.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(F.level=Math.max(F.level,1)))}destroy(){}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){let r=this._normalizeBufferProps(t);return new Gr(this,r)}createTexture(t){return new An(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new no(this,t)}createShader(t){return new xg(this,t)}createFramebuffer(t){return new xn(this,t)}createVertexArray(t){return new za(this,t)}createTransformFeedback(t){return new vg(this,t)}createQuerySet(t){return new wg(this,t)}createRenderPipeline(t){return new Eg(this,t)}beginRenderPass(t){return new Mg(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(t={}){return new Sg(this,t)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(t,r){return XC(t,r)}readPixelsToBufferWebGL(t,r){return YC(t,r)}setParametersWebGL(t){Hr(this.gl,t)}getParametersWebGL(t){return lg(this.gl,t)}withParametersWebGL(t,r){return so(this.gl,t,r)}resetWebGL(){F.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),mC(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return vC(this.gl,t,this._extensions)}loseDevice(){let t=!1,n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(t=!0,n.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){Wr.get(this.gl).push()}popState(){Wr.get(this.gl).pop()}setSpectorMetadata(t,r){t.__SPECTOR_Metadata=r}getGLKey(t,r){let n=Number(t);for(let s in this.gl)if(this.gl[s]===n)return`GL.${s}`;return r?.emptyIfUnknown?"":String(t)}getGLKeys(t){let r={emptyIfUnknown:!0};return Object.entries(t).reduce((n,[s,i])=>(n[`${s}:${this.getGLKey(s,r)}`]=`${i}:${this.getGLKey(i,r)}`,n),{})}_constants;setConstantAttributeWebGL(t,r){let n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);let s=this._constants[t];switch(s&&_X(s,r)&&F.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=r,r.constructor){case Float32Array:pX(this,t,r);break;case Int32Array:gX(this,t,r);break;case Uint32Array:mX(this,t,r);break;default:throw new Error("constant")}}getExtension(t){return _n(this.gl,t,this._extensions),this._extensions}};function pX(e,t,r){switch(r.length){case 1:e.gl.vertexAttrib1fv(t,r);break;case 2:e.gl.vertexAttrib2fv(t,r);break;case 3:e.gl.vertexAttrib3fv(t,r);break;case 4:e.gl.vertexAttrib4fv(t,r);break;default:}}function gX(e,t,r){e.gl.vertexAttribI4iv(t,r)}function mX(e,t,r){e.gl.vertexAttribI4uiv(t,r)}function _X(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}var xX={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},yX=e=>({drawBuffersWEBGL(t){return e.drawBuffers(t)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),AX=e=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return e.createVertexArray()},deleteVertexArrayOES(t){return e.deleteVertexArray(t)},isVertexArrayOES(t){return e.isVertexArray(t)},bindVertexArrayOES(t){return e.bindVertexArray(t)}}),TX=e=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...t){return e.drawArraysInstanced(...t)},drawElementsInstancedANGLE(...t){return e.drawElementsInstanced(...t)},vertexAttribDivisorANGLE(...t){return e.vertexAttribDivisor(...t)}});function cP(e=!0){let t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext){t.getContext=t.originalGetContext,t.originalGetContext=void 0;return}t.originalGetContext=t.getContext,t.getContext=function(r,n){if(r==="webgl"||r==="experimental-webgl"){let s=this.originalGetContext("webgl2",n);return s instanceof HTMLElement&&MX(s),s}return this.originalGetContext(r,n)}}function MX(e){e.getExtension("EXT_color_buffer_float");let t={...xX,WEBGL_disjoint_timer_query:e.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:yX(e),OES_vertex_array_object:AX(e),ANGLE_instanced_arrays:TX(e)},r=e.getExtension;e.getExtension=function(s){let i=r.call(e,s);return i||(s in t?t[s]:null)};let n=e.getSupportedExtensions;e.getSupportedExtensions=function(){return(n.apply(e)||[])?.concat(Object.keys(t))}}var Cg=1,Q2=class extends kl{type="webgl";constructor(){super(),Ze.defaultProps={...Ze.defaultProps,..._g},be.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(t){cP(t)}async attach(t){if(t instanceof be)return t;if(t?.device instanceof Ze)return t.device;if(!EX(t))throw new Error("Invalid WebGL2RenderingContext");return new be({_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1}})}async create(t={}){F.groupCollapsed(Cg,"WebGLDevice created")();let r=[];(t.debugWebGL||t.debug)&&r.push(NC()),t.debugSpectorJS&&r.push(RC(t));let n=await Promise.allSettled(r);for(let o of n)o.status==="rejected"&&F.error(`Failed to initialize debug libraries ${o.reason}`)();let s=new be(t),i=`Created ${s.type}${s.debug?" debug":""} context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return F.probe(Cg,i)(),F.table(Cg,s.info)(),F.groupEnd(Cg)(),s}};function EX(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:Boolean(e&&Number.isFinite(e._version))}var Pg=new Q2;function Ys(){}var bX=({isDragging:e})=>e?"grabbing":"grab",lP={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Ys,onWebGLInitialized:Ys,onResize:Ys,onViewStateChange:Ys,onInteractionStateChange:Ys,onBeforeRender:Ys,onAfterRender:Ys,onLoad:Ys,onError:e=>k.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:bX,getTooltip:null,debug:!1,drawPickingColors:!1},zh=class{constructor(t){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new we({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=n=>{let{_pickRequest:s}=this;if(n.type==="pointerleave")s.x=-1,s.y=-1,s.radius=0;else{if(n.leftButton||n.rightButton)return;{let i=n.offsetCenter;if(!i)return;s.x=i.x,s.y=i.y,s.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:s.x,y:s.y}),s.event=n},this._onEvent=n=>{let s=lh[n.type],i=n.offsetCenter;if(!s||!i||!this.layerManager)return;let o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:o,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:c}=a,l=c&&(c[s]||c.props[s]),h=this.props[s],f=!1;l&&(f=l.call(c,a,n)),f||(h?.(a,n),this.widgetManager.onEvent(a,n))},this._onPointerDown=n=>{let s=n.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:s.x,y:s.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo},this.props={...lP,...t},t=this.props,t.viewState&&t.initialViewState&&k.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,t.device&&(this.device=t.device);let r=this.device;!r&&t.gl&&(t.gl instanceof WebGLRenderingContext&&k.error("WebGL1 context not supported.")(),r=Pg.attach(t.gl)),r||(r=ws.createDevice({type:"best-available",adapters:[Pg],...t.deviceProps,createCanvasContext:{canvas:this._createCanvas(t),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(r,t),this.setProps(t),t._typedArrayManagerProps&&kr.setOptions(t._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(t){this.stats.get("setProps Time").timeStart(),"onLayerHover"in t&&k.removed("onLayerHover","onHover")(),"onLayerClick"in t&&k.removed("onLayerClick","onClick")(),t.initialViewState&&!tt(this.props.initialViewState,t.initialViewState,3)&&(this.viewState=t.initialViewState),Object.assign(this.props,t),this._setCanvasSize(this.props);let r=Object.create(this.props);Object.assign(r,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(r),this.layerManager&&(this.viewManager.setProps(r),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(r),this.effectManager.setProps(r),this.deckRenderer.setProps(r),this.deckPicker.setProps(r),this.widgetManager.setProps(r)),this.stats.get("setProps Time").timeEnd()}needsRedraw(t={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let r=this._needsRedraw;t.clearRedrawFlags&&(this._needsRedraw=!1);let n=this.viewManager.needsRedraw(t),s=this.layerManager.needsRedraw(t),i=this.effectManager.needsRedraw(t),o=this.deckRenderer.needsRedraw(t);return r=r||n||s||i||o,r}redraw(t){if(!this.layerManager)return;let r=this.needsRedraw({clearRedrawFlags:!0});r=t||r,r&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(r):this._drawLayers(r))}get isInitialized(){return this.viewManager!==null}getViews(){return yt(this.viewManager),this.viewManager.views}getViewports(t){return yt(this.viewManager),this.viewManager.getViewports(t)}getCanvas(){return this.canvas}pickObject(t){let r=this._pick("pickObject","pickObject Time",t).result;return r.length?r[0]:null}pickMultipleObjects(t){return t.depth=t.depth||10,this._pick("pickObject","pickMultipleObjects Time",t).result}pickObjects(t){return this._pick("pickObjects","pickObjects Time",t)}_addResources(t,r=!1){for(let n in t)this.layerManager.resourceManager.add({resourceId:n,data:t[n],forceUpdate:r})}_removeResources(t){for(let r of t)this.layerManager.resourceManager.remove(r)}_addDefaultEffect(t){this.effectManager.addDefaultEffect(t)}_addDefaultShaderModule(t){this.layerManager.addDefaultShaderModule(t)}_removeDefaultShaderModule(t){this.layerManager?.removeDefaultShaderModule(t)}_pick(t,r,n){yt(this.deckPicker);let{stats:s}=this;s.get("Pick Count").incrementCount(),s.get(r).timeStart();let i=this.deckPicker[t]({layers:this.layerManager.getLayers(n),views:this.viewManager.getViews(),viewports:this.getViewports(n),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...n});return s.get(r).timeEnd(),i}_createCanvas(t){let r=t.canvas;return typeof r=="string"&&(r=document.getElementById(r),yt(r)),r||(r=document.createElement("canvas"),r.id=t.id||"deckgl-overlay",(t.parent||document.body).appendChild(r)),Object.assign(r.style,t.style),r}_setCanvasSize(t){if(!this.canvas)return;let{width:r,height:n}=t;if(r||r===0){let s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.width=s}if(n||n===0){let s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.position=t.style?.position||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){let{canvas:t}=this;if(!t)return;let r=t.clientWidth??t.width,n=t.clientHeight??t.height;(r!==this.width||n!==this.height)&&(this.width=r,this.height=n,this.viewManager?.setProps({width:r,height:n}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:r,height:n}))}_createAnimationLoop(t,r){let{gl:n,onError:s,useDevicePixels:i}=r;return new xh({device:t,useDevicePixels:i,autoResizeDrawingBuffer:!n,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:s})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let{views:t}=this.props,r=Array.isArray(t)?t:t?[t]:[new qs({id:"default-view"})];return r.length&&this.props.controller&&(r[0].props.controller=this.props.controller),r}_onContextLost(){let{onError:t}=this.props;this.animationLoop&&t&&t(new Error("WebGL context is lost"))}_pickAndCallback(){let{_pickRequest:t}=this;if(t.event){let{result:r,emptyInfo:n}=this._pick("pickObject","pickObject Time",t);this.cursorState.isHovering=r.length>0;let s=n,i=!1;for(let o of r)s=o,i=o.layer?.onHover(o,t.event)||i;i||(this.props.onHover?.(s,t.event),this.widgetManager.onHover(s,t.event)),t.event=null}}_updateCursor(){let t=this.props.parent||this.canvas;t&&(t.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(t){if(this.device=t,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device instanceof be&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof be&&this.props.onWebGLInitialized(this.device.gl);let r=new Ki;r.play(),this.animationLoop.attachTimeline(r),this.eventManager=new ch(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(T2).map(s=>{let[i,o,a,c]=T2[s],l=this.props.eventRecognizerOptions?.[s],h={...o,...l,event:s};return{recognizer:new i(h),recognizeWith:a,requestFailure:c}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(let s in lh)this.eventManager.on(s,this._onEvent);this.viewManager=new Ch({timeline:r,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});let n=this.viewManager.getViewports()[0];this.layerManager=new Ji(this.device,{deck:this,stats:this.stats,viewport:n,timeline:r}),this.effectManager=new Oh({deck:this,device:this.device}),this.deckRenderer=new eo(this.device),this.deckPicker=new Nh(this.device),this.widgetManager=new cg({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new Bh),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(t,r){let{device:n,gl:s}=this.layerManager.context;this.props.onBeforeRender({device:n,gl:s});let i={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...r};this.deckRenderer?.renderLayers(i),i.pass==="screen"&&this.widgetManager.onRedraw({viewports:i.viewports,layers:i.layers}),this.props.onAfterRender({device:n,gl:s})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),k.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(t){let r=this.props.onViewStateChange(t)||t.viewState;this.viewState&&(this.viewState={...this.viewState,[t.viewId]:r},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(t){this.cursorState.isDragging=t.isDragging||!1,this.props.onInteractionStateChange(t)}_getFrameStats(){let{stats:t}=this;t.get("frameRate").timeEnd(),t.get("frameRate").timeStart();let r=this.animationLoop.stats;t.get("GPU Time").addTime(r.get("GPU Time").lastTiming),t.get("CPU Time").addTime(r.get("CPU Time").lastTiming)}_getMetrics(){let{metrics:t,stats:r}=this;t.fps=r.get("frameRate").getHz(),t.setPropsTime=r.get("setProps Time").time,t.updateAttributesTime=r.get("Update Attributes").time,t.framesRedrawn=r.get("Redraw Count").count,t.pickTime=r.get("pickObject Time").time+r.get("pickMultipleObjects Time").time+r.get("pickObjects Time").time,t.pickCount=r.get("Pick Count").count,t.gpuTime=r.get("GPU Time").time,t.cpuTime=r.get("CPU Time").time,t.gpuTimePerFrame=r.get("GPU Time").getAverageTime(),t.cpuTimePerFrame=r.get("CPU Time").getAverageTime();let n=ws.stats.get("Memory Usage");t.bufferMemory=n.get("Buffer Memory").count,t.textureMemory=n.get("Texture Memory").count,t.renderbufferMemory=n.get("Renderbuffer Memory").count,t.gpuMemory=n.get("GPU Memory").count}};zh.defaultProps=lP;zh.VERSION=Rd;var jr=zh;function hP(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return zl(e)}}var fP=Gd;function Vh(e,t){return{attribute:e,format:t.size>1?`${t.type}x${t.size}`:t.type,byteOffset:t.offset||0}}function $s(e){return e.stride||e.size*e.bytesPerElement}function uP(e,t){return e.type===t.type&&e.size===t.size&&$s(e)===$s(t)&&(e.offset||0)===(t.offset||0)}function tA(e,t){t.offset&&k.removed("shaderAttribute.offset","vertexOffset, elementOffset")();let r=$s(e),n=t.vertexOffset!==void 0?t.vertexOffset:e.vertexOffset||0,s=t.elementOffset||0,i=n*r+s*e.bytesPerElement+(e.offset||0);return{...t,offset:i,stride:r}}function SX(e,t){let r=tA(e,t);return{high:r,low:{...r,offset:r.offset+e.size*4}}}var Hh=class{constructor(t,r,n){this._buffer=null,this.device=t,this.id=r.id||"",this.size=r.size||1;let s=r.logicalType||r.type,i=s==="float64",{defaultValue:o}=r;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;i?a="float32":!s&&r.isIndexed?a="uint32":a=s||"float32";let c=hP(s||a);this.doublePrecision=i,i&&r.fp64===!1&&(c=Float32Array),this.value=null,this.settings={...r,defaultType:c,defaultValue:o,logicalType:s,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:c.BYTES_PER_ELEMENT},this.state={...n,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){let t=this.getAccessor();return t.vertexOffset?t.vertexOffset*$s(t):0}get numInstances(){return this.state.numInstances}set numInstances(t){this.state.numInstances=t}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),kr.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(t=this.id,r=null){let n={};if(this.state.constant){let s=this.value;if(r){let i=tA(this.getAccessor(),r),o=i.offset/s.BYTES_PER_ELEMENT,a=i.size||this.size;n[t]=s.subarray(o,o+a)}else n[t]=s}else n[t]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?n[`${t}64Low`]=n[t]:n[`${t}64Low`]=new Float32Array(this.size)),n}_getBufferLayout(t=this.id,r=null){let n=this.getAccessor(),s=[],i={name:this.id,byteStride:$s(n),attributes:s};if(this.doublePrecision){let o=SX(n,r||{});s.push(Vh(t,{...n,...o.high}),Vh(`${t}64Low`,{...n,...o.low}))}else if(r){let o=tA(n,r);s.push(Vh(t,{...n,...o}))}else s.push(Vh(t,n));return i}setAccessor(t){this.state.bufferAccessor=t}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let t=null;if(this.state.constant&&this.value){let r=Array.from(this.value);t=[r,r]}else{let{value:r,numInstances:n,size:s}=this,i=n*s;if(r&&i&&r.length>=i){let o=new Array(s).fill(1/0),a=new Array(s).fill(-1/0);for(let c=0;c<i;)for(let l=0;l<s;l++){let h=r[c++];h<o[l]&&(o[l]=h),h>a[l]&&(a[l]=h)}t=[o,a]}}return this.state.bounds=t,t}setData(t){let{state:r}=this,n;ArrayBuffer.isView(t)?n={value:t}:t instanceof K?n={buffer:t}:n=t;let s={...this.settings,...n};if(ArrayBuffer.isView(n.value)){if(!n.type)if(this.doublePrecision&&n.value instanceof Float64Array)s.type="float32";else{let o=fP(n.value);s.type=s.normalized?o.replace("int","norm"):o}s.bytesPerElement=n.value.BYTES_PER_ELEMENT,s.stride=$s(s)}if(r.bounds=null,n.constant){let i=n.value;if(i=this._normalizeValue(i,[],0),this.settings.normalized&&(i=this.normalizeConstant(i)),!(!r.constant||!this._areValuesEqual(i,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(i)?i:new Float32Array(i)}else if(n.buffer){let i=n.buffer;r.externalBuffer=i,r.constant=!1,this.value=n.value||null}else if(n.value){this._checkExternalBuffer(n);let i=n.value;r.externalBuffer=null,r.constant=!1,this.value=i;let{buffer:o}=this,a=$s(s),c=(s.vertexOffset||0)*a;if(this.doublePrecision&&i instanceof Float64Array&&(i=$p(i,s)),this.settings.isIndexed){let h=this.settings.defaultType;i.constructor!==h&&(i=new h(i))}let l=i.byteLength+c+a*2;(!o||o.byteLength<l)&&(o=this._createBuffer(l)),o.write(i,c)}return this.setAccessor(s),!0}updateSubBuffer(t={}){this.state.bounds=null;let r=this.value,{startOffset:n=0,endOffset:s}=t;this.buffer.write(this.doublePrecision&&r instanceof Float64Array?$p(r,{size:this.size,startIndex:n,endIndex:s}):r.subarray(n,s),n*r.BYTES_PER_ELEMENT+this.byteOffset)}allocate(t,r=!1){let{state:n}=this,s=n.allocatedValue,i=kr.allocate(s,t+1,{size:this.size,type:this.settings.defaultType,copy:r});this.value=i;let{byteOffset:o}=this,{buffer:a}=this;return(!a||a.byteLength<i.byteLength+o)&&(a=this._createBuffer(i.byteLength+o),r&&s&&a.write(s instanceof Float64Array?$p(s,this):s,o)),n.allocatedValue=i,n.constant=!1,n.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(t){let{value:r}=t;if(!ArrayBuffer.isView(r))throw new Error(`Attribute ${this.id} value is not TypedArray`);let n=this.settings.defaultType,s=!1;if(this.doublePrecision&&(s=r.BYTES_PER_ELEMENT<4),s)throw new Error(`Attribute ${this.id} does not support ${r.constructor.name}`);!(r instanceof n)&&this.settings.normalized&&!("normalized"in t)&&k.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(t){switch(this.settings.type){case"snorm8":return new Float32Array(t).map(r=>(r+128)/255*2-1);case"snorm16":return new Float32Array(t).map(r=>(r+32768)/65535*2-1);case"unorm8":return new Float32Array(t).map(r=>r/255);case"unorm16":return new Float32Array(t).map(r=>r/65535);default:return t}}_normalizeValue(t,r,n){let{defaultValue:s,size:i}=this.settings;if(Number.isFinite(t))return r[n]=t,r;if(!t){let o=i;for(;--o>=0;)r[n+o]=s[o];return r}switch(i){case 4:r[n+3]=Number.isFinite(t[3])?t[3]:s[3];case 3:r[n+2]=Number.isFinite(t[2])?t[2]:s[2];case 2:r[n+1]=Number.isFinite(t[1])?t[1]:s[1];case 1:r[n+0]=Number.isFinite(t[0])?t[0]:s[0];break;default:let o=i;for(;--o>=0;)r[n+o]=Number.isFinite(t[o])?t[o]:s[o]}return r}_areValuesEqual(t,r){if(!t||!r)return!1;let{size:n}=this;for(let s=0;s<n;s++)if(t[s]!==r[s])return!1;return!0}_createBuffer(t){this._buffer&&this._buffer.destroy();let{isIndexed:r,type:n}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:r?K.INDEX:K.VERTEX,indexType:r?n:void 0,byteLength:t}),this._buffer}};var dP=[],pP=[];function Yt(e,t=0,r=1/0){let n=dP,s={index:-1,data:e,target:[]};return e?typeof e[Symbol.iterator]=="function"?n=e:e.length>0&&(pP.length=e.length,n=pP):n=dP,(t>0||Number.isFinite(r))&&(n=(Array.isArray(n)?n:Array.from(n)).slice(t,r),s.index=t-1),{iterable:n,objectInfo:s}}function Rg(e){return e&&e[Symbol.asyncIterator]}function Ig(e,t){let{size:r,stride:n,offset:s,startIndices:i,nested:o}=t,a=e.BYTES_PER_ELEMENT,c=n?n/a:r,l=s?s/a:0,h=Math.floor((e.length-l)/c);return(f,{index:u,target:d})=>{if(!i){let _=u*c+l;for(let y=0;y<r;y++)d[y]=e[_+y];return d}let p=i[u],g=i[u+1]||h,m;if(o){m=new Array(g-p);for(let _=p;_<g;_++){let y=_*c+l;d=new Array(r);for(let x=0;x<r;x++)d[x]=e[y+x];m[_-p]=d}}else if(c===r)m=e.subarray(p*r+l,g*r+l);else{m=new e.constructor((g-p)*r);let _=0;for(let y=p;y<g;y++){let x=y*c+l;for(let A=0;A<r;A++)m[_++]=e[x+A]}}return m}}var gP=[],Wh=[[0,1/0]];function mP(e,t){if(e===Wh||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return e;let r=[],n=e.length,s=0;for(let i=0;i<n;i++){let o=e[i];o[1]<t[0]?(r.push(o),s=i+1):o[0]>t[1]?r.push(o):t=[Math.min(o[0],t[0]),Math.max(o[1],t[1])]}return r.splice(s,0,t),r}var wX={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function Og(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});let r=e.type||"interpolation";return{...wX[r],...t,...e,type:r}}var ts=class extends Hh{constructor(t,r){super(t,r,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Wh}),this.constant=!1,this.settings.update=r.update||(r.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(t){this.state.startIndices=t}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:t=!1}={}){let r=this.state.needsRedraw;return this.state.needsRedraw=r&&!t,r}layoutChanged(){return this.state.layoutChanged}setAccessor(t){var r;(r=this.state).layoutChanged||(r.layoutChanged=!uP(t,this.getAccessor())),super.setAccessor(t)}getUpdateTriggers(){let{accessor:t}=this.settings;return[this.id].concat(typeof t!="function"&&t||[])}supportsTransition(){return Boolean(this.settings.transition)}getTransitionSetting(t){if(!t||!this.supportsTransition())return null;let{accessor:r}=this.settings,n=this.settings.transition,s=Array.isArray(r)?t[r.find(i=>t[i])]:t[r];return Og(s,n)}setNeedsUpdate(t=this.id,r){if(this.state.needsUpdate=this.state.needsUpdate||t,this.setNeedsRedraw(t),r){let{startRow:n=0,endRow:s=1/0}=r;this.state.updateRanges=mP(this.state.updateRanges,[n,s])}else this.state.updateRanges=Wh}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=gP}setNeedsRedraw(t=this.id){this.state.needsRedraw=this.state.needsRedraw||t}allocate(t){let{state:r,settings:n}=this;return n.noAlloc?!1:n.update?(super.allocate(t,r.updateRanges!==Wh),!0):!1}updateBuffer({numInstances:t,data:r,props:n,context:s}){if(!this.needsUpdate())return!1;let{state:{updateRanges:i},settings:{update:o,noAlloc:a}}=this,c=!0;if(o){for(let[l,h]of i)o.call(s,this,{data:r,startRow:l,endRow:h,props:n,numInstances:t});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(let[l,h]of i){let f=Number.isFinite(l)?this.getVertexOffset(l):0,u=Number.isFinite(h)?this.getVertexOffset(h):a||!Number.isFinite(t)?this.value.length:t*this.size;super.updateSubBuffer({startOffset:f,endOffset:u})}this._checkAttributeArray()}else c=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),c}setConstantValue(t){return t===void 0||typeof t=="function"?!1:(this.setData({constant:!0,value:t})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(t){let{state:r}=this;return t?(this.clearNeedsUpdate(),r.lastExternalBuffer===t||(r.lastExternalBuffer=t,this.setNeedsRedraw(),this.setData(t)),!0):(r.lastExternalBuffer=null,!1)}setBinaryValue(t,r=null){let{state:n,settings:s}=this;if(!t)return n.binaryValue=null,n.binaryAccessor=null,!1;if(s.noAlloc)return!1;if(n.binaryValue===t)return this.clearNeedsUpdate(),!0;if(n.binaryValue=t,this.setNeedsRedraw(),s.transform||r!==this.startIndices){ArrayBuffer.isView(t)&&(t={value:t});let o=t;yt(ArrayBuffer.isView(o.value),`invalid ${s.accessor}`);let a=Boolean(o.size)&&o.size!==this.size;return n.binaryAccessor=Ig(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:r,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(t),!0}getVertexOffset(t){let{startIndices:r}=this;return(r?t<r.length?r[t]:this.numInstances:t)*this.size}getValue(){let t=this.settings.shaderAttributes,r=super.getValue();if(!t)return r;for(let n in t)Object.assign(r,super.getValue(n,t[n]));return r}getBufferLayout(t){this.state.layoutChanged=!1;let r=this.settings.shaderAttributes,n=super._getBufferLayout(),{stepMode:s}=this.settings;if(s==="dynamic"?n.stepMode=t?t.isInstanced?"instance":"vertex":"instance":n.stepMode=s??"vertex",!r)return n;for(let i in r){let o=super._getBufferLayout(i,r[i]);n.attributes.push(...o.attributes)}return n}_autoUpdater(t,{data:r,startRow:n,endRow:s,props:i,numInstances:o}){if(t.constant)return;let{settings:a,state:c,value:l,size:h,startIndices:f}=t,{accessor:u,transform:d}=a,p=c.binaryAccessor||(typeof u=="function"?u:i[u]);yt(typeof p=="function",`accessor "${u}" is not a function`);let g=t.getVertexOffset(n),{iterable:m,objectInfo:_}=Yt(r,n,s);for(let y of m){_.index++;let x=p(y,_);if(d&&(x=d.call(this,x)),f){let A=(_.index<f.length-1?f[_.index+1]:o)-f[_.index];if(x&&Array.isArray(x[0])){let M=g;for(let E of x)t._normalizeValue(E,l,M),M+=h}else x&&x.length>h?l.set(x,g):(t._normalizeValue(x,_.target,0),ig({target:l,source:_.target,start:g,count:A}));g+=A*h}else t._normalizeValue(x,l,g),g+=h}}_validateAttributeUpdaters(){let{settings:t}=this;if(!(t.noAlloc||typeof t.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){let{value:t}=this,r=Math.min(4,this.size);if(t&&t.length>=r){let n=!0;switch(r){case 4:n=n&&Number.isFinite(t[3]);case 3:n=n&&Number.isFinite(t[2]);case 2:n=n&&Number.isFinite(t[1]);case 1:n=n&&Number.isFinite(t[0]);break;default:n=!1}if(!n)throw new Error(`Illegal attribute generated for ${this.id}`)}}};function eA(e){let{source:t,target:r,start:n=0,size:s,getData:i}=e,o=e.end||r.length,a=t.length,c=o-n;if(a>c){r.set(t.subarray(0,c),n);return}if(r.set(t,n),!i)return;let l=a;for(;l<c;){let h=i(l,t);for(let f=0;f<s;f++)r[n+l]=h[f]||0,l++}}function _P({source:e,target:t,size:r,getData:n,sourceStartIndices:s,targetStartIndices:i}){if(!s||!i)return eA({source:e,target:t,size:r,getData:n}),t;let o=0,a=0,c=n&&((h,f)=>n(h+a,f)),l=Math.min(s.length,i.length);for(let h=1;h<l;h++){let f=s[h]*r,u=i[h]*r;eA({source:e.subarray(o,f),target:t,start:a,end:u,size:r,getData:c}),o=f,a=u}return a<t.length&&eA({source:[],target:t,start:a,size:r,getData:c}),t}function xP(e){let{device:t,settings:r,value:n}=e,s=new ts(t,r);return s.setData({value:n instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),s}function Lg(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${e}"`)}}function Ng(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function Bg(e){e.push(e.shift())}function yP(e,t){let{doublePrecision:r,settings:n,value:s,size:i}=e,o=r&&s instanceof Float64Array?2:1,a=0,{shaderAttributes:c}=e.settings;if(c)for(let l of Object.values(c))a=Math.max(a,l.vertexOffset??0);return(n.noAlloc?s.length:(t+a)*i)*o}function Fg({device:e,source:t,target:r}){return(!r||r.byteLength<t.byteLength)&&(r?.destroy(),r=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),r}function Dg({device:e,buffer:t,attribute:r,fromLength:n,toLength:s,fromStartIndices:i,getData:o=a=>a}){let a=r.doublePrecision&&r.value instanceof Float64Array?2:1,c=r.size*a,l=r.byteOffset,h=r.settings.bytesPerElement<4?l/r.settings.bytesPerElement*4:l,f=r.startIndices,u=i&&f,d=r.isConstant;if(!u&&t&&n>=s)return t;let p=r.value instanceof Float64Array?Float32Array:r.value.constructor,g=d?r.value:new p(r.getBuffer().readSyncWebGL(l,s*p.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!d){let x=o;o=(A,M)=>r.normalizeConstant(x(A,M))}let m=d?(x,A)=>o(g,A):(x,A)=>o(g.subarray(x+l,x+l+c),A),_=t?new Float32Array(t.readSyncWebGL(h,n*4).buffer):new Float32Array(0),y=new Float32Array(s);return _P({source:_,target:y,sourceStartIndices:i,targetStartIndices:f,size:c,getData:m}),(!t||t.byteLength<y.byteLength+h)&&(t?.destroy(),t=e.createBuffer({byteLength:y.byteLength+h,usage:35050})),t.write(y,h),t}var Va=class{constructor({device:t,attribute:r,timeline:n}){this.buffers=[],this.currentLength=0,this.device=t,this.transition=new Vr(n),this.attribute=r,this.attributeInTransition=xP(r),this.currentStartIndices=r.startIndices}get inProgress(){return this.transition.inProgress}start(t,r,n=1/0){this.settings=t,this.currentStartIndices=this.attribute.startIndices,this.currentLength=yP(this.attribute,r),this.transition.start({...t,duration:n})}update(){let t=this.transition.update();return t&&this.onUpdate(),t}setBuffer(t){this.attributeInTransition.setData({buffer:t,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(let t of this.buffers)t.destroy();this.buffers.length=0}};var Gh=class extends Va{constructor({device:t,attribute:r,timeline:n}){super({device:t,attribute:r,timeline:n}),this.type="interpolation",this.transform=IX(t,r)}start(t,r){let n=this.currentLength,s=this.currentStartIndices;if(super.start(t,r,t.duration),t.duration<=0){this.transition.cancel();return}let{buffers:i,attribute:o}=this;Bg(i),i[0]=Dg({device:this.device,buffer:i[0],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:s,getData:t.enter}),i[1]=Fg({device:this.device,source:i[0],target:i[1]}),this.setBuffer(i[1]);let{transform:a}=this,c=a.model,l=Math.floor(this.currentLength/o.size);TP(o)&&(l/=2),c.setVertexCount(l),o.isConstant?(c.setAttributes({aFrom:i[0]}),c.setConstantAttributes({aTo:o.value})):c.setAttributes({aFrom:i[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:i[1]})}onUpdate(){let{duration:t,easing:r}=this.settings,{time:n}=this.transition,s=n/t;r&&(s=r(s));let{model:i}=this.transform,o={time:s};i.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},CX=`uniform interpolationUniforms {
    float time;
  } interpolation;
  `,AP={name:"interpolation",vs:CX,uniformTypes:{time:"f32"}},PX=`#version 300 es
  #define SHADER_NAME interpolation-transition-vertex-shader
  
  in ATTRIBUTE_TYPE aFrom;
  in ATTRIBUTE_TYPE aTo;
  out ATTRIBUTE_TYPE vCurrent;
  
  void main(void) {
    vCurrent = mix(aFrom, aTo, interpolation.time);
    gl_Position = vec4(0.0);
  }
  `,RX=`#version 300 es
  #define SHADER_NAME interpolation-transition-vertex-shader
  
  in ATTRIBUTE_TYPE aFrom;
  in ATTRIBUTE_TYPE aFrom64Low;
  in ATTRIBUTE_TYPE aTo;
  in ATTRIBUTE_TYPE aTo64Low;
  out ATTRIBUTE_TYPE vCurrent;
  out ATTRIBUTE_TYPE vCurrent64Low;
  
  vec2 mix_fp64(vec2 a, vec2 b, float x) {
    vec2 range = sub_fp64(b, a);
    return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
  }
  
  void main(void) {
    for (int i=0; i<ATTRIBUTE_SIZE; i++) {
      vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
      vCurrent[i] = value.x;
      vCurrent64Low[i] = value.y;
    }
    gl_Position = vec4(0.0);
  }
  `;function TP(e){return e.doublePrecision&&e.value instanceof Float64Array}function IX(e,t){let r=t.size,n=Lg(r),s=Ng(r),i=t.getBufferLayout();return TP(t)?new cr(e,{vs:RX,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*r}]}],modules:[Ep,AP],defines:{ATTRIBUTE_TYPE:n,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new cr(e,{vs:PX,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:i.attributes[0].format}],modules:[AP],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"],disableWarnings:!0})}var jh=class extends Va{constructor({device:t,attribute:r,timeline:n}){super({device:t,attribute:r,timeline:n}),this.type="spring",this.texture=DX(t),this.framebuffer=kX(t,this.texture),this.transform=FX(t,r)}start(t,r){let n=this.currentLength,s=this.currentStartIndices;super.start(t,r);let{buffers:i,attribute:o}=this;for(let c=0;c<2;c++)i[c]=Dg({device:this.device,buffer:i[c],attribute:o,fromLength:n,toLength:this.currentLength,fromStartIndices:s,getData:t.enter});i[2]=Fg({device:this.device,source:i[0],target:i[2]}),this.setBuffer(i[1]);let{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){let{buffers:t,transform:r,framebuffer:n,transition:s}=this,i=this.settings;r.model.setAttributes({aPrev:t[0],aCur:t[1]}),r.transformFeedback.setBuffers({vNext:t[2]});let o={stiffness:i.stiffness,damping:i.damping};r.model.shaderInputs.setProps({spring:o}),r.run({framebuffer:n,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),Bg(t),this.setBuffer(t[1]),this.device.readPixelsToArrayWebGL(n)[0]>0||s.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}},OX=`uniform springUniforms {
    float damping;
    float stiffness;
  } spring;
  `,LX={name:"spring",vs:OX,uniformTypes:{damping:"f32",stiffness:"f32"}},NX=`#version 300 es
  #define SHADER_NAME spring-transition-vertex-shader
  
  #define EPSILON 0.00001
  
  in ATTRIBUTE_TYPE aPrev;
  in ATTRIBUTE_TYPE aCur;
  in ATTRIBUTE_TYPE aTo;
  out ATTRIBUTE_TYPE vNext;
  out float vIsTransitioningFlag;
  
  ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
    ATTRIBUTE_TYPE velocity = cur - prev;
    ATTRIBUTE_TYPE delta = dest - cur;
    ATTRIBUTE_TYPE force = delta * spring.stiffness;
    ATTRIBUTE_TYPE resistance = velocity * spring.damping;
    return force - resistance + velocity + cur;
  }
  
  void main(void) {
    bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
    vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;
  
    vNext = getNextValue(aCur, aPrev, aTo);
    gl_Position = vec4(0, 0, 0, 1);
    gl_PointSize = 100.0;
  }
  `,BX=`#version 300 es
  #define SHADER_NAME spring-transition-is-transitioning-fragment-shader
  
  in float vIsTransitioningFlag;
  
  out vec4 fragColor;
  
  void main(void) {
    if (vIsTransitioningFlag == 0.0) {
      discard;
    }
    fragColor = vec4(1.0);
  }`;function FX(e,t){let r=Lg(t.size),n=Ng(t.size);return new cr(e,{vs:NX,fs:BX,bufferLayout:[{name:"aPrev",format:n},{name:"aCur",format:n},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[LX],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function DX(e){return e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function kX(e,t){return e.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[t]})}var UX={interpolation:Gh,spring:jh},qh=class{constructor(t,{id:r,timeline:n}){if(!t)throw new Error("AttributeTransitionManager is constructed without device");this.id=r,this.device=t,this.timeline=n,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(let t in this.transitions)this._removeTransition(t)}update({attributes:t,transitions:r,numInstances:n}){this.numInstances=n||1;for(let s in t){let i=t[s],o=i.getTransitionSetting(r);o&&this._updateAttribute(s,i,o)}for(let s in this.transitions){let i=t[s];(!i||!i.getTransitionSetting(r))&&this._removeTransition(s)}}hasAttribute(t){let r=this.transitions[t];return r&&r.inProgress}getAttributes(){let t={};for(let r in this.transitions){let n=this.transitions[r];n.inProgress&&(t[r]=n.attributeInTransition)}return t}run(){if(this.numInstances===0)return!1;for(let r in this.transitions)this.transitions[r].update()&&(this.needsRedraw=!0);let t=this.needsRedraw;return this.needsRedraw=!1,t}_removeTransition(t){this.transitions[t].delete(),delete this.transitions[t]}_updateAttribute(t,r,n){let s=this.transitions[t],i=!s||s.type!==n.type;if(i){s&&this._removeTransition(t);let o=UX[n.type];o?this.transitions[t]=new o({attribute:r,timeline:this.timeline,device:this.device}):(k.error(`unsupported transition type '${n.type}'`)(),i=!1)}(i||r.needsRedraw())&&(this.needsRedraw=!0,this.transitions[t].start(n,this.numInstances))}};var MP="attributeManager.invalidate",zX="attributeManager.updateStart",VX="attributeManager.updateEnd",HX="attribute.updateStart",WX="attribute.allocate",GX="attribute.updateEnd",ur=class{constructor(t,{id:r="attribute-manager",stats:n,timeline:s}={}){this.mergeBoundsMemoized=Je(Hw),this.id=r,this.device=t,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=n,this.attributeTransitionManager=new qh(t,{id:`${r}-transitions`,timeline:s}),Object.seal(this)}finalize(){for(let t in this.attributes)this.attributes[t].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(t={clearRedrawFlags:!1}){let r=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!t.clearRedrawFlags,r&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(t){this._add(t)}addInstanced(t){this._add(t,{stepMode:"instance"})}remove(t){for(let r of t)this.attributes[r]!==void 0&&(this.attributes[r].delete(),delete this.attributes[r])}invalidate(t,r){let n=this._invalidateTrigger(t,r);Gt(MP,this,t,n)}invalidateAll(t){for(let r in this.attributes)this.attributes[r].setNeedsUpdate(r,t);Gt(MP,this,"all")}update({data:t,numInstances:r,startIndices:n=null,transitions:s,props:i={},buffers:o={},context:a={}}){let c=!1;Gt(zX,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(let l in this.attributes){let h=this.attributes[l],f=h.settings.accessor;h.startIndices=n,h.numInstances=r,i[l]&&k.removed(`props.${l}`,`data.attributes.${l}`)(),h.setExternalBuffer(o[l])||h.setBinaryValue(typeof f=="string"?o[f]:void 0,t.startIndices)||typeof f=="string"&&!o[f]&&h.setConstantValue(i[f])||h.needsUpdate()&&(c=!0,this._updateAttribute({attribute:h,numInstances:r,data:t,props:i,context:a})),this.needsRedraw=this.needsRedraw||h.needsRedraw()}c&&Gt(VX,this,r),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:r,transitions:s})}updateTransition(){let{attributeTransitionManager:t}=this,r=t.run();return this.needsRedraw=this.needsRedraw||r,r}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(t){let r=t.map(n=>this.attributes[n]?.getBounds());return this.mergeBoundsMemoized(r)}getChangedAttributes(t={clearChangedFlags:!1}){let{attributes:r,attributeTransitionManager:n}=this,s={...n.getAttributes()};for(let i in r){let o=r[i];o.needsRedraw(t)&&!n.hasAttribute(i)&&(s[i]=o)}return s}getBufferLayouts(t){return Object.values(this.getAttributes()).map(r=>r.getBufferLayout(t))}_add(t,r){for(let n in t){let s=t[n],i={...s,id:n,size:s.isIndexed&&1||s.size||1,...r};this.attributes[n]=new ts(this.device,i)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){let t={};for(let r in this.attributes)this.attributes[r].getUpdateTriggers().forEach(s=>{t[s]||(t[s]=[]),t[s].push(r)});this.updateTriggers=t}_invalidateTrigger(t,r){let{attributes:n,updateTriggers:s}=this,i=s[t];return i&&i.forEach(o=>{let a=n[o];a&&a.setNeedsUpdate(a.id,r)}),i}_updateAttribute(t){let{attribute:r,numInstances:n}=t;if(Gt(HX,r),r.constant){r.setConstantValue(r.value);return}r.allocate(n)&&Gt(WX,r,n),r.updateBuffer(t)&&(this.needsRedraw=!0,Gt(GX,r,n))}};var Xh=class extends Vr{get value(){return this._value}_onUpdate(){let{time:t,settings:{fromValue:r,toValue:n,duration:s,easing:i}}=this,o=i(t/s);this._value=he(r,n,o)}};var EP=1e-5;function bP(e,t,r,n,s){let i=t-e,a=(r-t)*s,c=-i*n;return a+c+i+t}function jX(e,t,r,n,s){if(Array.isArray(r)){let i=[];for(let o=0;o<r.length;o++)i[o]=bP(e[o],t[o],r[o],n,s);return i}return bP(e,t,r,n,s)}function SP(e,t){if(Array.isArray(e)){let r=0;for(let n=0;n<e.length;n++){let s=e[n]-t[n];r+=s*s}return Math.sqrt(r)}return Math.abs(e-t)}var Yh=class extends Vr{get value(){return this._currValue}_onUpdate(){let{fromValue:t,toValue:r,damping:n,stiffness:s}=this.settings,{_prevValue:i=t,_currValue:o=t}=this,a=jX(i,o,r,n,s),c=SP(a,r),l=SP(a,o);c<EP&&l<EP&&(a=r,this.end()),this._prevValue=o,this._currValue=a}};var qX={interpolation:Xh,spring:Yh},$h=class{constructor(t){this.transitions=new Map,this.timeline=t}get active(){return this.transitions.size>0}add(t,r,n,s){let{transitions:i}=this;if(i.has(t)){let c=i.get(t),{value:l=c.settings.fromValue}=c;r=l,this.remove(t)}if(s=Og(s),!s)return;let o=qX[s.type];if(!o){k.error(`unsupported transition type '${s.type}'`)();return}let a=new o(this.timeline);a.start({...s,fromValue:r,toValue:n}),i.set(t,a)}remove(t){let{transitions:r}=this;r.has(t)&&(r.get(t).cancel(),r.delete(t))}update(){let t={};for(let[r,n]of this.transitions)n.update(),t[r]=n.value,n.inProgress||this.remove(r);return t}clear(){for(let t of this.transitions.keys())this.remove(t)}};function wP(e){let t=e[br];for(let r in t){let n=t[r],{validate:s}=n;if(s&&!s(e[r],n))throw new Error(`Invalid prop ${r}: ${e[r]}`)}}function CP(e,t){let r=Ha({newProps:e,oldProps:t,propTypes:e[br],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),n=YX(e,t),s=!1;return n||(s=$X(e,t)),{dataChanged:n,propsChanged:r,updateTriggersChanged:s,extensionsChanged:KX(e,t),transitionsChanged:XX(e,t)}}function XX(e,t){if(!e.transitions)return!1;let r={},n=e[br],s=!1;for(let i in e.transitions){let o=n[i],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&rA(e[i],t[i],o)&&(r[i]=!0,s=!0)}return s?r:!1}function Ha({newProps:e,oldProps:t,ignoreProps:r={},propTypes:n={},triggerName:s="props"}){if(t===e)return!1;if(typeof e!="object"||e===null)return`${s} changed shallowly`;if(typeof t!="object"||t===null)return`${s} changed shallowly`;for(let i of Object.keys(e))if(!(i in r)){if(!(i in t))return`${s}.${i} added`;let o=rA(e[i],t[i],n[i]);if(o)return`${s}.${i} ${o}`}for(let i of Object.keys(t))if(!(i in r)){if(!(i in e))return`${s}.${i} dropped`;if(!Object.hasOwnProperty.call(e,i)){let o=rA(e[i],t[i],n[i]);if(o)return`${s}.${i} ${o}`}}return!1}function rA(e,t,r){let n=r&&r.equal;return n&&!n(e,t,r)||!n&&(n=e&&t&&e.equals,n&&!n.call(e,t))?"changed deeply":!n&&t!==e?"changed shallowly":null}function YX(e,t){if(t===null)return"oldProps is null, initial diff";let r=!1,{dataComparator:n,_dataDiff:s}=e;return n?n(e.data,t.data)||(r="Data comparator detected a change"):e.data!==t.data&&(r="A new data container was supplied"),r&&s&&(r=s(e.data,t.data)||r),r}function $X(e,t){if(t===null)return{all:!0};if("all"in e.updateTriggers&&vP(e,t,"all"))return{all:!0};let r={},n=!1;for(let s in e.updateTriggers)s!=="all"&&vP(e,t,s)&&(r[s]=!0,n=!0);return n?r:!1}function KX(e,t){if(t===null)return!0;let r=t.extensions,{extensions:n}=e;if(n===r)return!1;if(!r||!n||n.length!==r.length)return!0;for(let s=0;s<n.length;s++)if(!n[s].equals(r[s]))return!0;return!1}function vP(e,t,r){let n=e.updateTriggers[r];n=n??{};let s=t.updateTriggers[r];return s=s??{},Ha({oldProps:s,newProps:n,triggerName:r})}var ZX="count(): argument not an object",JX="count(): argument not a container";function kg(e){if(!tY(e))throw new Error(ZX);if(typeof e.count=="function")return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(QX(e))return Object.keys(e).length;throw new Error(JX)}function QX(e){return e!==null&&typeof e=="object"&&e.constructor===Object}function tY(e){return e!==null&&typeof e=="object"}function Ks(e,t){if(!t)return e;let r={...e,...t};if("defines"in t&&(r.defines={...e.defines,...t.defines}),"modules"in t&&(r.modules=(e.modules||[]).concat(t.modules),t.modules.some(n=>n.name==="project64"))){let n=r.modules.findIndex(s=>s.name==="project32");n>=0&&r.modules.splice(n,1)}if("inject"in t)if(!e.inject)r.inject=t.inject;else{let n={...e.inject};for(let s in t.inject)n[s]=(n[s]||"")+t.inject[s];r.inject=n}return r}var eY={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},nA={};function PP(e,t,r,n){if(r instanceof Q)return r;r.constructor&&r.constructor.name!=="Object"&&(r={data:r});let s=null;r.compressed&&(s={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});let i=t.createTexture({...r,sampler:{...eY,...s,...n},mipmaps:!0});return nA[i.id]=e,i}function RP(e,t){!t||!(t instanceof Q)||nA[t.id]===e&&(t.delete(),delete nA[t.id])}var rY={boolean:{validate(e,t){return!0},equal(e,t,r){return Boolean(e)===Boolean(t)}},number:{validate(e,t){return Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)}},color:{validate(e,t){return t.optional&&!e||sA(e)&&(e.length===3||e.length===4)},equal(e,t,r){return tt(e,t,1)}},accessor:{validate(e,t){let r=Ug(e);return r==="function"||r===Ug(t.value)},equal(e,t,r){return typeof t=="function"?!0:tt(e,t,1)}},array:{validate(e,t){return t.optional&&!e||sA(e)},equal(e,t,r){let{compare:n}=r,s=Number.isInteger(n)?n:n?1:0;return n?tt(e,t,s):e===t}},object:{equal(e,t,r){if(r.ignore)return!0;let{compare:n}=r,s=Number.isInteger(n)?n:n?1:0;return n?tt(e,t,s):e===t}},function:{validate(e,t){return t.optional&&!e||typeof e=="function"},equal(e,t,r){return!r.compare&&r.ignore!==!1||e===t}},data:{transform:(e,t,r)=>{if(!e)return e;let{dataTransform:n}=r.props;return n?n(e):typeof e.shape=="string"&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,r)=>{let n=r.context;return!n||!n.device?null:PP(r.id,n.device,e,{...t.parameters,...r.props.textureParameters})},release:(e,t,r)=>{RP(r.id,e)}}};function IP(e){let t={},r={},n={};for(let[s,i]of Object.entries(e)){let o=i?.deprecatedFor;if(o)n[s]=Array.isArray(o)?o:[o];else{let a=nY(s,i);t[s]=a,r[s]=a.value}}return{propTypes:t,defaultProps:r,deprecatedProps:n}}function nY(e,t){switch(Ug(t)){case"object":return Kh(e,t);case"array":return Kh(e,{type:"array",value:t,compare:!1});case"boolean":return Kh(e,{type:"boolean",value:t});case"number":return Kh(e,{type:"number",value:t});case"function":return Kh(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}function Kh(e,t){return"type"in t?{name:e,...rY[t.type],...t}:"value"in t?{name:e,type:Ug(t.value),...t}:{name:e,type:"object",value:t}}function sA(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function Ug(e){return sA(e)?"array":e===null?"null":typeof e}function OP(e,t){let r;for(let i=t.length-1;i>=0;i--){let o=t[i];"extensions"in o&&(r=o.extensions)}let n=iA(e.constructor,r),s=Object.create(n);s[Fa]=e,s[gn]={},s[zr]={};for(let i=0;i<t.length;++i){let o=t[i];for(let a in o)s[a]=o[a]}return Object.freeze(s),s}var sY="_mergedDefaultProps";function iA(e,t){if(!(e instanceof Wa.constructor))return{};let r=sY;if(t)for(let s of t){let i=s.constructor;i&&(r+=`:${i.extensionName||i.name}`)}let n=LP(e,r);return n||(e[r]=iY(e,t||[]))}function iY(e,t){if(!e.prototype)return null;let n=Object.getPrototypeOf(e),s=iA(n),i=LP(e,"defaultProps")||{},o=IP(i),a=Object.assign(Object.create(null),s,o.defaultProps),c=Object.assign(Object.create(null),s?.[br],o.propTypes),l=Object.assign(Object.create(null),s?.[sg],o.deprecatedProps);for(let h of t){let f=iA(h.constructor);f&&(Object.assign(a,f),Object.assign(c,f[br]),Object.assign(l,f[sg]))}return oY(a,e),cY(a,c),aY(a,l),a[br]=c,a[sg]=l,t.length===0&&!oA(e,"_propTypes")&&(e._propTypes=c),a}function oY(e,t){let r=hY(t);Object.defineProperties(e,{id:{writable:!0,value:r}})}function aY(e,t){for(let r in t)Object.defineProperty(e,r,{enumerable:!1,set(n){let s=`${this.id}: ${r}`;for(let i of t[r])oA(this,i)||(this[i]=n);k.deprecated(s,t[r].join("/"))()}})}function cY(e,t){let r={},n={};for(let s in t){let i=t[s],{name:o,value:a}=i;i.async&&(r[o]=a,n[o]=lY(o))}e[$n]=r,e[gn]={},Object.defineProperties(e,n)}function lY(e){return{enumerable:!0,set(t){typeof t=="string"||t instanceof Promise||Rg(t)?this[gn][e]=t:this[zr][e]=t},get(){if(this[zr]){if(e in this[zr])return this[zr][e]||this[$n][e];if(e in this[gn]){let t=this[Fa]&&this[Fa].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[$n][e]}}return this[$n][e]}}}function oA(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function LP(e,t){return oA(e,t)&&e[t]}function hY(e){let t=e.componentName;return t||k.warn(`${e.name}.componentName not specified`)(),t||e.name}var fY=0,Zh=class{constructor(...t){this.props=OP(this,t),this.id=this.props.id,this.count=fY++}clone(t){let{props:r}=this,n={};for(let s in r[$n])s in r[zr]?n[s]=r[zr][s]:s in r[gn]&&(n[s]=r[gn][s]);return new this.constructor({...r,...n,...t})}};Zh.componentName="Component";Zh.defaultProps={};var Wa=Zh;var uY=Object.freeze({}),io=class{constructor(t){this.component=t,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(let t in this.asyncProps){let r=this.asyncProps[t];r&&r.type&&r.type.release&&r.type.release(r.resolvedValue,r.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||uY}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(t){return t in this.asyncProps}getAsyncProp(t){let r=this.asyncProps[t];return r&&r.resolvedValue}isAsyncPropLoading(t){if(t){let r=this.asyncProps[t];return Boolean(r&&r.pendingLoadCount>0&&r.pendingLoadCount!==r.resolvedLoadCount)}for(let r in this.asyncProps)if(this.isAsyncPropLoading(r))return!0;return!1}reloadAsyncProp(t,r){this._watchPromise(t,Promise.resolve(r))}setAsyncProps(t){this.component=t[Fa]||this.component;let r=t[zr]||{},n=t[gn]||t,s=t[$n]||{};for(let i in r){let o=r[i];this._createAsyncPropData(i,s[i]),this._updateAsyncProp(i,o),r[i]=this.getAsyncProp(i)}for(let i in n){let o=n[i];this._createAsyncPropData(i,s[i]),this._updateAsyncProp(i,o)}}_fetch(t,r){return null}_onResolve(t,r){}_onError(t,r){}_updateAsyncProp(t,r){if(this._didAsyncInputValueChange(t,r)){if(typeof r=="string"&&(r=this._fetch(t,r)),r instanceof Promise){this._watchPromise(t,r);return}if(Rg(r)){this._resolveAsyncIterable(t,r);return}this._setPropValue(t,r)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(let t in this.asyncProps)Object.defineProperty(this.oldAsyncProps,t,{enumerable:!0,value:this.oldProps[t]})}}_didAsyncInputValueChange(t,r){let n=this.asyncProps[t];return r===n.resolvedValue||r===n.lastValue?!1:(n.lastValue=r,!0)}_setPropValue(t,r){this._freezeAsyncOldProps();let n=this.asyncProps[t];n&&(r=this._postProcessValue(n,r),n.resolvedValue=r,n.pendingLoadCount++,n.resolvedLoadCount=n.pendingLoadCount)}_setAsyncPropValue(t,r,n){let s=this.asyncProps[t];s&&n>=s.resolvedLoadCount&&r!==void 0&&(this._freezeAsyncOldProps(),s.resolvedValue=r,s.resolvedLoadCount=n,this.onAsyncPropUpdated(t,r))}_watchPromise(t,r){let n=this.asyncProps[t];if(n){n.pendingLoadCount++;let s=n.pendingLoadCount;r.then(i=>{this.component&&(i=this._postProcessValue(n,i),this._setAsyncPropValue(t,i,s),this._onResolve(t,i))}).catch(i=>{this._onError(t,i)})}}async _resolveAsyncIterable(t,r){if(t!=="data"){this._setPropValue(t,r);return}let n=this.asyncProps[t];if(!n)return;n.pendingLoadCount++;let s=n.pendingLoadCount,i=[],o=0;for await(let a of r){if(!this.component)return;let{dataTransform:c}=this.component.props;c?i=c(a,i):i=i.concat(a),Object.defineProperty(i,"__diff",{enumerable:!1,value:[{startRow:o,endRow:i.length}]}),o=i.length,this._setAsyncPropValue(t,i,s)}this._onResolve(t,i)}_postProcessValue(t,r){let n=t.type;return n&&this.component&&(n.release&&n.release(t.resolvedValue,n,this.component),n.transform)?n.transform(r,n,this.component):r}_createAsyncPropData(t,r){if(!this.asyncProps[t]){let s=this.component&&this.component.props[br];this.asyncProps[t]={type:s&&s[t],lastValue:null,resolvedValue:r,pendingLoadCount:0,resolvedLoadCount:0}}}};var Jh=class extends io{constructor({attributeManager:t,layer:r}){super(r),this.attributeManager=t,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(t,r){let n=this.layer,s=n?.props.fetch;return s?s(r,{propName:t,layer:n}):super._fetch(t,r)}_onResolve(t,r){let n=this.layer;if(n){let s=n.props.onDataLoad;t==="data"&&s&&s(r,{propName:t,layer:n})}}_onError(t,r){let n=this.layer;n&&n.raiseError(r,`loading ${t} of ${this.layer}`)}};var dY="layer.changeFlag",pY="layer.initialize",gY="layer.update",mY="layer.finalize",_Y="layer.matched",NP=2**24-1,xY=Object.freeze([]),yY=Je(({oldViewport:e,viewport:t})=>e.equals(t)),qr=new Uint8ClampedArray(0),AY={data:{type:"data",value:xY,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:r,loaders:n,loadOptions:s,signal:i})=>{let{resourceManager:o}=r.context;s=s||r.getLoadOptions(),n=n||r.props.loaders,i&&(s={...s,fetch:{...s?.fetch,signal:i}});let a=o.contains(e);return!a&&!s&&(o.add({resourceId:e,data:se(e,n),persistent:!1}),a=!0),a?o.subscribe({resourceId:e,onChange:c=>r.internalState?.reloadAsyncProp(t,c),consumerId:r.id,requestId:t}):se(e,n,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:W.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,-e*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},Qh=class extends Wa{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Gs.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let t=this;for(;t.parent;)t=t.parent;return t}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(t){yt(this.internalState);let r=this.internalState.viewport||this.context.viewport,n=O2(t,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[s,i,o]=wa(n,r.pixelProjectionMatrix);return t.length===2?[s,i]:[s,i,o]}unproject(t){return yt(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(t)}projectPosition(t,r){yt(this.internalState);let n=this.internalState.viewport||this.context.viewport;return Kp(t,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...r})}get isComposite(){return!1}get isDrawable(){return!0}setState(t){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,t),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){let t=this.state;return t&&(t.models||t.model&&[t.model])||[]}setShaderModuleProps(...t){for(let r of this.getModels())r.shaderInputs.setProps(...t)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){let{coordinateSystem:t}=this.props;return t===W.DEFAULT||t===W.LNGLAT||t===W.CARTESIAN}onHover(t,r){return this.props.onHover&&this.props.onHover(t,r)||!1}onClick(t,r){return this.props.onClick&&this.props.onClick(t,r)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(t,r=[]){return r[0]=t+1&255,r[1]=t+1>>8&255,r[2]=t+1>>8>>8&255,r}decodePickingColor(t){yt(t instanceof Uint8Array);let[r,n,s]=t;return r+n*256+s*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:kg(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(t){t=Ks(t,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(let r of this.props.extensions)t=Ks(t,r.getShaders.call(this,r));return t}shouldUpdateState(t){return t.changeFlags.propsOrDataChanged}updateState(t){let r=this.getAttributeManager(),{dataChanged:n}=t.changeFlags;if(n&&r)if(Array.isArray(n))for(let s of n)r.invalidateAll(s);else r.invalidateAll();if(r){let{props:s}=t,i=this.internalState.hasPickingBuffer,o=Number.isInteger(s.highlightedObjectIndex)||s.pickable||s.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(i!==o){this.internalState.hasPickingBuffer=o;let{pickingColors:a,instancePickingColors:c}=r.attributes,l=a||c;l&&(o&&l.constant&&(l.constant=!1,r.invalidate(l.id)),!l.value&&!o&&(l.constant=!0,l.value=[0,0,0]))}}}finalizeState(t){for(let n of this.getModels())n.destroy();let r=this.getAttributeManager();r&&r.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(t){for(let r of this.getModels())r.draw(t.renderPass)}getPickingInfo({info:t,mode:r,sourceLayer:n}){let{index:s}=t;return s>=0&&Array.isArray(this.props.data)&&(t.object=this.props.data[s]),t}raiseError(t,r){r&&(t=new Error(`${r}: ${t.message}`,{cause:t})),this.props.onError?.(t)||this.context?.onError?.(t,this)}getNeedsRedraw(t={clearRedrawFlags:!1}){return this._getNeedsRedraw(t)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(t){if(!this.internalState)return;let r=this.internalState.viewport;this.internalState.viewport=t,(!r||!yY({oldViewport:r,viewport:t}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(t="all"){let r=this.getAttributeManager();r&&(t==="all"?r.invalidateAll():r.invalidate(t))}updateAttributes(t){let r=!1;for(let n in t)t[n].layoutChanged()&&(r=!0);for(let n of this.getModels())this._setModelAttributes(n,t,r)}_updateAttributes(){let t=this.getAttributeManager();if(!t)return;let r=this.props,n=this.getNumInstances(),s=this.getStartIndices();t.update({data:r.data,numInstances:n,startIndices:s,props:r,transitions:r.transitions,buffers:r.data.attributes,context:this});let i=t.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(i)}_updateAttributeTransition(){let t=this.getAttributeManager();t&&t.updateTransition()}_updateUniformTransition(){let{uniformTransitions:t}=this.internalState;if(t.active){let r=t.update(),n=Object.create(this.props);for(let s in r)Object.defineProperty(n,s,{value:r[s]});return n}return this.props}calculateInstancePickingColors(t,{numInstances:r}){if(t.constant)return;let n=Math.floor(qr.length/4);if(this.internalState.usesPickingColorCache=!0,n<r){r>NP&&k.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),qr=kr.allocate(qr,r,{size:4,copy:!0,maxCount:Math.max(r,NP)});let s=Math.floor(qr.length/4),i=[0,0,0];for(let o=n;o<s;o++)this.encodePickingColor(o,i),qr[o*4+0]=i[0],qr[o*4+1]=i[1],qr[o*4+2]=i[2],qr[o*4+3]=0}t.value=qr.subarray(0,r*4)}_setModelAttributes(t,r,n=!1){if(!Object.keys(r).length)return;if(n){let a=this.getAttributeManager();t.setBufferLayout(a.getBufferLayouts(t)),r=a.getAttributes()}let s=t.userData?.excludeAttributes||{},i={},o={};for(let a in r){if(s[a])continue;let c=r[a].getValue();for(let l in c){let h=c[l];h instanceof K?r[a].settings.isIndexed?t.setIndexBuffer(h):i[l]=h:h&&(o[l]=h)}}t.setAttributes(i),t.setConstantAttributes(o)}disablePickingIndex(t){let r=this.props.data;if(!("attributes"in r)){this._disablePickingIndex(t);return}let{pickingColors:n,instancePickingColors:s}=this.getAttributeManager().attributes,i=n||s,o=i&&r.attributes&&r.attributes[i.id];if(o&&o.value){let a=o.value,c=this.encodePickingColor(t);for(let l=0;l<r.length;l++){let h=i.getVertexOffset(l);a[h]===c[0]&&a[h+1]===c[1]&&a[h+2]===c[2]&&this._disablePickingIndex(l)}}else this._disablePickingIndex(t)}_disablePickingIndex(t){let{pickingColors:r,instancePickingColors:n}=this.getAttributeManager().attributes,s=r||n;if(!s)return;let i=s.getVertexOffset(t),o=s.getVertexOffset(t+1);s.buffer.write(new Uint8Array(o-i),i)}restorePickingColors(){let{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,n=t||r;n&&(this.internalState.usesPickingColorCache&&n.value.buffer!==qr.buffer&&(n.value=qr.subarray(0,n.value.length)),n.updateSubBuffer({startOffset:0}))}_initialize(){yt(!this.internalState),yt(Number.isFinite(this.props.coordinateSystem)),Gt(pY,this);let t=this._getAttributeManager();t&&t.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new Jh({attributeManager:t,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(k.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),t)}),this.internalState.uniformTransitions=new $h(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(let r of this.props.extensions)r.initializeState.call(this,this.context,r);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(t){Gt(_Y,this,this===t);let{state:r,internalState:n}=t;this!==t&&(this.internalState=n,this.state=r,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){let t=this.needsUpdate();if(Gt(gY,this,t),!t)return;let r=this.props,n=this.context,s=this.internalState,i=n.viewport,o=this._updateUniformTransition();s.propsInTransition=o,n.viewport=s.viewport||i,this.props=o;try{let a=this._getUpdateParams(),c=this.getModels();if(n.device)this.updateState(a);else try{this.updateState(a)}catch{}for(let h of this.props.extensions)h.updateState.call(this,a,h);this.setNeedsRedraw(),this._updateAttributes();let l=this.getModels()[0]!==c[0];this._postUpdate(a,l)}finally{n.viewport=i,this.props=r,this._clearChangeFlags(),s.needsUpdate=!1,s.resetOldProps()}}_finalize(){Gt(mY,this),this.finalizeState(this.context);for(let t of this.props.extensions)t.finalizeState.call(this,this.context,t)}_drawLayer({renderPass:t,shaderModuleProps:r=null,uniforms:n={},parameters:s={}}){this._updateAttributeTransition();let i=this.props,o=this.context;this.props=this.internalState.propsInTransition||i;try{r&&this.setShaderModuleProps(r);let{getPolygonOffset:a}=this.props,c=a&&a(n)||[0,0];o.device instanceof be&&o.device.setParametersWebGL({polygonOffset:c});for(let l of this.getModels())l.setParameters(s);if(o.device instanceof be)o.device.withParametersWebGL(s,()=>{let l={renderPass:t,shaderModuleProps:r,uniforms:n,parameters:s,context:o};for(let h of this.props.extensions)h.draw.call(this,l,h);this.draw(l)});else{let l={renderPass:t,shaderModuleProps:r,uniforms:n,parameters:s,context:o};for(let h of this.props.extensions)h.draw.call(this,l,h);this.draw(l)}}finally{this.props=i}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(t){if(!this.internalState)return;let{changeFlags:r}=this.internalState;for(let s in t)if(t[s]){let i=!1;switch(s){case"dataChanged":let o=t[s],a=r[s];o&&Array.isArray(a)&&(r.dataChanged=Array.isArray(o)?a.concat(o):o,i=!0);default:r[s]||(r[s]=t[s],i=!0)}i&&Gt(dY,this,s,t)}let n=Boolean(r.dataChanged||r.updateTriggersChanged||r.propsChanged||r.extensionsChanged);r.propsOrDataChanged=n,r.somethingChanged=n||r.viewportChanged||r.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(t,r){let n=CP(t,r);if(n.updateTriggersChanged)for(let s in n.updateTriggersChanged)n.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(n.transitionsChanged)for(let s in n.transitionsChanged)this.internalState.uniformTransitions.add(s,r[s],t[s],t.transitions?.[s]);return this.setChangeFlags(n)}validateProps(){wP(this.props)}updateAutoHighlight(t){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(t)}_updateAutoHighlight(t){let r={highlightedObjectColor:t.picked?t.color:null},{highlightColor:n}=this.props;t.picked&&typeof n=="function"&&(r.highlightColor=n(t)),this.setShaderModuleProps({picking:r}),this.setNeedsRedraw()}_getAttributeManager(){let t=this.context;return new ur(t.device,{id:this.props.id,stats:t.stats,timeline:t.timeline})}_postUpdate(t,r){let{props:n,oldProps:s}=t,i=this.state.model;i?.isInstanced&&i.setInstanceCount(this.getNumInstances());let{autoHighlight:o,highlightedObjectIndex:a,highlightColor:c}=n;if(r||s.autoHighlight!==o||s.highlightedObjectIndex!==a||s.highlightColor!==c){let l={};Array.isArray(c)&&(l.highlightColor=c),(r||s.autoHighlight!==o||a!==s.highlightedObjectIndex)&&(l.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:l})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(t){if(!this.internalState)return!1;let r=!1;r=r||this.internalState.needsRedraw&&this.id;let n=this.getAttributeManager(),s=n?n.getNeedsRedraw(t):!1;if(r=r||s,r)for(let i of this.props.extensions)i.onNeedsRedraw.call(this,i);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!t.clearRedrawFlags,r}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};Qh.defaultProps=AY;Qh.layerName="Layer";var ut=Qh;var TY="compositeLayer.renderLayers",zg=class extends ut{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(t=>t.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(t){}setState(t){super.setState(t),this.setNeedsUpdate()}getPickingInfo({info:t}){let{object:r}=t;return r&&r.__source&&r.__source.parent&&r.__source.parent.id===this.id&&(t.object=r.__source.object,t.index=r.__source.index),t}filterSubLayer(t){return!0}shouldRenderSubLayer(t,r){return r&&r.length}getSubLayerClass(t,r){let{_subLayerProps:n}=this.props;return n&&n[t]&&n[t].type||r}getSubLayerRow(t,r,n){return t.__source={parent:this,object:r,index:n},t}getSubLayerAccessor(t){if(typeof t=="function"){let r={index:-1,data:this.props.data,target:[]};return(n,s)=>n&&n.__source?(r.index=n.__source.index,t(n.__source.object,r)):t(n,s)}return t}getSubLayerProps(t={}){let{opacity:r,pickable:n,visible:s,parameters:i,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:c,highlightColor:l,coordinateSystem:h,coordinateOrigin:f,wrapLongitude:u,positionFormat:d,modelMatrix:p,extensions:g,fetch:m,operation:_,_subLayerProps:y}=this.props,x={id:"",updateTriggers:{},opacity:r,pickable:n,visible:s,parameters:i,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:c,highlightColor:l,coordinateSystem:h,coordinateOrigin:f,wrapLongitude:u,positionFormat:d,modelMatrix:p,extensions:g,fetch:m,operation:_},A=y&&t.id&&y[t.id],M=A&&A.updateTriggers,E=t.id||"sublayer";if(A){let w=this.props[br],v=t.type?t.type._propTypes:{};for(let b in A){let T=v[b]||w[b];T&&T.type==="accessor"&&(A[b]=this.getSubLayerAccessor(A[b]))}}Object.assign(x,t,A),x.id=`${this.props.id}-${E}`,x.updateTriggers={all:this.props.updateTriggers?.all,...t.updateTriggers,...M};for(let w of g){let v=w.getSubLayerProps.call(this,w);v&&Object.assign(x,v,{updateTriggers:Object.assign(x.updateTriggers,v.updateTriggers)})}return x}_updateAutoHighlight(t){for(let r of this.getSubLayers())r.updateAutoHighlight(t)}_getAttributeManager(){return null}_postUpdate(t,r){let n=this.internalState.subLayers,s=!n||this.needsUpdate();if(s){let i=this.renderLayers();n=We(i,Boolean),this.internalState.subLayers=n}Gt(TY,this,s,n);for(let i of n)i.parent=this}};zg.layerName="CompositeLayer";var Ft=zg;var Vg=Math.PI/180,BP=180/Math.PI,Hg=6370972,Ga=256;function MY(){let e=Ga/Hg,t=Math.PI/180*Ga;return{unitsPerMeter:[e,e,e],unitsPerMeter2:[0,0,0],metersPerUnit:[1/e,1/e,1/e],unitsPerDegree:[t,t,e],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/t,1/t,1/e]}}var Xr=class extends oe{constructor(t={}){let{longitude:r=0,zoom:n=0,nearZMultiplier:s=.5,farZMultiplier:i=1,resolution:o=10}=t,{latitude:a=0,height:c,altitude:l=1.5,fovy:h}=t;a=Math.max(Math.min(a,Tr),-Tr),c=c||1,h?l=qn(h):h=jn(l);let f=1/Math.PI/Math.cos(a*Math.PI/180),u=Math.pow(2,n)*f,d=t.nearZ??s,p=t.farZ??(l+Ga*2*u/c)*i,g=new $().lookAt({eye:[0,-l,0],up:[0,0,1]});g.rotateX(a*Vg),g.rotateZ(-r*Vg),g.scale(u/c),super({...t,height:c,viewMatrix:g,longitude:r,latitude:a,zoom:n,distanceScales:MY(),fovy:h,focalDistance:l,near:d,far:p}),this.scale=u,this.latitude=a,this.longitude=r,this.resolution=o}get projectionMode(){return Pe.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(t={}){let r={targetZ:t.z||0},n=this.unproject([0,this.height/2],r),s=this.unproject([this.width/2,0],r),i=this.unproject([this.width,this.height/2],r),o=this.unproject([this.width/2,this.height],r);return i[0]<this.longitude&&(i[0]+=360),n[0]>this.longitude&&(n[0]-=360),[Math.min(n[0],i[0],s[0],o[0]),Math.min(n[1],i[1],s[1],o[1]),Math.max(n[0],i[0],s[0],o[0]),Math.max(n[1],i[1],s[1],o[1])]}unproject(t,{topLeft:r=!0,targetZ:n}={}){let[s,i,o]=t,a=r?i:this.height-i,{pixelUnprojectionMatrix:c}=this,l;if(Number.isFinite(o))l=aA(c,[s,a,o,1]);else{let d=aA(c,[s,a,-1,1]),p=aA(c,[s,a,1,1]),g=((n||0)/Hg+1)*Ga,m=pe.sqrLen(pe.sub([],d,p)),_=pe.sqrLen(d),y=pe.sqrLen(p),A=4*((4*_*y-(m-_-y)**2)/16)/m,M=Math.sqrt(_-A),E=Math.sqrt(Math.max(0,g*g-A)),w=(M-E)/Math.sqrt(m);l=pe.lerp([],d,p,w)}let[h,f,u]=this.unprojectPosition(l);return Number.isFinite(o)?[h,f,u]:Number.isFinite(n)?[h,f,n]:[h,f]}projectPosition(t){let[r,n,s=0]=t,i=r*Vg,o=n*Vg,a=Math.cos(o),c=(s/Hg+1)*Ga;return[Math.sin(i)*a*c,-Math.cos(i)*a*c,Math.sin(o)*c]}unprojectPosition(t){let[r,n,s]=t,i=pe.len(t),o=Math.asin(s/i),c=Math.atan2(r,-n)*BP,l=o*BP,h=(i/Ga-1)*Hg;return[c,l,h]}projectFlat(t){return t}unprojectFlat(t){return t}panByPosition(t,r){let n=this.unproject(r);return{longitude:t[0]-n[0]+this.longitude,latitude:t[1]-n[1]+this.latitude}}};function aA(e,t){let r=He.transformMat4([],t,e);return He.scale(r,r,1/r[3]),r}var cA=Math.PI/180;function EY({height:e,focalDistance:t,orbitAxis:r,rotationX:n,rotationOrbit:s,zoom:i}){let o=r==="Z"?[0,0,1]:[0,1,0],a=r==="Z"?[0,-t,0]:[0,0,t],c=new $().lookAt({eye:a,up:o});c.rotateX(n*cA),r==="Z"?c.rotateZ(s*cA):c.rotateY(s*cA);let l=Math.pow(2,i)/e;return c.scale(l),c}var oo=class extends oe{constructor(t){let{height:r,projectionMatrix:n,fovy:s=50,orbitAxis:i="Z",target:o=[0,0,0],rotationX:a=0,rotationOrbit:c=0,zoom:l=0}=t,h=n?n[5]/2:qn(s);super({...t,longitude:void 0,viewMatrix:EY({height:r||1,focalDistance:h,orbitAxis:i,rotationX:a,rotationOrbit:c,zoom:l}),fovy:s,focalDistance:h,position:o,zoom:l}),this.projectedCenter=this.project(this.center)}unproject(t,{topLeft:r=!0}={}){let[n,s,i=this.projectedCenter[2]]=t,o=r?s:this.height-s,[a,c,l]=Mr([n,o,i],this.pixelUnprojectionMatrix);return[a,c,l]}panByPosition(t,r){let n=this.project(t),s=[this.width/2+n[0]-r[0],this.height/2+n[1]-r[1],this.projectedCenter[2]];return{target:this.unproject(s)}}};var bY=new $().lookAt({eye:[0,0,1]});function SY({width:e,height:t,near:r,far:n,padding:s}){let i=-e/2,o=e/2,a=-t/2,c=t/2;if(s){let{left:l=0,right:h=0,top:f=0,bottom:u=0}=s,d=ft((l+e-h)/2,0,e)-e/2,p=ft((f+t-u)/2,0,t)-t/2;i-=d,o-=d,a+=p,c+=p}return new $().ortho({left:i,right:o,bottom:a,top:c,near:r,far:n})}var es=class extends oe{constructor(t){let{width:r,height:n,near:s=.1,far:i=1e3,zoom:o=0,target:a=[0,0,0],padding:c=null,flipY:l=!0}=t,h=Array.isArray(o)?o[0]:o,f=Array.isArray(o)?o[1]:o,u=Math.min(h,f),d=Math.pow(2,u),p;if(h!==f){let g=Math.pow(2,h),m=Math.pow(2,f);p={unitsPerMeter:[g/d,m/d,1],metersPerUnit:[d/g,d/m,1]}}super({...t,longitude:void 0,position:a,viewMatrix:bY.clone().scale([d,d*(l?-1:1),d]),projectionMatrix:SY({width:r||1,height:n||1,padding:c,near:s,far:i}),zoom:u,distanceScales:p})}projectFlat([t,r]){let{unitsPerMeter:n}=this.distanceScales;return[t*n[0],r*n[1]]}unprojectFlat([t,r]){let{metersPerUnit:n}=this.distanceScales;return[t*n[0],r*n[1]]}panByPosition(t,r){let n=Mr(r,this.pixelUnprojectionMatrix),s=this.projectFlat(t),i=ie.add([],s,ie.negate([],n)),o=ie.add([],this.center,i);return{target:this.unprojectFlat(o)}}};var ao=class extends oe{constructor(t){let{longitude:r,latitude:n,modelMatrix:s,bearing:i=0,pitch:o=0,up:a=[0,0,1]}=t,l=new Br({bearing:i,pitch:o===-90?1e-4:90+o}).toVector3().normalize(),h=s?new $(s).transformAsVector(l):l,f=Number.isFinite(n)?uh({latitude:n}):0,u=Math.pow(2,f),d=new $().lookAt({eye:[0,0,0],center:h,up:a}).scale(u);super({...t,zoom:f,viewMatrix:d}),this.latitude=n,this.longitude=r}};var co=20,FP=500,tf=class extends Qn{constructor(t){let{width:r,height:n,position:s=[0,0,0],bearing:i=0,pitch:o=0,longitude:a=null,latitude:c=null,maxPitch:l=90,minPitch:h=-90,startRotatePos:f,startBearing:u,startPitch:d,startZoomPosition:p,startPanPos:g,startPanPosition:m}=t;super({width:r,height:n,position:s,bearing:i,pitch:o,longitude:a,latitude:c,maxPitch:l,minPitch:h},{startRotatePos:f,startBearing:u,startPitch:d,startZoomPosition:p,startPanPos:g,startPanPosition:m}),this.makeViewport=t.makeViewport}panStart({pos:t}){let{position:r}=this.getViewportProps();return this._getUpdatedState({startPanPos:t,startPanPosition:r})}pan({pos:t}){if(!t)return this;let{startPanPos:r=[0,0],startPanPosition:n=[0,0]}=this.getState(),{width:s,height:i,bearing:o,pitch:a}=this.getViewportProps(),c=FP*(t[0]-r[0])/s,l=FP*(t[1]-r[1])/i,h=new Br({bearing:o,pitch:a}),f=new Br({bearing:o,pitch:-90}),u=h.toVector3().normalize(),d=f.toVector3().cross(u).normalize();return this._getUpdatedState({position:new D(n).add(d.scale(c)).add(u.scale(l))})}panEnd(){return this._getUpdatedState({startPanPos:null,startPanPosition:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:t,deltaAngleX:r=0,deltaAngleY:n=0}){let{startRotatePos:s,startBearing:i,startPitch:o}=this.getState(),{width:a,height:c}=this.getViewportProps();if(!s||i===void 0||o===void 0)return this;let l;if(t){let h=(t[0]-s[0])/a,f=(t[1]-s[1])/c;l={bearing:i-h*180,pitch:o-f*90}}else l={bearing:i-r,pitch:o-n};return this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startRotatePos:null,startBearing:null,startPitch:null})}zoomStart(){return this._getUpdatedState({startZoomPosition:this.getViewportProps().position})}zoom({pos:t,scale:r}){let n=this.getViewportProps(),s=this.getState().startZoomPosition||n.position,i=this.makeViewport(n),{projectionMatrix:o,width:a}=i,l=2*Math.atan(1/o[0])*(t[0]/a-.5),h=this.getDirection(!0);return this._move(h.rotateZ({radians:-l}),Math.log2(r)*co,s)}zoomEnd(){return this._getUpdatedState({startZoomPosition:null})}moveLeft(t=co){let r=this.getDirection(!0);return this._move(r.rotateZ({radians:Math.PI/2}),t)}moveRight(t=co){let r=this.getDirection(!0);return this._move(r.rotateZ({radians:-Math.PI/2}),t)}moveUp(t=co){let r=this.getDirection(!0);return this._move(r,t)}moveDown(t=co){let r=this.getDirection(!0);return this._move(r.negate(),t)}rotateLeft(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-t})}rotateRight(t=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+t})}rotateUp(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+t})}rotateDown(t=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-t})}zoomIn(t=co){return this._move(new D(0,0,1),t)}zoomOut(t=co){return this._move(new D(0,0,-1),t)}shortestPathFrom(t){let r=t.getViewportProps(),n={...this.getViewportProps()},{bearing:s,longitude:i}=n;return Math.abs(s-r.bearing)>180&&(n.bearing=s<0?s+360:s-360),i!==null&&r.longitude!==null&&Math.abs(i-r.longitude)>180&&(n.longitude=i<0?i+360:i-360),n}_move(t,r,n=this.getViewportProps().position){let s=t.scale(r);return this._getUpdatedState({position:new D(n).add(s)})}getDirection(t=!1){return new Br({bearing:this.getViewportProps().bearing,pitch:t?90:90+this.getViewportProps().pitch}).toVector3().normalize()}_getUpdatedState(t){return new tf({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}applyConstraints(t){let{pitch:r,maxPitch:n,minPitch:s,longitude:i,bearing:o}=t;return t.pitch=ft(r,s,n),i!==null&&(i<-180||i>180)&&(t.longitude=Xi(i+180,360)-180),(o<-180||o>180)&&(t.bearing=Xi(o+180,360)-180),t}},lo=class extends je{constructor(){super(...arguments),this.ControllerState=tf,this.transition={transitionDuration:300,transitionInterpolator:new Ee(["position","pitch","bearing"])}}};var Wg=class extends Ge{constructor(t={}){super(t)}getViewportType(){return ao}get ControllerType(){return lo}};Wg.displayName="FirstPersonView";var DP=Wg;var ef=class extends Qn{constructor(t){let{width:r,height:n,rotationX:s=0,rotationOrbit:i=0,target:o=[0,0,0],zoom:a=0,minRotationX:c=-90,maxRotationX:l=90,minZoom:h=-1/0,maxZoom:f=1/0,startPanPosition:u,startRotatePos:d,startRotationX:p,startRotationOrbit:g,startZoomPosition:m,startZoom:_}=t;super({width:r,height:n,rotationX:s,rotationOrbit:i,target:o,zoom:a,minRotationX:c,maxRotationX:l,minZoom:h,maxZoom:f},{startPanPosition:u,startRotatePos:d,startRotationX:p,startRotationOrbit:g,startZoomPosition:m,startZoom:_}),this.makeViewport=t.makeViewport}panStart({pos:t}){return this._getUpdatedState({startPanPosition:this._unproject(t)})}pan({pos:t,startPosition:r}){let n=this.getState().startPanPosition||r;if(!n)return this;let i=this.makeViewport(this.getViewportProps()).panByPosition(n,t);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanPosition:null})}rotateStart({pos:t}){return this._getUpdatedState({startRotatePos:t,startRotationX:this.getViewportProps().rotationX,startRotationOrbit:this.getViewportProps().rotationOrbit})}rotate({pos:t,deltaAngleX:r=0,deltaAngleY:n=0}){let{startRotatePos:s,startRotationX:i,startRotationOrbit:o}=this.getState(),{width:a,height:c}=this.getViewportProps();if(!s||i===void 0||o===void 0)return this;let l;if(t){let h=(t[0]-s[0])/a,f=(t[1]-s[1])/c;(i<-90||i>90)&&(h*=-1),l={rotationX:i+f*180,rotationOrbit:o+h*180}}else l={rotationX:i+n,rotationOrbit:o+r};return this._getUpdatedState(l)}rotateEnd(){return this._getUpdatedState({startRotationX:null,startRotationOrbit:null})}shortestPathFrom(t){let r=t.getViewportProps(),n={...this.getViewportProps()},{rotationOrbit:s}=n;return Math.abs(s-r.rotationOrbit)>180&&(n.rotationOrbit=s<0?s+360:s-360),n}zoomStart({pos:t}){return this._getUpdatedState({startZoomPosition:this._unproject(t),startZoom:this.getViewportProps().zoom})}zoom({pos:t,startPos:r,scale:n}){let{startZoom:s,startZoomPosition:i}=this.getState();if(i||(s=this.getViewportProps().zoom,i=this._unproject(r)||this._unproject(t)),!i)return this;let o=this._calculateNewZoom({scale:n,startZoom:s}),a=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...a.panByPosition(i,t)})}zoomEnd(){return this._getUpdatedState({startZoomPosition:null,startZoom:null})}zoomIn(t=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:t})})}zoomOut(t=2){return this._getUpdatedState({zoom:this._calculateNewZoom({scale:1/t})})}moveLeft(t=50){return this._panFromCenter([-t,0])}moveRight(t=50){return this._panFromCenter([t,0])}moveUp(t=50){return this._panFromCenter([0,-t])}moveDown(t=50){return this._panFromCenter([0,t])}rotateLeft(t=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit-t})}rotateRight(t=15){return this._getUpdatedState({rotationOrbit:this.getViewportProps().rotationOrbit+t})}rotateUp(t=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX-t})}rotateDown(t=10){return this._getUpdatedState({rotationX:this.getViewportProps().rotationX+t})}_unproject(t){let r=this.makeViewport(this.getViewportProps());return t&&r.unproject(t)}_calculateNewZoom({scale:t,startZoom:r}){let{maxZoom:n,minZoom:s}=this.getViewportProps();r===void 0&&(r=this.getViewportProps().zoom);let i=r+Math.log2(t);return ft(i,s,n)}_panFromCenter(t){let{width:r,height:n,target:s}=this.getViewportProps();return this.pan({startPosition:s,pos:[r/2+t[0],n/2+t[1]]})}_getUpdatedState(t){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...t})}applyConstraints(t){let{maxZoom:r,minZoom:n,zoom:s,maxRotationX:i,minRotationX:o,rotationOrbit:a}=t;return t.zoom=Array.isArray(s)?[ft(s[0],n,r),ft(s[1],n,r)]:ft(s,n,r),t.rotationX=ft(t.rotationX,o,i),(a<-180||a>180)&&(t.rotationOrbit=Xi(a+180,360)-180),t}},ho=class extends je{constructor(){super(...arguments),this.ControllerState=ef,this.transition={transitionDuration:300,transitionInterpolator:new Ee({transitionProps:{compare:["target","zoom","rotationX","rotationOrbit"],required:["target","zoom"]}})}}};var Gg=class extends Ge{constructor(t={}){super(t),this.props.orbitAxis=t.orbitAxis||"Z"}getViewportType(){return oo}get ControllerType(){return ho}};Gg.displayName="OrbitView";var kP=Gg;var lA=class extends ef{constructor(t){super(t),this.zoomAxis=t.zoomAxis||"all"}_calculateNewZoom({scale:t,startZoom:r}){let{maxZoom:n,minZoom:s}=this.getViewportProps();r===void 0&&(r=this.getViewportProps().zoom);let i=Math.log2(t);if(Array.isArray(r)){let[o,a]=r;switch(this.zoomAxis){case"X":o=ft(o+i,s,n);break;case"Y":a=ft(a+i,s,n);break;default:let c=Math.min(o+i,a+i);c<s&&(i+=s-c),c=Math.max(o+i,a+i),c>n&&(i+=n-c),o+=i,a+=i}return[o,a]}return ft(r+i,s,n)}},fo=class extends je{constructor(){super(...arguments),this.ControllerState=lA,this.transition={transitionDuration:300,transitionInterpolator:new Ee(["target","zoom"])},this.dragMode="pan"}_onPanRotate(){return!1}};var jg=class extends Ge{constructor(t={}){super(t)}getViewportType(){return es}get ControllerType(){return fo}};jg.displayName="OrthographicView";var UP=jg;var hA=class extends Ih{applyConstraints(t){let{maxZoom:r,minZoom:n,zoom:s}=t;t.zoom=ft(s,n,r);let{longitude:i,latitude:o}=t;return(i<-180||i>180)&&(t.longitude=Xi(i+180,360)-180),t.latitude=ft(o,-Tr,Tr),t}},uo=class extends je{constructor(){super(...arguments),this.ControllerState=hA,this.transition={transitionDuration:300,transitionInterpolator:new Ee(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(t){super.setProps(t),this.dragRotate=!1,this.touchRotate=!1}};var qg=class extends Ge{constructor(t={}){super(t)}getViewportType(t){return t.zoom>12?Re:Xr}get ControllerType(){return uo}};qg.displayName="GlobeView";var Xg=qg;var rf=class{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(t){t&&(this.opts=t)}equals(t){return this===t?!0:this.constructor===t.constructor&&tt(this.opts,t.opts,1)}getShaders(t){return null}getSubLayerProps(t){let{defaultProps:r}=t.constructor,n={updateTriggers:{}};for(let s in r)if(s in this.props){let i=r[s],o=this.props[s];n[s]=o,i&&i.type==="accessor"&&(n.updateTriggers[s]=this.props.updateTriggers[s],typeof o=="function"&&(n[s]=this.getSubLayerAccessor(o)))}return n}initializeState(t,r){}updateState(t,r){}onNeedsRedraw(t){}getNeedsPickingBuffer(t){return!1}draw(t,r){}finalizeState(t,r){}};rf.defaultProps={};rf.extensionName="LayerExtension";var ce=rf;var fA={bearing:0,pitch:0,position:[0,0,0]},vY={speed:1.2,curve:1.414},rs=class extends Jn{constructor(t={}){super({compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),this.opts={...vY,...t}}interpolateProps(t,r,n){let s=C2(t,r,n,this.opts);for(let i in fA)s[i]=he(t[i]||fA[i],r[i]||fA[i],n);return s}getDuration(t,r){let{transitionDuration:n}=r;return n==="auto"&&(n=P2(t,r,this.opts)),n}};var ns=class{constructor(t){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;let{attributes:r={}}=t;this.typedArrayManager=kr,this.attributes={},this._attributeDefs=r,this.opts=t,this.updateGeometry(t)}updateGeometry(t){Object.assign(this.opts,t);let{data:r,buffers:n={},getGeometry:s,geometryBuffer:i,positionFormat:o,dataChanged:a,normalize:c=!0}=this.opts;if(this.data=r,this.getGeometry=s,this.positionSize=i&&i.size||(o==="XY"?2:3),this.buffers=n,this.normalize=c,i&&(yt(r.startIndices),this.getGeometry=this.getGeometryFromBuffer(i),c||(n.vertexPositions=i)),this.geometryBuffer=n.vertexPositions,Array.isArray(a))for(let l of a)this._rebuildGeometry(l);else this._rebuildGeometry()}updatePartialGeometry({startRow:t,endRow:r}){this._rebuildGeometry({startRow:t,endRow:r})}getGeometryFromBuffer(t){let r=t.value||t;return ArrayBuffer.isView(r)?Ig(r,{size:this.positionSize,offset:t.offset,stride:t.stride,startIndices:this.data.startIndices}):null}_allocate(t,r){let{attributes:n,buffers:s,_attributeDefs:i,typedArrayManager:o}=this;for(let a in i)if(a in s)o.release(n[a]),n[a]=null;else{let c=i[a];c.copy=r,n[a]=o.allocate(n[a],t,c)}}_forEachGeometry(t,r,n){let{data:s,getGeometry:i}=this,{iterable:o,objectInfo:a}=Yt(s,r,n);for(let c of o){a.index++;let l=i?i(c,a):null;t(l,a.index)}}_rebuildGeometry(t){if(!this.data)return;let{indexStarts:r,vertexStarts:n,instanceCount:s}=this,{data:i,geometryBuffer:o}=this,{startRow:a=0,endRow:c=1/0}=t||{},l={};if(t||(r=[0],n=[0]),this.normalize||!o)this._forEachGeometry((f,u)=>{let d=f&&this.normalizeGeometry(f);l[u]=d,n[u+1]=n[u]+(d?this.getGeometrySize(d):0)},a,c),s=n[n.length-1];else if(n=i.startIndices,s=n[i.length]||0,ArrayBuffer.isView(o))s=s||o.length/this.positionSize;else if(o instanceof K){let f=this.positionSize*4;s=s||o.byteLength/f}else if(o.buffer){let f=o.stride||this.positionSize*4;s=s||o.buffer.byteLength/f}else if(o.value){let f=o.value,u=o.stride/f.BYTES_PER_ELEMENT||this.positionSize;s=s||f.length/u}this._allocate(s,Boolean(t)),this.indexStarts=r,this.vertexStarts=n,this.instanceCount=s;let h={};this._forEachGeometry((f,u)=>{let d=l[u]||f;h.vertexStart=n[u],h.indexStart=r[u];let p=u<n.length-1?n[u+1]:s;h.geometrySize=p-n[u],h.geometryIndex=u,this.updateGeometryAttributes(d,h)},a,c),this.vertexCount=r[r.length-1]}};function Yr(e,t){t&&Object.entries(t).map(([r,n])=>{r.startsWith("--")?e.style.setProperty(r,n):e.style[r]=n})}function Zs(e,t){t&&Object.keys(t).map(r=>{r.startsWith("--")?e.style.removeProperty(r):e.style[r]=""})}var zP=`uniform arcUniforms {
    bool greatCircle;
    bool useShortestPath;
    float numSegments;
    float widthScale;
    float widthMinPixels;
    float widthMaxPixels;
    highp int widthUnits;
  } arc;
  `,VP={name:"arc",vs:zP,fs:zP,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}};var HP=`#version 300 es
  #define SHADER_NAME arc-layer-vertex-shader
  in vec4 instanceSourceColors;
  in vec4 instanceTargetColors;
  in vec3 instanceSourcePositions;
  in vec3 instanceSourcePositions64Low;
  in vec3 instanceTargetPositions;
  in vec3 instanceTargetPositions64Low;
  in vec3 instancePickingColors;
  in float instanceWidths;
  in float instanceHeights;
  in float instanceTilts;
  out vec4 vColor;
  out vec2 uv;
  out float isValid;
  float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
  float deltaZ = targetZ - sourceZ;
  float dh = distance * instanceHeights;
  if (dh == 0.0) {
  return sourceZ + deltaZ * ratio;
  }
  float unitZ = deltaZ / dh;
  float p2 = unitZ * unitZ + 1.0;
  float dir = step(deltaZ, 0.0);
  float z0 = mix(sourceZ, targetZ, dir);
  float r = mix(ratio, 1.0 - ratio, dir);
  return sqrt(r * (p2 - r)) * dh + z0;
  }
  vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return dir_screenspace * offset_direction * width / 2.0;
  }
  float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));
  }
  vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
  float distance = length(source.xy - target.xy);
  float z = paraboloid(distance, source.z, target.z, segmentRatio);
  float tiltAngle = radians(instanceTilts);
  vec2 tiltDirection = normalize(target.xy - source.xy);
  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
  return vec3(
  mix(source.xy, target.xy, segmentRatio) + tilt,
  z * cos(tiltAngle)
  );
  }
  float getAngularDist (vec2 source, vec2 target) {
  vec2 sourceRadians = radians(source);
  vec2 targetRadians = radians(target);
  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
  vec2 shd_sq = sin_half_delta * sin_half_delta;
  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
  return 2.0 * asin(sqrt(a));
  }
  vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
  vec2 lngLat;
  if(abs(angularDist - PI) < 0.001) {
  lngLat = (1.0 - t) * source.xy + t * target.xy;
  } else {
  float a = sin((1.0 - t) * angularDist);
  float b = sin(t * angularDist);
  vec3 p = source3D.yxz * a + target3D.yxz * b;
  lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
  }
  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
  return vec3(lngLat, z);
  }
  void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;
  float segmentIndex = float(gl_VertexID / 2);
  float segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
  float nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  isValid = 1.0;
  uv = vec2(segmentRatio, segmentSide);
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;
  vec4 curr;
  vec4 next;
  vec3 source;
  vec3 target;
  if ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
  source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
  target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
  float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
  vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
  vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
  vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
  if (abs(currPos.x - prevPos.x) > 180.0) {
  indexDir = -1.0;
  isValid = 0.0;
  } else if (abs(currPos.x - nextPos.x) > 180.0) {
  indexDir = 1.0;
  isValid = 0.0;
  }
  nextPos = indexDir < 0.0 ? prevPos : nextPos;
  nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
  if (isValid == 0.0) {
  nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
  float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
  currPos = mix(currPos, nextPos, t);
  segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
  }
  vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
  vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
  curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
  next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
  } else {
  vec3 source_world = instanceSourcePositions;
  vec3 target_world = instanceTargetPositions;
  if (arc.useShortestPath) {
  source_world.x = mod(source_world.x + 180., 360.0) - 180.;
  target_world.x = mod(target_world.x + 180., 360.0) - 180.;
  float deltaLng = target_world.x - source_world.x;
  if (deltaLng > 180.) target_world.x -= 360.;
  if (deltaLng < -180.) source_world.x -= 360.;
  }
  source = project_position(source_world, instanceSourcePositions64Low);
  target = project_position(target_world, instanceTargetPositions64Low);
  float antiMeridianX = 0.0;
  if (arc.useShortestPath) {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
  antiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;
  }
  float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
  if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
  isValid = 0.0;
  indexDir = sign(segmentRatio - thresholdRatio);
  segmentRatio = thresholdRatio;
  }
  }
  nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
  vec3 currPos = interpolateFlat(source, target, segmentRatio);
  vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
  if (arc.useShortestPath) {
  if (nextPos.x < antiMeridianX) {
  currPos.x += TILE_SIZE;
  nextPos.x += TILE_SIZE;
  }
  }
  curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
  next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
  geometry.position = vec4(currPos, 1.0);
  }
  float widthPixels = clamp(
  project_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),
  arc.widthMinPixels, arc.widthMaxPixels
  );
  vec3 offset = vec3(
  getExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),
  0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(curr, geometry);
  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
  vColor = vec4(color.rgb, color.a * layer.opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
  }
  `;var WP=`#version 300 es
  #define SHADER_NAME arc-layer-fragment-shader
  precision highp float;
  in vec4 vColor;
  in vec2 uv;
  in float isValid;
  out vec4 fragColor;
  void main(void) {
  if (isValid == 0.0) {
  discard;
  }
  fragColor = vColor;
  geometry.uv = uv;
  DECKGL_FILTER_COLOR(fragColor, geometry);
  }
  `;var Yg=[0,0,0,255],wY={getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getSourceColor:{type:"accessor",value:Yg},getTargetColor:{type:"accessor",value:Yg},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},nf=class extends ut{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:HP,fs:WP,modules:[st,Tt,VP]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:Yg},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:Yg},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){let{widthUnits:r,widthScale:n,widthMinPixels:s,widthMaxPixels:i,greatCircle:o,wrapLongitude:a,numSegments:c}=this.props,l={numSegments:c,widthUnits:Lt[r],widthScale:n,widthMinPixels:s,widthMaxPixels:i,greatCircle:o,useShortestPath:a},h=this.state.model;h.shaderInputs.setProps({arc:l}),h.setVertexCount(c*2),h.draw(this.context.renderPass)}_getModel(){return new Y(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0})}};nf.layerName="ArcLayer";nf.defaultProps=wY;var $g=nf;var CY=new Uint32Array([0,2,1,0,3,2]),PY=new Float32Array([0,1,0,0,1,0,1,1]);function uA(e,t){if(!t)return RY(e);let r=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),n=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),s=Math.ceil(r/t)+1,i=Math.ceil(n/t)+1,o=(s-1)*(i-1)*6,a=new Uint32Array(o),c=new Float32Array(s*i*2),l=new Float64Array(s*i*3),h=0,f=0;for(let u=0;u<s;u++){let d=u/(s-1);for(let p=0;p<i;p++){let g=p/(i-1),m=IY(e,d,g);l[h*3+0]=m[0],l[h*3+1]=m[1],l[h*3+2]=m[2]||0,c[h*2+0]=d,c[h*2+1]=1-g,u>0&&p>0&&(a[f++]=h-i,a[f++]=h-i-1,a[f++]=h-1,a[f++]=h-i,a[f++]=h-1,a[f++]=h),h++}}return{vertexCount:o,positions:l,indices:a,texCoords:c}}function RY(e){let t=new Float64Array(12);for(let r=0;r<e.length;r++)t[r*3+0]=e[r][0],t[r*3+1]=e[r][1],t[r*3+2]=e[r][2]||0;return{vertexCount:6,positions:t,indices:CY,texCoords:PY}}function IY(e,t,r){return he(he(e[0],e[1],r),he(e[3],e[2],r),t)}var GP=`uniform bitmapUniforms {
    vec4 bounds;
    float coordinateConversion;
    float desaturate;
    vec3 tintColor;
    vec4 transparentColor;
  } bitmap;
  `,jP={name:"bitmap",vs:GP,fs:GP,uniformTypes:{bounds:"vec4<f32>",coordinateConversion:"f32",desaturate:"f32",tintColor:"vec3<f32>",transparentColor:"vec4<f32>"}};var qP=`#version 300 es
  #define SHADER_NAME bitmap-layer-vertex-shader
  
  in vec2 texCoords;
  in vec3 positions;
  in vec3 positions64Low;
  
  out vec2 vTexCoord;
  out vec2 vTexPos;
  
  const vec3 pickingColor = vec3(1.0, 0.0, 0.0);
  
  void main(void) {
    geometry.worldPosition = positions;
    geometry.uv = texCoords;
    geometry.pickingColor = pickingColor;
  
    gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  
    vTexCoord = texCoords;
  
    if (bitmap.coordinateConversion < -0.5) {
      vTexPos = geometry.position.xy + project.commonOrigin.xy;
    } else if (bitmap.coordinateConversion > 0.5) {
      vTexPos = geometry.worldPosition.xy;
    }
  
    vec4 color = vec4(0.0);
    DECKGL_FILTER_COLOR(color, geometry);
  }
  `;var OY=`
  vec3 packUVsIntoRGB(vec2 uv) {
    // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
    vec2 uv8bit = floor(uv * 256.);
  
    // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
    // Scale and clamp to 0-1 range
    vec2 uvFraction = fract(uv * 256.);
    vec2 uvFraction4bit = floor(uvFraction * 16.);
  
    // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
    float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;
  
    return vec3(uv8bit, fractions) / 255.;
  }
  `,XP=`#version 300 es
  #define SHADER_NAME bitmap-layer-fragment-shader
  
  #ifdef GL_ES
  precision highp float;
  #endif
  
  uniform sampler2D bitmapTexture;
  
  in vec2 vTexCoord;
  in vec2 vTexPos;
  
  out vec4 fragColor;
  
  /* projection utils */
  const float TILE_SIZE = 512.0;
  const float PI = 3.1415926536;
  const float WORLD_SCALE = TILE_SIZE / PI / 2.0;
  
  // from degrees to Web Mercator
  vec2 lnglat_to_mercator(vec2 lnglat) {
    float x = lnglat.x;
    float y = clamp(lnglat.y, -89.9, 89.9);
    return vec2(
      radians(x) + PI,
      PI + log(tan(PI * 0.25 + radians(y) * 0.5))
    ) * WORLD_SCALE;
  }
  
  // from Web Mercator to degrees
  vec2 mercator_to_lnglat(vec2 xy) {
    xy /= WORLD_SCALE;
    return degrees(vec2(
      xy.x - PI,
      atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
    ));
  }
  /* End projection utils */
  
  // apply desaturation
  vec3 color_desaturate(vec3 color) {
    float luminance = (color.r + color.g + color.b) * 0.333333333;
    return mix(color, vec3(luminance), bitmap.desaturate);
  }
  
  // apply tint
  vec3 color_tint(vec3 color) {
    return color * bitmap.tintColor;
  }
  
  // blend with background color
  vec4 apply_opacity(vec3 color, float alpha) {
    if (bitmap.transparentColor.a == 0.0) {
      return vec4(color, alpha);
    }
    float blendedAlpha = alpha + bitmap.transparentColor.a * (1.0 - alpha);
    float highLightRatio = alpha / blendedAlpha;
    vec3 blendedRGB = mix(bitmap.transparentColor.rgb, color, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  }
  
  vec2 getUV(vec2 pos) {
    return vec2(
      (pos.x - bitmap.bounds[0]) / (bitmap.bounds[2] - bitmap.bounds[0]),
      (pos.y - bitmap.bounds[3]) / (bitmap.bounds[1] - bitmap.bounds[3])
    );
  }
  
  ${OY}
  
  void main(void) {
    vec2 uv = vTexCoord;
    if (bitmap.coordinateConversion < -0.5) {
      vec2 lnglat = mercator_to_lnglat(vTexPos);
      uv = getUV(lnglat);
    } else if (bitmap.coordinateConversion > 0.5) {
      vec2 commonPos = lnglat_to_mercator(vTexPos);
      uv = getUV(commonPos);
    }
    vec4 bitmapColor = texture(bitmapTexture, uv);
  
    fragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * layer.opacity);
  
    geometry.uv = uv;
    DECKGL_FILTER_COLOR(fragColor, geometry);
  
    if (bool(picking.isActive) && !bool(picking.isAttribute)) {
      // Since instance information is not used, we can use picking color for pixel index
      fragColor.rgb = packUVsIntoRGB(uv);
    }
  }
  `;var LY={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:W.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0,value:null}},sf=class extends ut{getShaders(){return super.getShaders({vs:qP,fs:XP,modules:[st,Tt,jP]})}initializeState(){let t=this.getAttributeManager();t.remove(["instancePickingColors"]);let r=!0;t.add({indices:{size:1,isIndexed:!0,update:n=>n.value=this.state.mesh.indices,noAlloc:r},positions:{size:3,type:"float64",fp64:this.use64bitPositions(),update:n=>n.value=this.state.mesh.positions,noAlloc:r},texCoords:{size:2,update:n=>n.value=this.state.mesh.texCoords,noAlloc:r}})}updateState({props:t,oldProps:r,changeFlags:n}){let s=this.getAttributeManager();if(n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),s.invalidateAll()),t.bounds!==r.bounds){let i=this.state.mesh,o=this._createMesh();this.state.model.setVertexCount(o.vertexCount);for(let a in o)i&&i[a]!==o[a]&&s.invalidate(a);this.setState({mesh:o,...this._getCoordinateUniforms()})}else t._imageCoordinateSystem!==r._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}getPickingInfo(t){let{image:r}=this.props,n=t.info;if(!n.color||!r)return n.bitmap=null,n;let{width:s,height:i}=r;n.index=0;let o=NY(n.color);return n.bitmap={size:{width:s,height:i},uv:o,pixel:[Math.floor(o[0]*s),Math.floor(o[1]*i)]},n}disablePickingIndex(){this.setState({disablePicking:!0})}restorePickingColors(){this.setState({disablePicking:!1})}_updateAutoHighlight(t){super._updateAutoHighlight({...t,color:this.encodePickingColor(0)})}_createMesh(){let{bounds:t}=this.props,r=t;return YP(t)&&(r=[[t[0],t[1]],[t[0],t[3]],[t[2],t[3]],[t[2],t[1]]]),uA(r,this.context.viewport.resolution)}_getModel(){return new Y(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-list",isInstanced:!1})}draw(t){let{shaderModuleProps:r}=t,{model:n,coordinateConversion:s,bounds:i,disablePicking:o}=this.state,{image:a,desaturate:c,transparentColor:l,tintColor:h}=this.props;if(!(r.picking.isActive&&o)&&a&&n){let f={bitmapTexture:a,bounds:i,coordinateConversion:s,desaturate:c,tintColor:h.slice(0,3).map(u=>u/255),transparentColor:l.map(u=>u/255)};n.shaderInputs.setProps({bitmap:f}),n.draw(this.context.renderPass)}}_getCoordinateUniforms(){let{LNGLAT:t,CARTESIAN:r,DEFAULT:n}=W,{_imageCoordinateSystem:s}=this.props;if(s!==n){let{bounds:i}=this.props;if(!YP(i))throw new Error("_imageCoordinateSystem only supports rectangular bounds");let o=this.context.viewport.resolution?t:r;if(s=s===t?t:r,s===t&&o===r)return{coordinateConversion:-1,bounds:i};if(s===r&&o===t){let a=Kt([i[0],i[1]]),c=Kt([i[2],i[3]]);return{coordinateConversion:1,bounds:[a[0],a[1],c[0],c[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}};sf.layerName="BitmapLayer";sf.defaultProps=LY;var Kg=sf;function NY(e){let[t,r,n]=e,s=(n&240)/256,i=(n&15)/16;return[(t+i)/256,(r+s)/256]}function YP(e){return Number.isFinite(e[0])}var $P=`uniform iconUniforms {
    float sizeScale;
    vec2 iconsTextureDim;
    float sizeMinPixels;
    float sizeMaxPixels;
    bool billboard;
    highp int sizeUnits;
    float alphaCutoff;
  } icon;
  `,KP={name:"icon",vs:$P,fs:$P,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}};var ZP=`#version 300 es
  #define SHADER_NAME icon-layer-vertex-shader
  in vec2 positions;
  in vec3 instancePositions;
  in vec3 instancePositions64Low;
  in float instanceSizes;
  in float instanceAngles;
  in vec4 instanceColors;
  in vec3 instancePickingColors;
  in vec4 instanceIconFrames;
  in float instanceColorModes;
  in vec2 instanceOffsets;
  in vec2 instancePixelOffset;
  out float vColorMode;
  out vec4 vColor;
  out vec2 vTextureCoords;
  out vec2 uv;
  vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
  }
  void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
  project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
  icon.sizeMinPixels, icon.sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;
  if (icon.billboard)  {
  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  vec3 offset = vec3(pixelOffset, 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
  vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
  DECKGL_FILTER_SIZE(offset_common, geometry);
  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vTextureCoords = mix(
  instanceIconFrames.xy,
  instanceIconFrames.xy + iconSize,
  (positions.xy + 1.0) / 2.0
  ) / icon.iconsTextureDim;
  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
  vColorMode = instanceColorModes;
  }
  `;var JP=`#version 300 es
  #define SHADER_NAME icon-layer-fragment-shader
  precision highp float;
  uniform sampler2D iconsTexture;
  in float vColorMode;
  in vec4 vColor;
  in vec2 vTextureCoords;
  in vec2 uv;
  out vec4 fragColor;
  void main(void) {
  geometry.uv = uv;
  vec4 texColor = texture(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * layer.opacity * vColor.a;
  if (a < icon.alphaCutoff) {
  discard;
  }
  fragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  }
  `;var BY=1024,FY=4,QP=()=>{},tR={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},DY={x:0,y:0,width:0,height:0};function kY(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function UY(e,t,r,n){let s=Math.min(r/t.width,n/t.height),i=Math.floor(t.width*s),o=Math.floor(t.height*s);return s===1?{image:t,width:i,height:o}:(e.canvas.height=o,e.canvas.width=i,e.clearRect(0,0,i,o),e.drawImage(t,0,0,t.width,t.height,0,0,i,o),{image:e.canvas,width:i,height:o})}function of(e){return e&&(e.id||e.url)}function zY(e,t,r,n){let{width:s,height:i,device:o}=e,a=o.createTexture({format:"rgba8unorm",width:t,height:r,sampler:n,mipmaps:!0}),c=o.createCommandEncoder();return c.copyTextureToTexture({sourceTexture:e,destinationTexture:a,width:s,height:i}),c.finish(),e.destroy(),a}function eR(e,t,r){for(let n=0;n<t.length;n++){let{icon:s,xOffset:i}=t[n],o=of(s);e[o]={...s,x:i,y:r}}}function VY({icons:e,buffer:t,mapping:r={},xOffset:n=0,yOffset:s=0,rowHeight:i=0,canvasWidth:o}){let a=[];for(let c=0;c<e.length;c++){let l=e[c],h=of(l);if(!r[h]){let{height:f,width:u}=l;n+u+t>o&&(eR(r,a,s),n=0,s=i+s+t,i=0,a=[]),a.push({icon:l,xOffset:n}),n=n+u+t,i=Math.max(i,f)}}return a.length>0&&eR(r,a,s),{mapping:r,rowHeight:i,xOffset:n,yOffset:s,canvasWidth:o,canvasHeight:kY(i+s+t)}}function HY(e,t,r){if(!e||!t)return null;r=r||{};let n={},{iterable:s,objectInfo:i}=Yt(e);for(let o of s){i.index++;let a=t(o,i),c=of(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!n[c]&&(!r[c]||a.url!==r[c].url)&&(n[c]={...a,source:o,sourceIndex:i.index})}return n}var af=class{constructor(t,{onUpdate:r=QP,onError:n=QP}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=FY,this._canvasWidth=BY,this._canvasHeight=0,this._canvas=null,this.device=t,this.onUpdate=r,this.onError=n}finalize(){this._texture?.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(t){let r=this._autoPacking?of(t):t;return this._mapping[r]||DY}setProps({loadOptions:t,autoPacking:r,iconAtlas:n,iconMapping:s,textureParameters:i}){t&&(this._loadOptions=t),r!==void 0&&(this._autoPacking=r),s&&(this._mapping=s),n&&(this._texture?.delete(),this._texture=null,this._externalTexture=n),i&&(this._samplerParameters=i)}get isLoaded(){return this._pendingCount===0}packIcons(t,r){if(!this._autoPacking||typeof document>"u")return;let n=Object.values(HY(t,r,this._mapping)||{});if(n.length>0){let{mapping:s,xOffset:i,yOffset:o,rowHeight:a,canvasHeight:c}=VY({icons:n,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=s,this._xOffset=i,this._yOffset=o,this._canvasHeight=c,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||tR,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=zY(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||tR)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(n)}}_loadIcons(t){let r=this._canvas.getContext("2d",{willReadFrequently:!0});for(let n of t)this._pendingCount++,se(n.url,this._loadOptions).then(s=>{let i=of(n),o=this._mapping[i],{x:a,y:c,width:l,height:h}=o,{image:f,width:u,height:d}=UY(r,s,l,h);this._texture?.copyExternalImage({image:f,x:a+(l-u)/2,y:c+(h-d)/2,width:u,height:d}),o.width=u,o.height=d,this._texture.generateMipmap(),this.onUpdate()}).catch(s=>{this.onError({url:n.url,source:n.source,sourceIndex:n.sourceIndex,loadOptions:this._loadOptions,error:s})}).finally(()=>{this._pendingCount--})}};var rR=[0,0,0,255],WY={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:e=>e.position},getIcon:{type:"accessor",value:e=>e.icon},getColor:{type:"accessor",value:rR},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}},cf=class extends ut{getShaders(){return super.getShaders({vs:ZP,fs:JP,modules:[st,Tt,KP]})}initializeState(){this.state={iconManager:new af(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:rR},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(t){super.updateState(t);let{props:r,oldProps:n,changeFlags:s}=t,i=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:c,getIcon:l,textureParameters:h}=r,{iconManager:f}=this.state;if(typeof o=="string")return;let u=o||this.internalState.isAsyncPropLoading("iconAtlas");f.setProps({loadOptions:r.loadOptions,autoPacking:!u,iconAtlas:o,iconMapping:u?a:null,textureParameters:h}),u?n.iconMapping!==r.iconMapping&&i.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&f.packIcons(c,l),s.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),i.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(t){super.finalizeState(t),this.state.iconManager.finalize()}draw({uniforms:t}){let{sizeScale:r,sizeMinPixels:n,sizeMaxPixels:s,sizeUnits:i,billboard:o,alphaCutoff:a}=this.props,{iconManager:c}=this.state,l=c.getTexture();if(l){let h=this.state.model,f={iconsTexture:l,iconsTextureDim:[l.width,l.height],sizeUnits:Lt[i],sizeScale:r,sizeMinPixels:n,sizeMaxPixels:s,billboard:o,alphaCutoff:a};h.shaderInputs.setProps({icon:f}),h.draw(this.context.renderPass)}}_getModel(){let t=[-1,-1,1,-1,-1,1,1,1];return new Y(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new it({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(t){let r=this.getCurrentLayer()?.props.onIconError;r?r(t):k.error(t.error.message)()}getInstanceOffset(t){let{width:r,height:n,anchorX:s=r/2,anchorY:i=n/2}=this.state.iconManager.getIconMapping(t);return[r/2-s,n/2-i]}getInstanceColorMode(t){return this.state.iconManager.getIconMapping(t).mask?1:0}getInstanceIconFrame(t){let{x:r,y:n,width:s,height:i}=this.state.iconManager.getIconMapping(t);return[r,n,s,i]}};cf.defaultProps=WY;cf.layerName="IconLayer";var ja=cf;var nR=`uniform lineUniforms {
    float widthScale;
    float widthMinPixels;
    float widthMaxPixels;
    float useShortestPath;
    highp int widthUnits;
  } line;
  `,sR={name:"line",vs:nR,fs:nR,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}};var iR=`#version 300 es
  #define SHADER_NAME line-layer-vertex-shader
  in vec3 positions;
  in vec3 instanceSourcePositions;
  in vec3 instanceTargetPositions;
  in vec3 instanceSourcePositions64Low;
  in vec3 instanceTargetPositions64Low;
  in vec4 instanceColors;
  in vec3 instancePickingColors;
  in float instanceWidths;
  out vec4 vColor;
  out vec2 uv;
  vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return dir_screenspace * offset_direction * width / 2.0;
  }
  vec3 splitLine(vec3 a, vec3 b, float x) {
  float t = (x - a.x) / (b.x - a.x);
  return vec3(x, mix(a.yz, b.yz, t));
  }
  void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;
  vec3 source_world = instanceSourcePositions;
  vec3 target_world = instanceTargetPositions;
  vec3 source_world_64low = instanceSourcePositions64Low;
  vec3 target_world_64low = instanceTargetPositions64Low;
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
  source_world.x = mod(source_world.x + 180., 360.0) - 180.;
  target_world.x = mod(target_world.x + 180., 360.0) - 180.;
  float deltaLng = target_world.x - source_world.x;
  if (deltaLng * line.useShortestPath > 180.) {
  source_world.x += 360. * line.useShortestPath;
  source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
  source_world_64low = vec3(0.0);
  } else if (deltaLng * line.useShortestPath < -180.) {
  target_world.x += 360. * line.useShortestPath;
  target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
  target_world_64low = vec3(0.0);
  } else if (line.useShortestPath < 0.) {
  gl_Position = vec4(0.);
  return;
  }
  }
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;
  float widthPixels = clamp(
  project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
  line.widthMinPixels, line.widthMaxPixels
  );
  vec3 offset = vec3(
  getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
  0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(p, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
  }
  `;var oR=`#version 300 es
  #define SHADER_NAME line-layer-fragment-shader
  precision highp float;
  in vec4 vColor;
  in vec2 uv;
  out vec4 fragColor;
  void main(void) {
  geometry.uv = uv;
  fragColor = vColor;
  DECKGL_FILTER_COLOR(fragColor, geometry);
  }
  `;var GY=[0,0,0,255],jY={getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getColor:{type:"accessor",value:GY},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},lf=class extends ut{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:iR,fs:oR,modules:[st,Tt,sR]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){let{widthUnits:r,widthScale:n,widthMinPixels:s,widthMaxPixels:i,wrapLongitude:o}=this.props,a=this.state.model,c={widthUnits:Lt[r],widthScale:n,widthMinPixels:s,widthMaxPixels:i,useShortestPath:o?1:0};a.shaderInputs.setProps({line:c}),a.draw(this.context.renderPass),o&&(a.shaderInputs.setProps({line:{...c,useShortestPath:-1}}),a.draw(this.context.renderPass))}_getModel(){let t=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Y(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new it({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}};lf.layerName="LineLayer";lf.defaultProps=jY;var aR=lf;var cR=`uniform pointCloudUniforms {
    float radiusPixels;
    highp int sizeUnits;
  } pointCloud;
  `,lR={name:"pointCloud",vs:cR,fs:cR,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}};var hR=`#version 300 es
  #define SHADER_NAME point-cloud-layer-vertex-shader
  in vec3 positions;
  in vec3 instanceNormals;
  in vec4 instanceColors;
  in vec3 instancePositions;
  in vec3 instancePositions64Low;
  in vec3 instancePickingColors;
  out vec4 vColor;
  out vec2 unitPosition;
  void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * layer.opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
  }
  `;var fR=`#version 300 es
  #define SHADER_NAME point-cloud-layer-fragment-shader
  precision highp float;
  in vec4 vColor;
  in vec2 unitPosition;
  out vec4 fragColor;
  void main(void) {
  geometry.uv = unitPosition.xy;
  float distToCenter = length(unitPosition);
  if (distToCenter > 1.0) {
  discard;
  }
  fragColor = vColor;
  DECKGL_FILTER_COLOR(fragColor, geometry);
  }
  `;var uR=[0,0,0,255],dR=[0,0,1],qY={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:e=>e.position},getNormal:{type:"accessor",value:dR},getColor:{type:"accessor",value:uR},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function XY(e){let{header:t,attributes:r}=e;if(!(!t||!r)&&(e.length=t.vertexCount,r.POSITION&&(r.instancePositions=r.POSITION),r.NORMAL&&(r.instanceNormals=r.NORMAL),r.COLOR_0)){let{size:n,value:s}=r.COLOR_0;r.instanceColors={size:n,type:"unorm8",value:s}}}var hf=class extends ut{getShaders(){return super.getShaders({vs:hR,fs:fR,modules:[st,Us,Tt,lR]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:dR},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:uR}})}updateState(t){let{changeFlags:r,props:n}=t;super.updateState(t),r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),r.dataChanged&&XY(n.data)}draw({uniforms:t}){let{pointSize:r,sizeUnits:n}=this.props,s=this.state.model,i={sizeUnits:Lt[n],radiusPixels:r};s.shaderInputs.setProps({pointCloud:i}),s.draw(this.context.renderPass)}_getModel(){let t=[];for(let r=0;r<3;r++){let n=r/3*Math.PI*2;t.push(Math.cos(n)*2,Math.sin(n)*2,0)}return new Y(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new it({topology:"triangle-list",attributes:{positions:new Float32Array(t)}}),isInstanced:!0})}};hf.layerName="PointCloudLayer";hf.defaultProps=qY;var Zg=hf;var pR=`uniform scatterplotUniforms {
    float radiusScale;
    float radiusMinPixels;
    float radiusMaxPixels;
    float lineWidthScale;
    float lineWidthMinPixels;
    float lineWidthMaxPixels;
    float stroked;
    bool filled;
    bool antialiasing;
    bool billboard;
    highp int radiusUnits;
    highp int lineWidthUnits;
  } scatterplot;
  `,gR={name:"scatterplot",vs:pR,fs:pR,uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}};var mR=`#version 300 es
  #define SHADER_NAME scatterplot-layer-vertex-shader
  in vec3 positions;
  in vec3 instancePositions;
  in vec3 instancePositions64Low;
  in float instanceRadius;
  in float instanceLineWidths;
  in vec4 instanceFillColors;
  in vec4 instanceLineColors;
  in vec3 instancePickingColors;
  out vec4 vFillColor;
  out vec4 vLineColor;
  out vec2 unitPosition;
  out float innerUnitRadius;
  out float outerRadiusPixels;
  void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
  project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
  scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );
  float lineWidthPixels = clamp(
  project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
  scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );
  outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
  if (scatterplot.billboard) {
  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  vec3 offset = edgePadding * positions * outerRadiusPixels;
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
  vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
  }
  `;var _R=`#version 300 es
  #define SHADER_NAME scatterplot-layer-fragment-shader
  precision highp float;
  in vec4 vFillColor;
  in vec4 vLineColor;
  in vec2 unitPosition;
  in float innerUnitRadius;
  in float outerRadiusPixels;
  out vec4 fragColor;
  void main(void) {
  geometry.uv = unitPosition;
  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = scatterplot.antialiasing ?
  smoothedge(distToCenter, outerRadiusPixels) :
  step(distToCenter, outerRadiusPixels);
  if (inCircle == 0.0) {
  discard;
  }
  if (scatterplot.stroked > 0.5) {
  float isLine = scatterplot.antialiasing ?
  smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
  step(innerUnitRadius * outerRadiusPixels, distToCenter);
  if (scatterplot.filled) {
  fragColor = mix(vFillColor, vLineColor, isLine);
  } else {
  if (isLine == 0.0) {
  discard;
  }
  fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
  }
  } else if (scatterplot.filled == false) {
  discard;
  } else {
  fragColor = vFillColor;
  }
  fragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(fragColor, geometry);
  }
  `;var xR=[0,0,0,255],YY={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:xR},getLineColor:{type:"accessor",value:xR},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},ff=class extends ut{getShaders(){return super.getShaders({vs:mR,fs:_R,modules:[st,Tt,gR]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t),t.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){let{radiusUnits:r,radiusScale:n,radiusMinPixels:s,radiusMaxPixels:i,stroked:o,filled:a,billboard:c,antialiasing:l,lineWidthUnits:h,lineWidthScale:f,lineWidthMinPixels:u,lineWidthMaxPixels:d}=this.props,p={stroked:o,filled:a,billboard:c,antialiasing:l,radiusUnits:Lt[r],radiusScale:n,radiusMinPixels:s,radiusMaxPixels:i,lineWidthUnits:Lt[h],lineWidthScale:f,lineWidthMinPixels:u,lineWidthMaxPixels:d},g=this.state.model;g.shaderInputs.setProps({scatterplot:p}),g.draw(this.context.renderPass)}_getModel(){let t=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Y(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new it({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(t)}}}),isInstanced:!0})}};ff.defaultProps=YY;ff.layerName="ScatterplotLayer";var Jg=ff;var qa={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function po(e,t,r={}){return yR(e,r)!==t?($Y(e,r),!0):!1}function yR(e,t={}){return Math.sign(Qg(e,t))}var dA={x:0,y:1,z:2};function Qg(e,t={}){let{start:r=0,end:n=e.length,plane:s="xy"}=t,i=t.size||2,o=0,a=dA[s[0]],c=dA[s[1]];for(let l=r,h=n-i;l<n;l+=i)o+=(e[l+a]-e[h+a])*(e[l+c]+e[h+c]),h=l;return o/2}function $Y(e,t){let{start:r=0,end:n=e.length,size:s=2}=t,i=(n-r)/s,o=Math.floor(i/2);for(let a=0;a<o;++a){let c=r+a*s,l=r+(i-1-a)*s;for(let h=0;h<s;++h){let f=e[c+h];e[c+h]=e[l+h],e[l+h]=f}}}function Qe(e,t){let r=t.length,n=e.length;if(n>0){let s=!0;for(let i=0;i<r;i++)if(e[n-r+i]!==t[i]){s=!1;break}if(s)return!1}for(let s=0;s<r;s++)e[n+s]=t[s];return!0}function uf(e,t){let r=t.length;for(let n=0;n<r;n++)e[n]=t[n]}function Js(e,t,r,n,s=[]){let i=n+t*r;for(let o=0;o<r;o++)s[o]=e[i+o];return s}function tm(e,t,r,n,s=[]){let i,o;if(r&8)i=(n[3]-e[1])/(t[1]-e[1]),o=3;else if(r&4)i=(n[1]-e[1])/(t[1]-e[1]),o=1;else if(r&2)i=(n[2]-e[0])/(t[0]-e[0]),o=2;else if(r&1)i=(n[0]-e[0])/(t[0]-e[0]),o=0;else return null;for(let a=0;a<e.length;a++)s[a]=(o&1)===a?n[o]:i*(t[a]-e[a])+e[a];return s}function df(e,t){let r=0;return e[0]<t[0]?r|=1:e[0]>t[2]&&(r|=2),e[1]<t[1]?r|=4:e[1]>t[3]&&(r|=8),r}function pf(e,t){let{size:r=2,broken:n=!1,gridResolution:s=10,gridOffset:i=[0,0],startIndex:o=0,endIndex:a=e.length}=t||{},c=(a-o)/r,l=[],h=[l],f=Js(e,0,r,o),u,d,p=MR(f,s,i,[]),g=[];Qe(l,f);for(let m=1;m<c;m++){for(u=Js(e,m,r,o,u),d=df(u,p);d;){tm(f,u,d,p,g);let _=df(g,p);_&&(tm(f,g,_,p,g),d=_),Qe(l,g),uf(f,g),JY(p,s,d),n&&l.length>r&&(l=[],h.push(l),Qe(l,f)),d=df(u,p)}Qe(l,u),uf(f,u)}return n?h:h[0]}var AR=0,ZY=1;function gf(e,t=null,r){if(!e.length)return[];let{size:n=2,gridResolution:s=10,gridOffset:i=[0,0],edgeTypes:o=!1}=r||{},a=[],c=[{pos:e,types:o?new Array(e.length/n).fill(ZY):null,holes:t||[]}],l=[[],[]],h=[];for(;c.length;){let{pos:f,types:u,holes:d}=c.shift();QY(f,n,d[0]||f.length,l),h=MR(l[0],s,i,h);let p=df(l[1],h);if(p){let g=TR(f,u,n,0,d[0]||f.length,h,p),m={pos:g[0].pos,types:g[0].types,holes:[]},_={pos:g[1].pos,types:g[1].types,holes:[]};c.push(m,_);for(let y=0;y<d.length;y++)g=TR(f,u,n,d[y],d[y+1]||f.length,h,p),g[0]&&(m.holes.push(m.pos.length),m.pos=em(m.pos,g[0].pos),o&&(m.types=em(m.types,g[0].types))),g[1]&&(_.holes.push(_.pos.length),_.pos=em(_.pos,g[1].pos),o&&(_.types=em(_.types,g[1].types)))}else{let g={positions:f};o&&(g.edgeTypes=u),d.length&&(g.holeIndices=d),a.push(g)}}return a}function TR(e,t,r,n,s,i,o){let a=(s-n)/r,c=[],l=[],h=[],f=[],u=[],d,p,g,m=Js(e,a-1,r,n),_=Math.sign(o&8?m[1]-i[3]:m[0]-i[2]),y=t&&t[a-1],x=0,A=0;for(let M=0;M<a;M++)d=Js(e,M,r,n,d),p=Math.sign(o&8?d[1]-i[3]:d[0]-i[2]),g=t&&t[n/r+M],p&&_&&_!==p&&(tm(m,d,o,i,u),Qe(c,u)&&h.push(y),Qe(l,u)&&f.push(y)),p<=0?(Qe(c,d)&&h.push(g),x-=p):h.length&&(h[h.length-1]=AR),p>=0?(Qe(l,d)&&f.push(g),A+=p):f.length&&(f[f.length-1]=AR),uf(m,d),_=p,y=g;return[x?{pos:c,types:t&&h}:null,A?{pos:l,types:t&&f}:null]}function MR(e,t,r,n){let s=Math.floor((e[0]-r[0])/t)*t+r[0],i=Math.floor((e[1]-r[1])/t)*t+r[1];return n[0]=s,n[1]=i,n[2]=s+t,n[3]=i+t,n}function JY(e,t,r){r&8?(e[1]+=t,e[3]+=t):r&4?(e[1]-=t,e[3]-=t):r&2?(e[0]+=t,e[2]+=t):r&1&&(e[0]-=t,e[2]-=t)}function QY(e,t,r,n){let s=1/0,i=-1/0,o=1/0,a=-1/0;for(let c=0;c<r;c+=t){let l=e[c],h=e[c+1];s=l<s?l:s,i=l>i?l:i,o=h<o?h:o,a=h>a?h:a}return n[0][0]=s,n[0][1]=o,n[1][0]=i,n[1][1]=a,n}function em(e,t){for(let r=0;r<t.length;r++)e.push(t[r]);return e}var t$=85.051129;function pA(e,t){let{size:r=2,startIndex:n=0,endIndex:s=e.length,normalize:i=!0}=t||{},o=e.slice(n,s);ER(o,r,0,s-n);let a=pf(o,{size:r,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(i)for(let c of a)bR(c,r);return a}function gA(e,t=null,r){let{size:n=2,normalize:s=!0,edgeTypes:i=!1}=r||{};t=t||[];let o=[],a=[],c=0,l=0;for(let f=0;f<=t.length;f++){let u=t[f]||e.length,d=l,p=e$(e,n,c,u);for(let g=p;g<u;g++)o[l++]=e[g];for(let g=c;g<p;g++)o[l++]=e[g];ER(o,n,d,l),r$(o,n,d,l,r?.maxLatitude),c=u,a[f]=l}a.pop();let h=gf(o,a,{size:n,gridResolution:360,gridOffset:[-180,-180],edgeTypes:i});if(s)for(let f of h)bR(f.positions,n);return h}function e$(e,t,r,n){let s=-1,i=-1;for(let o=r+1;o<n;o+=t){let a=Math.abs(e[o]);a>s&&(s=a,i=o-1)}return i}function r$(e,t,r,n,s=t$){let i=e[r],o=e[n-t];if(Math.abs(i-o)>180){let a=Js(e,0,t,r);a[0]+=Math.round((o-i)/360)*360,Qe(e,a),a[1]=Math.sign(a[1])*s,Qe(e,a),a[0]=i,Qe(e,a)}}function ER(e,t,r,n){let s=e[0],i;for(let o=r;o<n;o+=t){i=e[o];let a=i-s;(a>180||a<-180)&&(i-=Math.round(a/360)*360),e[o]=s=i}}function bR(e,t){let r,n=e.length/t;for(let i=0;i<n&&(r=e[i*t],(r+180)%360===0);i++);let s=-Math.round(r/360)*360;if(s!==0)for(let i=0;i<n;i++)e[i*t]+=s}var mf=class extends it{constructor(t){let{indices:r,attributes:n}=s$(t);super({...t,indices:r,attributes:n})}};function s$(e){let{radius:t,height:r=1,nradial:n=10}=e,{vertices:s}=e;s&&(k.assert(s.length>=n),s=s.flatMap(d=>[d[0],d[1]]),po(s,qa.COUNTER_CLOCKWISE));let i=r>0,o=n+1,a=i?o*3+1:n,c=Math.PI*2/n,l=new Uint16Array(i?n*3*2:0),h=new Float32Array(a*3),f=new Float32Array(a*3),u=0;if(i){for(let d=0;d<o;d++){let p=d*c,g=d%n,m=Math.sin(p),_=Math.cos(p);for(let y=0;y<2;y++)h[u+0]=s?s[g*2]:_*t,h[u+1]=s?s[g*2+1]:m*t,h[u+2]=(1/2-y)*r,f[u+0]=s?s[g*2]:_,f[u+1]=s?s[g*2+1]:m,u+=3}h[u+0]=h[u-3],h[u+1]=h[u-2],h[u+2]=h[u-1],u+=3}for(let d=i?0:1;d<o;d++){let p=Math.floor(d/2)*Math.sign(.5-d%2),g=p*c,m=(p+n)%n,_=Math.sin(g),y=Math.cos(g);h[u+0]=s?s[m*2]:y*t,h[u+1]=s?s[m*2+1]:_*t,h[u+2]=r/2,f[u+2]=1,u+=3}if(i){let d=0;for(let p=0;p<n;p++)l[d++]=p*2+0,l[d++]=p*2+2,l[d++]=p*2+0,l[d++]=p*2+1,l[d++]=p*2+1,l[d++]=p*2+3}return{indices:l,attributes:{POSITION:{size:3,value:h},NORMAL:{size:3,value:f}}}}var SR=`uniform columnUniforms {
    float radius;
    float angle;
    vec2 offset;
    bool extruded;
    bool stroked;
    bool isStroke;
    float coverage;
    float elevationScale;
    float edgeDistance;
    float widthScale;
    float widthMinPixels;
    float widthMaxPixels;
    highp int radiusUnits;
    highp int widthUnits;
  } column;
  `,vR={name:"column",vs:SR,fs:SR,uniformTypes:{radius:"f32",angle:"f32",offset:"vec2<f32>",extruded:"f32",stroked:"f32",isStroke:"f32",coverage:"f32",elevationScale:"f32",edgeDistance:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",radiusUnits:"i32",widthUnits:"i32"}};var wR=`#version 300 es
  #define SHADER_NAME column-layer-vertex-shader
  in vec3 positions;
  in vec3 normals;
  in vec3 instancePositions;
  in float instanceElevations;
  in vec3 instancePositions64Low;
  in vec4 instanceFillColors;
  in vec4 instanceLineColors;
  in float instanceStrokeWidths;
  in vec3 instancePickingColors;
  out vec4 vColor;
  #ifdef FLAT_SHADING
  out vec3 cameraPosition;
  out vec4 position_commonspace;
  #endif
  void main(void) {
  geometry.worldPosition = instancePositions;
  vec4 color = column.isStroke ? instanceLineColors : instanceFillColors;
  mat2 rotationMatrix = mat2(cos(column.angle), sin(column.angle), -sin(column.angle), cos(column.angle));
  float elevation = 0.0;
  float strokeOffsetRatio = 1.0;
  if (column.extruded) {
  elevation = instanceElevations * (positions.z + 1.0) / 2.0 * column.elevationScale;
  } else if (column.stroked) {
  float widthPixels = clamp(
  project_size_to_pixel(instanceStrokeWidths * column.widthScale, column.widthUnits),
  column.widthMinPixels, column.widthMaxPixels) / 2.0;
  float halfOffset = project_pixel_size(widthPixels) / project_size(column.edgeDistance * column.coverage * column.radius);
  if (column.isStroke) {
  strokeOffsetRatio -= sign(positions.z) * halfOffset;
  } else {
  strokeOffsetRatio -= halfOffset;
  }
  }
  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
  float dotRadius = column.radius * column.coverage * shouldRender;
  geometry.pickingColor = instancePickingColors;
  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
  vec3 centroidPosition64Low = instancePositions64Low;
  vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + column.offset) * dotRadius;
  if (column.radiusUnits == UNIT_METERS) {
  offset = project_size(offset);
  }
  vec3 pos = vec3(offset, 0.);
  DECKGL_FILTER_SIZE(pos, geometry);
  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  if (column.extruded && !column.isStroke) {
  #ifdef FLAT_SHADING
  cameraPosition = project.cameraPosition;
  position_commonspace = geometry.position;
  vColor = vec4(color.rgb, color.a * layer.opacity);
  #else
  vec3 lightColor = lighting_getLightColor(color.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, color.a * layer.opacity);
  #endif
  } else {
  vColor = vec4(color.rgb, color.a * layer.opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
  }
  `;var CR=`#version 300 es
  #define SHADER_NAME column-layer-fragment-shader
  precision highp float;
  out vec4 fragColor;
  in vec4 vColor;
  #ifdef FLAT_SHADING
  in vec3 cameraPosition;
  in vec4 position_commonspace;
  #endif
  void main(void) {
  fragColor = vColor;
  geometry.uv = vec2(0.);
  #ifdef FLAT_SHADING
  if (column.extruded && !column.isStroke && !bool(picking.isActive)) {
  vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
  fragColor.rgb = lighting_getLightColor(vColor.rgb, cameraPosition, position_commonspace.xyz, normal);
  }
  #endif
  DECKGL_FILTER_COLOR(fragColor, geometry);
  }
  `;var rm=[0,0,0,255],i$={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,flatShading:!1,getPosition:{type:"accessor",value:e=>e.position},getFillColor:{type:"accessor",value:rm},getLineColor:{type:"accessor",value:rm},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},_f=class extends ut{getShaders(){let t={},{flatShading:r}=this.props;return r&&(t.FLAT_SHADING=1),super.getShaders({vs:wR,fs:CR,defines:t,modules:[st,r?Ta:Us,Tt,vR]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getFillColor",defaultValue:rm},instanceLineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getLineColor",defaultValue:rm},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}updateState(t){super.updateState(t);let{props:r,oldProps:n,changeFlags:s}=t,i=s.extensionsChanged||r.flatShading!==n.flatShading;i&&(this.state.models?.forEach(a=>a.destroy()),this.setState(this._getModels()),this.getAttributeManager().invalidateAll());let o=this.getNumInstances();this.state.fillModel.setInstanceCount(o),this.state.wireframeModel.setInstanceCount(o),(i||r.diskResolution!==n.diskResolution||r.vertices!==n.vertices||(r.extruded||r.stroked)!==(n.extruded||n.stroked))&&this._updateGeometry(r)}getGeometry(t,r,n){let s=new mf({radius:1,height:n?2:0,vertices:r,nradial:t}),i=0;if(r)for(let o=0;o<t;o++){let a=r[o],c=Math.sqrt(a[0]*a[0]+a[1]*a[1]);i+=c/t}else i=1;return this.setState({edgeDistance:Math.cos(Math.PI/t)*i}),s}_getModels(){let t=this.getShaders(),r=this.getAttributeManager().getBufferLayouts(),n=new Y(this.context.device,{...t,id:`${this.props.id}-fill`,bufferLayout:r,isInstanced:!0}),s=new Y(this.context.device,{...t,id:`${this.props.id}-wireframe`,bufferLayout:r,isInstanced:!0});return{fillModel:n,wireframeModel:s,models:[s,n]}}_updateGeometry({diskResolution:t,vertices:r,extruded:n,stroked:s}){let i=this.getGeometry(t,r,n||s);this.setState({fillVertexCount:i.attributes.POSITION.value.length/3});let o=this.state.fillModel,a=this.state.wireframeModel;o.setGeometry(i),o.setTopology("triangle-strip"),o.setIndexBuffer(null),a.setGeometry(i),a.setTopology("line-list")}draw({uniforms:t}){let{lineWidthUnits:r,lineWidthScale:n,lineWidthMinPixels:s,lineWidthMaxPixels:i,radiusUnits:o,elevationScale:a,extruded:c,filled:l,stroked:h,wireframe:f,offset:u,coverage:d,radius:p,angle:g}=this.props,m=this.state.fillModel,_=this.state.wireframeModel,{fillVertexCount:y,edgeDistance:x}=this.state,A={radius:p,angle:g/180*Math.PI,offset:u,extruded:c,stroked:h,coverage:d,elevationScale:a,edgeDistance:x,radiusUnits:Lt[o],widthUnits:Lt[r],widthScale:n,widthMinPixels:s,widthMaxPixels:i};c&&f&&(_.shaderInputs.setProps({column:{...A,isStroke:!0}}),_.draw(this.context.renderPass)),l&&(m.setVertexCount(y),m.shaderInputs.setProps({column:{...A,isStroke:!1}}),m.draw(this.context.renderPass)),!c&&h&&(m.setVertexCount(y*2/3),m.shaderInputs.setProps({column:{...A,isStroke:!0}}),m.draw(this.context.renderPass))}};_f.layerName="ColumnLayer";_f.defaultProps=i$;var Tn=_f;var o$={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}},xf=class extends Tn{_updateGeometry(){let t=new Yn;this.state.fillModel.setGeometry(t)}draw({uniforms:t}){let{elevationScale:r,extruded:n,offset:s,coverage:i,cellSize:o,angle:a,radiusUnits:c}=this.props,l=this.state.fillModel,h={radius:o/2,radiusUnits:Lt[c],angle:a,offset:s,extruded:n,stroked:!1,coverage:i,elevationScale:r,edgeDistance:1,isStroke:!1,widthUnits:0,widthScale:0,widthMinPixels:0,widthMaxPixels:0};l.shaderInputs.setProps({column:h}),l.draw(this.context.renderPass)}};xf.layerName="GridCellLayer";xf.defaultProps=o$;var PR=xf;function RR(e,t,r,n){let s;if(Array.isArray(e[0])){let i=e.length*t;s=new Array(i);for(let o=0;o<e.length;o++)for(let a=0;a<t;a++)s[o*t+a]=e[o][a]||0}else s=e;return r?pf(s,{size:t,gridResolution:r}):n?pA(s,{size:t}):s}var a$=1,c$=2,mA=4,yf=class extends ns{constructor(t){super({...t,attributes:{positions:{size:3,padding:18,initialize:!0,type:t.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(t){return this.attributes[t]}getGeometryFromBuffer(t){return this.normalize?super.getGeometryFromBuffer(t):null}normalizeGeometry(t){return this.normalize?RR(t,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):t}getGeometrySize(t){if(IR(t)){let n=0;for(let s of t)n+=this.getGeometrySize(s);return n}let r=this.getPathLength(t);return r<2?0:this.isClosed(t)?r<3?0:r+2:r}updateGeometryAttributes(t,r){if(r.geometrySize!==0)if(t&&IR(t))for(let n of t){let s=this.getGeometrySize(n);r.geometrySize=s,this.updateGeometryAttributes(n,r),r.vertexStart+=s}else this._updateSegmentTypes(t,r),this._updatePositions(t,r)}_updateSegmentTypes(t,r){let n=this.attributes.segmentTypes,s=t?this.isClosed(t):!1,{vertexStart:i,geometrySize:o}=r;n.fill(0,i,i+o),s?(n[i]=mA,n[i+o-2]=mA):(n[i]+=a$,n[i+o-2]+=c$),n[i+o-1]=mA}_updatePositions(t,r){let{positions:n}=this.attributes;if(!n||!t)return;let{vertexStart:s,geometrySize:i}=r,o=new Array(3);for(let a=s,c=0;c<i;a++,c++)this.getPointOnPath(t,c,o),n[a*3]=o[0],n[a*3+1]=o[1],n[a*3+2]=o[2]}getPathLength(t){return t.length/this.positionSize}getPointOnPath(t,r,n=[]){let{positionSize:s}=this;r*s>=t.length&&(r+=1-t.length/s);let i=r*s;return n[0]=t[i],n[1]=t[i+1],n[2]=s===3&&t[i+2]||0,n}isClosed(t){if(!this.normalize)return Boolean(this.opts.loop);let{positionSize:r}=this,n=t.length-r;return t[0]===t[n]&&t[1]===t[n+1]&&(r===2||t[2]===t[n+2])}};function IR(e){return Array.isArray(e[0])}var OR=`uniform pathUniforms {
    float widthScale;
    float widthMinPixels;
    float widthMaxPixels;
    float jointType;
    float capType;
    float miterLimit;
    bool billboard;
    highp int widthUnits;
  } path;
  `,LR={name:"path",vs:OR,fs:OR,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}};var NR=`#version 300 es
  #define SHADER_NAME path-layer-vertex-shader
  in vec2 positions;
  in float instanceTypes;
  in vec3 instanceStartPositions;
  in vec3 instanceEndPositions;
  in vec3 instanceLeftPositions;
  in vec3 instanceRightPositions;
  in vec3 instanceLeftPositions64Low;
  in vec3 instanceStartPositions64Low;
  in vec3 instanceEndPositions64Low;
  in vec3 instanceRightPositions64Low;
  in float instanceStrokeWidths;
  in vec4 instanceColors;
  in vec3 instancePickingColors;
  uniform float opacity;
  out vec4 vColor;
  out vec2 vCornerOffset;
  out float vMiterLength;
  out vec2 vPathPosition;
  out float vPathLength;
  out float vJointType;
  const float EPSILON = 0.001;
  const vec3 ZERO_OFFSET = vec3(0.0);
  float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
  }
  vec3 getLineJoinOffset(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
  ) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);
  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);
  mat3 rotationMatrix;
  bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
  deltaA3 = deltaA3 * rotationMatrix;
  deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;
  float lenA = length(deltaA);
  float lenB = length(deltaB);
  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;
  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
  min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
  miterSize,
  step(0.0, cornerPosition)
  );
  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
  * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
  offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
  vJointType = path.capType;
  } else {
  vJointType = path.jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;
  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
  dot(offsetFromStartOfPath, perp),
  dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;
  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);
  if (needsRotation) {
  offset = rotationMatrix * offset;
  }
  return offset;
  }
  void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
  float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
  position = refPosition + (position - refPosition) * r;
  }
  }
  void main() {
  geometry.pickingColor = instancePickingColors;
  vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
  float isEnd = positions.x;
  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
  project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
  path.widthMinPixels, path.widthMaxPixels) / 2.0);
  vec3 width;
  if (path.billboard) {
  vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
  vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
  vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
  clipLine(prevPositionScreen, currPositionScreen);
  clipLine(nextPositionScreen, currPositionScreen);
  clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
  width = vec3(widthPixels, 0.0);
  DECKGL_FILTER_SIZE(width, geometry);
  vec3 offset = getLineJoinOffset(
  prevPositionScreen.xyz / prevPositionScreen.w,
  currPositionScreen.xyz / currPositionScreen.w,
  nextPositionScreen.xyz / nextPositionScreen.w,
  project_pixel_size_to_clipspace(width.xy)
  );
  DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
  gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
  } else {
  prevPosition = project_position(prevPosition, prevPosition64Low);
  currPosition = project_position(currPosition, currPosition64Low);
  nextPosition = project_position(nextPosition, nextPosition64Low);
  width = vec3(project_pixel_size(widthPixels), 0.0);
  DECKGL_FILTER_SIZE(width, geometry);
  vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
  geometry.position = vec4(currPosition + offset, 1.0);
  gl_Position = project_common_position_to_clipspace(geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
  }
  `;var BR=`#version 300 es
  #define SHADER_NAME path-layer-fragment-shader
  precision highp float;
  in vec4 vColor;
  in vec2 vCornerOffset;
  in float vMiterLength;
  in vec2 vPathPosition;
  in float vPathLength;
  in float vJointType;
  out vec4 fragColor;
  void main(void) {
  geometry.uv = vPathPosition;
  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
  if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
  discard;
  }
  if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
  discard;
  }
  }
  fragColor = vColor;
  DECKGL_FILTER_COLOR(fragColor, geometry);
  }
  `;var FR=[0,0,0,255],l$={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:e=>e.path},getColor:{type:"accessor",value:FR},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},_A={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e},Af=class extends ut{getShaders(){return super.getShaders({vs:NR,fs:BR,modules:[st,Tt,LR]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:_A,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:_A,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:_A,defaultValue:FR},instancePickingColors:{size:4,type:"uint8",accessor:(n,{index:s,target:i})=>this.encodePickingColor(n&&n.__source?n.__source.index:s,i)}}),this.setState({pathTesselator:new yf({fp64:this.use64bitPositions()})})}updateState(t){super.updateState(t);let{props:r,changeFlags:n}=t,s=this.getAttributeManager();if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPath)){let{pathTesselator:o}=this.state,a=r.data.attributes||{};o.updateGeometry({data:r.data,geometryBuffer:a.getPath,buffers:a,normalize:!r._pathType,loop:r._pathType==="loop",getGeometry:r.getPath,positionFormat:r.positionFormat,wrapLongitude:r.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:n.dataChanged}),this.setState({numInstances:o.instanceCount,startIndices:o.vertexStarts}),n.dataChanged||s.invalidateAll()}n.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),s.invalidateAll())}getPickingInfo(t){let r=super.getPickingInfo(t),{index:n}=r,s=this.props.data;return s[0]&&s[0].__source&&(r.object=s.find(i=>i.__source.index===n)),r}disablePickingIndex(t){let r=this.props.data;if(r[0]&&r[0].__source)for(let n=0;n<r.length;n++)r[n].__source.index===t&&this._disablePickingIndex(n);else super.disablePickingIndex(t)}draw({uniforms:t}){let{jointRounded:r,capRounded:n,billboard:s,miterLimit:i,widthUnits:o,widthScale:a,widthMinPixels:c,widthMaxPixels:l}=this.props,h=this.state.model,f={jointType:Number(r),capType:Number(n),billboard:s,widthUnits:Lt[o],widthScale:a,miterLimit:i,widthMinPixels:c,widthMaxPixels:l};h.shaderInputs.setProps({path:f}),h.draw(this.context.renderPass)}_getModel(){let t=[0,1,2,1,4,2,1,3,4,3,5,4],r=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Y(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new it({topology:"triangle-list",attributes:{indices:new Uint16Array(t),positions:{value:new Float32Array(r),size:2}}}),isInstanced:!0})}calculatePositions(t){let{pathTesselator:r}=this.state;t.startIndices=r.vertexStarts,t.value=r.get("positions")}calculateSegmentTypes(t){let{pathTesselator:r}=this.state;t.startIndices=r.vertexStarts,t.value=r.get("segmentTypes")}};Af.defaultProps=l$;Af.layerName="PathLayer";var Mn=Af;var qR=Nn(VR(),1);var am=qa.CLOCKWISE,HR=qa.COUNTER_CLOCKWISE,Qs={isClosed:!0};function S$(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}function Ya(e){return"positions"in e?e.positions:e}function bf(e){return"holeIndices"in e?e.holeIndices:null}function v$(e){return Array.isArray(e[0])}function w$(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}function C$(e){let t=e[0],r=e[e.length-1];return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]}function P$(e,t,r,n){for(let s=0;s<t;s++)if(e[r+s]!==e[n-t+s])return!1;return!0}function WR(e,t,r,n,s){let i=t,o=r.length;for(let a=0;a<o;a++)for(let c=0;c<n;c++)e[i++]=r[a][c]||0;if(!C$(r))for(let a=0;a<n;a++)e[i++]=r[0][a]||0;return Qs.start=t,Qs.end=i,Qs.size=n,po(e,s,Qs),i}function GR(e,t,r,n,s=0,i,o){i=i||r.length;let a=i-s;if(a<=0)return t;let c=t;for(let l=0;l<a;l++)e[c++]=r[s+l];if(!P$(r,n,s,i))for(let l=0;l<n;l++)e[c++]=r[s+l];return Qs.start=t,Qs.end=c,Qs.size=n,po(e,o,Qs),c}function cm(e,t){S$(e);let r=[],n=[];if("positions"in e){let{positions:s,holeIndices:i}=e;if(i){let o=0;for(let a=0;a<=i.length;a++)o=GR(r,o,s,t,i[a-1],i[a],a===0?am:HR),n.push(o);return n.pop(),{positions:r,holeIndices:n}}e=s}if(!v$(e))return GR(r,0,e,t,0,r.length,am),r;if(!w$(e)){let s=0;for(let[i,o]of e.entries())s=WR(r,s,o,t,i===0?am:HR),n.push(s);return n.pop(),{positions:r,holeIndices:n}}return WR(r,0,e,t,am),r}function MA(e,t,r){let n=e.length/3,s=0;for(let i=0;i<n;i++){let o=(i+1)%n;s+=e[i*3+t]*e[o*3+r],s-=e[o*3+t]*e[i*3+r]}return Math.abs(s/2)}function jR(e,t,r,n){let s=e.length/3;for(let i=0;i<s;i++){let o=i*3,a=e[o+0],c=e[o+1],l=e[o+2];e[o+t]=a,e[o+r]=c,e[o+n]=l}}function XR(e,t,r,n){let s=bf(e);s&&(s=s.map(a=>a/t));let i=Ya(e),o=n&&t===3;if(r){let a=i.length;i=i.slice();let c=[];for(let l=0;l<a;l+=t){c[0]=i[l],c[1]=i[l+1],o&&(c[2]=i[l+2]);let h=r(c);i[l]=h[0],i[l+1]=h[1],o&&(i[l+2]=h[2])}}if(o){let a=MA(i,0,1),c=MA(i,0,2),l=MA(i,1,2);if(!a&&!c&&!l)return[];a>c&&a>l||(c>l?(r||(i=i.slice()),jR(i,0,2,1)):(r||(i=i.slice()),jR(i,2,0,1)))}return(0,qR.default)(i,s,t)}var Sf=class extends ns{constructor(t){let{fp64:r,IndexType:n=Uint32Array}=t;super({...t,attributes:{positions:{size:3,type:r?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:n,size:1}}})}get(t){let{attributes:r}=this;return t==="indices"?r.indices&&r.indices.subarray(0,this.vertexCount):r[t]}updateGeometry(t){super.updateGeometry(t);let r=this.buffers.indices;if(r)this.vertexCount=(r.value||r).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(t){if(this.normalize){let r=cm(t,this.positionSize);return this.opts.resolution?gf(Ya(r),bf(r),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?gA(Ya(r),bf(r),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):r}return t}getGeometrySize(t){if($R(t)){let r=0;for(let n of t)r+=this.getGeometrySize(n);return r}return Ya(t).length/this.positionSize}getGeometryFromBuffer(t){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(t):null}updateGeometryAttributes(t,r){if(t&&$R(t))for(let n of t){let s=this.getGeometrySize(n);r.geometrySize=s,this.updateGeometryAttributes(n,r),r.vertexStart+=s,r.indexStart=this.indexStarts[r.geometryIndex+1]}else{let n=t;this._updateIndices(n,r),this._updatePositions(n,r),this._updateVertexValid(n,r)}}_updateIndices(t,{geometryIndex:r,vertexStart:n,indexStart:s}){let{attributes:i,indexStarts:o,typedArrayManager:a}=this,c=i.indices;if(!c||!t)return;let l=s,h=XR(t,this.positionSize,this.opts.preproject,this.opts.full3d);c=a.allocate(c,s+h.length,{copy:!0});for(let f=0;f<h.length;f++)c[l++]=h[f]+n;o[r+1]=s+h.length,i.indices=c}_updatePositions(t,{vertexStart:r,geometrySize:n}){let{attributes:{positions:s},positionSize:i}=this;if(!s||!t)return;let o=Ya(t);for(let a=r,c=0;c<n;a++,c++){let l=o[c*i],h=o[c*i+1],f=i>2?o[c*i+2]:0;s[a*3]=l,s[a*3+1]=h,s[a*3+2]=f}}_updateVertexValid(t,{vertexStart:r,geometrySize:n}){let{positionSize:s}=this,i=this.attributes.vertexValid,o=t&&bf(t);if(t&&t.edgeTypes?i.set(t.edgeTypes,r):i.fill(1,r,r+n),o)for(let a=0;a<o.length;a++)i[r+o[a]/s-1]=0;i[r+n-1]=0}};function $R(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}var KR=`uniform solidPolygonUniforms {
    bool extruded;
    bool isWireframe;
    float elevationScale;
  } solidPolygon;
  `,ZR={name:"solidPolygon",vs:KR,fs:KR,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}};var lm=`in vec4 fillColors;
  in vec4 lineColors;
  in vec3 pickingColors;
  out vec4 vColor;
  struct PolygonProps {
  vec3 positions;
  vec3 positions64Low;
  vec3 normal;
  float elevations;
  };
  vec3 project_offset_normal(vec3 vector) {
  if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
  project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
  return normalize(vector * project.commonUnitsPerWorldUnit);
  }
  return project_normal(vector);
  }
  void calculatePosition(PolygonProps props) {
  vec3 pos = props.positions;
  vec3 pos64Low = props.positions64Low;
  vec3 normal = props.normal;
  vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
  geometry.worldPosition = props.positions;
  geometry.pickingColor = pickingColors;
  if (solidPolygon.extruded) {
  pos.z += props.elevations * solidPolygon.elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  if (solidPolygon.extruded) {
  #ifdef IS_SIDE_VERTEX
  normal = project_offset_normal(normal);
  #else
  normal = project_normal(normal);
  #endif
  geometry.normal = normal;
  vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, colors.a * layer.opacity);
  } else {
  vColor = vec4(colors.rgb, colors.a * layer.opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
  }
  `;var JR=`#version 300 es
  #define SHADER_NAME solid-polygon-layer-vertex-shader
  in vec3 vertexPositions;
  in vec3 vertexPositions64Low;
  in float elevations;
  ${lm}
  void main(void) {
  PolygonProps props;
  props.positions = vertexPositions;
  props.positions64Low = vertexPositions64Low;
  props.elevations = elevations;
  props.normal = vec3(0.0, 0.0, 1.0);
  calculatePosition(props);
  }
  `;var QR=`#version 300 es
  #define SHADER_NAME solid-polygon-layer-vertex-shader-side
  #define IS_SIDE_VERTEX
  in vec2 positions;
  in vec3 vertexPositions;
  in vec3 nextVertexPositions;
  in vec3 vertexPositions64Low;
  in vec3 nextVertexPositions64Low;
  in float elevations;
  in float instanceVertexValid;
  ${lm}
  void main(void) {
  if(instanceVertexValid < 0.5){
  gl_Position = vec4(0.);
  return;
  }
  PolygonProps props;
  vec3 pos;
  vec3 pos64Low;
  vec3 nextPos;
  vec3 nextPos64Low;
  #if RING_WINDING_ORDER_CW == 1
  pos = vertexPositions;
  pos64Low = vertexPositions64Low;
  nextPos = nextVertexPositions;
  nextPos64Low = nextVertexPositions64Low;
  #else
  pos = nextVertexPositions;
  pos64Low = nextVertexPositions64Low;
  nextPos = vertexPositions;
  nextPos64Low = vertexPositions64Low;
  #endif
  props.positions = mix(pos, nextPos, positions.x);
  props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
  props.normal = vec3(
  pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
  nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
  0.0);
  props.elevations = elevations * positions.y;
  calculatePosition(props);
  }
  `;var tI=`#version 300 es
  #define SHADER_NAME solid-polygon-layer-fragment-shader
  precision highp float;
  in vec4 vColor;
  out vec4 fragColor;
  void main(void) {
  fragColor = vColor;
  geometry.uv = vec2(0.);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  }
  `;var fm=[0,0,0,255],R$={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:e=>e.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:fm},getLineColor:{type:"accessor",value:fm},material:!0},hm={enter:(e,t)=>t.length?t.subarray(t.length-e.length):e},vf=class extends ut{getShaders(t){return super.getShaders({vs:t==="top"?JR:QR,fs:tI,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[st,Us,Tt,ZR]})}get wrapLongitude(){return!1}getBounds(){return this.getAttributeManager()?.getBounds(["vertexPositions"])}initializeState(){let{viewport:t}=this.context,{coordinateSystem:r}=this.props,{_full3d:n}=this.props;t.isGeospatial&&r===W.DEFAULT&&(r=W.LNGLAT);let s;r===W.LNGLAT&&(n?s=t.projectPosition.bind(t):s=t.projectFlat.bind(t)),this.setState({numInstances:0,polygonTesselator:new Sf({preproject:s,fp64:this.use64bitPositions(),IndexType:Uint32Array})});let i=this.getAttributeManager(),o=!0;i.remove(["instancePickingColors"]),i.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:hm,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,stepMode:"dynamic",transition:hm,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:hm,accessor:"getFillColor",defaultValue:fm},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:hm,accessor:"getLineColor",defaultValue:fm},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(a,{index:c,target:l})=>this.encodePickingColor(a&&a.__source?a.__source.index:c,l)}})}getPickingInfo(t){let r=super.getPickingInfo(t),{index:n}=r,s=this.props.data;return s[0]&&s[0].__source&&(r.object=s.find(i=>i.__source.index===n)),r}disablePickingIndex(t){let r=this.props.data;if(r[0]&&r[0].__source)for(let n=0;n<r.length;n++)r[n].__source.index===t&&this._disablePickingIndex(n);else super.disablePickingIndex(t)}draw({uniforms:t}){let{extruded:r,filled:n,wireframe:s,elevationScale:i}=this.props,{topModel:o,sideModel:a,wireframeModel:c,polygonTesselator:l}=this.state,h={extruded:Boolean(r),elevationScale:i,isWireframe:!1};c&&s&&(c.setInstanceCount(l.instanceCount-1),c.shaderInputs.setProps({solidPolygon:{...h,isWireframe:!0}}),c.draw(this.context.renderPass)),a&&n&&(a.setInstanceCount(l.instanceCount-1),a.shaderInputs.setProps({solidPolygon:h}),a.draw(this.context.renderPass)),o&&n&&(o.setVertexCount(l.vertexCount),o.shaderInputs.setProps({solidPolygon:h}),o.draw(this.context.renderPass))}updateState(t){super.updateState(t),this.updateGeometry(t);let{props:r,oldProps:n,changeFlags:s}=t,i=this.getAttributeManager();(s.extensionsChanged||r.filled!==n.filled||r.extruded!==n.extruded)&&(this.state.models?.forEach(a=>a.destroy()),this.setState(this._getModels()),i.invalidateAll())}updateGeometry({props:t,oldProps:r,changeFlags:n}){if(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon)){let{polygonTesselator:i}=this.state,o=t.data.attributes||{};i.updateGeometry({data:t.data,normalize:t._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:t.getPolygon,positionFormat:t.positionFormat,wrapLongitude:t.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:n.dataChanged,full3d:t._full3d}),this.setState({numInstances:i.instanceCount,startIndices:i.vertexStarts}),n.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){let{id:t,filled:r,extruded:n}=this.props,s,i,o;if(r){let a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1;let c=this.getAttributeManager().getBufferLayouts({isInstanced:!1});s=new Y(this.context.device,{...a,id:`${t}-top`,topology:"triangle-list",bufferLayout:c,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(n){let a=this.getAttributeManager().getBufferLayouts({isInstanced:!0});i=new Y(this.context.device,{...this.getShaders("side"),id:`${t}-side`,bufferLayout:a,geometry:new it({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new Y(this.context.device,{...this.getShaders("side"),id:`${t}-wireframe`,bufferLayout:a,geometry:new it({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[i,o,s].filter(Boolean),topModel:s,sideModel:i,wireframeModel:o}}calculateIndices(t){let{polygonTesselator:r}=this.state;t.startIndices=r.indexStarts,t.value=r.get("indices")}calculatePositions(t){let{polygonTesselator:r}=this.state;t.startIndices=r.vertexStarts,t.value=r.get("positions")}calculateVertexValid(t){t.value=this.state.polygonTesselator.get("vertexValid")}};vf.defaultProps=R$;vf.layerName="SolidPolygonLayer";var ti=vf;function um({data:e,getIndex:t,dataRange:r,replace:n}){let{startRow:s=0,endRow:i=1/0}=r,o=e.length,a=o,c=o;for(let u=0;u<o;u++){let d=t(e[u]);if(a>u&&d>=s&&(a=u),d>=i){c=u;break}}let l=a,f=c-a!==n.length?e.slice(c):void 0;for(let u=0;u<n.length;u++)e[l++]=n[u];if(f){for(let u=0;u<f.length;u++)e[l++]=f[u];e.length=l}return{startRow:a,endRow:a+n.length}}var eI=[0,0,0,255],I$=[0,0,0,255],O$={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:I$},getLineColor:{type:"accessor",value:eI},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0},wf=class extends Ft{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&k.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:t}){let r=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getPolygon);if(r&&Array.isArray(t.dataChanged)){let n=this.state.paths.slice(),s=t.dataChanged.map(i=>um({data:n,getIndex:o=>o.__source.index,dataRange:i,replace:this._getPaths(i)}));this.setState({paths:n,pathsDiff:s})}else r&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(t={}){let{data:r,getPolygon:n,positionFormat:s,_normalize:i}=this.props,o=[],a=s==="XY"?2:3,{startRow:c,endRow:l}=t,{iterable:h,objectInfo:f}=Yt(r,c,l);for(let u of h){f.index++;let d=n(u,f);i&&(d=cm(d,a));let{holeIndices:p}=d,g=d.positions||d;if(p)for(let m=0;m<=p.length;m++){let _=g.slice(p[m-1]||0,p[m]||g.length);o.push(this.getSubLayerRow({path:_},u,f.index))}else o.push(this.getSubLayerRow({path:g},u,f.index))}return o}renderLayers(){let{data:t,_dataDiff:r,stroked:n,filled:s,extruded:i,wireframe:o,_normalize:a,_windingOrder:c,elevationScale:l,transitions:h,positionFormat:f}=this.props,{lineWidthUnits:u,lineWidthScale:d,lineWidthMinPixels:p,lineWidthMaxPixels:g,lineJointRounded:m,lineMiterLimit:_,lineDashJustified:y}=this.props,{getFillColor:x,getLineColor:A,getLineWidth:M,getLineDashArray:E,getElevation:w,getPolygon:v,updateTriggers:b,material:T}=this.props,{paths:I,pathsDiff:N}=this.state,B=this.getSubLayerClass("fill",ti),C=this.getSubLayerClass("stroke",Mn),V=this.shouldRenderSubLayer("fill",I)&&new B({_dataDiff:r,extruded:i,elevationScale:l,filled:s,wireframe:o,_normalize:a,_windingOrder:c,getElevation:w,getFillColor:x,getLineColor:i&&o?A:eI,material:T,transitions:h},this.getSubLayerProps({id:"fill",updateTriggers:b&&{getPolygon:b.getPolygon,getElevation:b.getElevation,getFillColor:b.getFillColor,lineColors:i&&o,getLineColor:b.getLineColor}}),{data:t,positionFormat:f,getPolygon:v}),rt=!i&&n&&this.shouldRenderSubLayer("stroke",I)&&new C({_dataDiff:N&&(()=>N),widthUnits:u,widthScale:d,widthMinPixels:p,widthMaxPixels:g,jointRounded:m,miterLimit:_,dashJustified:y,_pathType:"loop",transitions:h&&{getWidth:h.getLineWidth,getColor:h.getLineColor,getPath:h.getPolygon},getColor:this.getSubLayerAccessor(A),getWidth:this.getSubLayerAccessor(M),getDashArray:this.getSubLayerAccessor(E)},this.getSubLayerProps({id:"stroke",updateTriggers:b&&{getWidth:b.getLineWidth,getColor:b.getLineColor,getDashArray:b.getLineDashArray}}),{data:I,positionFormat:f,getPath:J=>J.path});return[!i&&V,rt,i&&V]}};wf.layerName="PolygonLayer";wf.defaultProps=O$;var ei=wf;function rI(e,t){if(!e)return null;let r="startIndices"in e?e.startIndices[t]:t,n=e.featureIds.value[r];return r!==-1?L$(e,n,r):null}function L$(e,t,r){let n={properties:{...e.properties[t]}};for(let s in e.numericProps)n.properties[s]=e.numericProps[s].value[r];return n}function nI(e,t){let r={points:null,lines:null,polygons:null};for(let n in r){let s=e[n].globalFeatureIds.value;r[n]=new Uint8ClampedArray(s.length*4);let i=[];for(let o=0;o<s.length;o++)t(s[o],i),r[n][o*4+0]=i[0],r[n][o*4+1]=i[1],r[n][o*4+2]=i[2],r[n][o*4+3]=255}return r}var sI=`uniform sdfUniforms {
    float gamma;
    bool enabled;
    float buffer;
    float outlineBuffer;
    vec4 outlineColor;
  } sdf;
  `,iI={name:"sdf",vs:sI,fs:sI,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}};var oI=`#version 300 es
  #define SHADER_NAME multi-icon-layer-fragment-shader
  precision highp float;
  uniform sampler2D iconsTexture;
  in vec4 vColor;
  in vec2 vTextureCoords;
  in vec2 uv;
  out vec4 fragColor;
  void main(void) {
  geometry.uv = uv;
  if (!bool(picking.isActive)) {
  float alpha = texture(iconsTexture, vTextureCoords).a;
  vec4 color = vColor;
  if (sdf.enabled) {
  float distance = alpha;
  alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
  if (sdf.outlineBuffer > 0.0) {
  float inFill = alpha;
  float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
  color = mix(sdf.outlineColor, vColor, inFill);
  alpha = inBorder;
  }
  }
  float a = alpha * color.a;
  if (a < icon.alphaCutoff) {
  discard;
  }
  fragColor = vec4(color.rgb, a * layer.opacity);
  }
  DECKGL_FILTER_COLOR(fragColor, geometry);
  }
  `;var EA=192/256,aI=[],N$={getIconOffsets:{type:"accessor",value:e=>e.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},Cf=class extends ja{getShaders(){let t=super.getShaders();return{...t,modules:[...t.modules,iI],fs:oI}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(r,{index:n,target:s})=>this.encodePickingColor(n,s)}})}updateState(t){super.updateState(t);let{props:r,oldProps:n}=t,{outlineColor:s}=r;s!==n.outlineColor&&(s=s.map(i=>i/255),s[3]=Number.isFinite(s[3])?s[3]:1,this.setState({outlineColor:s})),!r.sdf&&r.outlineWidth&&k.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(t){let{sdf:r,smoothing:n,outlineWidth:s}=this.props,{outlineColor:i}=this.state,o=s?Math.max(n,EA*(1-s)):-1,a=this.state.model,c={buffer:EA,outlineBuffer:o,gamma:n,enabled:Boolean(r),outlineColor:i};if(a.shaderInputs.setProps({sdf:c}),super.draw(t),r&&s){let{iconManager:l}=this.state;l.getTexture()&&(a.shaderInputs.setProps({sdf:{...c,outlineBuffer:EA}}),a.draw(this.context.renderPass))}}getInstanceOffset(t){return t?Array.from(t).flatMap(r=>super.getInstanceOffset(r)):aI}getInstanceColorMode(t){return 1}getInstanceIconFrame(t){return t?Array.from(t).flatMap(r=>super.getInstanceIconFrame(r)):aI}};Cf.defaultProps=N$;Cf.layerName="MultiIconLayer";var dm=Cf;var Pf=class{constructor({fontSize:t=24,buffer:r=3,radius:n=8,cutoff:s=.25,fontFamily:i="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=r,this.cutoff=s,this.radius=n;let c=this.size=t+r*4,l=this._createCanvas(c),h=this.ctx=l.getContext("2d",{willReadFrequently:!0});h.font=`${a} ${o} ${t}px ${i}`,h.textBaseline="alphabetic",h.textAlign="left",h.fillStyle="black",this.gridOuter=new Float64Array(c*c),this.gridInner=new Float64Array(c*c),this.f=new Float64Array(c),this.z=new Float64Array(c+1),this.v=new Uint16Array(c)}_createCanvas(t){let r=document.createElement("canvas");return r.width=r.height=t,r}draw(t){let{width:r,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:i,actualBoundingBoxRight:o}=this.ctx.measureText(t),a=Math.ceil(n),c=0,l=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-i))),h=Math.min(this.size-this.buffer,a+Math.ceil(s)),f=l+2*this.buffer,u=h+2*this.buffer,d=Math.max(f*u,0),p=new Uint8ClampedArray(d),g={data:p,width:f,height:u,glyphWidth:l,glyphHeight:h,glyphTop:a,glyphLeft:c,glyphAdvance:r};if(l===0||h===0)return g;let{ctx:m,buffer:_,gridInner:y,gridOuter:x}=this;m.clearRect(_,_,l,h),m.fillText(t,_,_+a);let A=m.getImageData(_,_,l,h);x.fill(1e20,0,d),y.fill(0,0,d);for(let M=0;M<h;M++)for(let E=0;E<l;E++){let w=A.data[4*(M*l+E)+3]/255;if(w===0)continue;let v=(M+_)*f+E+_;if(w===1)x[v]=0,y[v]=1e20;else{let b=.5-w;x[v]=b>0?b*b:0,y[v]=b<0?b*b:0}}cI(x,0,0,f,u,f,this.f,this.v,this.z),cI(y,_,_,l,h,f,this.f,this.v,this.z);for(let M=0;M<d;M++){let E=Math.sqrt(x[M])-Math.sqrt(y[M]);p[M]=Math.round(255-255*(E/this.radius+this.cutoff))}return g}};function cI(e,t,r,n,s,i,o,a,c){for(let l=t;l<t+n;l++)lI(e,r*i+l,i,s,o,a,c);for(let l=r;l<r+s;l++)lI(e,l*i+t,1,n,o,a,c)}function lI(e,t,r,n,s,i,o){i[0]=0,o[0]=-1e20,o[1]=1e20,s[0]=e[t];for(let a=1,c=0,l=0;a<n;a++){s[a]=e[t+a*r];let h=a*a;do{let f=i[c];l=(s[a]-s[f]+h-f*f)/(a-f)/2}while(l<=o[c]&&--c>-1);c++,i[c]=a,o[c]=l,o[c+1]=1e20}for(let a=0,c=0;a<n;a++){for(;o[c+1]<a;)c++;let l=i[c],h=a-l;e[t+a*r]=s[l]+h*h}}var B$=32,F$=[];function D$(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function hI({characterSet:e,getFontWidth:t,fontHeight:r,buffer:n,maxCanvasWidth:s,mapping:i={},xOffset:o=0,yOffset:a=0}){let c=0,l=o,h=r+n*2;for(let f of e)if(!i[f]){let u=t(f);l+u+n*2>s&&(l=0,c++),i[f]={x:l+n,y:a+c*h+n,width:u,height:h,layoutWidth:u,layoutHeight:r},l+=u+n*2}return{mapping:i,xOffset:l,yOffset:a+c*h,canvasHeight:D$(a+(c+1)*h)}}function fI(e,t,r,n){let s=0;for(let i=t;i<r;i++){let o=e[i];s+=n[o]?.layoutWidth||0}return s}function uI(e,t,r,n,s,i){let o=t,a=0;for(let c=t;c<r;c++){let l=fI(e,c,c+1,s);a+l>n&&(o<c&&i.push(c),o=c,a=0),a+=l}return a}function k$(e,t,r,n,s,i){let o=t,a=t,c=t,l=0;for(let h=t;h<r;h++)if((e[h]===" "||e[h+1]===" "||h+1===r)&&(c=h+1),c>a){let f=fI(e,a,c,s);l+f>n&&(o<a&&(i.push(a),o=a,l=0),f>n&&(f=uI(e,a,c,n,s,i),o=i[i.length-1])),a=c,l+=f}return l}function U$(e,t,r,n,s=0,i){i===void 0&&(i=e.length);let o=[];return t==="break-all"?uI(e,s,i,r,n,o):k$(e,s,i,r,n,o),o}function z$(e,t,r,n,s,i){let o=0,a=0;for(let c=t;c<r;c++){let l=e[c],h=n[l];h?(a||(a=h.layoutHeight),s[c]=o+h.layoutWidth/2,o+=h.layoutWidth):(k.warn(`Missing character: ${l} (${l.codePointAt(0)})`)(),s[c]=o,o+=B$)}i[0]=o,i[1]=a}function dI(e,t,r,n,s){let i=Array.from(e),o=i.length,a=new Array(o),c=new Array(o),l=new Array(o),h=(r==="break-word"||r==="break-all")&&isFinite(n)&&n>0,f=[0,0],u=[0,0],d=0,p=0,g=0;for(let m=0;m<=o;m++){let _=i[m];if((_===`
  `||m===o)&&(g=m),g>p){let y=h?U$(i,r,n,s,p,g):F$;for(let x=0;x<=y.length;x++){let A=x===0?p:y[x-1],M=x<y.length?y[x]:g;z$(i,A,M,s,a,u);for(let E=A;E<M;E++){let w=i[E],v=s[w]?.layoutOffsetY||0;c[E]=d+u[1]/2+v,l[E]=u[0]}d=d+u[1]*t,f[0]=Math.max(f[0],u[0])}p=g}_===`
  `&&(a[p]=0,c[p]=0,l[p]=0,p++)}return f[1]=d,{x:a,y:c,rowWidth:l,size:f}}function pI({value:e,length:t,stride:r,offset:n,startIndices:s,characterSet:i}){let o=e.BYTES_PER_ELEMENT,a=r?r/o:1,c=n?n/o:0,l=s[t]||Math.ceil((e.length-c)/a),h=i&&new Set,f=new Array(t),u=e;if(a>1||c>0){let d=e.constructor;u=new d(l);for(let p=0;p<l;p++)u[p]=e[p*a+c]}for(let d=0;d<t;d++){let p=s[d],g=s[d+1]||l,m=u.subarray(p,g);f[d]=String.fromCodePoint.apply(null,m),h&&m.forEach(h.add,h)}if(h)for(let d of h)i.add(String.fromCodePoint(d));return{texts:f,characterCount:l}}var $a=class{constructor(t=5){this._cache={},this._order=[],this.limit=t}get(t){let r=this._cache[t];return r&&(this._deleteOrder(t),this._appendOrder(t)),r}set(t,r){this._cache[t]?(this.delete(t),this._cache[t]=r,this._appendOrder(t)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[t]=r,this._appendOrder(t))}delete(t){this._cache[t]&&(delete this._cache[t],this._deleteOrder(t))}_deleteOrder(t){let r=this._order.indexOf(t);r>=0&&this._order.splice(r,1)}_appendOrder(t){this._order.push(t)}};function V$(){let e=[];for(let t=32;t<128;t++)e.push(String.fromCharCode(t));return e}var mo={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:V$(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},gI=1024,mI=.9,_I=1.2,yI=3,pm=new $a(yI);function H$(e,t){let r;typeof t=="string"?r=new Set(Array.from(t)):r=new Set(t);let n=pm.get(e);if(!n)return r;for(let s in n.mapping)r.has(s)&&r.delete(s);return r}function W$(e,t){for(let r=0;r<e.length;r++)t.data[4*r+3]=e[r]}function xI(e,t,r,n){e.font=`${n} ${r}px ${t}`,e.fillStyle="#000",e.textBaseline="alphabetic",e.textAlign="left"}function AI(e){k.assert(Number.isFinite(e)&&e>=yI,"Invalid cache limit"),pm=new $a(e)}var Rf=class{constructor(){this.props={...mo}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){let{fontSize:t,buffer:r}=this.props;return(t*_I+r*2)/t}setProps(t={}){Object.assign(this.props,t),this._key=this._getKey();let r=H$(this._key,this.props.characterSet),n=pm.get(this._key);if(n&&r.size===0){this._atlas!==n&&(this._atlas=n);return}let s=this._generateFontAtlas(r,n);this._atlas=s,pm.set(this._key,s)}_generateFontAtlas(t,r){let{fontFamily:n,fontWeight:s,fontSize:i,buffer:o,sdf:a,radius:c,cutoff:l}=this.props,h=r&&r.data;h||(h=document.createElement("canvas"),h.width=gI);let f=h.getContext("2d",{willReadFrequently:!0});xI(f,n,i,s);let{mapping:u,canvasHeight:d,xOffset:p,yOffset:g}=hI({getFontWidth:m=>f.measureText(m).width,fontHeight:i*_I,buffer:o,characterSet:t,maxCanvasWidth:gI,...r&&{mapping:r.mapping,xOffset:r.xOffset,yOffset:r.yOffset}});if(h.height!==d){let m=f.getImageData(0,0,h.width,h.height);h.height=d,f.putImageData(m,0,0)}if(xI(f,n,i,s),a){let m=new Pf({fontSize:i,buffer:o,radius:c,cutoff:l,fontFamily:n,fontWeight:`${s}`});for(let _ of t){let{data:y,width:x,height:A,glyphTop:M}=m.draw(_);u[_].width=x,u[_].layoutOffsetY=i*mI-M;let E=f.createImageData(x,A);W$(y,E),f.putImageData(E,u[_].x,u[_].y)}}else for(let m of t)f.fillText(m,u[m].x,u[m].y+o+i*mI);return{xOffset:p,yOffset:g,mapping:u,data:h,width:h.width,height:h.height}}_getKey(){let{fontFamily:t,fontWeight:r,fontSize:n,buffer:s,sdf:i,radius:o,cutoff:a}=this.props;return i?`${t} ${r} ${n} ${s} ${o} ${a}`:`${t} ${r} ${n} ${s}`}};var TI=`uniform textBackgroundUniforms {
    bool billboard;
    float sizeScale;
    float sizeMinPixels;
    float sizeMaxPixels;
    vec4 padding;
    highp int sizeUnits;
    bool stroked;
  } textBackground;
  `,MI={name:"textBackground",vs:TI,fs:TI,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}};var EI=`#version 300 es
  #define SHADER_NAME text-background-layer-vertex-shader
  in vec2 positions;
  in vec3 instancePositions;
  in vec3 instancePositions64Low;
  in vec4 instanceRects;
  in float instanceSizes;
  in float instanceAngles;
  in vec2 instancePixelOffsets;
  in float instanceLineWidths;
  in vec4 instanceFillColors;
  in vec4 instanceLineColors;
  in vec3 instancePickingColors;
  out vec4 vFillColor;
  out vec4 vLineColor;
  out float vLineWidth;
  out vec2 uv;
  out vec2 dimensions;
  vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
  }
  void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
  project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
  textBackground.sizeMinPixels, textBackground.sizeMaxPixels
  );
  dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;
  if (textBackground.billboard)  {
  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  vec3 offset = vec3(pixelOffset, 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
  vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
  DECKGL_FILTER_SIZE(offset_common, geometry);
  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
  }
  `;var bI=`#version 300 es
  #define SHADER_NAME text-background-layer-fragment-shader
  precision highp float;
  in vec4 vFillColor;
  in vec4 vLineColor;
  in float vLineWidth;
  in vec2 uv;
  in vec2 dimensions;
  out vec4 fragColor;
  void main(void) {
  geometry.uv = uv;
  vec2 pixelPosition = uv * dimensions;
  if (textBackground.stroked) {
  float distToEdge = min(
  min(pixelPosition.x, dimensions.x - pixelPosition.x),
  min(pixelPosition.y, dimensions.y - pixelPosition.y)
  );
  float isBorder = smoothedge(distToEdge, vLineWidth);
  fragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
  fragColor = vFillColor;
  }
  DECKGL_FILTER_COLOR(fragColor, geometry);
  }
  `;var G$={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:e=>e.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},If=class extends ut{getShaders(){return super.getShaders({vs:EI,fs:bI,modules:[st,Tt,MI]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(t){super.updateState(t);let{changeFlags:r}=t;r.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:t}){let{billboard:r,sizeScale:n,sizeUnits:s,sizeMinPixels:i,sizeMaxPixels:o,getLineWidth:a}=this.props,{padding:c}=this.props;c.length<4&&(c=[c[0],c[1],c[0],c[1]]);let l=this.state.model,h={billboard:r,stroked:Boolean(a),padding:c,sizeUnits:Lt[s],sizeScale:n,sizeMinPixels:i,sizeMaxPixels:o};l.shaderInputs.setProps({textBackground:h}),l.draw(this.context.renderPass)}_getModel(){let t=[0,0,1,0,0,1,1,1];return new Y(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new it({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(t)}}}),isInstanced:!0})}};If.defaultProps=G$;If.layerName="TextBackgroundLayer";var gm=If;var SI={start:1,middle:0,end:-1},vI={top:1,center:0,bottom:-1},bA=[0,0,0,255],j$=1,q$={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:bA},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:mo.characterSet},fontFamily:mo.fontFamily,fontWeight:mo.fontWeight,lineHeight:j$,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:bA},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:e=>e.text},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:bA},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},Of=class extends Ft{constructor(){super(...arguments),this.getBoundingRect=(t,r)=>{let{size:[n,s]}=this.transformParagraph(t,r),{fontSize:i}=this.state.fontAtlasManager.props;n/=i,s/=i;let{getTextAnchor:o,getAlignmentBaseline:a}=this.props,c=SI[typeof o=="function"?o(t,r):o],l=vI[typeof a=="function"?a(t,r):a];return[(c-1)*n/2,(l-1)*s/2,n,s]},this.getIconOffsets=(t,r)=>{let{getTextAnchor:n,getAlignmentBaseline:s}=this.props,{x:i,y:o,rowWidth:a,size:[c,l]}=this.transformParagraph(t,r),h=SI[typeof n=="function"?n(t,r):n],f=vI[typeof s=="function"?s(t,r):s],u=i.length,d=new Array(u*2),p=0;for(let g=0;g<u;g++){let m=(1-h)*(c-a[g])/2;d[p++]=(h-1)*c/2+m+i[g],d[p++]=(f-1)*l/2+o[g]}return d}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new Rf},this.props.maxWidth>0&&k.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(t){let{props:r,oldProps:n,changeFlags:s}=t;(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||r.lineHeight!==n.lineHeight||r.wordBreak!==n.wordBreak||r.maxWidth!==n.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:t}){return t.object=t.index>=0?this.props.data[t.index]:null,t}_updateFontAtlas(){let{fontSettings:t,fontFamily:r,fontWeight:n}=this.props,{fontAtlasManager:s,characterSet:i}=this.state,o={...t,characterSet:i,fontFamily:r,fontWeight:n};if(!s.mapping)return s.setProps(o),!0;for(let a in o)if(o[a]!==s.props[a])return s.setProps(o),!0;return!1}_updateText(){let{data:t,characterSet:r}=this.props,n=t.attributes?.getText,{getText:s}=this.props,i=t.startIndices,o,a=r==="auto"&&new Set;if(n&&i){let{texts:c,characterCount:l}=pI({...ArrayBuffer.isView(n)?{value:n}:n,length:t.length,startIndices:i,characterSet:a});o=l,s=(h,{index:f})=>c[f]}else{let{iterable:c,objectInfo:l}=Yt(t);i=[0],o=0;for(let h of c){l.index++;let f=Array.from(s(h,l)||"");a&&f.forEach(a.add,a),o+=f.length,i.push(o)}}this.setState({getText:s,startIndices:i,numInstances:o,characterSet:a||r})}transformParagraph(t,r){let{fontAtlasManager:n}=this.state,s=n.mapping,i=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:c}=this.props,l=i(t,r)||"";return dI(l,a,o,c*n.props.fontSize,s)}renderLayers(){let{startIndices:t,numInstances:r,getText:n,fontAtlasManager:{scale:s,atlas:i,mapping:o},styleVersion:a}=this.state,{data:c,_dataDiff:l,getPosition:h,getColor:f,getSize:u,getAngle:d,getPixelOffset:p,getBackgroundColor:g,getBorderColor:m,getBorderWidth:_,backgroundPadding:y,background:x,billboard:A,fontSettings:M,outlineWidth:E,outlineColor:w,sizeScale:v,sizeUnits:b,sizeMinPixels:T,sizeMaxPixels:I,transitions:N,updateTriggers:B}=this.props,C=this.getSubLayerClass("characters",dm),V=this.getSubLayerClass("background",gm);return[x&&new V({getFillColor:g,getLineColor:m,getLineWidth:_,padding:y,getPosition:h,getSize:u,getAngle:d,getPixelOffset:p,billboard:A,sizeScale:v,sizeUnits:b,sizeMinPixels:T,sizeMaxPixels:I,transitions:N&&{getPosition:N.getPosition,getAngle:N.getAngle,getSize:N.getSize,getFillColor:N.getBackgroundColor,getLineColor:N.getBorderColor,getLineWidth:N.getBorderWidth,getPixelOffset:N.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:B.getPosition,getAngle:B.getAngle,getSize:B.getSize,getFillColor:B.getBackgroundColor,getLineColor:B.getBorderColor,getLineWidth:B.getBorderWidth,getPixelOffset:B.getPixelOffset,getBoundingRect:{getText:B.getText,getTextAnchor:B.getTextAnchor,getAlignmentBaseline:B.getAlignmentBaseline,styleVersion:a}}}),{data:c.attributes&&c.attributes.background?{length:c.length,attributes:c.attributes.background}:c,_dataDiff:l,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new C({sdf:M.sdf,smoothing:Number.isFinite(M.smoothing)?M.smoothing:mo.smoothing,outlineWidth:E/(M.radius||mo.radius),outlineColor:w,iconAtlas:i,iconMapping:o,getPosition:h,getColor:f,getSize:u,getAngle:d,getPixelOffset:p,billboard:A,sizeScale:v*s,sizeUnits:b,sizeMinPixels:T*s,sizeMaxPixels:I*s,transitions:N&&{getPosition:N.getPosition,getAngle:N.getAngle,getColor:N.getColor,getSize:N.getSize,getPixelOffset:N.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:B.getText,getPosition:B.getPosition,getAngle:B.getAngle,getColor:B.getColor,getSize:B.getSize,getPixelOffset:B.getPixelOffset,getIconOffsets:{getTextAnchor:B.getTextAnchor,getAlignmentBaseline:B.getAlignmentBaseline,styleVersion:a}}}),{data:c,_dataDiff:l,startIndices:t,numInstances:r,getIconOffsets:this.getIconOffsets,getIcon:n})]}static set fontAtlasCacheLimit(t){AI(t)}};Of.defaultProps=q$;Of.layerName="TextLayer";var mm=Of;var Lf={circle:{type:Jg,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:ja,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:mm,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Nf={type:Mn,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},_m={type:ti,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Ka({type:e,props:t}){let r={};for(let n in t)r[n]=e.defaultProps[t[n]];return r}function xm(e,t){let{transitions:r,updateTriggers:n}=e.props,s={updateTriggers:{},transitions:r&&{getPosition:r.geometry}};for(let i in t){let o=t[i],a=e.props[i];i.startsWith("get")&&(a=e.getSubLayerAccessor(a),s.updateTriggers[o]=n[i],r&&(s.transitions[o]=r[i])),s[o]=a}return s}function CI(e){if(Array.isArray(e))return e;switch(k.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return k.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}function SA(e,t,r={}){let n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:s=0,endRow:i=e.length}=r;for(let o=s;o<i;o++){let a=e[o],{geometry:c}=a;if(c)if(c.type==="GeometryCollection"){k.assert(Array.isArray(c.geometries),"GeoJSON does not have geometries array");let{geometries:l}=c;for(let h=0;h<l.length;h++){let f=l[h];wI(f,n,t,a,o)}}else wI(c,n,t,a,o)}return n}function wI(e,t,r,n,s){let{type:i,coordinates:o}=e,{pointFeatures:a,lineFeatures:c,polygonFeatures:l,polygonOutlineFeatures:h}=t;if(!Y$(i,o)){k.warn(`${i} coordinates are malformed`)();return}switch(i){case"Point":a.push(r({geometry:e},n,s));break;case"MultiPoint":o.forEach(f=>{a.push(r({geometry:{type:"Point",coordinates:f}},n,s))});break;case"LineString":c.push(r({geometry:e},n,s));break;case"MultiLineString":o.forEach(f=>{c.push(r({geometry:{type:"LineString",coordinates:f}},n,s))});break;case"Polygon":l.push(r({geometry:e},n,s)),o.forEach(f=>{h.push(r({geometry:{type:"LineString",coordinates:f}},n,s))});break;case"MultiPolygon":o.forEach(f=>{l.push(r({geometry:{type:"Polygon",coordinates:f}},n,s)),f.forEach(u=>{h.push(r({geometry:{type:"LineString",coordinates:u}},n,s))})});break;default:}}var X$={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function Y$(e,t){let r=X$[e];for(k.assert(r,`Unknown GeoJSON type ${e}`);t&&--r>0;)t=t[0];return t&&Number.isFinite(t[0])}function PI(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function ym(e){return e.geometry.coordinates}function RI(e,t){let r=PI(),{pointFeatures:n,lineFeatures:s,polygonFeatures:i,polygonOutlineFeatures:o}=e;return r.points.data=n,r.points._dataDiff=t.pointFeatures&&(()=>t.pointFeatures),r.points.getPosition=ym,r.lines.data=s,r.lines._dataDiff=t.lineFeatures&&(()=>t.lineFeatures),r.lines.getPath=ym,r.polygons.data=i,r.polygons._dataDiff=t.polygonFeatures&&(()=>t.polygonFeatures),r.polygons.getPolygon=ym,r.polygonsOutline.data=o,r.polygonsOutline._dataDiff=t.polygonOutlineFeatures&&(()=>t.polygonOutlineFeatures),r.polygonsOutline.getPath=ym,r}function II(e,t){let r=PI(),{points:n,lines:s,polygons:i}=e,o=nI(e,t);return r.points.data={length:n.positions.value.length/n.positions.size,attributes:{...n.attributes,getPosition:n.positions,instancePickingColors:{size:4,value:o.points}},properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},r.lines.data={length:s.pathIndices.value.length-1,startIndices:s.pathIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:o.lines}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},r.lines._pathType="open",r.polygons.data={length:i.polygonIndices.value.length-1,startIndices:i.polygonIndices.value,attributes:{...i.attributes,getPolygon:i.positions,pickingColors:{size:4,value:o.polygons}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},r.polygons._normalize=!1,i.triangles&&(r.polygons.data.attributes.indices=i.triangles.value),r.polygonsOutline.data={length:i.primitivePolygonIndices.value.length-1,startIndices:i.primitivePolygonIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:4,value:o.polygons}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},r.polygonsOutline._pathType="open",r}var $$=["points","linestrings","polygons"],K$={...Ka(Lf.circle),...Ka(Lf.icon),...Ka(Lf.text),...Ka(Nf),...Ka(_m),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:e=>e.properties.icon},getText:{type:"accessor",value:e=>e.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}},Bf=class extends Ft{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:t,changeFlags:r}){if(!r.dataChanged)return;let{data:n}=this.props,s=n&&"points"in n&&"polygons"in n&&"lines"in n;this.setState({binary:s}),s?this._updateStateBinary({props:t,changeFlags:r}):this._updateStateJSON({props:t,changeFlags:r})}_updateStateBinary({props:t,changeFlags:r}){let n=II(t.data,this.encodePickingColor);this.setState({layerProps:n})}_updateStateJSON({props:t,changeFlags:r}){let n=CI(t.data),s=this.getSubLayerRow.bind(this),i={},o={};if(Array.isArray(r.dataChanged)){let c=this.state.features;for(let l in c)i[l]=c[l].slice(),o[l]=[];for(let l of r.dataChanged){let h=SA(n,s,l);for(let f in c)o[f].push(um({data:i[f],getIndex:u=>u.__source.index,dataRange:l,replace:h[f]}))}}else i=SA(n,s);let a=RI(i,o);this.setState({features:i,featuresDiff:o,layerProps:a})}getPickingInfo(t){let r=super.getPickingInfo(t),{index:n,sourceLayer:s}=r;return r.featureType=$$.find(i=>s.id.startsWith(`${this.id}-${i}-`)),n>=0&&s.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(r.index=this.props.data.points.globalFeatureIds.value[n]),r}_updateAutoHighlight(t){let r=`${this.id}-points-`,n=t.featureType==="points";for(let s of this.getSubLayers())s.id.startsWith(r)===n&&s.updateAutoHighlight(t)}_renderPolygonLayer(){let{extruded:t,wireframe:r}=this.props,{layerProps:n}=this.state,s="polygons-fill",i=this.shouldRenderSubLayer(s,n.polygons?.data)&&this.getSubLayerClass(s,_m.type);if(i){let o=xm(this,_m.props),a=t&&r;return a||delete o.getLineColor,o.updateTriggers.lineColors=a,new i(o,this.getSubLayerProps({id:s,updateTriggers:o.updateTriggers}),n.polygons)}return null}_renderLineLayers(){let{extruded:t,stroked:r}=this.props,{layerProps:n}=this.state,s="polygons-stroke",i="linestrings",o=!t&&r&&this.shouldRenderSubLayer(s,n.polygonsOutline?.data)&&this.getSubLayerClass(s,Nf.type),a=this.shouldRenderSubLayer(i,n.lines?.data)&&this.getSubLayerClass(i,Nf.type);if(o||a){let c=xm(this,Nf.props);return[o&&new o(c,this.getSubLayerProps({id:s,updateTriggers:c.updateTriggers}),n.polygonsOutline),a&&new a(c,this.getSubLayerProps({id:i,updateTriggers:c.updateTriggers}),n.lines)]}return null}_renderPointLayers(){let{pointType:t}=this.props,{layerProps:r,binary:n}=this.state,{highlightedObjectIndex:s}=this.props;!n&&Number.isFinite(s)&&(s=r.points.data.findIndex(a=>a.__source.index===s));let i=new Set(t.split("+")),o=[];for(let a of i){let c=`points-${a}`,l=Lf[a],h=l&&this.shouldRenderSubLayer(c,r.points?.data)&&this.getSubLayerClass(c,l.type);if(h){let f=xm(this,l.props),u=r.points;if(a==="text"&&n){let{instancePickingColors:d,...p}=u.data.attributes;u={...u,data:{...u.data,attributes:p}}}o.push(new h(f,this.getSubLayerProps({id:c,updateTriggers:f.updateTriggers,highlightedObjectIndex:s}),u))}}return o}renderLayers(){let{extruded:t}=this.props,r=this._renderPolygonLayer(),n=this._renderLineLayers(),s=this._renderPointLayers();return[!t&&r,n,s,t&&r]}getSubLayerAccessor(t){let{binary:r}=this.state;return!r||typeof t!="function"?super.getSubLayerAccessor(t):(n,s)=>{let{data:i,index:o}=s,a=rI(i,o);return t(a,s)}}};Bf.layerName="GeoJsonLayer";Bf.defaultProps=K$;var _o=Bf;function Z$(e){return typeof e=="string"?e.charAt(0).toLowerCase()+e.slice(1):e}function Am(e){if(Array.isArray(e))return e.map(t=>Am(t));if(e&&typeof e=="object"){let t={};for(let[r,n]of Object.entries(e))t[Z$(r)]=Am(n);return t}return e}var hO=Nn(lO(),1);function NA(e,t){if(t?._parser&&t._parser!=="fast-xml-parser")throw new Error(t?._parser);let r={allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:t?.removeNSPrefix,textNodeName:t?.textNodeName,isArray:(s,i,o,a)=>Boolean(t?.arrayPaths?.some(l=>i===l)),...t?._fastXML},n=oZ(e,r);return t?.uncapitalizeKeys?Am(n):n}function oZ(e,t){return new hO.XMLParser({ignoreAttributes:!1,attributeNamePrefix:"",...t}).parse(e)}var aZ="4.2.1",$r={dataType:null,batchType:null,name:"XML",id:"xml",module:"xml",version:aZ,worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:cZ,options:{xml:{_parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(e,t)=>NA(new TextDecoder().decode(e),{...$r.options.xml,...t?.xml}),parseTextSync:(e,t)=>NA(e,{...$r.options.xml,...t?.xml})};function cZ(e){return e.startsWith("<?xml")}function fO(e,t){let r=$r.parseTextSync?.(e,t),n=r?.ServiceExceptionReport?.ServiceException||r?.["ogc:ServiceExceptionReport"]?.["ogc:ServiceException"];return typeof n=="string"?n:n.value||n.code||"Unknown error"}var lZ="4.2.1",kf={dataType:null,batchType:null,id:"wms-error",name:"WMS Error",module:"wms",version:lZ,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:hZ,options:{wms:{throwOnError:!1}},parse:async(e,t)=>BA(new TextDecoder().decode(e),t),parseSync:(e,t)=>BA(new TextDecoder().decode(e),t),parseTextSync:(e,t)=>BA(e,t)};function hZ(e){return e.startsWith("<?xml")}function BA(e,t){let r={...kf.options.wms,...t?.wms},n=fO(e,r),s=r.minimalErrors?n:`WMS Service error: ${n}`;if(r.throwOnError)throw new Error(s);return s}function yo(e){return Array.isArray(e)?e:e?[e]:[]}function Uf(e){let t=yo(e);return t.length>0&&t.every(r=>typeof r=="string")?t:[]}function zf(e,t=void 0){switch(typeof e){case"number":return e;case"string":return parseFloat(e);default:return}}function Mm(e,t=void 0){switch(typeof e){case"number":return e;case"string":return parseInt(e,10);default:return}}function Ao(e){switch(e){case"true":return!0;case"false":return!1;case"1":return!0;case"0":return!1;default:return!1}}function FA(e,t){let r=$r.parseTextSync?.(e,t),n=r.WMT_MS_Capabilities||r.WMS_Capabilities||r,s=fZ(n);if(t?.inheritedLayerProps)for(let i of s.layers)dO(i,null);return t?.includeRawJSON&&(s.json=n),t?.includeXMLText&&(s.xml=e),s}function fZ(e){let t={version:String(e.version||""),name:String(e.Service?.Name||"unnamed"),title:e.Service?.Title?String(e.Service?.Title):void 0,abstract:e.Service?.Abstract?String(e.Service?.Abstract):void 0,keywords:Uf(e.Service?.KeywordList?.Keyword),fees:e.Service?.Fees?JSON.stringify(e.Service?.Fees):void 0,accessConstraints:e.Service?.AccessConstraints?JSON.stringify(e.Service?.AccessConstraints):void 0,layerLimit:Mm(e.Service?.LayerLimit),maxWidth:Mm(e.Service?.maxWidth),maxHeight:Mm(e.Service?.maxHeight),layers:[],requests:uZ(e.Capability?.Request),exceptions:dZ(e.Exception)},r=yo(e.Capability?.Layer);for(let n of r)t.layers.push(uO(n));for(let[n,s]of Object.entries(t))s===void 0&&delete t[n];return t}function uZ(e){let t={};for(let[r,n]of Object.entries(e||{})){let s=Uf(n?.Format);t[r]={mimeTypes:s}}return t}function dZ(e){if(yo(e?.Format).length>0)return{mimeTypes:Uf(e)}}function uO(e){let t={title:String(e?.Title||""),name:e?.Name&&String(e?.Name),abstract:e?.Name&&String(e?.Abstract),keywords:Uf(e.KeywordList?.Keyword)},r=e?.CRS||e?.SRS;r&&Array.isArray(r)&&r.every(l=>typeof l=="string")&&(t.crs=r);let n=e?.EX_GeographicBoundingBox&&pZ(e?.EX_GeographicBoundingBox);n&&(t.geographicBoundingBox=n),n=e?.LatLonBoundingBox&&gZ(e?.LatLonBoundingBox),n&&(t.geographicBoundingBox=n);let s=e?.BoundingBox&&mZ(e?.BoundingBox);s&&s.length>0&&(t.boundingBoxes=s);let o=yo(e?.Dimension).map(l=>xZ(l));o.length&&(t.dimensions=o),e?.opaque&&(t.opaque=Ao(e?.opaque)),e?.cascaded&&(t.cascaded=Ao(e?.cascaded)),e?.queryable&&(t.queryable=Ao(e?.queryable));let a=yo(e?.Layer),c=[];for(let l of a)c.push(uO(l));c.length>0&&(t.layers=c);for(let[l,h]of Object.entries(t))h===void 0&&delete t[l];return t}function pZ(e){let{westBoundLongitude:t,northBoundLatitude:r,eastBoundLongitude:n,southBoundLatitude:s}=e;return[[t,s],[n,r]]}function gZ(e){let{minx:t,miny:r,maxx:n,maxy:s}=e;return[[t,r],[n,s]]}function mZ(e){return yo(e).map(r=>_Z(r))}function _Z(e){let{CRS:t,SRS:r,minx:n,miny:s,maxx:i,maxy:o,resx:a,resy:c}=e,l={crs:t||r,boundingBox:[[zf(n),zf(s)],[zf(i),zf(o)]]};return a&&(l.xResolution=a),c&&(l.yResolution=c),l}function xZ(e){let{name:t,units:r,value:n}=e,s={name:t,units:r,extent:n};return e.unitSymbol&&(s.unitSymbol=e.unitSymbol),e.default&&(s.defaultValue=e.default),e.multipleValues&&(s.multipleValues=Ao(e.multipleValues)),e.nearestValue&&(s.nearestValue=Ao(e.nearestValue)),e.current&&(s.current=Ao(e.current)),s}function dO(e,t){t?.geographicBoundingBox&&!e.geographicBoundingBox&&(e.geographicBoundingBox=[...t.geographicBoundingBox]),t?.crs&&!e.crs&&(e.crs=[...t.crs]),t?.boundingBoxes&&!e.boundingBoxes&&(e.boundingBoxes=[...t.boundingBoxes]),t?.dimensions&&!e.dimensions&&(e.dimensions=[...t.dimensions]);for(let r of e.layers||[])dO(r,e)}var yZ="4.2.1",Za={dataType:null,batchType:null,id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:yZ,worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:AZ,options:{wms:{}},parse:async(e,t)=>FA(new TextDecoder().decode(e),t?.wms),parseTextSync:(e,t)=>FA(e,t?.wms)};function AZ(e){return e.startsWith("<?xml")}function DA(e,t){let n=($r.parseTextSync?.(e,t)).FeatureInfoResponse?.FIELDS||[];return{features:(Array.isArray(n)?n:[n]).map(i=>TZ(i))}}function TZ(e){return{attributes:e||{},type:"",bounds:{bottom:0,top:0,left:0,right:0}}}var pO={...Za,dataType:null,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(e,t)=>DA(new TextDecoder().decode(e),t),parseTextSync:(e,t)=>DA(e,t)};function kA(e,t){return $r.parseTextSync?.(e,t)}var gO={...Za,dataType:null,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(e,t)=>kA(new TextDecoder().decode(e),t),parseTextSync:(e,t)=>kA(e,t)};function mO(e,t){let{type:r="auto"}=e,n=r==="auto"?EZ(e.url,t):MZ(r,t);if(!n)throw new Error("Not a valid image source type");return n.create(e)}function MZ(e,t){for(let r of t)if(r.type===e)return r;return null}function EZ(e,t){for(let r of t)if(r.testURL&&r.testURL(e))return r;return null}var _O={type:"wms",testURL:e=>e.toLowerCase().includes("wms"),create:e=>new UA(e)},UA=class extends pr{url;data;substituteCRS84;flipCRS;wmsParameters;vendorParameters;capabilities=null;constructor(t){super(t),this.url=t.url,this.data=t.url,this.substituteCRS84=t.substituteCRS84??!1,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...t.wmsParameters},this.vendorParameters=t.vendorParameters||{}}async getMetadata(){let t=await this.getCapabilities();return this.normalizeMetadata(t)}async getImage(t){let{boundingBox:r,bbox:n,...s}=t,i={bbox:r?[...r[0],...r[1]]:n,...s};return await this.getMap(i)}normalizeMetadata(t){return t}async getCapabilities(t,r){let n=this.getCapabilitiesURL(t,r),s=await this.fetch(n),i=await s.arrayBuffer();this._checkResponse(s,i);let o=await Za.parse(i,this.loadOptions);return this.capabilities=o,o}async getMap(t,r){let n=this.getMapURL(t,r),s=await this.fetch(n),i=await s.arrayBuffer();this._checkResponse(s,i);try{return await cn.parse(i,this.loadOptions)}catch{throw this._parseError(i)}}async getFeatureInfo(t,r){let n=this.getFeatureInfoURL(t,r),s=await this.fetch(n),i=await s.arrayBuffer();return this._checkResponse(s,i),await pO.parse(i,this.loadOptions)}async getFeatureInfoText(t,r){let n=this.getFeatureInfoURL(t,r),s=await this.fetch(n),i=await s.arrayBuffer();return this._checkResponse(s,i),new TextDecoder().decode(i)}async describeLayer(t,r){let n=this.describeLayerURL(t,r),s=await this.fetch(n),i=await s.arrayBuffer();return this._checkResponse(s,i),await gO.parse(i,this.loadOptions)}async getLegendGraphic(t,r){let n=this.getLegendGraphicURL(t,r),s=await this.fetch(n),i=await s.arrayBuffer();this._checkResponse(s,i);try{return await cn.parse(i,this.loadOptions)}catch{throw this._parseError(i)}}getCapabilitiesURL(t,r){let n={version:this.wmsParameters.version,...t};return this._getWMSUrl("GetCapabilities",n,r)}getMapURL(t,r){t=this._getWMS130Parameters(t);let n={version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...t};return this._getWMSUrl("GetMap",n,r)}getFeatureInfoURL(t,r){t=this._getWMS130Parameters(t);let{boundingBox:n,bbox:s}=t;t.bbox=n?[...n[0],...n[1]]:s;let i={version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...t};return this._getWMSUrl("GetFeatureInfo",i,r)}describeLayerURL(t,r){let n={version:this.wmsParameters.version,...t};return this._getWMSUrl("DescribeLayer",n,r)}getLegendGraphicURL(t,r){let n={version:this.wmsParameters.version,...t};return this._getWMSUrl("GetLegendGraphic",n,r)}_parseWMSUrl(t){let[r,n]=t.split("?"),s=n.split("&"),i={};for(let o of s){let[a,c]=o.split("=");i[a]=c}return{url:r,parameters:i}}_getWMSUrl(t,r,n){let s=this.url,i=!0,o={service:"WMS",version:r.version,request:t,...r,...this.vendorParameters,...n},a=["transparent","time","elevation"];for(let[c,l]of Object.entries(o))(!a.includes(c)||l)&&(s+=i?"?":"&",i=!1,s+=this._getURLParameter(c,l,r));return encodeURI(s)}_getWMS130Parameters(t){let r={...t};return r.srs&&(r.crs=r.crs||r.srs,delete r.srs),r}_getURLParameter(t,r,n){switch(t){case"crs":n.version!=="1.3.0"?t="srs":this.substituteCRS84&&r==="EPSG:4326"&&(r="CRS:84");break;case"srs":n.version==="1.3.0"&&(t="crs");break;case"bbox":let s=this._flipBoundingBox(r,n);s&&(r=s);break;case"x":n.version==="1.3.0"&&(t="i");break;case"y":n.version==="1.3.0"&&(t="j");break;default:}return t=t.toUpperCase(),Array.isArray(r)?`${t}=${r.join(",")}`:`${t}=${r?String(r):""}`}_flipBoundingBox(t,r){if(!Array.isArray(t)||t.length!==4)return null;let n=r.version==="1.3.0"&&this.flipCRS.includes(r.crs||"")&&!(this.substituteCRS84&&r.crs==="EPSG:4326"),s=t;return n?[s[1],s[0],s[3],s[2]]:s}async _fetchArrayBuffer(t){let r=await this.fetch(t),n=await r.arrayBuffer();return this._checkResponse(r,n),n}_checkResponse(t,r){let n=t.headers["content-type"];if(!t.ok||kf.mimeTypes.includes(n)){let s=pl(this.loadOptions,{wms:{throwOnError:!0}}),i=kf.parseSync?.(r,s);throw new Error(i)}}_parseError(t){let r=kf.parseSync?.(t,this.loadOptions);return new Error(r)}};var Ja=class extends pr{constructor(t){super(t)}async getMetadata(){throw new Error("ImageSource.getMetadata not implemented")}async getImage(t){let r=this.getGranularParameters(t),n=this.getURLFromTemplate(r),i=await(await this.fetch(n)).arrayBuffer();return await cn.parse(i)}getGranularParameters(t){let[[r,n],[s,i]]=t.boundingBox;return{...t,east:r,north:n,south:i,west:s}}getURLFromTemplate(t){let r=this.props.url;for(let[n,s]of Object.entries(t))r=r.replace(`\${${n}}`,String(s)),r=r.replace(`{${n}}`,String(s));return r}};H(Ja,"type","template"),H(Ja,"testURL",t=>t.toLowerCase().includes("{"));var zA=class extends Ja{data;constructor(t){super(t),this.data=t.url}async getMetadata(){return await this.metadata()}async getImage(t){throw new Error("not implemented")}async metadata(){throw new Error("not implemented")}exportImage(t){throw new Error("not implemented")}metadataURL(t){return`${this.props.url}?f=pjson`}exportImageURL(t){let r=`bbox=${t.bbox[0]},${t.bbox[1]},${t.bbox[2]},${t.bbox[3]}`,n=`size=${t.width},${t.height}`,s={...t,bbox:r,size:n};return delete s.width,delete s.height,this.getUrl("exportImage",s)}getUrl(t,r,n){let s=`${this.props.url}/${t}`,i=!0;for(let[o,a]of Object.entries(r))s+=i?"?":"&",i=!1,Array.isArray(a)?s+=`${o.toUpperCase()}=${a.join(",")}`:s+=`${o.toUpperCase()}=${a?String(a):""}`;return s}async checkResponse(t){if(!t.ok)throw new Error("error")}},xO={type:"arcgis-image-server",testURL:e=>e.toLowerCase().includes("ImageServer"),create:e=>new zA(e)};var bZ=[_O,xO];function VA(e){return mO(e,bZ)}var yO=6378137*Math.PI;function HA(e){let t=Kt(e);return t[0]=(t[0]/256-1)*yO,t[1]=(t[1]/256-1)*yO,t}var SZ={id:"imagery-layer",data:"",serviceType:"auto",srs:"auto",layers:{type:"array",compare:!0,value:[]},onMetadataLoad:{type:"function",value:()=>{}},onMetadataLoadError:{type:"function",value:console.error},onImageLoadStart:{type:"function",value:()=>{}},onImageLoad:{type:"function",value:()=>{}},onImageLoadError:{type:"function",compare:!1,value:(e,t)=>console.error(t,e)}},Qa=class extends Ft{get isLoaded(){return this.state?.loadCounter===0&&super.isLoaded}shouldUpdateState(){return!0}initializeState(){this.state._nextRequestId=0,this.state.lastRequestId=-1,this.state.loadCounter=0}updateState({changeFlags:t,props:r,oldProps:n}){let{viewport:s}=this.context;t.dataChanged||r.serviceType!==n.serviceType?(this.state.imageSource=this._createImageSource(r),this._loadMetadata(),this.debounce(()=>this.loadImage(s,"image source changed"),0)):tt(r.layers,n.layers,1)?t.viewportChanged&&this.debounce(()=>this.loadImage(s,"viewport changed")):this.debounce(()=>this.loadImage(s,"layers changed"),0)}finalizeState(){}renderLayers(){let{bounds:t,image:r,lastRequestParameters:n}=this.state;return r&&new Kg({...this.getSubLayerProps({id:"bitmap"}),_imageCoordinateSystem:n.srs==="EPSG:4326"?W.LNGLAT:W.CARTESIAN,bounds:t,image:r})}async getFeatureInfoText(t,r){let{lastRequestParameters:n}=this.state;return n?await this.state.imageSource.getFeatureInfoText?.({...n,query_layers:n.layers,x:t,y:r,info_format:"application/vnd.ogc.gml"}):""}_createImageSource(t){if(t.data instanceof pr)return t.data;if(typeof t.data=="string")return VA({url:t.data,loadOptions:t.loadOptions,type:t.serviceType});throw new Error("invalid image source in props.data")}async _loadMetadata(){let{imageSource:t}=this.state;try{this.state.loadCounter++;let r=await t.getMetadata();this.state.imageSource===t&&this.getCurrentLayer()?.props.onMetadataLoad(r)}catch(r){this.getCurrentLayer()?.props.onMetadataLoadError(r)}finally{this.state.loadCounter--}}async loadImage(t,r){let{layers:n,serviceType:s}=this.props;if(s==="wms"&&n.length===0)return;let i=t.getBounds(),{width:o,height:a}=t,c=this.getRequestId(),{srs:l}=this.props;l==="auto"&&(l=t.resolution?"EPSG:4326":"EPSG:3857");let h={width:o,height:a,boundingBox:[[i[0],i[1]],[i[2],i[3]]],layers:n,crs:l};if(l==="EPSG:3857"){let f=HA([i[0],i[1]]),u=HA([i[2],i[3]]);h.boundingBox=[f,u]}try{this.state.loadCounter++,this.props.onImageLoadStart(c);let f=await this.state.imageSource.getImage(h);this.state.lastRequestId<c&&(this.getCurrentLayer()?.props.onImageLoad(c),this.setState({image:f,bounds:i,lastRequestParameters:h,lastRequestId:c}))}catch(f){this.raiseError(f,"Load image"),this.getCurrentLayer()?.props.onImageLoadError(c,f)}finally{this.state.loadCounter--}}getRequestId(){return this.state._nextRequestId++}debounce(t,r=500){clearTimeout(this.state._timeoutId),this.state._timeoutId=setTimeout(()=>t(),r)}};Qa.layerName="WMSLayer";Qa.defaultProps=SZ;var vZ={getHeight:{type:"accessor",value:0},greatCircle:!0},Vf=class extends $g{};Vf.layerName="GreatCircleLayer";Vf.defaultProps=vZ;var AO=Vf;var wZ={...ei.defaultProps},Hf=class extends Ft{indexToBounds(){return null}renderLayers(){let{elevationScale:t,extruded:r,wireframe:n,filled:s,stroked:i,lineWidthUnits:o,lineWidthScale:a,lineWidthMinPixels:c,lineWidthMaxPixels:l,lineJointRounded:h,lineMiterLimit:f,lineDashJustified:u,getElevation:d,getFillColor:p,getLineColor:g,getLineWidth:m}=this.props,{updateTriggers:_,material:y,transitions:x}=this.props,A=this.getSubLayerClass("cell",ei),{updateTriggers:M,...E}=this.indexToBounds()||{};return new A({filled:s,wireframe:n,extruded:r,elevationScale:t,stroked:i,lineWidthUnits:o,lineWidthScale:a,lineWidthMinPixels:c,lineWidthMaxPixels:l,lineJointRounded:h,lineMiterLimit:f,lineDashJustified:u,material:y,transitions:x,getElevation:d,getFillColor:p,getLineColor:g,getLineWidth:m},this.getSubLayerProps({id:"cell",updateTriggers:_&&{...M,getElevation:_.getElevation,getFillColor:_.getFillColor,getLineColor:_.getLineColor,getLineWidth:_.getLineWidth}}),E)}};Hf.layerName="GeoCellLayer";Hf.defaultProps=wZ;var En=Hf;var Em=Nn(WA(),1),CZ=3,PZ=30,RZ=2*PZ+1,MO=180/Math.PI;function bO(e,t,r){let n=1<<t;return[(e[0]+r[0])/n,(e[1]+r[1])/n]}function EO(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function SO(e){return[EO(e[0]),EO(e[1])]}function vO(e,[t,r]){switch(e){case 0:return[1,t,r];case 1:return[-t,1,r];case 2:return[-t,-r,1];case 3:return[-1,-r,-t];case 4:return[r,-1,-t];case 5:return[r,t,-1];default:throw new Error("Invalid face")}}function wO([e,t,r]){let n=Math.atan2(r,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*MO,n*MO]}function CO(e){let t=Em.default.fromString(e,!0,10).toString(2);for(;t.length<CZ+RZ;)t="0"+t;let r=t.lastIndexOf("1"),n=t.substring(0,3),s=t.substring(3,r),i=s.length/2,o=Em.default.fromString(n,!0,2).toString(10),a=Em.default.fromString(s,!0,2).toString(4);for(;a.length<i;)a="0"+a;return`${o}/${a}`}function IZ(e,t,r,n){if(n===0){r===1&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);let s=t[0];t[0]=t[1],t[1]=s}}function PO(e){let t=e.split("/"),r=parseInt(t[0],10),n=t[1],s=n.length,i=[0,0],o;for(let a=s-1;a>=0;a--){o=s-a;let c=n[a],l=0,h=0;c==="1"?h=1:c==="2"?(l=1,h=1):c==="3"&&(l=1);let f=Math.pow(2,o-1);IZ(f,i,l,h),i[0]+=f*l,i[1]+=f*h}if(r%2===1){let a=i[0];i[0]=i[1],i[1]=a}return{face:r,ij:i,level:o}}var RO=Nn(WA(),1);function OZ(e){let t=e.padEnd(16,"0");return RO.default.fromString(t,16)}var LZ=100;function NZ({face:e,ij:t,level:r}){let n=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(LZ*Math.pow(2,-r))),i=new Float64Array(4*s*2+2),o=0,a=0;for(let c=0;c<4;c++){let l=n[c].slice(0),h=n[c+1],f=(h[0]-l[0])/s,u=(h[1]-l[1])/s;for(let d=0;d<s;d++){l[0]+=f,l[1]+=u;let p=bO(t,r,l),g=SO(p),m=vO(e,g),_=wO(m);Math.abs(_[1])>89.999&&(_[0]=a);let y=_[0]-a;_[0]+=y>180?-360:y<-180?360:0,i[o++]=_[0],i[o++]=_[1],a=_[0]}}return i[o++]=i[0],i[o++]=i[1],i}function BZ(e){if(typeof e=="string"){if(e.indexOf("/")>0)return e;e=OZ(e)}return CO(e.toString())}function IO(e){let t=BZ(e),r=PO(t);return NZ(r)}var FZ={getS2Token:{type:"accessor",value:e=>e.token}},Gf=class extends En{indexToBounds(){let{data:t,getS2Token:r}=this.props;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(n,s)=>IO(r(n,s))}}};Gf.layerName="S2Layer";Gf.defaultProps=FZ;var OO=Gf;var GA=512;function DZ(e,t){let r=0,n=0,s=1<<e.length,i=s/GA;for(let o=0;o<e.length;o++){s>>=1;let a=parseInt(e[o]);a%2&&(r|=s),a>1&&(n|=s)}return[[r/i,GA-n/i],[(r+t)/i,GA-(n+t)/i]]}function LO(e,t=1){let[r,n]=DZ(e,t),[s,i]=Te(r),[o,a]=Te(n);return[o,i,o,a,s,a,s,i,o,i]}var kZ={getQuadkey:{type:"accessor",value:e=>e.quadkey}},jf=class extends En{indexToBounds(){let{data:t,extruded:r,getQuadkey:n}=this.props,s=r?.99:1;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(i,o)=>LO(n(i,o),s),updateTriggers:{getPolygon:s}}}};jf.layerName="QuadkeyLayer";jf.defaultProps=kZ;var NO=jf;var To=class{constructor(t){this.index=t,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(t){this._bbox||(this._bbox=t,"west"in t?this.boundingBox=[[t.west,t.south],[t.east,t.north]]:this.boundingBox=[[t.left,t.top],[t.right,t.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return Boolean(this._loader)&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){let t=this.content?this.content.byteLength:0;return Number.isFinite(t)||console.error("byteLength not defined in tile data"),t}async _loadData({getData:t,requestScheduler:r,onLoad:n,onError:s}){let{index:i,id:o,bbox:a,userData:c,zoom:l}=this,h=this._loaderId;this._abortController=new AbortController;let{signal:f}=this._abortController,u=await r.scheduleRequest(this,g=>g.isSelected?1:-1);if(!u){this._isCancelled=!0;return}if(this._isCancelled){u.done();return}let d=null,p;try{d=await t({index:i,id:o,bbox:a,userData:c,zoom:l,signal:f})}catch(g){p=g||!0}finally{u.done()}if(h===this._loaderId){if(this._loader=void 0,this.content=d,this._isCancelled&&!d){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,p?s(p,this):n(this)}}loadData(t){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(t),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){this.isLoaded||(this._isCancelled=!0,this._abortController?.abort())}};var Jt={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};var BO=new D,UZ=new D,ni=class{constructor(t=[0,0,0],r=[0,0,0],n){n=n||BO.copy(t).add(r).scale(.5),this.center=new D(n),this.halfDiagonal=new D(r).subtract(this.center),this.minimum=new D(t),this.maximum=new D(r)}clone(){return new ni(this.minimum,this.maximum,this.center)}equals(t){return this===t||Boolean(t)&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}transform(t){return this.center.transformAsPoint(t),this.halfDiagonal.transform(t),this.minimum.transform(t),this.maximum.transform(t),this}intersectPlane(t){let{halfDiagonal:r}=this,n=UZ.from(t.normal),s=r.x*Math.abs(n.x)+r.y*Math.abs(n.y)+r.z*Math.abs(n.z),i=this.center.dot(n)+t.distance;return i-s>0?Jt.INSIDE:i+s<0?Jt.OUTSIDE:Jt.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){let r=BO.from(t).subtract(this.center),{halfDiagonal:n}=this,s=0,i;return i=Math.abs(r.x)-n.x,i>0&&(s+=i*i),i=Math.abs(r.y)-n.y,i>0&&(s+=i*i),i=Math.abs(r.z)-n.z,i>0&&(s+=i*i),s}};var qf=new D,FO=new D,si=class{constructor(t=[0,0,0],r=0){this.radius=-0,this.center=new D,this.fromCenterRadius(t,r)}fromCenterRadius(t,r){return this.center.from(t),this.radius=r,this}fromCornerPoints(t,r){return r=qf.from(r),this.center=new D().from(t).add(r).scale(.5),this.radius=this.center.distance(r),this}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new si(this.center,this.radius)}union(t){let r=this.center,n=this.radius,s=t.center,i=t.radius,o=qf.copy(s).subtract(r),a=o.magnitude();if(n>=a+i)return this.clone();if(i>=a+n)return t.clone();let c=(n+a+i)*.5;return FO.copy(o).scale((-n+c)/a).add(r),this.center.copy(FO),this.radius=c,this}expand(t){let n=qf.from(t).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(t){this.center.transform(t);let r=jt.getScaling(qf,t);return this.radius=Math.max(r[0],Math.max(r[1],r[2]))*this.radius,this}distanceSquaredTo(t){let r=this.distanceTo(t);return r*r}distanceTo(t){let n=qf.from(t).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(t){let r=this.center,n=this.radius,i=t.normal.dot(r)+t.distance;return i<-n?Jt.OUTSIDE:i<n?Jt.INTERSECTING:Jt.INSIDE}};var zZ=new D,VZ=new D,bm=new D,Sm=new D,vm=new D,HZ=new D,WZ=new D,is={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8},Mo=class{constructor(t=[0,0,0],r=[0,0,0,0,0,0,0,0,0]){this.center=new D().from(t),this.halfAxes=new Ut(r)}get halfSize(){let t=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new D(t).len(),new D(r).len(),new D(n).len()]}get quaternion(){let t=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),s=new D(t).normalize(),i=new D(r).normalize(),o=new D(n).normalize();return new ks().fromMatrix3(new Ut([...s,...i,...o]))}fromCenterHalfSizeQuaternion(t,r,n){let s=new ks(n),i=new Ut().fromQuaternion(s);return i[0]=i[0]*r[0],i[1]=i[1]*r[0],i[2]=i[2]*r[0],i[3]=i[3]*r[1],i[4]=i[4]*r[1],i[5]=i[5]*r[1],i[6]=i[6]*r[2],i[7]=i[7]*r[2],i[8]=i[8]*r[2],this.center=new D().from(t),this.halfAxes=i,this}clone(){return new Mo(this.center,this.halfAxes)}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new si){let r=this.halfAxes,n=r.getColumn(0,bm),s=r.getColumn(1,Sm),i=r.getColumn(2,vm),o=zZ.copy(n).add(s).add(i);return t.center.copy(this.center),t.radius=o.magnitude(),t}intersectPlane(t){let r=this.center,n=t.normal,s=this.halfAxes,i=n.x,o=n.y,a=n.z,c=Math.abs(i*s[is.COLUMN0ROW0]+o*s[is.COLUMN0ROW1]+a*s[is.COLUMN0ROW2])+Math.abs(i*s[is.COLUMN1ROW0]+o*s[is.COLUMN1ROW1]+a*s[is.COLUMN1ROW2])+Math.abs(i*s[is.COLUMN2ROW0]+o*s[is.COLUMN2ROW1]+a*s[is.COLUMN2ROW2]),l=n.dot(r)+t.distance;return l<=-c?Jt.OUTSIDE:l>=c?Jt.INSIDE:Jt.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){let r=VZ.from(t).subtract(this.center),n=this.halfAxes,s=n.getColumn(0,bm),i=n.getColumn(1,Sm),o=n.getColumn(2,vm),a=s.magnitude(),c=i.magnitude(),l=o.magnitude();s.normalize(),i.normalize(),o.normalize();let h=0,f;return f=Math.abs(r.dot(s))-a,f>0&&(h+=f*f),f=Math.abs(r.dot(i))-c,f>0&&(h+=f*f),f=Math.abs(r.dot(o))-l,f>0&&(h+=f*f),h}computePlaneDistances(t,r,n=[-0,-0]){let s=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,o=this.center,a=this.halfAxes,c=a.getColumn(0,bm),l=a.getColumn(1,Sm),h=a.getColumn(2,vm),f=HZ.copy(c).add(l).add(h).add(o),u=WZ.copy(f).subtract(t),d=r.dot(u);return s=Math.min(d,s),i=Math.max(d,i),f.copy(o).add(c).add(l).subtract(h),u.copy(f).subtract(t),d=r.dot(u),s=Math.min(d,s),i=Math.max(d,i),f.copy(o).add(c).subtract(l).add(h),u.copy(f).subtract(t),d=r.dot(u),s=Math.min(d,s),i=Math.max(d,i),f.copy(o).add(c).subtract(l).subtract(h),u.copy(f).subtract(t),d=r.dot(u),s=Math.min(d,s),i=Math.max(d,i),o.copy(f).subtract(c).add(l).add(h),u.copy(f).subtract(t),d=r.dot(u),s=Math.min(d,s),i=Math.max(d,i),o.copy(f).subtract(c).add(l).subtract(h),u.copy(f).subtract(t),d=r.dot(u),s=Math.min(d,s),i=Math.max(d,i),o.copy(f).subtract(c).subtract(l).add(h),u.copy(f).subtract(t),d=r.dot(u),s=Math.min(d,s),i=Math.max(d,i),o.copy(f).subtract(c).subtract(l).subtract(h),u.copy(f).subtract(t),d=r.dot(u),s=Math.min(d,s),i=Math.max(d,i),n[0]=s,n[1]=i,n}transform(t){this.center.transformAsPoint(t);let r=this.halfAxes.getColumn(0,bm);r.transformAsPoint(t);let n=this.halfAxes.getColumn(1,Sm);n.transformAsPoint(t);let s=this.halfAxes.getColumn(2,vm);return s.transformAsPoint(t),this.halfAxes=new Ut([...r,...n,...s]),this}getTransform(){throw new Error("not implemented")}};var DO=new D,kO=new D,Kr=class{constructor(t=[0,0,1],r=0){this.normal=new D,this.distance=-0,this.fromNormalDistance(t,r)}fromNormalDistance(t,r){return fn(Number.isFinite(r)),this.normal.from(t).normalize(),this.distance=r,this}fromPointNormal(t,r){t=DO.from(t),this.normal.from(r).normalize();let n=-this.normal.dot(t);return this.distance=n,this}fromCoefficients(t,r,n,s){return this.normal.set(t,r,n),fn(kt(this.normal.len(),1)),this.distance=s,this}clone(){return new Kr(this.normal,this.distance)}equals(t){return kt(this.distance,t.distance)&&kt(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){let r=kO.copy(this.normal).transformAsVector(t).normalize(),n=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(n,r)}projectPointOntoPlane(t,r=[0,0,0]){let n=DO.from(t),s=this.getPointDistance(n),i=kO.copy(this.normal).scale(s);return n.subtract(i).to(r)}};var UO=[new D([1,0,0]),new D([0,1,0]),new D([0,0,1])],zO=new D,GZ=new D,tr=class{constructor(t=[]){this.planes=t}fromBoundingSphere(t){this.planes.length=2*UO.length;let r=t.center,n=t.radius,s=0;for(let i of UO){let o=this.planes[s],a=this.planes[s+1];o||(o=this.planes[s]=new Kr),a||(a=this.planes[s+1]=new Kr);let c=zO.copy(i).scale(-n).add(r);o.fromPointNormal(c,i);let l=zO.copy(i).scale(n).add(r),h=GZ.copy(i).negate();a.fromPointNormal(l,h),s+=2}return this}computeVisibility(t){let r=Jt.INSIDE;for(let n of this.planes)switch(t.intersectPlane(n)){case Jt.OUTSIDE:return Jt.OUTSIDE;case Jt.INTERSECTING:r=Jt.INTERSECTING;break;default:}return r}computeVisibilityWithPlaneMask(t,r){if(fn(Number.isFinite(r),"parentPlaneMask is required."),r===tr.MASK_OUTSIDE||r===tr.MASK_INSIDE)return r;let n=tr.MASK_INSIDE,s=this.planes;for(let i=0;i<this.planes.length;++i){let o=i<31?1<<i:0;if(i<31&&!(r&o))continue;let a=s[i],c=t.intersectPlane(a);if(c===Jt.OUTSIDE)return tr.MASK_OUTSIDE;c===Jt.INTERSECTING&&(n|=o)}return n}};tr.MASK_OUTSIDE=4294967295;tr.MASK_INSIDE=0;tr.MASK_INDETERMINATE=2147483647;var lkt=new D,hkt=new D,fkt=new D,ukt=new D,dkt=new D;var ykt=new D,Akt=new D,Tkt=new D,Mkt=new D,Ekt=new D,bkt=new D,Skt=new D,vkt=new D,wkt=new D,Ckt=new D,Pkt=new D,Rkt=new D;var bn=new Ut,qZ=new Ut,XZ=new Ut,wm=new Ut,VO=new Ut;function XA(e,t={}){let r=Aa.EPSILON20,n=10,s=0,i=0,o=qZ,a=XZ;o.identity(),a.copy(e);let c=r*YZ(a);for(;i<n&&$Z(a)>c;)KZ(a,wm),VO.copy(wm).transpose(),a.multiplyRight(wm),a.multiplyLeft(VO),o.multiplyRight(wm),++s>2&&(++i,s=0);return t.unitary=o.toTarget(t.unitary),t.diagonal=a.toTarget(t.diagonal),t}function YZ(e){let t=0;for(let r=0;r<9;++r){let n=e[r];t+=n*n}return Math.sqrt(t)}var jA=[1,0,0],qA=[2,2,1];function $Z(e){let t=0;for(let r=0;r<3;++r){let n=e[bn.getElementIndex(qA[r],jA[r])];t+=2*n*n}return Math.sqrt(t)}function KZ(e,t){let r=Aa.EPSILON15,n=0,s=1;for(let l=0;l<3;++l){let h=Math.abs(e[bn.getElementIndex(qA[l],jA[l])]);h>n&&(s=l,n=h)}let i=jA[s],o=qA[s],a=1,c=0;if(Math.abs(e[bn.getElementIndex(o,i)])>r){let l=e[bn.getElementIndex(o,o)],h=e[bn.getElementIndex(i,i)],f=e[bn.getElementIndex(o,i)],u=(l-h)/2/f,d;u<0?d=-1/(-u+Math.sqrt(1+u*u)):d=1/(u+Math.sqrt(1+u*u)),a=1/Math.sqrt(1+d*d),c=d*a}return Ut.IDENTITY.to(t),t[bn.getElementIndex(i,i)]=t[bn.getElementIndex(o,o)]=a,t[bn.getElementIndex(o,i)]=c,t[bn.getElementIndex(i,o)]=-c,t}var ii=new D,ZZ=new D,JZ=new D,QZ=new D,tJ=new D,eJ=new Ut,rJ={diagonal:new Ut,unitary:new Ut};function YA(e,t=new Mo){if(!e||e.length===0)return t.halfAxes=new Ut([0,0,0,0,0,0,0,0,0]),t.center=new D,t;let r=e.length,n=new D(0,0,0);for(let b of e)n.add(b);let s=1/r;n.multiplyByScalar(s);let i=0,o=0,a=0,c=0,l=0,h=0;for(let b of e){let T=ii.copy(b).subtract(n);i+=T.x*T.x,o+=T.x*T.y,a+=T.x*T.z,c+=T.y*T.y,l+=T.y*T.z,h+=T.z*T.z}i*=s,o*=s,a*=s,c*=s,l*=s,h*=s;let f=eJ;f[0]=i,f[1]=o,f[2]=a,f[3]=o,f[4]=c,f[5]=l,f[6]=a,f[7]=l,f[8]=h;let{unitary:u}=XA(f,rJ),d=t.halfAxes.copy(u),p=d.getColumn(0,JZ),g=d.getColumn(1,QZ),m=d.getColumn(2,tJ),_=-Number.MAX_VALUE,y=-Number.MAX_VALUE,x=-Number.MAX_VALUE,A=Number.MAX_VALUE,M=Number.MAX_VALUE,E=Number.MAX_VALUE;for(let b of e)ii.copy(b),_=Math.max(ii.dot(p),_),y=Math.max(ii.dot(g),y),x=Math.max(ii.dot(m),x),A=Math.min(ii.dot(p),A),M=Math.min(ii.dot(g),M),E=Math.min(ii.dot(m),E);p=p.multiplyByScalar(.5*(A+_)),g=g.multiplyByScalar(.5*(M+y)),m=m.multiplyByScalar(.5*(E+x)),t.center.copy(p).add(g).add(m);let w=ZZ.set(_-A,y-M,x-E).multiplyByScalar(.5),v=new Ut([w[0],0,0,0,w[1],0,0,0,w[2]]);return t.halfAxes.multiplyRight(v),t}var tc=512,HO=3,WO=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],GO=WO.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),nJ=GO.concat([[.25,.5],[.75,.5]]),oi=class{constructor(t,r,n){this.x=t,this.y=r,this.z=n}get children(){if(!this._children){let t=this.x*2,r=this.y*2,n=this.z+1;this._children=[new oi(t,r,n),new oi(t,r+1,n),new oi(t+1,r,n),new oi(t+1,r+1,n)]}return this._children}update(t){let{viewport:r,cullingVolume:n,elevationBounds:s,minZ:i,maxZ:o,bounds:a,offset:c,project:l}=t,h=this.getBoundingVolume(s,c,l);if(a&&!this.insideBounds(a)||n.computeVisibility(h)<0)return!1;if(!this.childVisible){let{z:u}=this;if(u<o&&u>=i){let d=h.distanceTo(r.cameraPosition)*r.scale/r.height;u+=Math.floor(Math.log2(d))}if(u>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(let u of this.children)u.update(t);return!0}getSelected(t=[]){if(this.selected&&t.push(this),this._children)for(let r of this._children)r.getSelected(t);return t}insideBounds([t,r,n,s]){let i=Math.pow(2,this.z),o=tc/i;return this.x*o<n&&this.y*o<s&&(this.x+1)*o>t&&(this.y+1)*o>r}getBoundingVolume(t,r,n){if(n){let c=this.z<1?nJ:this.z<2?GO:WO,l=[];for(let h of c){let f=Cm(this.x+h[0],this.y+h[1],this.z);f[2]=t[0],l.push(n(f)),t[0]!==t[1]&&(f[2]=t[1],l.push(n(f)))}return YA(l)}let s=Math.pow(2,this.z),i=tc/s,o=this.x*i+r*tc,a=tc-(this.y+1)*i;return new ni([o,a,t[0]],[o+i,a+i,t[1]])}};function jO(e,t,r,n){let s=e instanceof Xr&&e.resolution?e.projectPosition:null,i=Object.values(e.getFrustumPlanes()).map(({normal:d,distance:p})=>new Kr(d.clone().negate(),p)),o=new tr(i),a=e.distanceScales.unitsPerMeter[2],c=r&&r[0]*a||0,l=r&&r[1]*a||0,h=e instanceof Re&&e.pitch<=60?t:0;if(n){let[d,p,g,m]=n,_=Kt([d,m]),y=Kt([g,p]);n=[_[0],tc-_[1],y[0],tc-y[1]]}let f=new oi(0,0,0),u={viewport:e,project:s,cullingVolume:o,elevationBounds:[c,l],minZ:h,maxZ:t,bounds:n,offset:0};if(f.update(u),e instanceof Re&&e.subViewports&&e.subViewports.length>1){for(u.offset=-1;f.update(u)&&!(--u.offset<-HO););for(u.offset=1;f.update(u)&&!(++u.offset>HO););}return f.getSelected()}var os=512,sJ=[-1/0,-1/0,1/0,1/0],ai={type:"object",value:null,validate:(e,t)=>t.optional&&e===null||typeof e=="string"||Array.isArray(e)&&e.every(r=>typeof r=="string"),equal:(e,t)=>{if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t))return!1;let r=e.length;if(r!==t.length)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}};function XO(e,t){let r=[t.transformAsPoint([e[0],e[1]]),t.transformAsPoint([e[2],e[1]]),t.transformAsPoint([e[0],e[3]]),t.transformAsPoint([e[2],e[3]])];return[Math.min(...r.map(s=>s[0])),Math.min(...r.map(s=>s[1])),Math.max(...r.map(s=>s[0])),Math.max(...r.map(s=>s[1]))]}function iJ(e){return Math.abs(e.split("").reduce((t,r)=>(t<<5)-t+r.charCodeAt(0)|0,0))}function Sn(e,t){if(!e||!e.length)return null;let{index:r,id:n}=t;if(Array.isArray(e)){let i=iJ(n)%e.length;e=e[i]}let s=e;for(let i of Object.keys(r)){let o=new RegExp(`{${i}}`,"g");s=s.replace(o,String(r[i]))}return Number.isInteger(r.y)&&Number.isInteger(r.z)&&(s=s.replace(/\{-y\}/g,String(Math.pow(2,r.z)-r.y-1))),s}function oJ(e,t,r){let n;if(t&&t.length===2){let[s,i]=t,o=e.getBounds({z:s}),a=e.getBounds({z:i});n=[Math.min(o[0],a[0]),Math.min(o[1],a[1]),Math.max(o[2],a[2]),Math.max(o[3],a[3])]}else n=e.getBounds();return e.isGeospatial?[Math.max(n[0],r[0]),Math.max(n[1],r[1]),Math.min(n[2],r[2]),Math.min(n[3],r[3])]:[Math.max(Math.min(n[0],r[2]),r[0]),Math.max(Math.min(n[1],r[3]),r[1]),Math.min(Math.max(n[2],r[0]),r[2]),Math.min(Math.max(n[3],r[1]),r[3])]}function YO({viewport:e,z:t,cullRect:r}){return(e.subViewports||[e]).map(s=>$A(s,t||0,r))}function $A(e,t,r){if(!Array.isArray(t)){let i=r.x-e.x,o=r.y-e.y,{width:a,height:c}=r,l={targetZ:t},h=e.unproject([i,o],l),f=e.unproject([i+a,o],l),u=e.unproject([i,o+c],l),d=e.unproject([i+a,o+c],l);return[Math.min(h[0],f[0],u[0],d[0]),Math.min(h[1],f[1],u[1],d[1]),Math.max(h[0],f[0],u[0],d[0]),Math.max(h[1],f[1],u[1],d[1])]}let n=$A(e,t[0],r),s=$A(e,t[1],r);return[Math.min(n[0],s[0]),Math.min(n[1],s[1]),Math.max(n[2],s[2]),Math.max(n[3],s[3])]}function aJ(e,t,r){return r?XO(e,r).map(s=>s*t/os):e.map(n=>n*t/os)}function KA(e,t){return Math.pow(2,e)*os/t}function Cm(e,t,r){let n=KA(r,os),s=e/n*360-180,i=Math.PI-2*Math.PI*t/n,o=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[s,o]}function qO(e,t,r,n){let s=KA(r,n);return[e/s*os,t/s*os]}function ZA(e,t,r,n,s=os){if(e.isGeospatial){let[l,h]=Cm(t,r,n),[f,u]=Cm(t+1,r+1,n);return{west:l,north:h,east:f,south:u}}let[i,o]=qO(t,r,n,s),[a,c]=qO(t+1,r+1,n,s);return{left:i,top:o,right:a,bottom:c}}function cJ(e,t,r,n,s){let i=oJ(e,null,n),o=KA(t,r),[a,c,l,h]=aJ(i,o,s),f=[];for(let u=Math.floor(a);u<l;u++)for(let d=Math.floor(c);d<h;d++)f.push({x:u,y:d,z:t});return f}function JA({viewport:e,maxZoom:t,minZoom:r,zRange:n,extent:s,tileSize:i=os,modelMatrix:o,modelMatrixInverse:a,zoomOffset:c=0}){let l=e.isGeospatial?Math.round(e.zoom+Math.log2(os/i))+c:Math.ceil(e.zoom)+c;if(typeof r=="number"&&Number.isFinite(r)&&l<r){if(!s)return[];l=r}typeof t=="number"&&Number.isFinite(t)&&l>t&&(l=t);let h=s;return o&&a&&s&&!e.isGeospatial&&(h=XO(s,o)),e.isGeospatial?jO(e,l,n,s):cJ(e,l,i,h||sJ,a)}function QA(e){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function tT(e){return Number.isFinite(e.west)&&Number.isFinite(e.north)&&Number.isFinite(e.east)&&Number.isFinite(e.south)}function $O(e){let t={},r;return n=>{for(let s in n)if(!lJ(n[s],t[s])){r=e(n),t=n;break}return r}}function lJ(e,t){if(e===t)return!0;if(Array.isArray(e)){let r=e.length;if(!t||t.length!==r)return!1;for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}return!1}var KO=1,Pm=2,hJ="never",fJ="no-overlap",Xf="best-available",uJ=5,dJ={[Xf]:gJ,[fJ]:mJ,[hJ]:()=>{}},pJ={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}},Eo=class{constructor(t){this._getCullBounds=$O(YO),this.opts={...pJ,...t},this.setOptions(this.opts),this.onTileLoad=r=>{this.opts.onTileLoad?.(r),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=r.byteLength,this._resizeCache())},this._requestScheduler=new Es({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new $,this._modelMatrixInverse=new $}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(t=>t.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(t=>t.needsReload)}setOptions(t){Object.assign(this.opts,t),Number.isFinite(t.maxZoom)&&(this._maxZoom=Math.floor(t.maxZoom)),Number.isFinite(t.minZoom)&&(this._minZoom=Math.ceil(t.minZoom))}finalize(){for(let t of this._cache.values())t.isLoading&&t.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(let t of this._cache.keys()){let r=this._cache.get(t);!this._selectedTiles||!this._selectedTiles.includes(r)?this._cache.delete(t):r.setNeedsReload()}}update(t,{zRange:r,modelMatrix:n}={zRange:null,modelMatrix:null}){let s=n?new $(n):new $,i=!s.equals(this._modelMatrix);if(!this._viewport||!t.equals(this._viewport)||!kt(this._zRange,r)||i){i&&(this._modelMatrixInverse=s.clone().invert(),this._modelMatrix=s),this._viewport=t,this._zRange=r;let a=this.getTileIndices({viewport:t,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:r,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=a.map(c=>this._getTile(c,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(a=>this._getTile(a.index,!0)));let o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(t,r){if(!t.isVisible)return!1;if(r&&this._viewport){let n=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:r}),{bbox:s}=t;for(let[i,o,a,c]of n){let l;if("west"in s)l=s.west<a&&s.east>i&&s.south<c&&s.north>o;else{let h=Math.min(s.top,s.bottom),f=Math.max(s.top,s.bottom);l=s.left<a&&s.right>i&&h<c&&f>o}if(l)return!0}return!1}return!0}getTileIndices({viewport:t,maxZoom:r,minZoom:n,zRange:s,modelMatrix:i,modelMatrixInverse:o}){let{tileSize:a,extent:c,zoomOffset:l}=this.opts;return JA({viewport:t,maxZoom:r,minZoom:n,zRange:s,tileSize:a,extent:c,modelMatrix:i,modelMatrixInverse:o,zoomOffset:l})}getTileId(t){return`${t.x}-${t.y}-${t.z}`}getTileZoom(t){return t.z}getTileMetadata(t){let{tileSize:r}=this.opts;return{bbox:ZA(this._viewport,t.x,t.y,t.z,r)}}getParentIndex(t){let r=Math.floor(t.x/2),n=Math.floor(t.y/2),s=t.z-1;return{x:r,y:n,z:s}}updateTileStates(){let t=this.opts.refinementStrategy||Xf,r=new Array(this._cache.size),n=0;for(let s of this._cache.values())r[n++]=s.isVisible,s.isSelected=!1,s.isVisible=!1;for(let s of this._selectedTiles)s.isSelected=!0,s.isVisible=!0;(typeof t=="function"?t:dJ[t])(Array.from(this._cache.values())),n=0;for(let s of this._cache.values())if(r[n++]!==s.isVisible)return!0;return!1}_pruneRequests(){let{maxRequests:t=0}=this.opts,r=[],n=0;for(let s of this._cache.values())s.isLoading&&(n++,!s.isSelected&&!s.isVisible&&r.push(s));for(;t>0&&n>t&&r.length>0;)r.shift().abort(),n--}_rebuildTree(){let{_cache:t}=this;for(let r of t.values())r.parent=null,r.children&&(r.children.length=0);for(let r of t.values()){let n=this._getNearestAncestor(r);r.parent=n,n?.children&&n.children.push(r)}}_resizeCache(){let{_cache:t,opts:r}=this,n=r.maxCacheSize??(r.maxCacheByteSize!==null?1/0:uJ*this.selectedTiles.length),s=r.maxCacheByteSize??1/0;if(t.size>n||this._cacheByteSize>s){for(let[o,a]of t)if(!a.isVisible&&!a.isSelected&&(this._cacheByteSize-=r.maxCacheByteSize!==null?a.byteLength:0,t.delete(o),this.opts.onTileUnload?.(a)),t.size<=n&&this._cacheByteSize<=s)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((o,a)=>o.zoom-a.zoom),this._dirty=!1)}_getTile(t,r){let n=this.getTileId(t),s=this._cache.get(n),i=!1;return!s&&r?(s=new To(t),Object.assign(s,this.getTileMetadata(s.index)),Object.assign(s,{id:n,zoom:this.getTileZoom(s.index)}),i=!0,this._cache.set(n,s),this._dirty=!0):s&&s.needsReload&&(i=!0),s&&i&&s.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),s}_getNearestAncestor(t){let{_minZoom:r=0}=this,n=t.index;for(;this.getTileZoom(n)>r;){n=this.getParentIndex(n);let s=this._getTile(n);if(s)return s}return null}};function gJ(e){for(let t of e)t.state=0;for(let t of e)t.isSelected&&!ZO(t)&&eT(t);for(let t of e)t.isVisible=Boolean(t.state&Pm)}function mJ(e){for(let r of e)r.state=0;for(let r of e)r.isSelected&&ZO(r);let t=Array.from(e).sort((r,n)=>r.zoom-n.zoom);for(let r of t)if(r.isVisible=Boolean(r.state&Pm),r.children&&(r.isVisible||r.state&KO))for(let n of r.children)n.state=KO;else r.isSelected&&eT(r)}function ZO(e){let t=e;for(;t;){if(t.isLoaded||t.content)return t.state|=Pm,!0;t=t.parent}return!1}function eT(e){for(let t of e.children)t.isLoaded||t.content?t.state|=Pm:eT(t)}var _J={TilesetClass:Eo,data:{type:"data",value:[]},dataComparator:ai.equal,renderSubLayers:{type:"function",value:e=>new _o(e)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:e=>console.error(e)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:Xf,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0},Yf=class extends Ft{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){this.state?.tileset?.finalize()}get isLoaded(){return Boolean(this.state?.tileset?.selectedTiles?.every(t=>t.isLoaded&&t.layers&&t.layers.every(r=>r.isLoaded)))}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({changeFlags:t}){let{tileset:r}=this.state,n=t.propsOrDataChanged||t.updateTriggersChanged,s=t.dataChanged||t.updateTriggersChanged&&(t.updateTriggersChanged.all||t.updateTriggersChanged.getTileData);r?n&&(r.setOptions(this._getTilesetOptions()),s?r.reloadAll():r.tiles.forEach(i=>{i.layers=null})):(r=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:r})),this._updateTileset()}_getTilesetOptions(){let{tileSize:t,maxCacheSize:r,maxCacheByteSize:n,refinementStrategy:s,extent:i,maxZoom:o,minZoom:a,maxRequests:c,debounceTime:l,zoomOffset:h}=this.props;return{maxCacheSize:r,maxCacheByteSize:n,maxZoom:o,minZoom:a,tileSize:t,refinementStrategy:s,extent:i,maxRequests:c,debounceTime:l,zoomOffset:h,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){let t=this.state.tileset,{zRange:r,modelMatrix:n}=this.props,s=t.update(this.context.viewport,{zRange:r,modelMatrix:n}),{isLoaded:i}=t,o=this.state.isLoaded!==i,a=this.state.frameNumber!==s;i&&(o||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:s}),this.state.isLoaded=i}_onViewportLoad(){let{tileset:t}=this.state,{onViewportLoad:r}=this.props;r&&r(t.selectedTiles)}_onTileLoad(t){this.props.onTileLoad(t),t.layers=null,this.setNeedsUpdate()}_onTileError(t,r){this.props.onTileError(t),r.layers=null,this.setNeedsUpdate()}_onTileUnload(t){this.props.onTileUnload(t)}getTileData(t){let{data:r,getTileData:n,fetch:s}=this.props,{signal:i}=t;return t.url=typeof r=="string"||Array.isArray(r)?Sn(r,t):null,n?n(t):s&&t.url?s(t.url,{propName:"data",layer:this,signal:i}):null}renderSubLayers(t){return this.props.renderSubLayers(t)}getSubLayerPropsByTile(t){return null}getPickingInfo(t){let r=t.sourceLayer,n=r.props.tile,s=t.info;return s.picked&&(s.tile=n),s.sourceTile=n,s.sourceTileSubLayer=r,s}_updateAutoHighlight(t){t.sourceTileSubLayer.updateAutoHighlight(t)}renderLayers(){return this.state.tileset.tiles.map(t=>{let r=this.getSubLayerPropsByTile(t);if(!(!t.isLoaded&&!t.content))if(t.layers)r&&t.layers[0]&&Object.keys(r).some(n=>t.layers[0].props[n]!==r[n])&&(t.layers=t.layers.map(n=>n.clone(r)));else{let n=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:t.id,updateTriggers:this.props.updateTriggers}),data:t.content,_offset:0,tile:t});t.layers=We(n,Boolean).map(s=>s.clone({tile:t,...r}))}return t.layers})}filterSubLayer({layer:t,cullRect:r}){let{tile:n}=t.props;return this.state.tileset.isTileVisible(n,r)}};Yf.defaultProps=_J;Yf.layerName="TileLayer";var bo=Yf;var JO=`uniform tripsUniforms {
    bool fadeTrail;
    float trailLength;
    float currentTime;
  } trips;
  `,QO={name:"trips",vs:JO,fs:JO,uniformTypes:{fadeTrail:"f32",trailLength:"f32",currentTime:"f32"}};var xJ={fadeTrail:!0,trailLength:{type:"number",value:120,min:0},currentTime:{type:"number",value:0,min:0},getTimestamps:{type:"accessor",value:e=>e.timestamps}},$f=class extends Mn{getShaders(){let t=super.getShaders();return t.inject={"vs:#decl":`in float instanceTimestamps;
  in float instanceNextTimestamps;
  out float vTime;
  `,"vs:#main-end":`vTime = instanceTimestamps + (instanceNextTimestamps - instanceTimestamps) * vPathPosition.y / vPathLength;
  `,"fs:#decl":`in float vTime;
  `,"fs:#main-start":`if(vTime > trips.currentTime || (trips.fadeTrail && (vTime < trips.currentTime - trips.trailLength))) {
    discard;
  }
  `,"fs:DECKGL_FILTER_COLOR":`if(trips.fadeTrail) {
    color.a *= 1.0 - (trips.currentTime - vTime) / trips.trailLength;
  }
  `},t.modules=[...t.modules,QO],t}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({timestamps:{size:1,accessor:"getTimestamps",shaderAttributes:{instanceTimestamps:{vertexOffset:0},instanceNextTimestamps:{vertexOffset:1}}}})}draw(t){let{fadeTrail:r,trailLength:n,currentTime:s}=this.props,i={fadeTrail:r,trailLength:n,currentTime:s};this.state.model.shaderInputs.setProps({trips:i}),super.draw(t)}};$f.layerName="TripsLayer";$f.defaultProps=xJ;var tL=$f;var sL=Nn(Kf(),1);var Sr=Nn(Kf(),1);var Zf=Nn(Kf(),1);function Rm(e,t){t=t===void 0?e[0][0]:t;for(let r of e){let n=r[0]-t;n>180?r[0]-=360:n<-180&&(r[0]+=360)}}function yJ(e,t,r){let[n,s]=(0,Zf.cellToLatLng)(e),i=t.length;Rm(t,s);let o=t[0]===t[i-1]?i-1:i;for(let a=0;a<o;a++)t[a][0]=he(s,t[a][0],r),t[a][1]=he(n,t[a][1],r)}function rL(e,t,r){let n=e(t,r),[s,i]=(0,Zf.cellToLatLng)(n);return[i,s]}function rT(e,t=1){let r=(0,Zf.cellToBoundary)(e,!0);return t!==1?yJ(e,r,t):Rm(r),r}function nL(e){let t=new Float64Array(e.length*2),r=0;for(let n of e)t[r++]=n[0],t[r++]=n[1];return t}var AJ=10;function TJ(e,t){let r;return e==null?r=t:typeof e=="object"?r={...e,coverage:t}:r={getHexagon:e,coverage:t},r}var MJ={...ei.defaultProps,highPrecision:"auto",coverage:{type:"number",min:0,max:1,value:1},centerHexagon:null,getHexagon:{type:"accessor",value:e=>e.hexagon},extruded:!0},ci=class extends Ft{initializeState(){ci._checkH3Lib(),this.state={edgeLengthKM:0,resolution:-1}}shouldUpdateState({changeFlags:t}){return this._shouldUseHighPrecision()?t.propsOrDataChanged:t.somethingChanged}updateState({props:t,changeFlags:r}){if(t.highPrecision!==!0&&(r.dataChanged||r.updateTriggersChanged&&r.updateTriggersChanged.getHexagon)){let n=this._calculateH3DataProps();this.setState(n)}this._updateVertices(this.context.viewport)}_calculateH3DataProps(){let t=-1,r=!1,n=!1,{iterable:s,objectInfo:i}=Yt(this.props.data);for(let o of s){i.index++;let a=this.props.getHexagon(o,i),c=(0,Sr.getResolution)(a);if(t<0){if(t=c,!this.props.highPrecision)break}else if(t!==c){n=!0;break}if((0,Sr.isPentagon)(a)){r=!0;break}}return{resolution:t,edgeLengthKM:t>=0?(0,Sr.getHexagonEdgeLengthAvg)(t,"km"):0,hasMultipleRes:n,hasPentagon:r}}_shouldUseHighPrecision(){if(this.props.highPrecision==="auto"){let{resolution:t,hasPentagon:r,hasMultipleRes:n}=this.state,{viewport:s}=this.context;return Boolean(s?.resolution)||n||r||t>=0&&t<=5}return this.props.highPrecision}_updateVertices(t){if(this._shouldUseHighPrecision())return;let{resolution:r,edgeLengthKM:n,centerHex:s}=this.state;if(r<0)return;let i=this.props.centerHexagon||(0,Sr.latLngToCell)(t.latitude,t.longitude,r);if(s===i)return;if(s)try{if((0,Sr.gridDistance)(s,i)*n<AJ)return}catch{}let{unitsPerMeter:o}=t.distanceScales,a=rT(i),[c,l]=(0,Sr.cellToLatLng)(i),[h,f]=t.projectFlat([l,c]);a=a.map(u=>{let d=t.projectFlat(u);return[(d[0]-h)/o[0],(d[1]-f)/o[1]]}),this.setState({centerHex:i,vertices:a})}renderLayers(){return this._shouldUseHighPrecision()?this._renderPolygonLayer():this._renderColumnLayer()}_getForwardProps(){let{elevationScale:t,material:r,coverage:n,extruded:s,wireframe:i,stroked:o,filled:a,lineWidthUnits:c,lineWidthScale:l,lineWidthMinPixels:h,lineWidthMaxPixels:f,getFillColor:u,getElevation:d,getLineColor:p,getLineWidth:g,transitions:m,updateTriggers:_}=this.props;return{elevationScale:t,extruded:s,coverage:n,wireframe:i,stroked:o,filled:a,lineWidthUnits:c,lineWidthScale:l,lineWidthMinPixels:h,lineWidthMaxPixels:f,material:r,getElevation:d,getFillColor:u,getLineColor:p,getLineWidth:g,transitions:m,updateTriggers:{getFillColor:_.getFillColor,getElevation:_.getElevation,getLineColor:_.getLineColor,getLineWidth:_.getLineWidth}}}_renderPolygonLayer(){let{data:t,getHexagon:r,updateTriggers:n,coverage:s}=this.props,i=this.getSubLayerClass("hexagon-cell-hifi",ei),o=this._getForwardProps();return o.updateTriggers.getPolygon=TJ(n.getHexagon,s),new i(o,this.getSubLayerProps({id:"hexagon-cell-hifi",updateTriggers:o.updateTriggers}),{data:t,_normalize:!1,_windingOrder:"CCW",positionFormat:"XY",getPolygon:(a,c)=>{let l=r(a,c);return nL(rT(l,s))}})}_renderColumnLayer(){let{data:t,getHexagon:r,updateTriggers:n}=this.props,s=this.getSubLayerClass("hexagon-cell",Tn),i=this._getForwardProps();return i.updateTriggers.getPosition=n.getHexagon,new s(i,this.getSubLayerProps({id:"hexagon-cell",flatShading:!0,updateTriggers:i.updateTriggers}),{data:t,diskResolution:6,radius:1,vertices:this.state.vertices,getPosition:rL.bind(null,r)})}};ci.defaultProps=MJ;ci.layerName="H3HexagonLayer";ci._checkH3Lib=()=>{};var ec=ci;var EJ={getHexagons:{type:"accessor",value:e=>e.hexagons}},Jf=class extends En{initializeState(){ec._checkH3Lib()}updateState({props:t,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&r.updateTriggersChanged.getHexagons){let{data:n,getHexagons:s}=t,i=[],{iterable:o,objectInfo:a}=Yt(n);for(let c of o){a.index++;let l=s(c,a),h=(0,sL.cellsToMultiPolygon)(l,!0);for(let f of h){for(let u of f)Rm(u);i.push(this.getSubLayerRow({polygon:f},c,a.index))}}this.setState({polygons:i})}}indexToBounds(){let{getElevation:t,getFillColor:r,getLineColor:n,getLineWidth:s}=this.props;return{data:this.state.polygons,getPolygon:i=>i.polygon,getElevation:this.getSubLayerAccessor(t),getFillColor:this.getSubLayerAccessor(r),getLineColor:this.getSubLayerAccessor(n),getLineWidth:this.getSubLayerAccessor(s)}}};Jf.layerName="H3ClusterLayer";Jf.defaultProps=EJ;var iL=Jf;var nT=Math.PI/180,Im=new Float32Array(16),oL=new Float32Array(12);function aL(e,t,r){let n=t[0]*nT,s=t[1]*nT,i=t[2]*nT,o=Math.sin(i),a=Math.sin(n),c=Math.sin(s),l=Math.cos(i),h=Math.cos(n),f=Math.cos(s),u=r[0],d=r[1],p=r[2];e[0]=u*f*h,e[1]=u*c*h,e[2]=u*-a,e[3]=d*(-c*l+f*a*o),e[4]=d*(f*l+c*a*o),e[5]=d*h*o,e[6]=p*(c*o+f*a*l),e[7]=p*(-f*o+c*a*l),e[8]=p*h*l}function cL(e){return e[0]=e[0],e[1]=e[1],e[2]=e[2],e[3]=e[4],e[4]=e[5],e[5]=e[6],e[6]=e[8],e[7]=e[9],e[8]=e[10],e[9]=e[12],e[10]=e[13],e[11]=e[14],e.subarray(0,12)}var Om={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(e,{startRow:t,endRow:r}){let{data:n,getOrientation:s,getScale:i,getTranslation:o,getTransformMatrix:a}=this.props,c=Array.isArray(a),l=c&&a.length===16,h=Array.isArray(i),f=Array.isArray(s),u=Array.isArray(o),d=l||!c&&Boolean(a(n[0]));d?e.constant=l:e.constant=f&&h&&u;let p=e.value;if(e.constant){let g;d?(Im.set(a),g=cL(Im)):(g=oL,aL(g,s,i),g.set(o,9)),e.value=new Float32Array(g)}else{let g=t*e.size,{iterable:m,objectInfo:_}=Yt(n,t,r);for(let y of m){_.index++;let x;if(d)Im.set(l?a:a(y,_)),x=cL(Im);else{x=oL;let A=f?s:s(y,_),M=h?i:i(y,_);aL(x,A,M),x.set(u?o:o(y,_),9)}p[g++]=x[0],p[g++]=x[1],p[g++]=x[2],p[g++]=x[3],p[g++]=x[4],p[g++]=x[5],p[g++]=x[6],p[g++]=x[7],p[g++]=x[8],p[g++]=x[9],p[g++]=x[10],p[g++]=x[11]}}}};function Lm(e,t){return t===W.CARTESIAN||t===W.METER_OFFSETS||t===W.DEFAULT&&!e.isGeospatial}var lL=`uniform simpleMeshUniforms {
    float sizeScale;
    bool composeModelMatrix;
    bool hasTexture;
    bool flatShading;
  } simpleMesh;
  `,hL={name:"simpleMesh",vs:lL,fs:lL,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}};var fL=`#version 300 es
  #define SHADER_NAME simple-mesh-layer-vs
  in vec3 positions;
  in vec3 normals;
  in vec3 colors;
  in vec2 texCoords;
  in vec3 instancePositions;
  in vec3 instancePositions64Low;
  in vec4 instanceColors;
  in vec3 instancePickingColors;
  in vec3 instanceModelMatrixCol0;
  in vec3 instanceModelMatrixCol1;
  in vec3 instanceModelMatrixCol2;
  in vec3 instanceTranslation;
  out vec2 vTexCoord;
  out vec3 cameraPosition;
  out vec3 normals_commonspace;
  out vec4 position_commonspace;
  out vec4 vColor;
  void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = texCoords;
  geometry.pickingColor = instancePickingColors;
  vTexCoord = texCoords;
  cameraPosition = project.cameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
  mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
  vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
  if (simpleMesh.composeModelMatrix) {
  DECKGL_FILTER_SIZE(pos, geometry);
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.worldPosition += pos;
  gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
  geometry.position = position_commonspace;
  }
  else {
  pos = project_size(pos);
  DECKGL_FILTER_SIZE(pos, geometry);
  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  }
  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  DECKGL_FILTER_COLOR(vColor, geometry);
  }
  `;var uL=`#version 300 es
  #define SHADER_NAME simple-mesh-layer-fs
  precision highp float;
  uniform sampler2D sampler;
  in vec2 vTexCoord;
  in vec3 cameraPosition;
  in vec3 normals_commonspace;
  in vec4 position_commonspace;
  in vec4 vColor;
  out vec4 fragColor;
  void main(void) {
  geometry.uv = vTexCoord;
  vec3 normal;
  if (simpleMesh.flatShading) {
  normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
  } else {
  normal = normals_commonspace;
  }
  vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
  DECKGL_FILTER_COLOR(color, geometry);
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * layer.opacity);
  }
  `;function sT(e){let t=e.positions||e.POSITION;k.assert(t,'no "postions" or "POSITION" attribute in mesh');let r=t.value.length/t.size,n=e.COLOR_0||e.colors;n||(n={size:3,value:new Float32Array(r*3).fill(1)});let s=e.NORMAL||e.normals;s||(s={size:3,value:new Float32Array(r*3).fill(0)});let i=e.TEXCOORD_0||e.texCoords;return i||(i={size:2,value:new Float32Array(r*2).fill(0)}),{positions:t,colors:n,normals:s,texCoords:i}}function dL(e){return e instanceof it?(e.attributes=sT(e.attributes),e):e.attributes?new it({...e,topology:"triangle-list",attributes:sT(e.attributes)}):new it({topology:"triangle-list",attributes:sT(e)})}var bJ=[0,0,0,255],SJ={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:bJ},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}},Qf=class extends ut{getShaders(){return super.getShaders({vs:fL,fs:uL,modules:[st,Ta,Tt,hL]})}getBounds(){if(this.props._instanced)return super.getBounds();let t=this.state.positionBounds;if(t)return t;let{mesh:r}=this.props;if(!r)return null;if(t=r.header?.boundingBox,!t){let{attributes:n}=dL(r);n.POSITION=n.POSITION||n.positions,t=Fn(n)}return this.state.positionBounds=t,t}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:Om}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(t){super.updateState(t);let{props:r,oldProps:n,changeFlags:s}=t;if(r.mesh!==n.mesh||s.extensionsChanged){if(this.state.positionBounds=null,this.state.model?.destroy(),r.mesh){this.state.model=this.getModel(r.mesh);let i=r.mesh.attributes||r.mesh;this.setState({hasNormals:Boolean(i.NORMAL||i.normals)})}this.getAttributeManager().invalidateAll()}r.texture!==n.texture&&r.texture instanceof Q&&this.setTexture(r.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(t){super.finalizeState(t),this.state.emptyTexture.delete()}draw({uniforms:t}){let{model:r}=this.state;if(!r)return;let{viewport:n,renderPass:s}=this.context,{sizeScale:i,coordinateSystem:o,_instanced:a}=this.props,c={sizeScale:i,composeModelMatrix:!a||Lm(n,o),flatShading:!this.state.hasNormals};r.shaderInputs.setProps({simpleMesh:c}),r.draw(s)}get isLoaded(){return Boolean(this.state?.model&&super.isLoaded)}getModel(t){let r=new Y(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:dL(t),isInstanced:!0}),{texture:n}=this.props,{emptyTexture:s}=this.state,i={sampler:n||s,hasTexture:Boolean(n)};return r.shaderInputs.setProps({simpleMesh:i}),r}setTexture(t){let{emptyTexture:r,model:n}=this.state;if(n){let s={sampler:t||r,hasTexture:Boolean(t)};n.shaderInputs.setProps({simpleMesh:s})}}};Qf.defaultProps=SJ;Qf.layerName="SimpleMeshLayer";var So=Qf;var Zr;(function(e){e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.ONE=1]="ONE",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.LINEAR=9729]="LINEAR",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"})(Zr||(Zr={}));function eu(e,t,r,n){let s={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};s.defines.USE_TEX_LOD=1;let{imageBasedLightingEnvironment:i}=n;return i&&(s.bindings.pbr_diffuseEnvSampler=i.diffuseEnvSampler.texture,s.bindings.pbr_specularEnvSampler=i.specularEnvSampler.texture,s.bindings.pbr_BrdfLUT=i.brdfLutTexture.texture,s.uniforms.scaleIBLAmbient=[1,1]),n?.pbrDebug&&(s.defines.PBR_DEBUG=1,s.uniforms.scaleDiffBaseMR=[0,0,0,0],s.uniforms.scaleFGDSpec=[0,0,0,0]),r.NORMAL&&(s.defines.HAS_NORMALS=1),r.TANGENT&&n?.useTangents&&(s.defines.HAS_TANGENTS=1),r.TEXCOORD_0&&(s.defines.HAS_UV=1),n?.imageBasedLightingEnvironment&&(s.defines.USE_IBL=1),n?.lights&&(s.defines.USE_LIGHTS=1),t&&vJ(e,t,s),s}function vJ(e,t,r){if(r.uniforms.unlit=Boolean(t.unlit),t.pbrMetallicRoughness&&wJ(e,t.pbrMetallicRoughness,r),t.normalTexture){tu(e,t.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",r);let{scale:n=1}=t.normalTexture;r.uniforms.normalScale=n}if(t.occlusionTexture){tu(e,t.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",r);let{strength:n=1}=t.occlusionTexture;r.uniforms.occlusionStrength=n}switch(t.emissiveTexture&&(tu(e,t.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",r),r.uniforms.emissiveFactor=t.emissiveFactor||[0,0,0]),t.alphaMode){case"MASK":let{alphaCutoff:n=.5}=t;r.defines.ALPHA_CUTOFF=1,r.uniforms.alphaCutoff=n;break;case"BLEND":F.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),r.parameters.blendColorOperation="add",r.parameters.blendColorSrcFactor="src-alpha",r.parameters.blendColorDstFactor="one-minus-src-alpha",r.parameters.blendAlphaOperation="add",r.parameters.blendAlphaSrcFactor="one",r.parameters.blendAlphaDstFactor="one-minus-src-alpha",r.glParameters.blend=!0,r.glParameters.blendEquation=Zr.FUNC_ADD,r.glParameters.blendFunc=[Zr.SRC_ALPHA,Zr.ONE_MINUS_SRC_ALPHA,Zr.ONE,Zr.ONE_MINUS_SRC_ALPHA];break}}function wJ(e,t,r){t.baseColorTexture&&tu(e,t.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",r),r.uniforms.baseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&tu(e,t.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",r);let{metallicFactor:n=1,roughnessFactor:s=1}=t;r.uniforms.metallicRoughnessValues=[n,s]}function tu(e,t,r,n=null,s){let i=t?.texture?.sampler?.parameters||{},o=t.texture.source.image,a,c={};o.compressed?(a=o,c={[Zr.TEXTURE_MIN_FILTER]:o.data.length>1?Zr.LINEAR_MIPMAP_NEAREST:Zr.LINEAR}):a={data:o};let l=e.createTexture({id:t.uniformName||t.id,parameters:{...i,...c},pixelStore:{[Zr.UNPACK_FLIP_Y_WEBGL]:!1},...a});s.bindings[r]=l,n&&(s.defines[n]=1),s.generatedTextures.push(l)}var pL="4.2.1";var Nm={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"},gL;async function oT(e){b_(e.modules);let t=S_("basis");return t||(gL||=CJ(e),await gL)}async function CJ(e){let t=null,r=null;return[t,r]=await Promise.all([await on(Nm.TRANSCODER,"textures",e),await on(Nm.TRANSCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await PJ(t,r)}function PJ(e,t){let r={};return t&&(r.wasmBinary=t),new Promise(n=>{e(r).then(s=>{let{BasisFile:i,initializeBasis:o}=s;o(),n({BasisFile:i})})})}var iT;async function aT(e){let t=e.modules||{};return t.basisEncoder?t.basisEncoder:(iT=iT||RJ(e),await iT)}async function RJ(e){let t=null,r=null;return[t,r]=await Promise.all([await on(Nm.ENCODER,"textures",e),await on(Nm.ENCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await IJ(t,r)}function IJ(e,t){let r={};return t&&(r.wasmBinary=t),new Promise(n=>{e(r).then(s=>{let{BasisFile:i,KTX2File:o,initializeBasis:a,BasisEncoder:c}=s;a(),n({BasisFile:i,KTX2File:o,BasisEncoder:c})})})}var vo={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919};var OJ=["","WEBKIT_","MOZ_"],mL={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"},Bm=null;function _L(e){if(!Bm){e=e||LJ()||void 0,Bm=new Set;for(let t of OJ)for(let r in mL)if(e&&e.getExtension(`${t}${r}`)){let n=mL[r];Bm.add(n)}}return Bm}function LJ(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}var c5t=new Uint8Array([0]);var xL,yL,AL,TL,ML,EL,bL,SL;(function(e){e[e.NONE=0]="NONE",e[e.BASISLZ=1]="BASISLZ",e[e.ZSTD=2]="ZSTD",e[e.ZLIB=3]="ZLIB"})(xL||(xL={})),function(e){e[e.BASICFORMAT=0]="BASICFORMAT"}(yL||(yL={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ETC1S=163]="ETC1S",e[e.UASTC=166]="UASTC"}(AL||(AL={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SRGB=1]="SRGB"}(TL||(TL={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LINEAR=1]="LINEAR",e[e.SRGB=2]="SRGB",e[e.ITU=3]="ITU",e[e.NTSC=4]="NTSC",e[e.SLOG=5]="SLOG",e[e.SLOG2=6]="SLOG2"}(ML||(ML={})),function(e){e[e.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",e[e.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(EL||(EL={})),function(e){e[e.RGB=0]="RGB",e[e.RRR=3]="RRR",e[e.GGG=4]="GGG",e[e.AAA=15]="AAA"}(bL||(bL={})),function(e){e[e.RGB=0]="RGB",e[e.RGBA=3]="RGBA",e[e.RRR=4]="RRR",e[e.RRRG=5]="RRRG"}(SL||(SL={}));var dr=[171,75,84,88,32,50,48,187,13,10,26,10];function vL(e){let t=new Uint8Array(e);return!(t.byteLength<dr.length||t[0]!==dr[0]||t[1]!==dr[1]||t[2]!==dr[2]||t[3]!==dr[3]||t[4]!==dr[4]||t[5]!==dr[5]||t[6]!==dr[6]||t[7]!==dr[7]||t[8]!==dr[8]||t[9]!==dr[9]||t[10]!==dr[10]||t[11]!==dr[11])}var NJ={etc1:{basisFormat:0,compressed:!0,format:vo.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:vo.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:vo.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:vo.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:vo.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:vo.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function lT(e,t){if(t.basis.containerFormat==="auto"){if(vL(e)){let n=await aT(t);return wL(n.KTX2File,e,t)}let{BasisFile:r}=await oT(t);return cT(r,e,t)}switch(t.basis.module){case"encoder":let r=await aT(t);switch(t.basis.containerFormat){case"ktx2":return wL(r.KTX2File,e,t);case"basis":default:return cT(r.BasisFile,e,t)}case"transcoder":default:let{BasisFile:n}=await oT(t);return cT(n,e,t)}}function cT(e,t,r){let n=new e(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("Failed to start basis transcoding");let s=n.getNumImages(),i=[];for(let o=0;o<s;o++){let a=n.getNumLevels(o),c=[];for(let l=0;l<a;l++)c.push(BJ(n,o,l,r));i.push(c)}return i}finally{n.close(),n.delete()}}function BJ(e,t,r,n){let s=e.getImageWidth(t,r),i=e.getImageHeight(t,r),o=e.getHasAlpha(),{compressed:a,format:c,basisFormat:l}=CL(n,o),h=e.getImageTranscodedSizeInBytes(t,r,l),f=new Uint8Array(h);if(!e.transcodeImage(f,t,r,l,0,0))throw new Error("failed to start Basis transcoding");return{width:s,height:i,data:f,compressed:a,format:c,hasAlpha:o}}function wL(e,t,r){let n=new e(new Uint8Array(t));try{if(!n.startTranscoding())throw new Error("failed to start KTX2 transcoding");let s=n.getLevels(),i=[];for(let o=0;o<s;o++){i.push(FJ(n,o,r));break}return[i]}finally{n.close(),n.delete()}}function FJ(e,t,r){let{alphaFlag:n,height:s,width:i}=e.getImageLevelInfo(t,0,0),{compressed:o,format:a,basisFormat:c}=CL(r,n),l=e.getImageTranscodedSizeInBytes(t,0,0,c),h=new Uint8Array(l);if(!e.transcodeImage(h,t,0,0,c,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:i,height:s,data:h,compressed:o,levelSize:l,hasAlpha:n,format:a}}function CL(e,t){let r=e&&e.basis&&e.basis.format;return r==="auto"&&(r=Fm()),typeof r=="object"&&(r=t?r.alpha:r.noAlpha),r=r.toLowerCase(),NJ[r]}function Fm(){let e=_L();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}var PL={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:pL,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},hT={...PL,parse:lT};var DJ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},kJ={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},uT=class{name;startTime=0;playing=!0;speed=1;channels=[];constructor(t){Object.assign(this,t)}animate(t){if(!this.playing)return;let n=(t/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:s,target:i,path:o})=>{GJ(n,s,i,o),zJ(i,i._node)})}},Dm=class{animations;constructor(t){this.animations=t.animations.map((r,n)=>{let s=r.name||`Animation-${n}`,i=r.samplers.map(({input:a,interpolation:c="LINEAR",output:l})=>({input:RL(t.accessors[a]),interpolation:c,output:RL(t.accessors[l])})),o=r.channels.map(({sampler:a,target:c})=>({sampler:i[a],target:t.nodes[c.node],path:c.path}));return new uT({name:s,channels:o})})}animate(t){this.setTime(t)}setTime(t){this.animations.forEach(r=>r.animate(t))}getAnimations(){return this.animations}};function RL(e){if(!e._animation){let t=kJ[e.componentType],r=DJ[e.type],n=r*e.count,{buffer:s,byteOffset:i}=e.bufferView.data,o=new t(s,i+(e.byteOffset||0),n);if(r===1)e._animation=Array.from(o);else{let a=[];for(let c=0;c<o.length;c+=r)a.push(Array.from(o.slice(c,c+r)));e._animation=a}}return e._animation}var UJ=new $;function zJ(e,t){if(t.matrix.identity(),e.translation&&t.matrix.translate(e.translation),e.rotation){let r=UJ.fromQuaternion(e.rotation);t.matrix.multiplyRight(r)}e.scale&&t.matrix.scale(e.scale)}var fT=new ks;function VJ(e,t,r,n,s){if(t==="rotation"){fT.slerp({start:r,target:n,ratio:s});for(let i=0;i<fT.length;i++)e[t][i]=fT[i]}else for(let i=0;i<r.length;i++)e[t][i]=s*n[i]+(1-s)*r[i]}function HJ(e,t,{p0:r,outTangent0:n,inTangent1:s,p1:i,tDiff:o,ratio:a}){for(let c=0;c<e[t].length;c++){let l=n[c]*o,h=s[c]*o;e[t][c]=(2*Math.pow(a,3)-3*Math.pow(a,2)+1)*r[c]+(Math.pow(a,3)-2*Math.pow(a,2)+a)*l+(-2*Math.pow(a,3)+3*Math.pow(a,2))*i[c]+(Math.pow(a,3)-Math.pow(a,2))*h}}function WJ(e,t,r){for(let n=0;n<r.length;n++)e[t][n]=r[n]}function GJ(e,{input:t,interpolation:r,output:n},s,i){let o=t[t.length-1],a=e%o,c=t.findIndex(u=>u>=a),l=Math.max(0,c-1);if(!Array.isArray(s[i]))switch(i){case"translation":s[i]=[0,0,0];break;case"rotation":s[i]=[0,0,0,1];break;case"scale":s[i]=[1,1,1];break;default:F.warn(`Bad animation path ${i}`)()}let h=t[l],f=t[c];switch(r){case"STEP":WJ(s,i,n[l]);break;case"LINEAR":if(f>h){let u=(a-h)/(f-h);VJ(s,i,n[l],n[c],u)}break;case"CUBICSPLINE":if(f>h){let u=(a-h)/(f-h),d=f-h,p=n[3*l+1],g=n[3*l+2],m=n[3*c+0],_=n[3*c+1];HJ(s,i,{p0:p,outTangent0:g,inTangent1:m,p1:_,tDiff:d,ratio:u})}break;default:F.warn(`Interpolation ${r} not supported`)();break}}var jJ=`
  layout(0) positions: vec4; // in vec4 POSITION;
  
    #ifdef HAS_NORMALS
      in vec4 normals; // in vec4 NORMAL;
    #endif
  
    #ifdef HAS_TANGENTS
      in vec4 TANGENT;
    #endif
  
    #ifdef HAS_UV
      // in vec2 TEXCOORD_0;
      in vec2 texCoords;
    #endif
  
  @vertex
    void main(void) {
      vec4 _NORMAL = vec4(0.);
      vec4 _TANGENT = vec4(0.);
      vec2 _TEXCOORD_0 = vec2(0.);
  
      #ifdef HAS_NORMALS
        _NORMAL = normals;
      #endif
  
      #ifdef HAS_TANGENTS
        _TANGENT = TANGENT;
      #endif
  
      #ifdef HAS_UV
        _TEXCOORD_0 = texCoords;
      #endif
  
      pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
      gl_Position = u_MVPMatrix * positions;
    }
  
  @fragment
    out vec4 fragmentColor;
  
    void main(void) {
      vec3 pos = pbr_vPosition;
      fragmentColor = pbr_filterColor(vec4(1.0));
    }
  `,qJ=`#version 300 es
  
    // in vec4 POSITION;
    in vec4 positions;
  
    #ifdef HAS_NORMALS
      // in vec4 NORMAL;
      in vec4 normals;
    #endif
  
    #ifdef HAS_TANGENTS
      in vec4 TANGENT;
    #endif
  
    #ifdef HAS_UV
      // in vec2 TEXCOORD_0;
      in vec2 texCoords;
    #endif
  
    void main(void) {
      vec4 _NORMAL = vec4(0.);
      vec4 _TANGENT = vec4(0.);
      vec2 _TEXCOORD_0 = vec2(0.);
  
      #ifdef HAS_NORMALS
        _NORMAL = normals;
      #endif
  
      #ifdef HAS_TANGENTS
        _TANGENT = TANGENT;
      #endif
  
      #ifdef HAS_UV
        _TEXCOORD_0 = texCoords;
      #endif
  
      pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
      gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
    }
  `,XJ=`#version 300 es
    out vec4 fragmentColor;
  
    void main(void) {
      vec3 pos = pbr_vPosition;
      fragmentColor = pbr_filterColor(vec4(1.0));
    }
  `;function IL(e,t){let{id:r,geometry:n,material:s,vertexCount:i,materialOptions:o,modelOptions:a}=t,c=eu(e,s,n.attributes,o);F.info(4,"createGLTFModel defines: ",c.defines)();let l=[],h={depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},f={id:r,source:jJ,vs:qJ,fs:XJ,geometry:n,topology:n.topology,vertexCount:i,modules:[Hi],...a,defines:{...c.defines,...a.defines},parameters:{...h,...c.parameters,...a.parameters}},u=new Y(e,f),{camera:d,...p}={...c.uniforms,...a.uniforms,...c.bindings,...a.bindings};return u.shaderInputs.setProps({pbrMaterial:p,pbrProjection:{camera:d}}),new pn({managedResources:l,model:u})}var wo;(function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(wo||(wo={}));function OL(e){switch(e){case wo.POINTS:return"point-list";case wo.LINES:return"line-list";case wo.LINE_STRIP:return"line-strip";case wo.TRIANGLES:return"triangle-list";case wo.TRIANGLE_STRIP:return"triangle-strip";default:throw new Error(String(e))}}var YJ={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1},km=class{device;options;gltf;constructor(t,r={}){this.device=t,this.options={...YJ,...r}}instantiate(t){return this.gltf=dT(t),(this.gltf.scenes||[]).map(n=>this.createScene(n))}createAnimator(){return Array.isArray(this.gltf.animations)?new Dm(this.gltf):null}createScene(t){let n=(t.nodes||[]).map(i=>this.createNode(i));return new lr({id:t.name||t.id,children:n})}createNode(t){if(!t._node){let s=(t.children||[]).map(o=>this.createNode(o));t.mesh&&s.push(this.createMesh(t.mesh));let i=new lr({id:t.name||t.id,children:s});if(t.matrix)i.setMatrix(t.matrix);else{if(i.matrix.identity(),t.translation&&i.matrix.translate(t.translation),t.rotation){let o=new $().fromQuaternion(t.rotation);i.matrix.multiplyRight(o)}t.scale&&i.matrix.scale(t.scale)}t._node=i}let r=this.gltf.nodes.find(n=>n.id===t.id);return r._node=t._node,t._node}createMesh(t){if(!t._mesh){let n=(t.primitives||[]).map((i,o)=>this.createPrimitive(i,o,t)),s=new lr({id:t.name||t.id,children:n});t._mesh=s}return t._mesh}createPrimitive(t,r,n){let s=t.name||`${n.name||n.id}-primitive-${r}`,i=OL(t.mode||4),o=t.indices?t.indices.count:this.getVertexCount(t.attributes),a=IL(this.device,{id:s,geometry:this.createGeometry(s,t,i),material:t.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:o});return a.bounds=[t.attributes.POSITION.min,t.attributes.POSITION.max],a}getVertexCount(t){throw new Error("getVertexCount not implemented")}createGeometry(t,r,n){let s={};for(let[i,o]of Object.entries(r.attributes)){let{components:a,size:c,value:l}=o;s[i]={size:c??a,value:l}}return new it({id:t,topology:n,indices:r.indices.value,attributes:s})}createBuffer(t,r){t.bufferView||(t.bufferView={});let{bufferView:n}=t;return n.lumaBuffers||(n.lumaBuffers={}),n.lumaBuffers[r]||(n.lumaBuffers[r]=this.device.createBuffer({id:`from-${n.id}`,data:n.data||t.value})),n.lumaBuffers[r]}createSampler(t){return t}needsPOT(){return!1}};function dT(e){if(ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof ImageBitmap)return e;if(Array.isArray(e))return e.map(dT);if(e&&typeof e=="object"){let t={};for(let r in e)t[r]=dT(e[r]);return t}return e}function pT(e,t,r){let n=new km(e,r),s=n.instantiate(t),i=n.createAnimator();return{scenes:s,animator:i}}var gT={};Bt(gT,{decode:()=>oQ,name:()=>iQ});function fe(e,t){if(!e)throw new Error(t||"assert failed: gltf")}var Um={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},zm={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4};var $J=1.33,LL=["SCALAR","VEC2","VEC3","VEC4"],KJ=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],ZJ=new Map(KJ),JJ={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},QJ={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},tQ={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Vm(e){return LL[e-1]||LL[0]}function rc(e){let t=ZJ.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function nc(e,t){let r=tQ[e.componentType],n=JJ[e.type],s=QJ[e.componentType],i=e.count*n,o=e.count*n*s;fe(o>=0&&o<=t.byteLength);let a=zm[e.componentType],c=Um[e.type];return{ArrayType:r,length:i,byteLength:o,componentByteSize:a,numberOfComponentsInElement:c}}function ru(e){let{images:t,bufferViews:r}=e;t=t||[],r=r||[];let n=t.map(o=>o.bufferView);r=r.filter(o=>!n.includes(o));let s=r.reduce((o,a)=>o+a.byteLength,0),i=t.reduce((o,a)=>{let{width:c,height:l}=a.image;return o+c*l},0);return s+Math.ceil(4*i*$J)}function NL(e,t,r){let n=e.bufferViews[r];fe(n);let s=n.buffer,i=t[s];fe(i);let o=(n.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,o,n.byteLength)}function BL(e,t,r){let n=typeof r=="number"?e.accessors?.[r]:r;if(!n)throw new Error(`No gltf accessor ${JSON.stringify(r)}`);let s=e.bufferViews?.[n.bufferView||0];if(!s)throw new Error(`No gltf buffer view for accessor ${s}`);let{arrayBuffer:i,byteOffset:o}=t[s.buffer],a=(o||0)+(n.byteOffset||0)+(s.byteOffset||0),{ArrayType:c,length:l,componentByteSize:h,numberOfComponentsInElement:f}=nc(n,s),u=h*f,d=s.byteStride||u;if(typeof s.byteStride>"u"||s.byteStride===u)return new c(i,a,l);let p=new c(l);for(let g=0;g<n.count;g++){let m=new c(i,a+g*d,f);p.set(m,g*f)}return p}function eQ(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}var At=class{gltf;sourceBuffers;byteLength;constructor(t){this.gltf={json:t?.json||eQ(),buffers:t?.buffers||[],images:t?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}hasExtension(t){let r=this.getUsedExtensions().find(s=>s===t),n=this.getRequiredExtensions().find(s=>s===t);return typeof r=="string"||typeof n=="string"}getExtension(t){let r=this.getUsedExtensions().find(s=>s===t),n=this.json.extensions||{};return r?n[t]:null}getRequiredExtension(t){return this.getRequiredExtensions().find(n=>n===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,r){return(t.extensions||{})[r]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,r){if(typeof r=="object")return r;let n=this.json[t]&&this.json[t][r];if(!n)throw new Error(`glTF file error: Could not find ${t}[${r}]`);return n}getTypedArrayForBufferView(t){t=this.getBufferView(t);let r=t.buffer,n=this.gltf.buffers[r];fe(n);let s=(t.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,s,t.byteLength)}getTypedArrayForAccessor(t){let r=this.getAccessor(t);return BL(this.gltf.json,this.gltf.buffers,r)}getTypedArrayForImageData(t){t=this.getAccessor(t);let r=this.getBufferView(t.bufferView),s=this.getBuffer(r.buffer).data,i=r.byteOffset||0;return new Uint8Array(s,i,r.byteLength)}addApplicationData(t,r){return this.json[t]=r,this}addExtraData(t,r){return this.json.extras=this.json.extras||{},this.json.extras[t]=r,this}addObjectExtension(t,r,n){return t.extensions=t.extensions||{},t.extensions[r]=n,this.registerUsedExtension(r),this}setObjectExtension(t,r,n){let s=t.extensions||{};s[r]=n}removeObjectExtension(t,r){let n=t?.extensions||{};if(n[r]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];let s=this.json.extensionsRemoved;s.includes(r)||s.push(r)}delete n[r]}addExtension(t,r={}){return fe(r),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=r,this.registerUsedExtension(t),r}addRequiredExtension(t,r={}){return fe(r),this.addExtension(t,r),this.registerRequiredExtension(t),r}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(r=>r===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(r=>r===t)||this.json.extensionsRequired.push(t)}removeExtension(t){if(this.json.extensions?.[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];let r=this.json.extensionsRemoved;r.includes(t)||r.push(t)}this.json.extensions&&delete this.json.extensions[t],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t)}setDefaultScene(t){this.json.scene=t}addScene(t){let{nodeIndices:r}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:r}),this.json.scenes.length-1}addNode(t){let{meshIndex:r,matrix:n}=t;this.json.nodes=this.json.nodes||[];let s={mesh:r};return n&&(s.matrix=n),this.json.nodes.push(s),this.json.nodes.length-1}addMesh(t){let{attributes:r,indices:n,material:s,mode:i=4}=t,a={primitives:[{attributes:this._addAttributes(r),mode:i}]};if(n){let c=this._addIndices(n);a.primitives[0].indices=c}return Number.isFinite(s)&&(a.primitives[0].material=s),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}addPointCloud(t){let n={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addImage(t,r){let n=Li(t),s=r||n?.mimeType,o={bufferView:this.addBufferView(t),mimeType:s};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(t,r=0,n=this.byteLength){let s=t.byteLength;fe(Number.isFinite(s)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);let i={buffer:r,byteOffset:n,byteLength:s};return this.byteLength+=Ms(s,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(t,r){let n={bufferView:t,type:Vm(r.size),componentType:r.componentType,count:r.count,max:r.max,min:r.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}addBinaryBuffer(t,r={size:3}){let n=this.addBufferView(t),s={min:r.min,max:r.max};(!s.min||!s.max)&&(s=this._getAccessorMinMax(t,r.size));let i={size:r.size,componentType:rc(t),count:Math.round(t.length/r.size),min:s.min,max:s.max};return this.addAccessor(n,Object.assign(i,r))}addTexture(t){let{imageIndex:r}=t,n={source:r};return this.json.textures=this.json.textures||[],this.json.textures.push(n),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){this.gltf.buffers=[];let t=this.byteLength,r=new ArrayBuffer(t),n=new Uint8Array(r),s=0;for(let i of this.sourceBuffers||[])s=D_(i,n,s);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=t:this.json.buffers=[{byteLength:t}],this.gltf.binary=r,this.sourceBuffers=[r]}_removeStringFromArray(t,r){let n=!0;for(;n;){let s=t.indexOf(r);s>-1?t.splice(s,1):n=!1}}_addAttributes(t={}){let r={};for(let n in t){let s=t[n],i=this._getGltfAttributeName(n),o=this.addBinaryBuffer(s.value,s);r[i]=o}return r}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,r){let n={min:null,max:null};if(t.length<r)return n;n.min=[],n.max=[];let s=t.subarray(0,r);for(let i of s)n.min.push(i),n.max.push(i);for(let i=r;i<t.length;i+=r)for(let o=0;o<r;o++)n.min[0+o]=Math.min(n.min[0+o],t[i+o]),n.max[0+o]=Math.max(n.max[0+o],t[i+o]);return n}};function FL(e){return(e%1+1)%1}var DL={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},rQ={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},kL={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function nu(e,t){return kL[t]*DL[e]}function sc(e,t,r,n){if(r!=="UINT8"&&r!=="UINT16"&&r!=="UINT32"&&r!=="UINT64")return null;let s=e.getTypedArrayForBufferView(t),i=ic(s,"SCALAR",r,n+1);return i instanceof BigInt64Array||i instanceof BigUint64Array?null:i}function ic(e,t,r,n=1){let s=DL[t],i=rQ[r],o=kL[r],a=n*s,c=a*o,l=e.buffer,h=e.byteOffset;return h%o!==0&&(l=new Uint8Array(l).slice(h,h+c).buffer,h=0),new i(l,h,a)}function oc(e,t,r){let n=`TEXCOORD_${t.texCoord||0}`,s=r.attributes[n],i=e.getTypedArrayForAccessor(s),o=e.gltf.json,a=t.index,c=o.textures?.[a]?.source;if(typeof c<"u"){let l=o.images?.[c]?.mimeType,h=e.gltf.images?.[c];if(h&&typeof h.width<"u"){let f=[];for(let u=0;u<i.length;u+=2){let d=nQ(h,l,i,u,t.channels);f.push(d)}return f}}return[]}function Hm(e,t,r,n,s){if(!r?.length)return;let i=[];for(let h of r){let f=n.findIndex(u=>u===h);f===-1&&(f=n.push(h)-1),i.push(f)}let o=new Uint32Array(i),a=e.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,c=e.addBufferView(o,a,0),l=e.addAccessor(c,{size:1,componentType:rc(o),count:o.length});s.attributes[t]=l}function nQ(e,t,r,n,s=[0]){let i={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=r[n],a=r[n+1],c=1;t&&(t.indexOf("image/jpeg")!==-1||t.indexOf("image/png")!==-1)&&(c=4);let l=sQ(o,a,e,c),h=0;for(let f of s){let u=typeof f=="number"?Object.values(i)[f]:i[f],d=l+u.offset,p=wl(e);if(p.data.length<=d)throw new Error(`${p.data.length} <= ${d}`);let g=p.data[d];h|=g<<u.shift}return h}function sQ(e,t,r,n=1){let s=r.width,i=FL(e)*(s-1),o=Math.round(i),a=r.height,c=FL(t)*(a-1),l=Math.round(c),h=r.components?r.components:n;return(l*s+o)*h}function Wm(e,t,r,n,s){let i=[];for(let o=0;o<t;o++){let a=r[o],c=r[o+1]-r[o];if(c+a>n)break;let l=a/s,h=c/s;i.push(e.slice(l,l+h))}return i}function Gm(e,t,r){let n=[];for(let s=0;s<t;s++){let i=s*r;n.push(e.slice(i,i+r))}return n}function jm(e,t,r,n){if(r)throw new Error("Not implemented - arrayOffsets for strings is specified");if(n){let s=[],i=new TextDecoder("utf8"),o=0;for(let a=0;a<e;a++){let c=n[a+1]-n[a];if(c+o<=t.length){let l=t.subarray(o,c+o),h=i.decode(l);s.push(h),o+=c}}return s}return[]}var UL="EXT_mesh_features",iQ=UL;async function oQ(e,t){let r=new At(e);aQ(r,t)}function aQ(e,t){let r=e.gltf.json;if(r.meshes)for(let n of r.meshes)for(let s of n.primitives)cQ(e,s,t)}function cQ(e,t,r){if(!r?.gltf?.loadBuffers)return;let s=t.extensions?.[UL]?.featureIds;if(s)for(let i of s){let o;if(typeof i.attribute<"u"){let a=`_FEATURE_ID_${i.attribute}`,c=t.attributes[a];o=e.getTypedArrayForAccessor(c)}else typeof i.texture<"u"&&r?.gltf?.loadImages?o=oc(e,i.texture,t):o=[];i.data=o}}var xT={};Bt(xT,{decode:()=>hQ,name:()=>lQ});var mT="EXT_structural_metadata",lQ=mT;async function hQ(e,t){let r=new At(e);fQ(r,t)}function fQ(e,t){if(!t.gltf?.loadBuffers)return;let r=e.getExtension(mT);r&&(t.gltf?.loadImages&&uQ(e,r),dQ(e,r))}function uQ(e,t){let r=t.propertyTextures,n=e.gltf.json;if(r&&n.meshes)for(let s of n.meshes)for(let i of s.primitives)gQ(e,r,i,t)}function dQ(e,t){let r=t.schema;if(!r)return;let n=r.classes,s=t.propertyTables;if(n&&s)for(let i in n){let o=pQ(s,i);o&&_Q(e,r,o)}}function pQ(e,t){for(let r of e)if(r.class===t)return r;return null}function gQ(e,t,r,n){if(!t)return;let i=r.extensions?.[mT]?.propertyTextures;if(i)for(let o of i){let a=t[o];mQ(e,a,r,n)}}function mQ(e,t,r,n){if(!t.properties)return;n.dataAttributeNames||(n.dataAttributeNames=[]);let s=t.class;for(let i in t.properties){let o=`${s}_${i}`,a=t.properties?.[i];if(!a)continue;a.data||(a.data=[]);let c=a.data,l=oc(e,a,r);l!==null&&(Hm(e,o,l,c,r),a.data=c,n.dataAttributeNames.push(o))}}function _Q(e,t,r){let n=t.classes?.[r.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);let s=r.count;for(let i in n.properties){let o=n.properties[i],a=r.properties?.[i];if(a){let c=xQ(e,t,o,s,a);a.data=c}}}function xQ(e,t,r,n,s){let i=[],o=s.values,a=e.getTypedArrayForBufferView(o),c=yQ(e,r,s,n),l=AQ(e,s,n);switch(r.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{i=TQ(r,n,a,c);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${r.type}`);case"STRING":{i=jm(n,a,c,l);break}case"ENUM":{i=MQ(t,r,n,a,c);break}default:throw new Error(`Unknown classProperty type ${r.type}`)}return i}function yQ(e,t,r,n){return t.array&&typeof t.count>"u"&&typeof r.arrayOffsets<"u"?sc(e,r.arrayOffsets,r.arrayOffsetType||"UINT32",n):null}function AQ(e,t,r){return typeof t.stringOffsets<"u"?sc(e,t.stringOffsets,t.stringOffsetType||"UINT32",r):null}function TQ(e,t,r,n){let s=e.array,i=e.count,o=nu(e.type,e.componentType),a=r.byteLength/o,c;return e.componentType?c=ic(r,e.type,e.componentType,a):c=r,s?n?Wm(c,t,n,r.length,o):i?Gm(c,t,i):[]:c}function MQ(e,t,r,n,s){let i=t.enumType;if(!i)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");let o=e.enums?.[i];if(!o)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${i}`);let a=o.valueType||"UINT16",c=nu(t.type,a),l=n.byteLength/c,h=ic(n,t.type,a,l);if(h||(h=n),t.array){if(s)return EQ({valuesData:h,numberOfElements:r,arrayOffsets:s,valuesDataBytesLength:n.length,elementSize:c,enumEntry:o});let f=t.count;return f?bQ(h,r,f,o):[]}return _T(h,0,r,o)}function EQ(e){let{valuesData:t,numberOfElements:r,arrayOffsets:n,valuesDataBytesLength:s,elementSize:i,enumEntry:o}=e,a=[];for(let c=0;c<r;c++){let l=n[c],h=n[c+1]-n[c];if(h+l>s)break;let f=l/i,u=h/i,d=_T(t,f,u,o);a.push(d)}return a}function bQ(e,t,r,n){let s=[];for(let i=0;i<t;i++){let o=r*i,a=_T(e,o,r,n);s.push(a)}return s}function _T(e,t,r,n){let s=[];for(let i=0;i<r;i++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)s.push("");else{let o=e[t+i],a=SQ(n,o);a?s.push(a.name):s.push("")}return s}function SQ(e,t){for(let r of e.values)if(r.value===t)return r;return null}var yT={};Bt(yT,{decode:()=>wQ,name:()=>vQ});var zL="EXT_feature_metadata",vQ=zL;async function wQ(e,t){let r=new At(e);CQ(r,t)}function CQ(e,t){if(!t.gltf?.loadBuffers)return;let r=e.getExtension(zL);r&&(t.gltf?.loadImages&&PQ(e,r),RQ(e,r))}function PQ(e,t){let r=t.schema;if(!r)return;let n=r.classes,{featureTextures:s}=t;if(n&&s)for(let i in n){let o=n[i],a=OQ(s,i);a&&NQ(e,a,o)}}function RQ(e,t){let r=t.schema;if(!r)return;let n=r.classes,s=t.featureTables;if(n&&s)for(let i in n){let o=IQ(s,i);o&&LQ(e,r,o)}}function IQ(e,t){for(let r in e){let n=e[r];if(n.class===t)return n}return null}function OQ(e,t){for(let r in e){let n=e[r];if(n.class===t)return n}return null}function LQ(e,t,r){if(!r.class)return;let n=t.classes?.[r.class];if(!n)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);let s=r.count;for(let i in n.properties){let o=n.properties[i],a=r.properties?.[i];if(a){let c=BQ(e,t,o,s,a);a.data=c}}}function NQ(e,t,r){let n=t.class;for(let s in r.properties){let i=t?.properties?.[s];if(i){let o=zQ(e,i,n);i.data=o}}}function BQ(e,t,r,n,s){let i=[],o=s.bufferView,a=e.getTypedArrayForBufferView(o),c=FQ(e,r,s,n),l=DQ(e,r,s,n);return r.type==="STRING"||r.componentType==="STRING"?i=jm(n,a,c,l):kQ(r)&&(i=UQ(r,n,a,c)),i}function FQ(e,t,r,n){return t.type==="ARRAY"&&typeof t.componentCount>"u"&&typeof r.arrayOffsetBufferView<"u"?sc(e,r.arrayOffsetBufferView,r.offsetType||"UINT32",n):null}function DQ(e,t,r,n){return typeof r.stringOffsetBufferView<"u"?sc(e,r.stringOffsetBufferView,r.offsetType||"UINT32",n):null}function kQ(e){let t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(e.type)||typeof e.componentType<"u"&&t.includes(e.componentType)}function UQ(e,t,r,n){let s=e.type==="ARRAY",i=e.componentCount,o="SCALAR",a=e.componentType||e.type,c=nu(o,a),l=r.byteLength/c,h=ic(r,o,a,l);return s?n?Wm(h,t,n,r.length,c):i?Gm(h,t,i):[]:h}function zQ(e,t,r){let n=e.gltf.json;if(!n.meshes)return[];let s=[];for(let i of n.meshes)for(let o of i.primitives)VQ(e,r,t,s,o);return s}function VQ(e,t,r,n,s){let i={channels:r.channels,...r.texture},o=oc(e,i,s);o&&Hm(e,t,o,n,s)}var VL="4.2.1";var ac=!0,HL=1735152710,MT=12,qm=8,HQ=1313821514,WQ=5130562,GQ=0,jQ=0,qQ=1;function XQ(e,t=0){return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}function WL(e,t=0,r={}){let n=new DataView(e),{magic:s=HL}=r,i=n.getUint32(t,!1);return i===s||i===HL}function jL(e,t,r=0,n={}){let s=new DataView(t),i=XQ(s,r+0),o=s.getUint32(r+4,ac),a=s.getUint32(r+8,ac);switch(Object.assign(e,{header:{byteOffset:r,byteLength:a,hasBinChunk:!1},type:i,version:o,json:{},binChunks:[]}),r+=MT,e.version){case 1:return YQ(e,s,r);case 2:return $Q(e,s,r,n={});default:throw new Error(`Invalid GLB version ${e.version}. Only supports version 1 and 2.`)}}function YQ(e,t,r){nt(e.header.byteLength>MT+qm);let n=t.getUint32(r+0,ac),s=t.getUint32(r+4,ac);return r+=qm,nt(s===GQ),AT(e,t,r,n),r+=n,r+=TT(e,t,r,e.header.byteLength),r}function $Q(e,t,r,n){return nt(e.header.byteLength>MT+qm),KQ(e,t,r,n),r+e.header.byteLength}function KQ(e,t,r,n){for(;r+8<=e.header.byteLength;){let s=t.getUint32(r+0,ac),i=t.getUint32(r+4,ac);switch(r+=qm,i){case HQ:AT(e,t,r,s);break;case WQ:TT(e,t,r,s);break;case jQ:n.strict||AT(e,t,r,s);break;case qQ:n.strict||TT(e,t,r,s);break;default:break}r+=Ms(s,4)}return r}function AT(e,t,r,n){let s=new Uint8Array(t.buffer,r,n),o=new TextDecoder("utf8").decode(s);return e.json=JSON.parse(o),Ms(n,4)}function TT(e,t,r,n){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:r,byteLength:n,arrayBuffer:t.buffer}),Ms(n,4)}function ET(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;let n=t.baseUri||t.uri;if(!n)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return n.substr(0,n.lastIndexOf("/")+1)+e}var ST={};Bt(ST,{decode:()=>ctt,name:()=>att});var ZQ="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",JQ="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",QQ=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),ttt=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),ett={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},rtt={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function qL(e,t,r,n,s,i="NONE"){let o=await ntt();ott(o,o.exports[rtt[s]],e,t,r,n,o.exports[ett[i||"NONE"]])}var bT;async function ntt(){return bT||(bT=stt()),bT}async function stt(){let e=ZQ;WebAssembly.validate(QQ)&&(e=JQ,console.log("Warning: meshopt_decoder is using experimental SIMD support"));let t=await WebAssembly.instantiate(itt(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function itt(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;++n){let s=e.charCodeAt(n);t[n]=s>96?s-71:s>64?s-65:s>47?s+4:s>46?63:62}let r=0;for(let n=0;n<e.length;++n)t[r++]=t[n]<60?ttt[t[n]]:(t[n]-60)*64+t[++n];return t.buffer.slice(0,r)}function ott(e,t,r,n,s,i,o){let a=e.exports.sbrk,c=n+3&-4,l=a(c*s),h=a(i.length),f=new Uint8Array(e.exports.memory.buffer);f.set(i,h);let u=t(l,n,s,h,i.length);if(u===0&&o&&o(l,c,s),r.set(f.subarray(l,l+n*s)),a(l-a(0)),u!==0)throw new Error(`Malformed buffer data: ${u}`)}var Xm="EXT_meshopt_compression",att=Xm;async function ctt(e,t){let r=new At(e);if(!t?.gltf?.decompressMeshes||!t.gltf?.loadBuffers)return;let n=[];for(let s of e.json.bufferViews||[])n.push(ltt(r,s));await Promise.all(n),r.removeExtension(Xm)}async function ltt(e,t){let r=e.getObjectExtension(t,Xm);if(r){let{byteOffset:n=0,byteLength:s=0,byteStride:i,count:o,mode:a,filter:c="NONE",buffer:l}=r,h=e.gltf.buffers[l],f=new Uint8Array(h.arrayBuffer,h.byteOffset+n,s),u=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await qL(u,o,i,f,a,c),e.removeObjectExtension(t,Xm)}}var vT={};Bt(vT,{name:()=>htt,preprocess:()=>ftt});var cc="EXT_texture_webp",htt=cc;function ftt(e,t){let r=new At(e);if(!nx("image/webp")){if(r.getRequiredExtensions().includes(cc))throw new Error(`gltf: Required extension ${cc} not supported by browser`);return}let{json:n}=r;for(let s of n.textures||[]){let i=r.getObjectExtension(s,cc);i&&(s.source=i.source),r.removeObjectExtension(s,cc)}r.removeExtension(cc)}var wT={};Bt(wT,{name:()=>utt,preprocess:()=>dtt});var Ym="KHR_texture_basisu",utt=Ym;function dtt(e,t){let r=new At(e),{json:n}=r;for(let s of n.textures||[]){let i=r.getObjectExtension(s,Ym);i&&(s.source=i.source,r.removeObjectExtension(s,Ym))}r.removeExtension(Ym)}var OT={};Bt(OT,{decode:()=>Ptt,encode:()=>Rtt,name:()=>wtt,preprocess:()=>Ctt});var XL="4.2.1";var YL={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:XL,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function KL(e,t,r){let n=ZL(t.metadata),s=[],i=ptt(t.attributes);for(let o in e){let a=e[o],c=$L(o,a,i[o]);s.push(c)}if(r){let o=$L("indices",r);s.push(o)}return{fields:s,metadata:n}}function ptt(e){let t={};for(let r in e){let n=e[r];t[n.name||"undefined"]=n}return t}function $L(e,t,r){let n=r?ZL(r.metadata):void 0;return Z_(e,t,n)}function ZL(e){Object.entries(e);let t={};for(let r in e)t[`${r}.string`]=JSON.stringify(e[r]);return t}var JL={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},gtt={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},mtt=4,su=class{draco;decoder;metadataQuerier;constructor(t){this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t,r={}){let n=new this.draco.DecoderBuffer;n.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(r);let s=this.decoder.GetEncodedGeometryType(n),i=s===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(s){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(n,i);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(n,i);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!i.ptr){let u=`DRACO decompression failed: ${o.error_msg()}`;throw new Error(u)}let a=this._getDracoLoaderData(i,s,r),c=this._getMeshData(i,a,r),l=Fn(c.attributes),h=KL(c.attributes,a,c.indices);return{loader:"draco",loaderData:a,header:{vertexCount:i.num_points(),boundingBox:l},...c,schema:h}}finally{this.draco.destroy(n),i&&this.draco.destroy(i)}}_getDracoLoaderData(t,r,n){let s=this._getTopLevelMetadata(t),i=this._getDracoAttributes(t,n);return{geometry_type:r,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:s,attributes:i}}_getDracoAttributes(t,r){let n={};for(let s=0;s<t.num_attributes();s++){let i=this.decoder.GetAttribute(t,s),o=this._getAttributeMetadata(t,s);n[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:s,metadata:o};let a=this._getQuantizationTransform(i,r);a&&(n[i.unique_id()].quantization_transform=a);let c=this._getOctahedronTransform(i,r);c&&(n[i.unique_id()].octahedron_transform=c)}return n}_getMeshData(t,r,n){let s=this._getMeshAttributes(r,t,n);if(!s.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(n.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:s,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:s,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:s}}_getMeshAttributes(t,r,n){let s={};for(let i of Object.values(t.attributes)){let o=this._deduceAttributeName(i,n);i.name=o;let a=this._getAttributeValues(r,i);if(a){let{value:c,size:l}=a;s[o]={value:c,size:l,byteOffset:i.byte_offset,byteStride:i.byte_stride,normalized:i.normalized}}}return s}_getTriangleListIndices(t){let n=t.num_faces()*3,s=n*mtt,i=this.draco._malloc(s);try{return this.decoder.GetTrianglesUInt32Array(t,s,i),new Uint32Array(this.draco.HEAPF32.buffer,i,n).slice()}finally{this.draco._free(i)}}_getTriangleStripIndices(t){let r=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,r),ytt(r)}finally{this.draco.destroy(r)}}_getAttributeValues(t,r){let n=gtt[r.data_type];if(!n)return console.warn(`DRACO: Unsupported attribute type ${r.data_type}`),null;let s=r.num_components,o=t.num_points()*s,a=o*n.BYTES_PER_ELEMENT,c=_tt(this.draco,n),l,h=this.draco._malloc(a);try{let f=this.decoder.GetAttribute(t,r.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,f,c,a,h),l=new n(this.draco.HEAPF32.buffer,h,o).slice()}finally{this.draco._free(h)}return{value:l,size:s}}_deduceAttributeName(t,r){let n=t.unique_id;for(let[o,a]of Object.entries(r.extraAttributes||{}))if(a===n)return o;let s=t.attribute_type;for(let o in JL)if(this.draco[o]===s)return JL[o];let i=r.attributeNameEntry||"name";return t.metadata[i]?t.metadata[i].string:`CUSTOM_ATTRIBUTE_${n}`}_getTopLevelMetadata(t){let r=this.decoder.GetMetadata(t);return this._getDracoMetadata(r)}_getAttributeMetadata(t,r){let n=this.decoder.GetAttributeMetadata(t,r);return this._getDracoMetadata(n)}_getDracoMetadata(t){if(!t||!t.ptr)return{};let r={},n=this.metadataQuerier.NumEntries(t);for(let s=0;s<n;s++){let i=this.metadataQuerier.GetEntryName(t,s);r[i]=this._getDracoMetadataField(t,i)}return r}_getDracoMetadataField(t,r){let n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,r,n);let s=xtt(n);return{int:this.metadataQuerier.GetIntEntry(t,r),string:this.metadataQuerier.GetStringEntry(t,r),double:this.metadataQuerier.GetDoubleEntry(t,r),intArray:s}}finally{this.draco.destroy(n)}}_disableAttributeTransforms(t){let{quantizedAttributes:r=[],octahedronAttributes:n=[]}=t,s=[...r,...n];for(let i of s)this.decoder.SkipAttributeTransform(this.draco[i])}_getQuantizationTransform(t,r){let{quantizedAttributes:n=[]}=r,s=t.attribute_type();if(n.map(o=>this.decoder[o]).includes(s)){let o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(t))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(a=>o.min_value(a))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(t,r){let{octahedronAttributes:n=[]}=r,s=t.attribute_type();if(n.map(o=>this.decoder[o]).includes(s)){let o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(t))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}};function _tt(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}function xtt(e){let t=e.size(),r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=e.GetValue(n);return r}function ytt(e){let t=e.size(),r=new Int32Array(t);for(let n=0;n<t;n++)r[n]=e.GetValue(n);return r}var Att="1.5.6",Ttt="1.4.1",CT=`https://www.gstatic.com/draco/versioned/decoders/${Att}`,er={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},PT={[er.DECODER]:`${CT}/${er.DECODER}`,[er.DECODER_WASM]:`${CT}/${er.DECODER_WASM}`,[er.FALLBACK_DECODER]:`${CT}/${er.FALLBACK_DECODER}`,[er.ENCODER]:`https://raw.githubusercontent.com/google/draco/${Ttt}/javascript/${er.ENCODER}`},RT;async function QL(e){let t=e.modules||{};return t.draco3d?RT||=t.draco3d.createDecoderModule({}).then(r=>({draco:r})):RT||=Mtt(e),await RT}async function Mtt(e){let t,r;switch(e.draco&&e.draco.decoderType){case"js":t=await on(PT[er.FALLBACK_DECODER],"draco",e,er.FALLBACK_DECODER);break;case"wasm":default:[t,r]=await Promise.all([await on(PT[er.DECODER],"draco",e,er.DECODER),await on(PT[er.DECODER_WASM],"draco",e,er.DECODER_WASM)])}return t=t||globalThis.DracoDecoderModule,await Ett(t,r)}function Ett(e,t){let r={};return t&&(r.wasmBinary=t),new Promise(n=>{e({...r,onModuleLoaded:s=>n({draco:s})})})}var $m={...YL,parse:btt};async function btt(e,t){let{draco:r}=await QL(t),n=new su(r);try{return n.parseSync(e,t?.draco)}finally{n.destroy()}}function tN(e){let t={};for(let r in e){let n=e[r];if(r!=="indices"){let s=IT(n);t[r]=s}}return t}function IT(e){let{buffer:t,size:r,count:n}=Stt(e);return{value:t,size:r,byteOffset:0,count:n,type:Vm(r),componentType:rc(t)}}function Stt(e){let t=e,r=1,n=0;return e&&e.value&&(t=e.value,r=e.size||1),t&&(ArrayBuffer.isView(t)||(t=vtt(t,Float32Array)),n=t.length/r),{buffer:t,size:r,count:n}}function vtt(e,t,r=!1){return e?Array.isArray(e)?new t(e):r&&!(e instanceof t)?new t(e):e:null}var li="KHR_draco_mesh_compression",wtt=li;function Ctt(e,t,r){let n=new At(e);for(let s of eN(n))n.getObjectExtension(s,li)}async function Ptt(e,t,r){if(!t?.gltf?.decompressMeshes)return;let n=new At(e),s=[];for(let i of eN(n))n.getObjectExtension(i,li)&&s.push(Itt(n,i,t,r));await Promise.all(s),n.removeExtension(li)}function Rtt(e,t={}){let r=new At(e);for(let n of r.json.meshes||[])Ott(n,t),r.addRequiredExtension(li)}async function Itt(e,t,r,n){let s=e.getObjectExtension(t,li);if(!s)return;let i=e.getTypedArrayForBufferView(s.bufferView),o=Pi(i.buffer,i.byteOffset),a={...r};delete a["3d-tiles"];let c=await sr(o,$m,a,n),l=tN(c.attributes);for(let[h,f]of Object.entries(l))if(h in t.attributes){let u=t.attributes[h],d=e.getAccessor(u);d?.min&&d?.max&&(f.min=d.min,f.max=d.max)}t.attributes=l,c.indices&&(t.indices=IT(c.indices)),e.removeObjectExtension(t,li),Ltt(t)}function Ott(e,t,r=4,n,s){if(!n.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");let i=n.DracoWriter.encodeSync({attributes:e}),o=s?.parseSync?.({attributes:e}),a=n._addFauxAttributes(o.attributes),c=n.addBufferView(i);return{primitives:[{attributes:a,mode:r,extensions:{[li]:{bufferView:c,attributes:a}}}]}}function Ltt(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*eN(e){for(let t of e.json.meshes||[])for(let r of t.primitives)yield r}var UT={};Bt(UT,{decode:()=>$tt,name:()=>qtt});var W8t=1/Math.PI*180,G8t=1/180*Math.PI,Ntt={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...Ntt}};var Se=globalThis.mathgl.config;function rN(e,{precision:t=Se.precision}={}){return e=Btt(e),`${parseFloat(e.toPrecision(t))}`}function lc(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function LT(e,t,r){let n=Se.EPSILON;r&&(Se.EPSILON=r);try{if(e===t)return!0;if(lc(e)&&lc(t)){if(e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(!LT(e[s],t[s]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=Se.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{Se.EPSILON=n}}function Btt(e){return Math.round(e/Se.EPSILON)*Se.EPSILON}var hc=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,r=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+r];return this.check()}toArray(t=[],r=0){for(let n=0;n<this.ELEMENTS;++n)t[r+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:lc(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Se)}formatString(t){let r="";for(let n=0;n<this.ELEMENTS;++n)r+=(n>0?", ":"")+rN(this[n],t);return`${t.printTypes?this.constructor.name:""}[${r}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!LT(this[r],t[r]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==t[r])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,r,n){if(n===void 0)return this.lerp(this,t,r);for(let s=0;s<this.ELEMENTS;++s){let i=t[s],o=typeof r=="number"?r:r[s];this[s]=i+n*(o-i)}return this.check()}min(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(t[r],this[r]);return this.check()}max(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(t[r],this[r]);return this.check()}clamp(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),r[n]);return this.check()}add(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]+=r[n];return this.check()}subtract(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]-=r[n];return this.check()}scale(t){if(typeof t=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;else for(let r=0;r<this.ELEMENTS&&r<t.length;++r)this[r]*=t[r];return this.check()}multiplyByScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}check(){if(Se.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)t=t&&Number.isFinite(this[r]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=t;return this.check()}addScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),r);return this.check()}get elements(){return this}};function Ftt(e,t){if(e.length!==t)return!1;for(let r=0;r<e.length;++r)if(!Number.isFinite(e[r]))return!1;return!0}function Oe(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function nN(e,t,r=""){if(Se.debug&&!Ftt(e,t))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return e}function NT(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}var Km=class extends hc{get x(){return this[0]}set x(t){this[0]=Oe(t)}get y(){return this[1]}set y(t){this[1]=Oe(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*this[r];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let r=0;for(let n=0;n<this.ELEMENTS;++n){let s=this[n]-t[n];r+=s*s}return Oe(r)}dot(t){let r=0;for(let n=0;n<this.ELEMENTS;++n)r+=this[n]*t[n];return Oe(r)}normalize(){let t=this.magnitude();if(t!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t;return this.check()}multiply(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]*=r[n];return this.check()}divide(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]/=r[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return NT(t>=0&&t<this.ELEMENTS,"index is out of range"),Oe(this[t])}setComponent(t,r){return NT(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=r,this.check()}addVectors(t,r){return this.copy(t).add(r)}subVectors(t,r){return this.copy(t).subtract(r)}multiplyVectors(t,r){return this.copy(t).multiply(r)}addScaledVector(t,r){return this.add(new this.constructor(t).multiplyScalar(r))}};var fc=typeof Float32Array<"u"?Float32Array:Array;var ezt=Math.PI/180;function ztt(){let e=new fc(2);return fc!=Float32Array&&(e[0]=0,e[1]=0),e}function iN(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[3]*s+r[6],e[1]=r[1]*n+r[4]*s+r[7],e}var rzt=function(){let e=ztt();return function(t,r,n,s,i,o){let a,c;for(r||(r=2),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],i(e,e,o),t[a]=e[0],t[a+1]=e[1];return t}}();function oN(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[3]*n+r[7]*s+r[11]*i||1;return e[0]=(r[0]*n+r[4]*s+r[8]*i)/o,e[1]=(r[1]*n+r[5]*s+r[9]*i)/o,e[2]=(r[2]*n+r[6]*s+r[10]*i)/o,e}function aN(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[2]*s,e[1]=r[1]*n+r[3]*s,e[2]=t[2],e}function cN(e,t,r){let n=t[0],s=t[1],i=t[2];return e[0]=r[0]*n+r[3]*s+r[6]*i,e[1]=r[1]*n+r[4]*s+r[7]*i,e[2]=r[2]*n+r[5]*s+r[8]*i,e[3]=t[3],e}function Vtt(){let e=new fc(3);return fc!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Htt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function lN(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[0],a=r[1],c=r[2];return e[0]=s*c-i*a,e[1]=i*o-n*c,e[2]=n*a-s*o,e}function hN(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[3]*n+r[7]*s+r[11]*i+r[15];return o=o||1,e[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/o,e[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/o,e[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/o,e}function Zm(e,t,r){let n=t[0],s=t[1],i=t[2];return e[0]=n*r[0]+s*r[3]+i*r[6],e[1]=n*r[1]+s*r[4]+i*r[7],e[2]=n*r[2]+s*r[5]+i*r[8],e}function fN(e,t,r){let n=r[0],s=r[1],i=r[2],o=r[3],a=t[0],c=t[1],l=t[2],h=s*l-i*c,f=i*a-n*l,u=n*c-s*a,d=s*u-i*f,p=i*h-n*u,g=n*f-s*h,m=o*2;return h*=m,f*=m,u*=m,d*=2,p*=2,g*=2,e[0]=a+h+d,e[1]=c+f+p,e[2]=l+u+g,e}function uN(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[0],i[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),i[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function dN(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),i[1]=s[1],i[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function pN(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),i[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),i[2]=s[2],e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function gN(e,t){let r=e[0],n=e[1],s=e[2],i=t[0],o=t[1],a=t[2],c=Math.sqrt((r*r+n*n+s*s)*(i*i+o*o+a*a)),l=c&&Htt(e,t)/c;return Math.acos(Math.min(Math.max(l,-1),1))}var izt=function(){let e=Vtt();return function(t,r,n,s,i,o){let a,c;for(r||(r=3),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}}();var BT=[0,0,0],Jm,Co=class extends Km{static get ZERO(){return Jm||(Jm=new Co(0,0,0),Object.freeze(Jm)),Jm}constructor(t=0,r=0,n=0){super(-0,-0,-0),arguments.length===1&&lc(t)?this.copy(t):(Se.debug&&(Oe(t),Oe(r),Oe(n)),this[0]=t,this[1]=r,this[2]=n)}set(t,r,n){return this[0]=t,this[1]=r,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return Se.debug&&(Oe(t.x),Oe(t.y),Oe(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Oe(t)}angle(t){return gN(this,t)}cross(t){return lN(this,this,t),this.check()}rotateX({radians:t,origin:r=BT}){return uN(this,this,r,t),this.check()}rotateY({radians:t,origin:r=BT}){return dN(this,this,r,t),this.check()}rotateZ({radians:t,origin:r=BT}){return pN(this,this,r,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return hN(this,this,t),this.check()}transformAsVector(t){return oN(this,this,t),this.check()}transformByMatrix3(t){return Zm(this,this,t),this.check()}transformByMatrix2(t){return aN(this,this,t),this.check()}transformByQuaternion(t){return fN(this,this,t),this.check()}};var Qm=class extends hc{toString(){let t="[";if(Se.printRowMajor){t+="row-major:";for(let r=0;r<this.RANK;++r)for(let n=0;n<this.RANK;++n)t+=` ${this[n*this.RANK+r]}`}else{t+="column-major:";for(let r=0;r<this.ELEMENTS;++r)t+=` ${this[r]}`}return t+="]",t}getElementIndex(t,r){return r*this.RANK+t}getElement(t,r){return this[r*this.RANK+t]}setElement(t,r,n){return this[r*this.RANK+t]=Oe(n),this}getColumn(t,r=new Array(this.RANK).fill(-0)){let n=t*this.RANK;for(let s=0;s<this.RANK;++s)r[s]=this[n+s];return r}setColumn(t,r){let n=t*this.RANK;for(let s=0;s<this.RANK;++s)this[n+s]=r[s];return this}};function mN(e,t){if(e===t){let r=t[1],n=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function _N(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=t[4],a=t[5],c=t[6],l=t[7],h=t[8],f=h*o-a*l,u=-h*i+a*c,d=l*i-o*c,p=r*f+n*u+s*d;return p?(p=1/p,e[0]=f*p,e[1]=(-h*n+s*l)*p,e[2]=(a*n-s*o)*p,e[3]=u*p,e[4]=(h*r-s*c)*p,e[5]=(-a*r+s*i)*p,e[6]=d*p,e[7]=(-l*r+n*c)*p,e[8]=(o*r-n*i)*p,e):null}function xN(e){let t=e[0],r=e[1],n=e[2],s=e[3],i=e[4],o=e[5],a=e[6],c=e[7],l=e[8];return t*(l*i-o*c)+r*(-l*s+o*a)+n*(c*s-i*a)}function FT(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=r[0],d=r[1],p=r[2],g=r[3],m=r[4],_=r[5],y=r[6],x=r[7],A=r[8];return e[0]=u*n+d*o+p*l,e[1]=u*s+d*a+p*h,e[2]=u*i+d*c+p*f,e[3]=g*n+m*o+_*l,e[4]=g*s+m*a+_*h,e[5]=g*i+m*c+_*f,e[6]=y*n+x*o+A*l,e[7]=y*s+x*a+A*h,e[8]=y*i+x*c+A*f,e}function yN(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=r[0],d=r[1];return e[0]=n,e[1]=s,e[2]=i,e[3]=o,e[4]=a,e[5]=c,e[6]=u*n+d*o+l,e[7]=u*s+d*a+h,e[8]=u*i+d*c+f,e}function AN(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=Math.sin(r),d=Math.cos(r);return e[0]=d*n+u*o,e[1]=d*s+u*a,e[2]=d*i+u*c,e[3]=d*o-u*n,e[4]=d*a-u*s,e[5]=d*c-u*i,e[6]=l,e[7]=h,e[8]=f,e}function DT(e,t,r){let n=r[0],s=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function TN(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=r+r,a=n+n,c=s+s,l=r*o,h=n*o,f=n*a,u=s*o,d=s*a,p=s*c,g=i*o,m=i*a,_=i*c;return e[0]=1-f-p,e[3]=h-_,e[6]=u+m,e[1]=h+_,e[4]=1-l-p,e[7]=d-g,e[2]=u-m,e[5]=d+g,e[8]=1-l-f,e}var kT;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"})(kT||(kT={}));var Wtt=Object.freeze([1,0,0,0,1,0,0,0,1]),as=class extends Qm{static get IDENTITY(){return jtt()}static get ZERO(){return Gtt()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return kT}constructor(t,...r){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):r.length>0?this.copy([t,...r]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(Wtt)}fromObject(t){return this.check()}fromQuaternion(t){return TN(this,t),this.check()}set(t,r,n,s,i,o,a,c,l){return this[0]=t,this[1]=r,this[2]=n,this[3]=s,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this.check()}setRowMajor(t,r,n,s,i,o,a,c,l){return this[0]=t,this[1]=s,this[2]=a,this[3]=r,this[4]=i,this[5]=c,this[6]=n,this[7]=o,this[8]=l,this.check()}determinant(){return xN(this)}transpose(){return mN(this,this),this.check()}invert(){return _N(this,this),this.check()}multiplyLeft(t){return FT(this,t,this),this.check()}multiplyRight(t){return FT(this,this,t),this.check()}rotate(t){return AN(this,this,t),this.check()}scale(t){return Array.isArray(t)?DT(this,this,t):DT(this,this,[t,t]),this.check()}translate(t){return yN(this,this,t),this.check()}transform(t,r){let n;switch(t.length){case 2:n=iN(r||[-0,-0],t,this);break;case 3:n=Zm(r||[-0,-0,-0],t,this);break;case 4:n=cN(r||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return nN(n,t.length),n}transformVector(t,r){return this.transform(t,r)}transformVector2(t,r){return this.transform(t,r)}transformVector3(t,r){return this.transform(t,r)}},t0,e0=null;function Gtt(){return t0||(t0=new as([0,0,0,0,0,0,0,0,0]),Object.freeze(t0)),t0}function jtt(){return e0||(e0=new as,Object.freeze(e0)),e0}var n0="KHR_texture_transform",qtt=n0,r0=new Co,Xtt=new as,Ytt=new as;async function $tt(e,t){if(!new At(e).hasExtension(n0)||!t.gltf?.loadBuffers)return;let s=e.json.materials||[];for(let i=0;i<s.length;i++)Ktt(i,e)}function Ktt(e,t){let r=t.json.materials?.[e],n=[r?.pbrMetallicRoughness?.baseColorTexture,r?.emissiveTexture,r?.normalTexture,r?.occlusionTexture,r?.pbrMetallicRoughness?.metallicRoughnessTexture],s=[];for(let i of n)i&&i?.extensions?.[n0]&&Ztt(t,e,i,s)}function Ztt(e,t,r,n){let s=Jtt(r,n);if(!s)return;let i=e.json.meshes||[];for(let o of i)for(let a of o.primitives){let c=a.material;Number.isFinite(c)&&t===c&&Qtt(e,a,s)}}function Jtt(e,t){let r=e.extensions?.[n0],{texCoord:n=0}=e,{texCoord:s=n}=r;if(!(t.findIndex(([o,a])=>o===n&&a===s)!==-1)){let o=ret(r);return n!==s&&(e.texCoord=s),t.push([n,s]),{originalTexCoord:n,texCoord:s,matrix:o}}return null}function Qtt(e,t,r){let{originalTexCoord:n,texCoord:s,matrix:i}=r,o=t.attributes[`TEXCOORD_${n}`];if(Number.isFinite(o)){let a=e.json.accessors?.[o];if(a&&a.bufferView){let c=e.json.bufferViews?.[a.bufferView];if(c){let{arrayBuffer:l,byteOffset:h}=e.buffers[c.buffer],f=(h||0)+(a.byteOffset||0)+(c.byteOffset||0),{ArrayType:u,length:d}=nc(a,c),p=zm[a.componentType],g=Um[a.type],m=c.byteStride||p*g,_=new Float32Array(d);for(let y=0;y<a.count;y++){let x=new u(l,f+y*m,2);r0.set(x[0],x[1],1),r0.transformByMatrix3(i),_.set([r0[0],r0[1]],y*g)}n===s?tet(a,c,e.buffers,_):eet(s,a,t,e,_)}}}}function tet(e,t,r,n){e.componentType=5126,r.push({arrayBuffer:n.buffer,byteOffset:0,byteLength:n.buffer.byteLength}),t.buffer=r.length-1,t.byteLength=n.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function eet(e,t,r,n,s){n.buffers.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength});let i=n.json.bufferViews;if(!i)return;i.push({buffer:n.buffers.length-1,byteLength:s.buffer.byteLength,byteOffset:0});let o=n.json.accessors;o&&(o.push({bufferView:i?.length-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),r.attributes[`TEXCOORD_${e}`]=o.length-1)}function ret(e){let{offset:t=[0,0],rotation:r=0,scale:n=[1,1]}=e,s=new as().set(1,0,0,0,1,0,t[0],t[1],1),i=Xtt.set(Math.cos(r),Math.sin(r),0,-Math.sin(r),Math.cos(r),0,0,0,1),o=Ytt.set(n[0],0,0,0,n[1],0,0,0,1);return s.multiplyRight(i).multiplyRight(o)}var zT={};Bt(zT,{decode:()=>set,encode:()=>iet,name:()=>net});var Po="KHR_lights_punctual",net=Po;async function set(e){let t=new At(e),{json:r}=t,n=t.getExtension(Po);n&&(t.json.lights=n.lights,t.removeExtension(Po));for(let s of r.nodes||[]){let i=t.getObjectExtension(s,Po);i&&(s.light=i.light),t.removeObjectExtension(s,Po)}}async function iet(e){let t=new At(e),{json:r}=t;if(r.lights){let n=t.addExtension(Po);fe(!n.lights),n.lights=r.lights,delete r.lights}if(t.json.lights){for(let n of t.json.lights){let s=n.node;t.addObjectExtension(s,Po,n)}delete t.json.lights}}var VT={};Bt(VT,{decode:()=>aet,encode:()=>cet,name:()=>oet});var iu="KHR_materials_unlit",oet=iu;async function aet(e){let t=new At(e),{json:r}=t;for(let n of r.materials||[])n.extensions&&n.extensions.KHR_materials_unlit&&(n.unlit=!0),t.removeObjectExtension(n,iu);t.removeExtension(iu)}function cet(e){let t=new At(e),{json:r}=t;if(t.materials)for(let n of r.materials||[])n.unlit&&(delete n.unlit,t.addObjectExtension(n,iu,{}),t.addExtension(iu))}var HT={};Bt(HT,{decode:()=>fet,encode:()=>uet,name:()=>het});var ou="KHR_techniques_webgl",het=ou;async function fet(e){let t=new At(e),{json:r}=t,n=t.getExtension(ou);if(n){let s=det(n,t);for(let i of r.materials||[]){let o=t.getObjectExtension(i,ou);o&&(i.technique=Object.assign({},o,s[o.technique]),i.technique.values=pet(i.technique,t)),t.removeObjectExtension(i,ou)}t.removeExtension(ou)}}async function uet(e,t){}function det(e,t){let{programs:r=[],shaders:n=[],techniques:s=[]}=e,i=new TextDecoder;return n.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=i.decode(t.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),r.forEach(o=>{o.fragmentShader=n[o.fragmentShader],o.vertexShader=n[o.vertexShader]}),s.forEach(o=>{o.program=r[o.program]}),s}function pet(e,t){let r=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach(n=>{e.uniforms[n].value&&!(n in r)&&(r[n]=e.uniforms[n].value)}),Object.keys(r).forEach(n=>{typeof r[n]=="object"&&r[n].index!==void 0&&(r[n].texture=t.getTexture(r[n].index))}),r}var MN=[xT,gT,ST,vT,wT,OT,zT,VT,HT,UT,yT];function EN(e,t={},r){let n=MN.filter(s=>SN(s.name,t));for(let s of n)s.preprocess?.(e,t,r)}async function bN(e,t={},r){let n=MN.filter(s=>SN(s.name,t));for(let s of n)await s.decode?.(e,t,r)}function SN(e,t){let r=t?.gltf?.excludeExtensions||{};return!(e in r&&!r[e])}var WT="KHR_binary_glTF";function vN(e){let t=new At(e),{json:r}=t;for(let n of r.images||[]){let s=t.getObjectExtension(n,WT);s&&Object.assign(n,s),t.removeObjectExtension(n,WT)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,t.removeExtension(WT)}var wN={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},met={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"},GT=class{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(t,r){this.json=t.json;let n=t.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${n.asset.version}`);return}if(!r.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),vN(t),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(let r in wN)this._convertTopLevelObjectToArray(t,r)}_convertTopLevelObjectToArray(t,r){let n=t[r];if(!(!n||Array.isArray(n))){t[r]=[];for(let s in n){let i=n[s];i.id=i.id||s;let o=t[r].length;t[r].push(i),this.idToIndexMap[r][s]=o}}}_convertObjectIdsToArrayIndices(t){for(let r in wN)this._convertIdsToIndices(t,r);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(let r of t.textures)this._convertTextureIds(r);for(let r of t.meshes)this._convertMeshIds(r);for(let r of t.nodes)this._convertNodeIds(r);for(let r of t.scenes)this._convertSceneIds(r)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(let r of t.primitives){let{attributes:n,indices:s,material:i}=r;for(let o in n)n[o]=this._convertIdToIndex(n[o],"accessor");s&&(r.indices=this._convertIdToIndex(s,"accessor")),i&&(r.material=this._convertIdToIndex(i,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(r=>this._convertIdToIndex(r,"node"))),t.meshes&&(t.meshes=t.meshes.map(r=>this._convertIdToIndex(r,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(r=>this._convertIdToIndex(r,"node")))}_convertIdsToIndices(t,r){t[r]||(console.warn(`gltf v1: json doesn't contain attribute ${r}`),t[r]=[]);for(let n of t[r])for(let s in n){let i=n[s],o=this._convertIdToIndex(i,s);n[s]=o}}_convertIdToIndex(t,r){let n=met[r];if(n in this.idToIndexMap){let s=this.idToIndexMap[n][t];if(!Number.isFinite(s))throw new Error(`gltf v1: failed to resolve ${r} with id ${t}`);return s}return t}_updateObjects(t){for(let r of this.json.buffers)delete r.type}_updateMaterial(t){for(let r of t.materials){r.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};let n=r.values?.tex||r.values?.texture2d_0||r.values?.diffuseTex,s=t.textures.findIndex(i=>i.id===n);s!==-1&&(r.pbrMetallicRoughness.baseColorTexture={index:s})}}};function CN(e,t={}){return new GT().normalize(e,t)}async function PN(e,t,r=0,n,s){return _et(e,t,r,n),CN(e,{normalize:n?.gltf?.normalize}),EN(e,n,s),n?.gltf?.loadBuffers&&e.json.buffers&&await xet(e,n,s),n?.gltf?.loadImages&&await yet(e,n,s),await bN(e,n,s),e}function _et(e,t,r,n){if(n.uri&&(e.baseUri=n.uri),t instanceof ArrayBuffer&&!WL(t,r,n)&&(t=new TextDecoder().decode(t)),typeof t=="string")e.json=N_(t);else if(t instanceof ArrayBuffer){let o={};r=jL(o,t,r,n.glb),fe(o.type==="glTF",`Invalid GLB magic string ${o.type}`),e._glb=o,e.json=o.json}else fe(!1,"GLTF: must be ArrayBuffer or string");let s=e.json.buffers||[];if(e.buffers=new Array(s.length).fill(null),e._glb&&e._glb.header.hasBinChunk){let{binChunks:o}=e._glb;e.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}let i=e.json.images||[];e.images=new Array(i.length).fill({})}async function xet(e,t,r){let n=e.json.buffers||[];for(let s=0;s<n.length;++s){let i=n[s];if(i.uri){let{fetch:o}=r;fe(o);let a=ET(i.uri,t),l=await(await r?.fetch?.(a))?.arrayBuffer?.();e.buffers[s]={arrayBuffer:l,byteOffset:0,byteLength:l.byteLength},delete i.uri}else e.buffers[s]===null&&(e.buffers[s]={arrayBuffer:new ArrayBuffer(i.byteLength),byteOffset:0,byteLength:i.byteLength})}}async function yet(e,t,r){let n=Aet(e),s=e.json.images||[],i=[];for(let o of n)i.push(Tet(e,s[o],o,t,r));return await Promise.all(i)}function Aet(e){let t=new Set,r=e.json.textures||[];for(let n of r)n.source!==void 0&&t.add(n.source);return Array.from(t).sort()}async function Tet(e,t,r,n,s){let i;if(t.uri&&!t.hasOwnProperty("bufferView")){let a=ET(t.uri,n),{fetch:c}=s;i=await(await c(a)).arrayBuffer(),t.bufferView={data:i}}if(Number.isFinite(t.bufferView)){let a=NL(e.json,e.buffers,t.bufferView);i=Pi(a.buffer,a.byteOffset,a.byteLength)}fe(i,"glTF image has no data");let o=await sr(i,[cn,hT],{...n,mimeType:t.mimeType,basis:n.basis||{format:Fm()}},s);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),e.images=e.images||[],e.images[r]=o}var cs={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:VL,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:Met,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function Met(e,t={},r){t={...cs.options,...t},t.gltf={...cs.options.gltf,...t.gltf};let{byteOffset:n=0}=t;return await PN({},e,n,t,r)}var Eet={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bet={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},vr={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},vet={magFilter:vr.TEXTURE_MAG_FILTER,minFilter:vr.TEXTURE_MIN_FILTER,wrapS:vr.TEXTURE_WRAP_S,wrapT:vr.TEXTURE_WRAP_T},wet={[vr.TEXTURE_MAG_FILTER]:vr.LINEAR,[vr.TEXTURE_MIN_FILTER]:vr.NEAREST_MIPMAP_LINEAR,[vr.TEXTURE_WRAP_S]:vr.REPEAT,[vr.TEXTURE_WRAP_T]:vr.REPEAT};function Cet(){return{id:"default-sampler",parameters:wet}}function Pet(e){return bet[e]}function Ret(e){return Eet[e]}var jT=class{baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(t,r={}){let{json:n,buffers:s=[],images:i=[]}=t,{baseUri:o=""}=t;return fe(n),this.baseUri=o,this.buffers=s,this.images=i,this.jsonUnprocessed=n,this.json=this._resolveTree(t.json,r),this.json}_resolveTree(t,r={}){let n={...t};return this.json=n,t.bufferViews&&(n.bufferViews=t.bufferViews.map((s,i)=>this._resolveBufferView(s,i))),t.images&&(n.images=t.images.map((s,i)=>this._resolveImage(s,i))),t.samplers&&(n.samplers=t.samplers.map((s,i)=>this._resolveSampler(s,i))),t.textures&&(n.textures=t.textures.map((s,i)=>this._resolveTexture(s,i))),t.accessors&&(n.accessors=t.accessors.map((s,i)=>this._resolveAccessor(s,i))),t.materials&&(n.materials=t.materials.map((s,i)=>this._resolveMaterial(s,i))),t.meshes&&(n.meshes=t.meshes.map((s,i)=>this._resolveMesh(s,i))),t.nodes&&(n.nodes=t.nodes.map((s,i)=>this._resolveNode(s,i)),n.nodes=n.nodes.map((s,i)=>this._resolveNodeChildren(s))),t.skins&&(n.skins=t.skins.map((s,i)=>this._resolveSkin(s,i))),t.scenes&&(n.scenes=t.scenes.map((s,i)=>this._resolveScene(s,i))),typeof this.json.scene=="number"&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}getScene(t){return this._get(this.json.scenes,t)}getNode(t){return this._get(this.json.nodes,t)}getSkin(t){return this._get(this.json.skins,t)}getMesh(t){return this._get(this.json.meshes,t)}getMaterial(t){return this._get(this.json.materials,t)}getAccessor(t){return this._get(this.json.accessors,t)}getCamera(t){return this._get(this.json.cameras,t)}getTexture(t){return this._get(this.json.textures,t)}getSampler(t){return this._get(this.json.samplers,t)}getImage(t){return this._get(this.json.images,t)}getBufferView(t){return this._get(this.json.bufferViews,t)}getBuffer(t){return this._get(this.json.buffers,t)}_get(t,r){if(typeof r=="object")return r;let n=t&&t[r];return n||console.warn(`glTF file error: Could not find ${t}[${r}]`),n}_resolveScene(t,r){return{...t,id:t.id||`scene-${r}`,nodes:(t.nodes||[]).map(n=>this.getNode(n))}}_resolveNode(t,r){let n={...t,id:t?.id||`node-${r}`};return t.mesh!==void 0&&(n.mesh=this.getMesh(t.mesh)),t.camera!==void 0&&(n.camera=this.getCamera(t.camera)),t.skin!==void 0&&(n.skin=this.getSkin(t.skin)),t.meshes!==void 0&&t.meshes.length&&(n.mesh=t.meshes.reduce((s,i)=>{let o=this.getMesh(i);return s.id=o.id,s.primitives=s.primitives.concat(o.primitives),s},{primitives:[]})),n}_resolveNodeChildren(t){return t.children&&(t.children=t.children.map(r=>this.getNode(r))),t}_resolveSkin(t,r){let n=typeof t.inverseBindMatrices=="number"?this.getAccessor(t.inverseBindMatrices):void 0;return{...t,id:t.id||`skin-${r}`,inverseBindMatrices:n}}_resolveMesh(t,r){let n={...t,id:t.id||`mesh-${r}`,primitives:[]};return t.primitives&&(n.primitives=t.primitives.map(s=>{let i={...s,attributes:{},indices:void 0,material:void 0},o=s.attributes;for(let a in o)i.attributes[a]=this.getAccessor(o[a]);return s.indices!==void 0&&(i.indices=this.getAccessor(s.indices)),s.material!==void 0&&(i.material=this.getMaterial(s.material)),i})),n}_resolveMaterial(t,r){let n={...t,id:t.id||`material-${r}`};if(n.normalTexture&&(n.normalTexture={...n.normalTexture},n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture={...n.occlusionTexture},n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture={...n.emissiveTexture},n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness={...n.pbrMetallicRoughness};let s=n.pbrMetallicRoughness;s.baseColorTexture&&(s.baseColorTexture={...s.baseColorTexture},s.baseColorTexture.texture=this.getTexture(s.baseColorTexture.index)),s.metallicRoughnessTexture&&(s.metallicRoughnessTexture={...s.metallicRoughnessTexture},s.metallicRoughnessTexture.texture=this.getTexture(s.metallicRoughnessTexture.index))}return n}_resolveAccessor(t,r){let n=Pet(t.componentType),s=Ret(t.type),i=n*s,o={...t,id:t.id||`accessor-${r}`,bytesPerComponent:n,components:s,bytesPerElement:i,value:void 0,bufferView:void 0,sparse:void 0};if(t.bufferView!==void 0&&(o.bufferView=this.getBufferView(t.bufferView)),o.bufferView){let a=o.bufferView.buffer,{ArrayType:c,byteLength:l}=nc(o,o.bufferView),h=(o.bufferView.byteOffset||0)+(o.byteOffset||0)+a.byteOffset,f=a.arrayBuffer.slice(h,h+l);o.bufferView.byteStride&&(f=this._getValueFromInterleavedBuffer(a,h,o.bufferView.byteStride,o.bytesPerElement,o.count)),o.value=new c(f)}return o}_getValueFromInterleavedBuffer(t,r,n,s,i){let o=new Uint8Array(i*s);for(let a=0;a<i;a++){let c=r+a*n;o.set(new Uint8Array(t.arrayBuffer.slice(c,c+s)),a*s)}return o.buffer}_resolveTexture(t,r){return{...t,id:t.id||`texture-${r}`,sampler:typeof t.sampler=="number"?this.getSampler(t.sampler):Cet(),source:typeof t.source=="number"?this.getImage(t.source):void 0}}_resolveSampler(t,r){let n={id:t.id||`sampler-${r}`,...t,parameters:{}};for(let s in n){let i=this._enumSamplerParameter(s);i!==void 0&&(n.parameters[i]=n[s])}return n}_enumSamplerParameter(t){return vet[t]}_resolveImage(t,r){let n={...t,id:t.id||`image-${r}`,image:null,bufferView:t.bufferView!==void 0?this.getBufferView(t.bufferView):void 0},s=this.images[r];return s&&(n.image=s),n}_resolveBufferView(t,r){let n=t.buffer,s=this.buffers[n].arrayBuffer,i=this.buffers[n].byteOffset||0;return t.byteOffset&&(i+=t.byteOffset),{id:`bufferView-${r}`,...t,buffer:this.buffers[n],data:new Uint8Array(s,i,t.byteLength)}}_resolveCamera(t,r){let n={...t,id:t.id||`camera-${r}`};return n.perspective,n.orthographic,n}};function Ro(e,t){return new jT().postProcess(e,t)}async function RN(e){let t=[];return e.scenes.forEach(r=>{r.traverse(n=>{Object.values(n.model.uniforms).forEach(s=>{s.loaded===!1&&t.push(s)})})}),await Iet(()=>t.some(r=>!r.loaded))}async function Iet(e){for(;e();)await new Promise(t=>requestAnimationFrame(t))}var IN=`uniform scenegraphUniforms {
    float sizeScale;
    float sizeMinPixels;
    float sizeMaxPixels;
    mat4 sceneModelMatrix;
    bool composeModelMatrix;
  } scenegraph;
  `,ON={name:"scenegraph",vs:IN,fs:IN,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}};var LN=`#version 300 es
  #define SHADER_NAME scenegraph-layer-vertex-shader
  in vec3 instancePositions;
  in vec3 instancePositions64Low;
  in vec4 instanceColors;
  in vec3 instancePickingColors;
  in vec3 instanceModelMatrixCol0;
  in vec3 instanceModelMatrixCol1;
  in vec3 instanceModelMatrixCol2;
  in vec3 instanceTranslation;
  in vec3 positions;
  #ifdef HAS_UV
  in vec2 texCoords;
  #endif
  #ifdef LIGHTING_PBR
  #ifdef HAS_NORMALS
  in vec3 normals;
  #endif
  #endif
  out vec4 vColor;
  #ifndef LIGHTING_PBR
  #ifdef HAS_UV
  out vec2 vTEXCOORD_0;
  #endif
  #endif
  void main(void) {
  #if defined(HAS_UV) && !defined(LIGHTING_PBR)
  vTEXCOORD_0 = texCoords;
  geometry.uv = texCoords;
  #endif
  geometry.worldPosition = instancePositions;
  geometry.pickingColor = instancePickingColors;
  mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
  vec3 normal = vec3(0.0, 0.0, 1.0);
  #ifdef LIGHTING_PBR
  #ifdef HAS_NORMALS
  normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
  #endif
  #endif
  float originalSize = project_size_to_pixel(scenegraph.sizeScale);
  float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
  vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
  if(scenegraph.composeModelMatrix) {
  DECKGL_FILTER_SIZE(pos, geometry);
  geometry.normal = project_normal(normal);
  geometry.worldPosition += pos;
  gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
  }
  else {
  pos = project_size(pos);
  DECKGL_FILTER_SIZE(pos, geometry);
  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
  geometry.normal = project_normal(normal);
  }
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  #ifdef LIGHTING_PBR
  pbr_vPosition = geometry.position.xyz;
  #ifdef HAS_NORMALS
  pbr_vNormal = geometry.normal;
  #endif
  #ifdef HAS_UV
  pbr_vUV = texCoords;
  #else
  pbr_vUV = vec2(0., 0.);
  #endif
  geometry.uv = pbr_vUV;
  #endif
  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);
  }
  `;var NN=`#version 300 es
  #define SHADER_NAME scenegraph-layer-fragment-shader
  in vec4 vColor;
  out vec4 fragColor;
  #ifndef LIGHTING_PBR
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
  in vec2 vTEXCOORD_0;
  uniform sampler2D pbr_baseColorSampler;
  #endif
  #endif
  void main(void) {
  #ifdef LIGHTING_PBR
  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  #else
  #if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
  fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
  geometry.uv = vTEXCOORD_0;
  #else
  fragColor = vColor;
  #endif
  #endif
  fragColor.a *= layer.opacity;
  DECKGL_FILTER_COLOR(fragColor, geometry);
  }
  `;var BN=[255,255,255,255],Oet={scenegraph:{type:"object",value:null,async:!0},getScene:e=>e&&e.scenes?typeof e.scene=="object"?e.scene:e.scenes[e.scene||0]:e,getAnimator:e=>e&&e.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:BN},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[cs]},au=class extends ut{getShaders(){let t={},r;this.props._lighting==="pbr"?(r=Hi,t.LIGHTING_PBR=1):r={name:"pbrMaterial"};let n=[st,Tt,ON,r];return super.getShaders({defines:t,vs:LN,fs:NN,modules:n})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:BN,transition:!0},instanceModelMatrix:Om})}updateState(t){super.updateState(t);let{props:r,oldProps:n}=t;r.scenegraph!==n.scenegraph?this._updateScenegraph():r._animations!==n._animations&&this._applyAnimationsProp(this.state.animator,r._animations)}finalizeState(t){super.finalizeState(t),this.state.scenegraph?.destroy()}get isLoaded(){return Boolean(this.state?.scenegraph&&super.isLoaded)}_updateScenegraph(){let t=this.props,{device:r}=this.context,n=null;if(t.scenegraph instanceof Er)n={scenes:[t.scenegraph]};else if(t.scenegraph&&typeof t.scenegraph=="object"){let a=t.scenegraph,c=a.json?Ro(a):a,l=pT(r,c,this._getModelOptions());n={gltf:c,...l},RN(l).then(()=>{this.setNeedsRedraw()}).catch(h=>{this.raiseError(h,"loading glTF")})}let s={layer:this,device:this.context.device},i=t.getScene(n,s),o=t.getAnimator(n,s);if(i instanceof lr){this.state.scenegraph?.destroy(),this._applyAnimationsProp(o,t._animations);let a=[];i.traverse(c=>{c instanceof pn&&a.push(c.model)}),this.setState({scenegraph:i,animator:o,models:a}),this.getAttributeManager().invalidateAll()}else i!==null&&k.warn("invalid scenegraph:",i)()}_applyAnimationsProp(t,r){if(!t||!r)return;let n=t.getAnimations();Object.keys(r).sort().forEach(s=>{let i=r[s];if(s==="*")n.forEach(o=>{Object.assign(o,i)});else if(Number.isFinite(Number(s))){let o=Number(s);o>=0&&o<n.length?Object.assign(n[o],i):k.warn(`animation ${s} not found`)()}else{let o=n.find(({name:a})=>a===s);o?Object.assign(o,i):k.warn(`animation ${s} not found`)()}})}_getModelOptions(){let{_imageBasedLightingEnvironment:t}=this.props,r;return t&&(typeof t=="function"?r=t({gl:this.context.gl,layer:this}):r=t),{imageBasedLightingEnvironment:r,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:t}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(t.timeline.getTime()),this.setNeedsRedraw());let{viewport:r,renderPass:n}=this.context,{sizeScale:s,sizeMinPixels:i,sizeMaxPixels:o,coordinateSystem:a}=this.props,c=this.getNumInstances();this.state.scenegraph.traverse((l,{worldMatrix:h})=>{if(l instanceof pn){let{model:f}=l;f.setInstanceCount(c);let u={camera:f.uniforms.cameraPosition},d={sizeScale:s,sizeMinPixels:i,sizeMaxPixels:o,composeModelMatrix:Lm(r,a),sceneModelMatrix:h};f.shaderInputs.setProps({pbrProjection:u,scenegraph:d}),f.draw(n)}})}};au.defaultProps=Oet;au.layerName="ScenegraphLayer";var s0=au;var FN=`uniform meshUniforms {
    bool pickFeatureIds;
  } mesh;
  `,DN={name:"mesh",vs:FN,fs:FN,uniformTypes:{pickFeatureIds:"f32"}};var kN=`#version 300 es
  #define SHADER_NAME simple-mesh-layer-vs
  in vec3 positions;
  in vec3 normals;
  in vec3 colors;
  in vec2 texCoords;
  in vec4 uvRegions;
  in vec3 featureIdsPickingColors;
  in vec4 instanceColors;
  in vec3 instancePickingColors;
  in vec3 instanceModelMatrixCol0;
  in vec3 instanceModelMatrixCol1;
  in vec3 instanceModelMatrixCol2;
  out vec2 vTexCoord;
  out vec3 cameraPosition;
  out vec3 normals_commonspace;
  out vec4 position_commonspace;
  out vec4 vColor;
  vec2 applyUVRegion(vec2 uv) {
  #ifdef HAS_UV_REGIONS
  return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
  #else
  return uv;
  #endif
  }
  void main(void) {
  vec2 uv = applyUVRegion(texCoords);
  geometry.uv = uv;
  if (mesh.pickFeatureIds) {
  geometry.pickingColor = featureIdsPickingColors;
  } else {
  geometry.pickingColor = instancePickingColors;
  }
  mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
  vTexCoord = uv;
  cameraPosition = project.cameraPosition;
  vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
  vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;
  vec3 projectedPosition = project_position(positions);
  position_commonspace = vec4(projectedPosition, 1.0);
  gl_Position = project_common_position_to_clipspace(position_commonspace);
  geometry.position = position_commonspace;
  normals_commonspace = project_normal(instanceModelMatrix * normals);
  geometry.normal = normals_commonspace;
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  #ifdef MODULE_PBRMATERIAL
  pbr_vPosition = geometry.position.xyz;
  #ifdef HAS_NORMALS
  pbr_vNormal = geometry.normal;
  #endif
  #ifdef HAS_UV
  pbr_vUV = uv;
  #else
  pbr_vUV = vec2(0., 0.);
  #endif
  geometry.uv = pbr_vUV;
  #endif
  DECKGL_FILTER_COLOR(vColor, geometry);
  }
  `;var UN=`#version 300 es
  #define SHADER_NAME simple-mesh-layer-fs
  precision highp float;
  uniform sampler2D sampler;
  in vec2 vTexCoord;
  in vec3 cameraPosition;
  in vec3 normals_commonspace;
  in vec4 position_commonspace;
  in vec4 vColor;
  out vec4 fragColor;
  void main(void) {
  #ifdef MODULE_PBRMATERIAL
  fragColor = vColor * pbr_filterColor(vec4(0));
  geometry.uv = pbr_vUV;
  fragColor.a *= layer.opacity;
  #else
  geometry.uv = vTexCoord;
  vec3 normal;
  if (simpleMesh.flatShading) {
  normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
  } else {
  normal = normals_commonspace;
  }
  vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
  vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
  fragColor = vec4(lightColor, color.a * layer.opacity);
  #endif
  DECKGL_FILTER_COLOR(fragColor, geometry);
  }
  `;function Let(e){let t=e.positions||e.POSITION,r=t.value.length/t.size;e.COLOR_0||e.colors||(e.colors={size:4,value:new Uint8Array(r*4).fill(255),normalized:!0})}var Net={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}},cu=class extends So{getShaders(){let t=super.getShaders();return t.modules.push(Hi,DN),{...t,vs:kN,fs:UN}}initializeState(){let{featureIds:t}=this.props;super.initializeState();let r=this.getAttributeManager();t&&r.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(t){super.updateState(t);let{props:r,oldProps:n}=t;r.pbrMaterial!==n.pbrMaterial&&this.updatePbrMaterialUniforms(r.pbrMaterial)}draw(t){let{featureIds:r}=this.props,{model:n}=this.state;if(!n)return;let s={pickFeatureIds:Boolean(r)},i={camera:n.uniforms.cameraPosition};n.shaderInputs.setProps({pbrProjection:i,mesh:s}),super.draw(t)}getModel(t){let{id:r}=this.props,n=this.parseMaterial(this.props.pbrMaterial,t);this.setState({parsedPBRMaterial:n});let s=this.getShaders();return Let(t.attributes),new Y(this.context.device,{...this.getShaders(),id:r,geometry:t,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...s.defines,...n?.defines,HAS_UV_REGIONS:t.attributes.uvRegions?1:0},parameters:n?.parameters,isInstanced:!0})}updatePbrMaterialUniforms(t){let{model:r}=this.state;if(r){let{mesh:n}=this.props,s=this.parseMaterial(t,n);this.setState({parsedPBRMaterial:s});let{pbr_baseColorSampler:i}=s.bindings,{emptyTexture:o}=this.state,a={sampler:i||o,hasTexture:Boolean(i)},{camera:c,...l}={...s.bindings,...s.uniforms};r.shaderInputs.setProps({simpleMesh:a,pbrMaterial:l})}}parseMaterial(t,r){let n=Boolean(t.pbrMetallicRoughness&&t.pbrMetallicRoughness.baseColorTexture);return eu(this.context.device,{unlit:n,...t},{NORMAL:r.attributes.normals,TEXCOORD_0:r.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(t){let r=this.props.featureIds,n=new Uint8ClampedArray(r.length*t.size),s=[];for(let i=0;i<r.length;i++)this.encodePickingColor(r[i],s),n[i*3]=s[0],n[i*3+1]=s[1],n[i*3+2]=s[2];t.value=n}finalizeState(t){super.finalizeState(t),this.state.parsedPBRMaterial?.generatedTextures.forEach(r=>r.destroy()),this.setState({parsedPBRMaterial:null})}};cu.layerName="MeshLayer";cu.defaultProps=Net;var zN=cu;var Bet=1/Math.PI*180,NVt=1/180*Math.PI,Fet={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...Fet}};var Qt=globalThis.mathgl.config;function qT(e,{precision:t=Qt.precision}={}){return e=Det(e),`${parseFloat(e.toPrecision(t))}`}function vn(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function wr(e,t){return Uet(e,r=>r*Bet,t)}function i0(e,t,r){let n=Qt.EPSILON;r&&(Qt.EPSILON=r);try{if(e===t)return!0;if(vn(e)&&vn(t)){if(e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(!i0(e[s],t[s]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=Qt.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{Qt.EPSILON=n}}function Det(e){return Math.round(e/Qt.EPSILON)*Qt.EPSILON}function ket(e){return e.clone?e.clone():new Array(e.length)}function Uet(e,t,r){if(vn(e)){let n=e;r=r||ket(n);for(let s=0;s<r.length&&s<n.length;++s){let i=typeof e=="number"?e:e[s];r[s]=t(i,s,r)}return r}return t(e)}var hi=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,r=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+r];return this.check()}toArray(t=[],r=0){for(let n=0;n<this.ELEMENTS;++n)t[r+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:vn(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Qt)}formatString(t){let r="";for(let n=0;n<this.ELEMENTS;++n)r+=(n>0?", ":"")+qT(this[n],t);return`${t.printTypes?this.constructor.name:""}[${r}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!i0(this[r],t[r]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==t[r])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,r,n){if(n===void 0)return this.lerp(this,t,r);for(let s=0;s<this.ELEMENTS;++s){let i=t[s],o=typeof r=="number"?r:r[s];this[s]=i+n*(o-i)}return this.check()}min(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(t[r],this[r]);return this.check()}max(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(t[r],this[r]);return this.check()}clamp(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),r[n]);return this.check()}add(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]+=r[n];return this.check()}subtract(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]-=r[n];return this.check()}scale(t){if(typeof t=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;else for(let r=0;r<this.ELEMENTS&&r<t.length;++r)this[r]*=t[r];return this.check()}multiplyByScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}check(){if(Qt.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)t=t&&Number.isFinite(this[r]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=t;return this.check()}addScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),r);return this.check()}get elements(){return this}};function zet(e,t){if(e.length!==t)return!1;for(let r=0;r<e.length;++r)if(!Number.isFinite(e[r]))return!1;return!0}function dt(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function fi(e,t,r=""){if(Qt.debug&&!zet(e,t))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return e}function XT(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}var uc=class extends hi{get x(){return this[0]}set x(t){this[0]=dt(t)}get y(){return this[1]}set y(t){this[1]=dt(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*this[r];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let r=0;for(let n=0;n<this.ELEMENTS;++n){let s=this[n]-t[n];r+=s*s}return dt(r)}dot(t){let r=0;for(let n=0;n<this.ELEMENTS;++n)r+=this[n]*t[n];return dt(r)}normalize(){let t=this.magnitude();if(t!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t;return this.check()}multiply(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]*=r[n];return this.check()}divide(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]/=r[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return XT(t>=0&&t<this.ELEMENTS,"index is out of range"),dt(this[t])}setComponent(t,r){return XT(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=r,this.check()}addVectors(t,r){return this.copy(t).add(r)}subVectors(t,r){return this.copy(t).subtract(r)}multiplyVectors(t,r){return this.copy(t).multiply(r)}addScaledVector(t,r){return this.add(new this.constructor(t).multiplyScalar(r))}};var Le=typeof Float32Array<"u"?Float32Array:Array;var jVt=Math.PI/180;function Vet(){let e=new Le(2);return Le!=Float32Array&&(e[0]=0,e[1]=0),e}function WN(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[3]*s+r[6],e[1]=r[1]*n+r[4]*s+r[7],e}function GN(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[4]*s+r[12],e[1]=r[1]*n+r[5]*s+r[13],e}var qVt=function(){let e=Vet();return function(t,r,n,s,i,o){let a,c;for(r||(r=2),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],i(e,e,o),t[a]=e[0],t[a+1]=e[1];return t}}();function jN(e,t,r){let n=t[0],s=t[1],i=r[3]*n+r[7]*s||1;return e[0]=(r[0]*n+r[4]*s)/i,e[1]=(r[1]*n+r[5]*s)/i,e}function o0(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[3]*n+r[7]*s+r[11]*i||1;return e[0]=(r[0]*n+r[4]*s+r[8]*i)/o,e[1]=(r[1]*n+r[5]*s+r[9]*i)/o,e[2]=(r[2]*n+r[6]*s+r[10]*i)/o,e}function qN(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[2]*s,e[1]=r[1]*n+r[3]*s,e[2]=t[2],e}function XN(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[2]*s,e[1]=r[1]*n+r[3]*s,e[2]=t[2],e[3]=t[3],e}function a0(e,t,r){let n=t[0],s=t[1],i=t[2];return e[0]=r[0]*n+r[3]*s+r[6]*i,e[1]=r[1]*n+r[4]*s+r[7]*i,e[2]=r[2]*n+r[5]*s+r[8]*i,e[3]=t[3],e}function YT(){let e=new Le(3);return Le!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Het(e){let t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function $T(e,t,r){let n=new Le(3);return n[0]=e,n[1]=t,n[2]=r,n}function YN(e,t){let r=t[0],n=t[1],s=t[2],i=r*r+n*n+s*s;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function KT(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function dc(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[0],a=r[1],c=r[2];return e[0]=s*c-i*a,e[1]=i*o-n*c,e[2]=n*a-s*o,e}function pc(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[3]*n+r[7]*s+r[11]*i+r[15];return o=o||1,e[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/o,e[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/o,e[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/o,e}function c0(e,t,r){let n=t[0],s=t[1],i=t[2];return e[0]=n*r[0]+s*r[3]+i*r[6],e[1]=n*r[1]+s*r[4]+i*r[7],e[2]=n*r[2]+s*r[5]+i*r[8],e}function l0(e,t,r){let n=r[0],s=r[1],i=r[2],o=r[3],a=t[0],c=t[1],l=t[2],h=s*l-i*c,f=i*a-n*l,u=n*c-s*a,d=s*u-i*f,p=i*h-n*u,g=n*f-s*h,m=o*2;return h*=m,f*=m,u*=m,d*=2,p*=2,g*=2,e[0]=a+h+d,e[1]=c+f+p,e[2]=l+u+g,e}function $N(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[0],i[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),i[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function KN(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),i[1]=s[1],i[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function ZN(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),i[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),i[2]=s[2],e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function JN(e,t){let r=e[0],n=e[1],s=e[2],i=t[0],o=t[1],a=t[2],c=Math.sqrt((r*r+n*n+s*s)*(i*i+o*o+a*a)),l=c&&KT(e,t)/c;return Math.acos(Math.min(Math.max(l,-1),1))}var QN=Het;var $Vt=function(){let e=YT();return function(t,r,n,s,i,o){let a,c;for(r||(r=3),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}}();var ZT=[0,0,0],h0,q=class extends uc{static get ZERO(){return h0||(h0=new q(0,0,0),Object.freeze(h0)),h0}constructor(t=0,r=0,n=0){super(-0,-0,-0),arguments.length===1&&vn(t)?this.copy(t):(Qt.debug&&(dt(t),dt(r),dt(n)),this[0]=t,this[1]=r,this[2]=n)}set(t,r,n){return this[0]=t,this[1]=r,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return Qt.debug&&(dt(t.x),dt(t.y),dt(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=dt(t)}angle(t){return JN(this,t)}cross(t){return dc(this,this,t),this.check()}rotateX({radians:t,origin:r=ZT}){return $N(this,this,r,t),this.check()}rotateY({radians:t,origin:r=ZT}){return KN(this,this,r,t),this.check()}rotateZ({radians:t,origin:r=ZT}){return ZN(this,this,r,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return pc(this,this,t),this.check()}transformAsVector(t){return o0(this,this,t),this.check()}transformByMatrix3(t){return c0(this,this,t),this.check()}transformByMatrix2(t){return qN(this,this,t),this.check()}transformByQuaternion(t){return l0(this,this,t),this.check()}};var f0,gc=class extends uc{static get ZERO(){return f0||(f0=new gc(0,0,0,0),Object.freeze(f0)),f0}constructor(t=0,r=0,n=0,s=0){super(-0,-0,-0,-0),vn(t)&&arguments.length===1?this.copy(t):(Qt.debug&&(dt(t),dt(r),dt(n),dt(s)),this[0]=t,this[1]=r,this[2]=n,this[3]=s)}set(t,r,n,s){return this[0]=t,this[1]=r,this[2]=n,this[3]=s,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return Qt.debug&&(dt(t.x),dt(t.y),dt(t.z),dt(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=dt(t)}get w(){return this[3]}set w(t){this[3]=dt(t)}transform(t){return pc(this,this,t),this.check()}transformByMatrix3(t){return a0(this,this,t),this.check()}transformByMatrix2(t){return XN(this,this,t),this.check()}transformByQuaternion(t){return l0(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}};var mc=class extends hi{toString(){let t="[";if(Qt.printRowMajor){t+="row-major:";for(let r=0;r<this.RANK;++r)for(let n=0;n<this.RANK;++n)t+=` ${this[n*this.RANK+r]}`}else{t+="column-major:";for(let r=0;r<this.ELEMENTS;++r)t+=` ${this[r]}`}return t+="]",t}getElementIndex(t,r){return r*this.RANK+t}getElement(t,r){return this[r*this.RANK+t]}setElement(t,r,n){return this[r*this.RANK+t]=dt(n),this}getColumn(t,r=new Array(this.RANK).fill(-0)){let n=t*this.RANK;for(let s=0;s<this.RANK;++s)r[s]=this[n+s];return r}setColumn(t,r){let n=t*this.RANK;for(let s=0;s<this.RANK;++s)this[n+s]=r[s];return this}};function tB(){let e=new Le(9);return Le!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function eB(e,t){if(e===t){let r=t[1],n=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function rB(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=t[4],a=t[5],c=t[6],l=t[7],h=t[8],f=h*o-a*l,u=-h*i+a*c,d=l*i-o*c,p=r*f+n*u+s*d;return p?(p=1/p,e[0]=f*p,e[1]=(-h*n+s*l)*p,e[2]=(a*n-s*o)*p,e[3]=u*p,e[4]=(h*r-s*c)*p,e[5]=(-a*r+s*i)*p,e[6]=d*p,e[7]=(-l*r+n*c)*p,e[8]=(o*r-n*i)*p,e):null}function nB(e){let t=e[0],r=e[1],n=e[2],s=e[3],i=e[4],o=e[5],a=e[6],c=e[7],l=e[8];return t*(l*i-o*c)+r*(-l*s+o*a)+n*(c*s-i*a)}function JT(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=r[0],d=r[1],p=r[2],g=r[3],m=r[4],_=r[5],y=r[6],x=r[7],A=r[8];return e[0]=u*n+d*o+p*l,e[1]=u*s+d*a+p*h,e[2]=u*i+d*c+p*f,e[3]=g*n+m*o+_*l,e[4]=g*s+m*a+_*h,e[5]=g*i+m*c+_*f,e[6]=y*n+x*o+A*l,e[7]=y*s+x*a+A*h,e[8]=y*i+x*c+A*f,e}function sB(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=r[0],d=r[1];return e[0]=n,e[1]=s,e[2]=i,e[3]=o,e[4]=a,e[5]=c,e[6]=u*n+d*o+l,e[7]=u*s+d*a+h,e[8]=u*i+d*c+f,e}function iB(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=Math.sin(r),d=Math.cos(r);return e[0]=d*n+u*o,e[1]=d*s+u*a,e[2]=d*i+u*c,e[3]=d*o-u*n,e[4]=d*a-u*s,e[5]=d*c-u*i,e[6]=l,e[7]=h,e[8]=f,e}function QT(e,t,r){let n=r[0],s=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function oB(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=r+r,a=n+n,c=s+s,l=r*o,h=n*o,f=n*a,u=s*o,d=s*a,p=s*c,g=i*o,m=i*a,_=i*c;return e[0]=1-f-p,e[3]=h-_,e[6]=u+m,e[1]=h+_,e[4]=1-l-p,e[7]=d-g,e[2]=u-m,e[5]=d+g,e[8]=1-l-f,e}var tM;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"})(tM||(tM={}));var jet=Object.freeze([1,0,0,0,1,0,0,0,1]),Io=class extends mc{static get IDENTITY(){return Xet()}static get ZERO(){return qet()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return tM}constructor(t,...r){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):r.length>0?this.copy([t,...r]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(jet)}fromObject(t){return this.check()}fromQuaternion(t){return oB(this,t),this.check()}set(t,r,n,s,i,o,a,c,l){return this[0]=t,this[1]=r,this[2]=n,this[3]=s,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this.check()}setRowMajor(t,r,n,s,i,o,a,c,l){return this[0]=t,this[1]=s,this[2]=a,this[3]=r,this[4]=i,this[5]=c,this[6]=n,this[7]=o,this[8]=l,this.check()}determinant(){return nB(this)}transpose(){return eB(this,this),this.check()}invert(){return rB(this,this),this.check()}multiplyLeft(t){return JT(this,t,this),this.check()}multiplyRight(t){return JT(this,this,t),this.check()}rotate(t){return iB(this,this,t),this.check()}scale(t){return Array.isArray(t)?QT(this,this,t):QT(this,this,[t,t]),this.check()}translate(t){return sB(this,this,t),this.check()}transform(t,r){let n;switch(t.length){case 2:n=WN(r||[-0,-0],t,this);break;case 3:n=c0(r||[-0,-0,-0],t,this);break;case 4:n=a0(r||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return fi(n,t.length),n}transformVector(t,r){return this.transform(t,r)}transformVector2(t,r){return this.transform(t,r)}transformVector3(t,r){return this.transform(t,r)}},u0,d0=null;function qet(){return u0||(u0=new Io([0,0,0,0,0,0,0,0,0]),Object.freeze(u0)),u0}function Xet(){return d0||(d0=new Io,Object.freeze(d0)),d0}function Yet(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function aB(e,t){if(e===t){let r=t[1],n=t[2],s=t[3],i=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=i,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function cB(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=t[4],a=t[5],c=t[6],l=t[7],h=t[8],f=t[9],u=t[10],d=t[11],p=t[12],g=t[13],m=t[14],_=t[15],y=r*a-n*o,x=r*c-s*o,A=r*l-i*o,M=n*c-s*a,E=n*l-i*a,w=s*l-i*c,v=h*g-f*p,b=h*m-u*p,T=h*_-d*p,I=f*m-u*g,N=f*_-d*g,B=u*_-d*m,C=y*B-x*N+A*I+M*T-E*b+w*v;return C?(C=1/C,e[0]=(a*B-c*N+l*I)*C,e[1]=(s*N-n*B-i*I)*C,e[2]=(g*w-m*E+_*M)*C,e[3]=(u*E-f*w-d*M)*C,e[4]=(c*T-o*B-l*b)*C,e[5]=(r*B-s*T+i*b)*C,e[6]=(m*A-p*w-_*x)*C,e[7]=(h*w-u*A+d*x)*C,e[8]=(o*N-a*T+l*v)*C,e[9]=(n*T-r*N-i*v)*C,e[10]=(p*E-g*A+_*y)*C,e[11]=(f*A-h*E-d*y)*C,e[12]=(a*b-o*I-c*v)*C,e[13]=(r*I-n*b+s*v)*C,e[14]=(g*x-p*M-m*y)*C,e[15]=(h*M-f*x+u*y)*C,e):null}function lB(e){let t=e[0],r=e[1],n=e[2],s=e[3],i=e[4],o=e[5],a=e[6],c=e[7],l=e[8],h=e[9],f=e[10],u=e[11],d=e[12],p=e[13],g=e[14],m=e[15],_=t*o-r*i,y=t*a-n*i,x=r*a-n*o,A=l*p-h*d,M=l*g-f*d,E=h*g-f*p,w=t*E-r*M+n*A,v=i*E-o*M+a*A,b=l*x-h*y+f*_,T=d*x-p*y+g*_;return c*w-s*v+m*b-u*T}function eM(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=t[9],d=t[10],p=t[11],g=t[12],m=t[13],_=t[14],y=t[15],x=r[0],A=r[1],M=r[2],E=r[3];return e[0]=x*n+A*a+M*f+E*g,e[1]=x*s+A*c+M*u+E*m,e[2]=x*i+A*l+M*d+E*_,e[3]=x*o+A*h+M*p+E*y,x=r[4],A=r[5],M=r[6],E=r[7],e[4]=x*n+A*a+M*f+E*g,e[5]=x*s+A*c+M*u+E*m,e[6]=x*i+A*l+M*d+E*_,e[7]=x*o+A*h+M*p+E*y,x=r[8],A=r[9],M=r[10],E=r[11],e[8]=x*n+A*a+M*f+E*g,e[9]=x*s+A*c+M*u+E*m,e[10]=x*i+A*l+M*d+E*_,e[11]=x*o+A*h+M*p+E*y,x=r[12],A=r[13],M=r[14],E=r[15],e[12]=x*n+A*a+M*f+E*g,e[13]=x*s+A*c+M*u+E*m,e[14]=x*i+A*l+M*d+E*_,e[15]=x*o+A*h+M*p+E*y,e}function hB(e,t,r){let n=r[0],s=r[1],i=r[2],o,a,c,l,h,f,u,d,p,g,m,_;return t===e?(e[12]=t[0]*n+t[4]*s+t[8]*i+t[12],e[13]=t[1]*n+t[5]*s+t[9]*i+t[13],e[14]=t[2]*n+t[6]*s+t[10]*i+t[14],e[15]=t[3]*n+t[7]*s+t[11]*i+t[15]):(o=t[0],a=t[1],c=t[2],l=t[3],h=t[4],f=t[5],u=t[6],d=t[7],p=t[8],g=t[9],m=t[10],_=t[11],e[0]=o,e[1]=a,e[2]=c,e[3]=l,e[4]=h,e[5]=f,e[6]=u,e[7]=d,e[8]=p,e[9]=g,e[10]=m,e[11]=_,e[12]=o*n+h*s+p*i+t[12],e[13]=a*n+f*s+g*i+t[13],e[14]=c*n+u*s+m*i+t[14],e[15]=l*n+d*s+_*i+t[15]),e}function fB(e,t,r){let n=r[0],s=r[1],i=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function uB(e,t,r,n){let s=n[0],i=n[1],o=n[2],a=Math.sqrt(s*s+i*i+o*o),c,l,h,f,u,d,p,g,m,_,y,x,A,M,E,w,v,b,T,I,N,B,C,V;return a<1e-6?null:(a=1/a,s*=a,i*=a,o*=a,l=Math.sin(r),c=Math.cos(r),h=1-c,f=t[0],u=t[1],d=t[2],p=t[3],g=t[4],m=t[5],_=t[6],y=t[7],x=t[8],A=t[9],M=t[10],E=t[11],w=s*s*h+c,v=i*s*h+o*l,b=o*s*h-i*l,T=s*i*h-o*l,I=i*i*h+c,N=o*i*h+s*l,B=s*o*h+i*l,C=i*o*h-s*l,V=o*o*h+c,e[0]=f*w+g*v+x*b,e[1]=u*w+m*v+A*b,e[2]=d*w+_*v+M*b,e[3]=p*w+y*v+E*b,e[4]=f*T+g*I+x*N,e[5]=u*T+m*I+A*N,e[6]=d*T+_*I+M*N,e[7]=p*T+y*I+E*N,e[8]=f*B+g*C+x*V,e[9]=u*B+m*C+A*V,e[10]=d*B+_*C+M*V,e[11]=p*B+y*C+E*V,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function dB(e,t,r){let n=Math.sin(r),s=Math.cos(r),i=t[4],o=t[5],a=t[6],c=t[7],l=t[8],h=t[9],f=t[10],u=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*s+l*n,e[5]=o*s+h*n,e[6]=a*s+f*n,e[7]=c*s+u*n,e[8]=l*s-i*n,e[9]=h*s-o*n,e[10]=f*s-a*n,e[11]=u*s-c*n,e}function pB(e,t,r){let n=Math.sin(r),s=Math.cos(r),i=t[0],o=t[1],a=t[2],c=t[3],l=t[8],h=t[9],f=t[10],u=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*s-l*n,e[1]=o*s-h*n,e[2]=a*s-f*n,e[3]=c*s-u*n,e[8]=i*n+l*s,e[9]=o*n+h*s,e[10]=a*n+f*s,e[11]=c*n+u*s,e}function gB(e,t,r){let n=Math.sin(r),s=Math.cos(r),i=t[0],o=t[1],a=t[2],c=t[3],l=t[4],h=t[5],f=t[6],u=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*s+l*n,e[1]=o*s+h*n,e[2]=a*s+f*n,e[3]=c*s+u*n,e[4]=l*s-i*n,e[5]=h*s-o*n,e[6]=f*s-a*n,e[7]=u*s-c*n,e}function mB(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=r+r,a=n+n,c=s+s,l=r*o,h=n*o,f=n*a,u=s*o,d=s*a,p=s*c,g=i*o,m=i*a,_=i*c;return e[0]=1-f-p,e[1]=h+_,e[2]=u-m,e[3]=0,e[4]=h-_,e[5]=1-l-p,e[6]=d+g,e[7]=0,e[8]=u+m,e[9]=d-g,e[10]=1-l-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _B(e,t,r,n,s,i,o){let a=1/(r-t),c=1/(s-n),l=1/(i-o);return e[0]=i*2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i*2*c,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(s+n)*c,e[10]=(o+i)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*l,e[15]=0,e}function $et(e,t,r,n,s){let i=1/Math.tan(t/2);if(e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0){let o=1/(n-s);e[10]=(s+n)*o,e[14]=2*s*n*o}else e[10]=-1,e[14]=-2*n;return e}var xB=$et;function Ket(e,t,r,n,s,i,o){let a=1/(t-r),c=1/(n-s),l=1/(i-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*a,e[13]=(s+n)*c,e[14]=(o+i)*l,e[15]=1,e}var yB=Ket;function AB(e,t,r,n){let s,i,o,a,c,l,h,f,u,d,p=t[0],g=t[1],m=t[2],_=n[0],y=n[1],x=n[2],A=r[0],M=r[1],E=r[2];return Math.abs(p-A)<1e-6&&Math.abs(g-M)<1e-6&&Math.abs(m-E)<1e-6?Yet(e):(f=p-A,u=g-M,d=m-E,s=1/Math.sqrt(f*f+u*u+d*d),f*=s,u*=s,d*=s,i=y*d-x*u,o=x*f-_*d,a=_*u-y*f,s=Math.sqrt(i*i+o*o+a*a),s?(s=1/s,i*=s,o*=s,a*=s):(i=0,o=0,a=0),c=u*a-d*o,l=d*i-f*a,h=f*o-u*i,s=Math.sqrt(c*c+l*l+h*h),s?(s=1/s,c*=s,l*=s,h*=s):(c=0,l=0,h=0),e[0]=i,e[1]=c,e[2]=f,e[3]=0,e[4]=o,e[5]=l,e[6]=u,e[7]=0,e[8]=a,e[9]=h,e[10]=d,e[11]=0,e[12]=-(i*p+o*g+a*m),e[13]=-(c*p+l*g+h*m),e[14]=-(f*p+u*g+d*m),e[15]=1,e)}function Zet(){let e=new Le(4);return Le!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function TB(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function MB(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function EB(e){let t=e[0],r=e[1],n=e[2],s=e[3];return Math.sqrt(t*t+r*r+n*n+s*s)}function bB(e){let t=e[0],r=e[1],n=e[2],s=e[3];return t*t+r*r+n*n+s*s}function SB(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=r*r+n*n+s*s+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=n*o,e[2]=s*o,e[3]=i*o,e}function vB(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function wB(e,t,r,n){let s=t[0],i=t[1],o=t[2],a=t[3];return e[0]=s+n*(r[0]-s),e[1]=i+n*(r[1]-i),e[2]=o+n*(r[2]-o),e[3]=a+n*(r[3]-a),e}function CB(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3];return e[0]=r[0]*n+r[4]*s+r[8]*i+r[12]*o,e[1]=r[1]*n+r[5]*s+r[9]*i+r[13]*o,e[2]=r[2]*n+r[6]*s+r[10]*i+r[14]*o,e[3]=r[3]*n+r[7]*s+r[11]*i+r[15]*o,e}function PB(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[0],a=r[1],c=r[2],l=r[3],h=l*n+a*i-c*s,f=l*s+c*n-o*i,u=l*i+o*s-a*n,d=-o*n-a*s-c*i;return e[0]=h*l+d*-o+f*-c-u*-a,e[1]=f*l+d*-a+u*-o-h*-c,e[2]=u*l+d*-c+h*-a-f*-o,e[3]=t[3],e}var A9t=function(){let e=Zet();return function(t,r,n,s,i,o){let a,c;for(r||(r=4),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}();var sM;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(sM||(sM={}));var Qet=45*Math.PI/180,trt=1,rM=.1,nM=500,ert=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),wt=class extends mc{static get IDENTITY(){return nrt()}static get ZERO(){return rrt()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return sM}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,r,n,s,i,o,a,c,l,h,f,u,d,p,g,m){return this[0]=t,this[1]=r,this[2]=n,this[3]=s,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this[9]=h,this[10]=f,this[11]=u,this[12]=d,this[13]=p,this[14]=g,this[15]=m,this.check()}setRowMajor(t,r,n,s,i,o,a,c,l,h,f,u,d,p,g,m){return this[0]=t,this[1]=i,this[2]=l,this[3]=d,this[4]=r,this[5]=o,this[6]=h,this[7]=p,this[8]=n,this[9]=a,this[10]=f,this[11]=g,this[12]=s,this[13]=c,this[14]=u,this[15]=m,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(ert)}fromObject(t){return this.check()}fromQuaternion(t){return mB(this,t),this.check()}frustum(t){let{left:r,right:n,bottom:s,top:i,near:o=rM,far:a=nM}=t;return a===1/0?srt(this,r,n,s,i,o):_B(this,r,n,s,i,o,a),this.check()}lookAt(t){let{eye:r,center:n=[0,0,0],up:s=[0,1,0]}=t;return AB(this,r,n,s),this.check()}ortho(t){let{left:r,right:n,bottom:s,top:i,near:o=rM,far:a=nM}=t;return yB(this,r,n,s,i,o,a),this.check()}orthographic(t){let{fovy:r=Qet,aspect:n=trt,focalDistance:s=1,near:i=rM,far:o=nM}=t;RB(r);let a=r/2,c=s*Math.tan(a),l=c*n;return this.ortho({left:-l,right:l,bottom:-c,top:c,near:i,far:o})}perspective(t){let{fovy:r=45*Math.PI/180,aspect:n=1,near:s=.1,far:i=500}=t;return RB(r),xB(this,r,n,s,i),this.check()}determinant(){return lB(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let n=this.getScale(r),s=1/n[0],i=1/n[1],o=1/n[2];return t[0]=this[0]*s,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*s,t[5]=this[5]*i,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*s,t[9]=this[9]*i,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let n=this.getScale(r),s=1/n[0],i=1/n[1],o=1/n[2];return t[0]=this[0]*s,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=this[4]*s,t[4]=this[5]*i,t[5]=this[6]*o,t[6]=this[8]*s,t[7]=this[9]*i,t[8]=this[10]*o,t}transpose(){return aB(this,this),this.check()}invert(){return cB(this,this),this.check()}multiplyLeft(t){return eM(this,t,this),this.check()}multiplyRight(t){return eM(this,this,t),this.check()}rotateX(t){return dB(this,this,t),this.check()}rotateY(t){return pB(this,this,t),this.check()}rotateZ(t){return gB(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,r){return uB(this,this,t,r),this.check()}scale(t){return fB(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return hB(this,this,t),this.check()}transform(t,r){return t.length===4?(r=CB(r||[-0,-0,-0,-0],t,this),fi(r,4),r):this.transformAsPoint(t,r)}transformAsPoint(t,r){let{length:n}=t,s;switch(n){case 2:s=GN(r||[-0,-0],t,this);break;case 3:s=pc(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return fi(s,t.length),s}transformAsVector(t,r){let n;switch(t.length){case 2:n=jN(r||[-0,-0],t,this);break;case 3:n=o0(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return fi(n,t.length),n}transformPoint(t,r){return this.transformAsPoint(t,r)}transformVector(t,r){return this.transformAsPoint(t,r)}transformDirection(t,r){return this.transformAsVector(t,r)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,r,n){return this.identity().translate([t,r,n])}},p0,g0;function rrt(){return p0||(p0=new wt([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(p0)),p0}function nrt(){return g0||(g0=new wt,Object.freeze(g0)),g0}function RB(e){if(e>Math.PI*2)throw Error("expected radians")}function srt(e,t,r,n,s,i){let o=2*i/(r-t),a=2*i/(s-n),c=(r+t)/(r-t),l=(s+n)/(s-n),h=-1,f=-1,u=-2*i;return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=c,e[9]=l,e[10]=h,e[11]=f,e[12]=0,e[13]=0,e[14]=u,e[15]=0,e}function IB(){let e=new Le(4);return Le!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function OB(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function iM(e,t,r){r=r*.5;let n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function oM(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=r[0],c=r[1],l=r[2],h=r[3];return e[0]=n*h+o*a+s*l-i*c,e[1]=s*h+o*c+i*a-n*l,e[2]=i*h+o*l+n*c-s*a,e[3]=o*h-n*a-s*c-i*l,e}function LB(e,t,r){r*=.5;let n=t[0],s=t[1],i=t[2],o=t[3],a=Math.sin(r),c=Math.cos(r);return e[0]=n*c+o*a,e[1]=s*c+i*a,e[2]=i*c-s*a,e[3]=o*c-n*a,e}function NB(e,t,r){r*=.5;let n=t[0],s=t[1],i=t[2],o=t[3],a=Math.sin(r),c=Math.cos(r);return e[0]=n*c-i*a,e[1]=s*c+o*a,e[2]=i*c+n*a,e[3]=o*c-s*a,e}function BB(e,t,r){r*=.5;let n=t[0],s=t[1],i=t[2],o=t[3],a=Math.sin(r),c=Math.cos(r);return e[0]=n*c+s*a,e[1]=s*c-n*a,e[2]=i*c+o*a,e[3]=o*c-i*a,e}function FB(e,t){let r=t[0],n=t[1],s=t[2];return e[0]=r,e[1]=n,e[2]=s,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-s*s)),e}function hu(e,t,r,n){let s=t[0],i=t[1],o=t[2],a=t[3],c=r[0],l=r[1],h=r[2],f=r[3],u,d,p,g,m;return u=s*c+i*l+o*h+a*f,u<0&&(u=-u,c=-c,l=-l,h=-h,f=-f),1-u>1e-6?(d=Math.acos(u),m=Math.sin(d),p=Math.sin((1-n)*d)/m,g=Math.sin(n*d)/m):(p=1-n,g=n),e[0]=p*s+g*c,e[1]=p*i+g*l,e[2]=p*o+g*h,e[3]=p*a+g*f,e}function DB(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=r*r+n*n+s*s+i*i,a=o?1/o:0;return e[0]=-r*a,e[1]=-n*a,e[2]=-s*a,e[3]=i*a,e}function kB(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function aM(e,t){let r=t[0]+t[4]+t[8],n;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[s*3+s]&&(s=2);let i=(s+1)%3,o=(s+2)%3;n=Math.sqrt(t[s*3+s]-t[i*3+i]-t[o*3+o]+1),e[s]=.5*n,n=.5/n,e[3]=(t[i*3+o]-t[o*3+i])*n,e[i]=(t[i*3+s]+t[s*3+i])*n,e[o]=(t[o*3+s]+t[s*3+o])*n}return e}var UB=TB;var zB=MB,VB=vB,HB=wB,WB=EB;var GB=bB;var jB=SB;var qB=function(){let e=YT(),t=$T(1,0,0),r=$T(0,1,0);return function(n,s,i){let o=KT(s,i);return o<-.999999?(dc(e,t,s),QN(e)<1e-6&&dc(e,r,s),YN(e,e),iM(n,e,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(dc(e,s,i),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+o,jB(n,n))}}(),N9t=function(){let e=IB(),t=IB();return function(r,n,s,i,o,a){return hu(e,n,o,a),hu(t,s,i,a),hu(r,e,t,2*a*(1-a)),r}}(),B9t=function(){let e=tB();return function(t,r,n,s){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=s[0],e[4]=s[1],e[7]=s[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],jB(t,aM(t,e))}}();var irt=[0,0,0,1],fu=class extends hi{constructor(t=0,r=0,n=0,s=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,r,n,s)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,r,n,s){return this[0]=t,this[1]=r,this[2]=n,this[3]=s,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return aM(this,t),this.check()}fromAxisRotation(t,r){return iM(this,t,r),this.check()}identity(){return OB(this),this.check()}setAxisAngle(t,r){return this.fromAxisRotation(t,r)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=dt(t)}get y(){return this[1]}set y(t){this[1]=dt(t)}get z(){return this[2]}set z(t){this[2]=dt(t)}get w(){return this[3]}set w(t){this[3]=dt(t)}len(){return WB(this)}lengthSquared(){return GB(this)}dot(t){return VB(this,t)}rotationTo(t,r){return qB(this,t,r),this.check()}add(t){return UB(this,this,t),this.check()}calculateW(){return FB(this,this),this.check()}conjugate(){return kB(this,this),this.check()}invert(){return DB(this,this),this.check()}lerp(t,r,n){return n===void 0?this.lerp(this,t,r):(HB(this,t,r,n),this.check())}multiplyRight(t){return oM(this,this,t),this.check()}multiplyLeft(t){return oM(this,t,this),this.check()}normalize(){let t=this.len(),r=t>0?1/t:0;return this[0]=this[0]*r,this[1]=this[1]*r,this[2]=this[2]*r,this[3]=this[3]*r,t===0&&(this[3]=1),this.check()}rotateX(t){return LB(this,this,t),this.check()}rotateY(t){return NB(this,this,t),this.check()}rotateZ(t){return BB(this,this,t),this.check()}scale(t){return zB(this,this,t),this.check()}slerp(t,r,n){let s,i,o;switch(arguments.length){case 1:({start:s=irt,target:i,ratio:o}=t);break;case 2:s=this,i=t,o=r;break;default:s=t,i=r,o=n}return hu(this,s,i,o),this.check()}transformVector4(t,r=new gc){return PB(r,t,this),fi(r,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,r){return this.setAxisAngle(t,r)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}};var art=1/Math.PI*180,crt=1/180*Math.PI,lrt={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...lrt}};var te=globalThis.mathgl.config;function cM(e,{precision:t=te.precision}={}){return e=hrt(e),`${parseFloat(e.toPrecision(t))}`}function ui(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function lM(e){return XB(e)}function hM(e){return YB(e)}function XB(e,t){return $B(e,r=>r*crt,t)}function YB(e,t){return $B(e,r=>r*art,t)}function hs(e,t,r){let n=te.EPSILON;r&&(te.EPSILON=r);try{if(e===t)return!0;if(ui(e)&&ui(t)){if(e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(!hs(e[s],t[s]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=te.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{te.EPSILON=n}}function hrt(e){return Math.round(e/te.EPSILON)*te.EPSILON}function frt(e){return e.clone?e.clone():new Array(e.length)}function $B(e,t,r){if(ui(e)){let n=e;r=r||frt(n);for(let s=0;s<r.length&&s<n.length;++s){let i=typeof e=="number"?e:e[s];r[s]=t(i,s,r)}return r}return t(e)}var _c=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,r=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+r];return this.check()}toArray(t=[],r=0){for(let n=0;n<this.ELEMENTS;++n)t[r+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:ui(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(te)}formatString(t){let r="";for(let n=0;n<this.ELEMENTS;++n)r+=(n>0?", ":"")+cM(this[n],t);return`${t.printTypes?this.constructor.name:""}[${r}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!hs(this[r],t[r]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==t[r])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,r,n){if(n===void 0)return this.lerp(this,t,r);for(let s=0;s<this.ELEMENTS;++s){let i=t[s],o=typeof r=="number"?r:r[s];this[s]=i+n*(o-i)}return this.check()}min(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(t[r],this[r]);return this.check()}max(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(t[r],this[r]);return this.check()}clamp(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),r[n]);return this.check()}add(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]+=r[n];return this.check()}subtract(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]-=r[n];return this.check()}scale(t){if(typeof t=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;else for(let r=0;r<this.ELEMENTS&&r<t.length;++r)this[r]*=t[r];return this.check()}multiplyByScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}check(){if(te.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)t=t&&Number.isFinite(this[r]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=t;return this.check()}addScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),r);return this.check()}get elements(){return this}};function urt(e,t){if(e.length!==t)return!1;for(let r=0;r<e.length;++r)if(!Number.isFinite(e[r]))return!1;return!0}function Ne(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function m0(e,t,r=""){if(te.debug&&!urt(e,t))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return e}function Cr(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}var _0=class extends _c{get x(){return this[0]}set x(t){this[0]=Ne(t)}get y(){return this[1]}set y(t){this[1]=Ne(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*this[r];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let r=0;for(let n=0;n<this.ELEMENTS;++n){let s=this[n]-t[n];r+=s*s}return Ne(r)}dot(t){let r=0;for(let n=0;n<this.ELEMENTS;++n)r+=this[n]*t[n];return Ne(r)}normalize(){let t=this.magnitude();if(t!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t;return this.check()}multiply(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]*=r[n];return this.check()}divide(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]/=r[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return Cr(t>=0&&t<this.ELEMENTS,"index is out of range"),Ne(this[t])}setComponent(t,r){return Cr(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=r,this.check()}addVectors(t,r){return this.copy(t).add(r)}subVectors(t,r){return this.copy(t).subtract(r)}multiplyVectors(t,r){return this.copy(t).multiply(r)}addScaledVector(t,r){return this.add(new this.constructor(t).multiplyScalar(r))}};var Jr=typeof Float32Array<"u"?Float32Array:Array,uu=Math.random;function xc(e){return e>=0?Math.round(e):e%.5===0?Math.floor(e):Math.round(e)}var yHt=Math.PI/180;function drt(){let e=new Jr(2);return Jr!=Float32Array&&(e[0]=0,e[1]=0),e}function KB(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[4]*s+r[12],e[1]=r[1]*n+r[5]*s+r[13],e}var AHt=function(){let e=drt();return function(t,r,n,s,i,o){let a,c;for(r||(r=2),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],i(e,e,o),t[a]=e[0],t[a+1]=e[1];return t}}();function ZB(e,t,r){let n=t[0],s=t[1],i=r[3]*n+r[7]*s||1;return e[0]=(r[0]*n+r[4]*s)/i,e[1]=(r[1]*n+r[5]*s)/i,e}function x0(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[3]*n+r[7]*s+r[11]*i||1;return e[0]=(r[0]*n+r[4]*s+r[8]*i)/o,e[1]=(r[1]*n+r[5]*s+r[9]*i)/o,e[2]=(r[2]*n+r[6]*s+r[10]*i)/o,e}function JB(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[2]*s,e[1]=r[1]*n+r[3]*s,e[2]=t[2],e}var yc={};Bt(yc,{add:()=>xrt,angle:()=>yM,bezier:()=>Ort,ceil:()=>yrt,clone:()=>prt,copy:()=>mrt,create:()=>QB,cross:()=>dM,dist:()=>Vrt,distance:()=>sF,div:()=>zrt,divide:()=>nF,dot:()=>uM,equals:()=>Drt,exactEquals:()=>Frt,floor:()=>Art,forEach:()=>jrt,fromValues:()=>grt,hermite:()=>Irt,inverse:()=>wrt,len:()=>Wrt,length:()=>tF,lerp:()=>Prt,max:()=>Mrt,min:()=>Trt,mul:()=>Urt,multiply:()=>rF,negate:()=>vrt,normalize:()=>Crt,random:()=>Lrt,rotateX:()=>mM,rotateY:()=>_M,rotateZ:()=>xM,round:()=>Ert,scale:()=>brt,scaleAndAdd:()=>Srt,set:()=>_rt,slerp:()=>Rrt,sqrDist:()=>Hrt,sqrLen:()=>Grt,squaredDistance:()=>iF,squaredLength:()=>oF,str:()=>Brt,sub:()=>krt,subtract:()=>eF,transformMat3:()=>pM,transformMat4:()=>du,transformQuat:()=>gM,zero:()=>Nrt});function QB(){let e=new Jr(3);return Jr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function prt(e){let t=new Jr(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function tF(e){let t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function grt(e,t,r){let n=new Jr(3);return n[0]=e,n[1]=t,n[2]=r,n}function mrt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function _rt(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function xrt(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function eF(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function rF(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function nF(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function yrt(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function Art(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Trt(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function Mrt(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function Ert(e,t){return e[0]=xc(t[0]),e[1]=xc(t[1]),e[2]=xc(t[2]),e}function brt(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function Srt(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function sF(e,t){let r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(r*r+n*n+s*s)}function iF(e,t){let r=t[0]-e[0],n=t[1]-e[1],s=t[2]-e[2];return r*r+n*n+s*s}function oF(e){let t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function vrt(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function wrt(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Crt(e,t){let r=t[0],n=t[1],s=t[2],i=r*r+n*n+s*s;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function uM(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function dM(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[0],a=r[1],c=r[2];return e[0]=s*c-i*a,e[1]=i*o-n*c,e[2]=n*a-s*o,e}function Prt(e,t,r,n){let s=t[0],i=t[1],o=t[2];return e[0]=s+n*(r[0]-s),e[1]=i+n*(r[1]-i),e[2]=o+n*(r[2]-o),e}function Rrt(e,t,r,n){let s=Math.acos(Math.min(Math.max(uM(t,r),-1),1)),i=Math.sin(s),o=Math.sin((1-n)*s)/i,a=Math.sin(n*s)/i;return e[0]=o*t[0]+a*r[0],e[1]=o*t[1]+a*r[1],e[2]=o*t[2]+a*r[2],e}function Irt(e,t,r,n,s,i){let o=i*i,a=o*(2*i-3)+1,c=o*(i-2)+i,l=o*(i-1),h=o*(3-2*i);return e[0]=t[0]*a+r[0]*c+n[0]*l+s[0]*h,e[1]=t[1]*a+r[1]*c+n[1]*l+s[1]*h,e[2]=t[2]*a+r[2]*c+n[2]*l+s[2]*h,e}function Ort(e,t,r,n,s,i){let o=1-i,a=o*o,c=i*i,l=a*o,h=3*i*a,f=3*c*o,u=c*i;return e[0]=t[0]*l+r[0]*h+n[0]*f+s[0]*u,e[1]=t[1]*l+r[1]*h+n[1]*f+s[1]*u,e[2]=t[2]*l+r[2]*h+n[2]*f+s[2]*u,e}function Lrt(e,t){t=t===void 0?1:t;let r=uu()*2*Math.PI,n=uu()*2-1,s=Math.sqrt(1-n*n)*t;return e[0]=Math.cos(r)*s,e[1]=Math.sin(r)*s,e[2]=n*t,e}function du(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[3]*n+r[7]*s+r[11]*i+r[15];return o=o||1,e[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/o,e[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/o,e[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/o,e}function pM(e,t,r){let n=t[0],s=t[1],i=t[2];return e[0]=n*r[0]+s*r[3]+i*r[6],e[1]=n*r[1]+s*r[4]+i*r[7],e[2]=n*r[2]+s*r[5]+i*r[8],e}function gM(e,t,r){let n=r[0],s=r[1],i=r[2],o=r[3],a=t[0],c=t[1],l=t[2],h=s*l-i*c,f=i*a-n*l,u=n*c-s*a,d=s*u-i*f,p=i*h-n*u,g=n*f-s*h,m=o*2;return h*=m,f*=m,u*=m,d*=2,p*=2,g*=2,e[0]=a+h+d,e[1]=c+f+p,e[2]=l+u+g,e}function mM(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[0],i[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),i[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function _M(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),i[1]=s[1],i[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function xM(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),i[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),i[2]=s[2],e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function yM(e,t){let r=e[0],n=e[1],s=e[2],i=t[0],o=t[1],a=t[2],c=Math.sqrt((r*r+n*n+s*s)*(i*i+o*o+a*a)),l=c&&uM(e,t)/c;return Math.acos(Math.min(Math.max(l,-1),1))}function Nrt(e){return e[0]=0,e[1]=0,e[2]=0,e}function Brt(e){return`vec3(${e[0]}, ${e[1]}, ${e[2]})`}function Frt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Drt(e,t){let r=e[0],n=e[1],s=e[2],i=t[0],o=t[1],a=t[2];return Math.abs(r-i)<=1e-6*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-o)<=1e-6*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-a)<=1e-6*Math.max(1,Math.abs(s),Math.abs(a))}var krt=eF,Urt=rF,zrt=nF,Vrt=sF,Hrt=iF,Wrt=tF,Grt=oF,jrt=function(){let e=QB();return function(t,r,n,s,i,o){let a,c;for(r||(r=3),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}}();var AM=[0,0,0],y0,lt=class extends _0{static get ZERO(){return y0||(y0=new lt(0,0,0),Object.freeze(y0)),y0}constructor(t=0,r=0,n=0){super(-0,-0,-0),arguments.length===1&&ui(t)?this.copy(t):(te.debug&&(Ne(t),Ne(r),Ne(n)),this[0]=t,this[1]=r,this[2]=n)}set(t,r,n){return this[0]=t,this[1]=r,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return te.debug&&(Ne(t.x),Ne(t.y),Ne(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Ne(t)}angle(t){return yM(this,t)}cross(t){return dM(this,this,t),this.check()}rotateX({radians:t,origin:r=AM}){return mM(this,this,r,t),this.check()}rotateY({radians:t,origin:r=AM}){return _M(this,this,r,t),this.check()}rotateZ({radians:t,origin:r=AM}){return xM(this,this,r,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return du(this,this,t),this.check()}transformAsVector(t){return x0(this,this,t),this.check()}transformByMatrix3(t){return pM(this,this,t),this.check()}transformByMatrix2(t){return JB(this,this,t),this.check()}transformByQuaternion(t){return gM(this,this,t),this.check()}};var A0=class extends _c{toString(){let t="[";if(te.printRowMajor){t+="row-major:";for(let r=0;r<this.RANK;++r)for(let n=0;n<this.RANK;++n)t+=` ${this[n*this.RANK+r]}`}else{t+="column-major:";for(let r=0;r<this.ELEMENTS;++r)t+=` ${this[r]}`}return t+="]",t}getElementIndex(t,r){return r*this.RANK+t}getElement(t,r){return this[r*this.RANK+t]}setElement(t,r,n){return this[r*this.RANK+t]=Ne(n),this}getColumn(t,r=new Array(this.RANK).fill(-0)){let n=t*this.RANK;for(let s=0;s<this.RANK;++s)r[s]=this[n+s];return r}setColumn(t,r){let n=t*this.RANK;for(let s=0;s<this.RANK;++s)this[n+s]=r[s];return this}};function qrt(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function aF(e,t){if(e===t){let r=t[1],n=t[2],s=t[3],i=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=i,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function cF(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=t[4],a=t[5],c=t[6],l=t[7],h=t[8],f=t[9],u=t[10],d=t[11],p=t[12],g=t[13],m=t[14],_=t[15],y=r*a-n*o,x=r*c-s*o,A=r*l-i*o,M=n*c-s*a,E=n*l-i*a,w=s*l-i*c,v=h*g-f*p,b=h*m-u*p,T=h*_-d*p,I=f*m-u*g,N=f*_-d*g,B=u*_-d*m,C=y*B-x*N+A*I+M*T-E*b+w*v;return C?(C=1/C,e[0]=(a*B-c*N+l*I)*C,e[1]=(s*N-n*B-i*I)*C,e[2]=(g*w-m*E+_*M)*C,e[3]=(u*E-f*w-d*M)*C,e[4]=(c*T-o*B-l*b)*C,e[5]=(r*B-s*T+i*b)*C,e[6]=(m*A-p*w-_*x)*C,e[7]=(h*w-u*A+d*x)*C,e[8]=(o*N-a*T+l*v)*C,e[9]=(n*T-r*N-i*v)*C,e[10]=(p*E-g*A+_*y)*C,e[11]=(f*A-h*E-d*y)*C,e[12]=(a*b-o*I-c*v)*C,e[13]=(r*I-n*b+s*v)*C,e[14]=(g*x-p*M-m*y)*C,e[15]=(h*M-f*x+u*y)*C,e):null}function lF(e){let t=e[0],r=e[1],n=e[2],s=e[3],i=e[4],o=e[5],a=e[6],c=e[7],l=e[8],h=e[9],f=e[10],u=e[11],d=e[12],p=e[13],g=e[14],m=e[15],_=t*o-r*i,y=t*a-n*i,x=r*a-n*o,A=l*p-h*d,M=l*g-f*d,E=h*g-f*p,w=t*E-r*M+n*A,v=i*E-o*M+a*A,b=l*x-h*y+f*_,T=d*x-p*y+g*_;return c*w-s*v+m*b-u*T}function TM(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=t[9],d=t[10],p=t[11],g=t[12],m=t[13],_=t[14],y=t[15],x=r[0],A=r[1],M=r[2],E=r[3];return e[0]=x*n+A*a+M*f+E*g,e[1]=x*s+A*c+M*u+E*m,e[2]=x*i+A*l+M*d+E*_,e[3]=x*o+A*h+M*p+E*y,x=r[4],A=r[5],M=r[6],E=r[7],e[4]=x*n+A*a+M*f+E*g,e[5]=x*s+A*c+M*u+E*m,e[6]=x*i+A*l+M*d+E*_,e[7]=x*o+A*h+M*p+E*y,x=r[8],A=r[9],M=r[10],E=r[11],e[8]=x*n+A*a+M*f+E*g,e[9]=x*s+A*c+M*u+E*m,e[10]=x*i+A*l+M*d+E*_,e[11]=x*o+A*h+M*p+E*y,x=r[12],A=r[13],M=r[14],E=r[15],e[12]=x*n+A*a+M*f+E*g,e[13]=x*s+A*c+M*u+E*m,e[14]=x*i+A*l+M*d+E*_,e[15]=x*o+A*h+M*p+E*y,e}function hF(e,t,r){let n=r[0],s=r[1],i=r[2],o,a,c,l,h,f,u,d,p,g,m,_;return t===e?(e[12]=t[0]*n+t[4]*s+t[8]*i+t[12],e[13]=t[1]*n+t[5]*s+t[9]*i+t[13],e[14]=t[2]*n+t[6]*s+t[10]*i+t[14],e[15]=t[3]*n+t[7]*s+t[11]*i+t[15]):(o=t[0],a=t[1],c=t[2],l=t[3],h=t[4],f=t[5],u=t[6],d=t[7],p=t[8],g=t[9],m=t[10],_=t[11],e[0]=o,e[1]=a,e[2]=c,e[3]=l,e[4]=h,e[5]=f,e[6]=u,e[7]=d,e[8]=p,e[9]=g,e[10]=m,e[11]=_,e[12]=o*n+h*s+p*i+t[12],e[13]=a*n+f*s+g*i+t[13],e[14]=c*n+u*s+m*i+t[14],e[15]=l*n+d*s+_*i+t[15]),e}function fF(e,t,r){let n=r[0],s=r[1],i=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function uF(e,t,r,n){let s=n[0],i=n[1],o=n[2],a=Math.sqrt(s*s+i*i+o*o),c,l,h,f,u,d,p,g,m,_,y,x,A,M,E,w,v,b,T,I,N,B,C,V;return a<1e-6?null:(a=1/a,s*=a,i*=a,o*=a,l=Math.sin(r),c=Math.cos(r),h=1-c,f=t[0],u=t[1],d=t[2],p=t[3],g=t[4],m=t[5],_=t[6],y=t[7],x=t[8],A=t[9],M=t[10],E=t[11],w=s*s*h+c,v=i*s*h+o*l,b=o*s*h-i*l,T=s*i*h-o*l,I=i*i*h+c,N=o*i*h+s*l,B=s*o*h+i*l,C=i*o*h-s*l,V=o*o*h+c,e[0]=f*w+g*v+x*b,e[1]=u*w+m*v+A*b,e[2]=d*w+_*v+M*b,e[3]=p*w+y*v+E*b,e[4]=f*T+g*I+x*N,e[5]=u*T+m*I+A*N,e[6]=d*T+_*I+M*N,e[7]=p*T+y*I+E*N,e[8]=f*B+g*C+x*V,e[9]=u*B+m*C+A*V,e[10]=d*B+_*C+M*V,e[11]=p*B+y*C+E*V,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function dF(e,t,r){let n=Math.sin(r),s=Math.cos(r),i=t[4],o=t[5],a=t[6],c=t[7],l=t[8],h=t[9],f=t[10],u=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*s+l*n,e[5]=o*s+h*n,e[6]=a*s+f*n,e[7]=c*s+u*n,e[8]=l*s-i*n,e[9]=h*s-o*n,e[10]=f*s-a*n,e[11]=u*s-c*n,e}function pF(e,t,r){let n=Math.sin(r),s=Math.cos(r),i=t[0],o=t[1],a=t[2],c=t[3],l=t[8],h=t[9],f=t[10],u=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*s-l*n,e[1]=o*s-h*n,e[2]=a*s-f*n,e[3]=c*s-u*n,e[8]=i*n+l*s,e[9]=o*n+h*s,e[10]=a*n+f*s,e[11]=c*n+u*s,e}function gF(e,t,r){let n=Math.sin(r),s=Math.cos(r),i=t[0],o=t[1],a=t[2],c=t[3],l=t[4],h=t[5],f=t[6],u=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*s+l*n,e[1]=o*s+h*n,e[2]=a*s+f*n,e[3]=c*s+u*n,e[4]=l*s-i*n,e[5]=h*s-o*n,e[6]=f*s-a*n,e[7]=u*s-c*n,e}function mF(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=r+r,a=n+n,c=s+s,l=r*o,h=n*o,f=n*a,u=s*o,d=s*a,p=s*c,g=i*o,m=i*a,_=i*c;return e[0]=1-f-p,e[1]=h+_,e[2]=u-m,e[3]=0,e[4]=h-_,e[5]=1-l-p,e[6]=d+g,e[7]=0,e[8]=u+m,e[9]=d-g,e[10]=1-l-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _F(e,t,r,n,s,i,o){let a=1/(r-t),c=1/(s-n),l=1/(i-o);return e[0]=i*2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i*2*c,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(s+n)*c,e[10]=(o+i)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*l,e[15]=0,e}function Xrt(e,t,r,n,s){let i=1/Math.tan(t/2);if(e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0){let o=1/(n-s);e[10]=(s+n)*o,e[14]=2*s*n*o}else e[10]=-1,e[14]=-2*n;return e}var xF=Xrt;function Yrt(e,t,r,n,s,i,o){let a=1/(t-r),c=1/(n-s),l=1/(i-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*a,e[13]=(s+n)*c,e[14]=(o+i)*l,e[15]=1,e}var yF=Yrt;function AF(e,t,r,n){let s,i,o,a,c,l,h,f,u,d,p=t[0],g=t[1],m=t[2],_=n[0],y=n[1],x=n[2],A=r[0],M=r[1],E=r[2];return Math.abs(p-A)<1e-6&&Math.abs(g-M)<1e-6&&Math.abs(m-E)<1e-6?qrt(e):(f=p-A,u=g-M,d=m-E,s=1/Math.sqrt(f*f+u*u+d*d),f*=s,u*=s,d*=s,i=y*d-x*u,o=x*f-_*d,a=_*u-y*f,s=Math.sqrt(i*i+o*o+a*a),s?(s=1/s,i*=s,o*=s,a*=s):(i=0,o=0,a=0),c=u*a-d*o,l=d*i-f*a,h=f*o-u*i,s=Math.sqrt(c*c+l*l+h*h),s?(s=1/s,c*=s,l*=s,h*=s):(c=0,l=0,h=0),e[0]=i,e[1]=c,e[2]=f,e[3]=0,e[4]=o,e[5]=l,e[6]=u,e[7]=0,e[8]=a,e[9]=h,e[10]=d,e[11]=0,e[12]=-(i*p+o*g+a*m),e[13]=-(c*p+l*g+h*m),e[14]=-(f*p+u*g+d*m),e[15]=1,e)}function $rt(){let e=new Jr(4);return Jr!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function TF(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3];return e[0]=r[0]*n+r[4]*s+r[8]*i+r[12]*o,e[1]=r[1]*n+r[5]*s+r[9]*i+r[13]*o,e[2]=r[2]*n+r[6]*s+r[10]*i+r[14]*o,e[3]=r[3]*n+r[7]*s+r[11]*i+r[15]*o,e}var NHt=function(){let e=$rt();return function(t,r,n,s,i,o){let a,c;for(r||(r=4),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}();var bM;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(bM||(bM={}));var Krt=45*Math.PI/180,Zrt=1,MM=.1,EM=500,Jrt=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),di=class extends A0{static get IDENTITY(){return tnt()}static get ZERO(){return Qrt()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return bM}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,r,n,s,i,o,a,c,l,h,f,u,d,p,g,m){return this[0]=t,this[1]=r,this[2]=n,this[3]=s,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this[9]=h,this[10]=f,this[11]=u,this[12]=d,this[13]=p,this[14]=g,this[15]=m,this.check()}setRowMajor(t,r,n,s,i,o,a,c,l,h,f,u,d,p,g,m){return this[0]=t,this[1]=i,this[2]=l,this[3]=d,this[4]=r,this[5]=o,this[6]=h,this[7]=p,this[8]=n,this[9]=a,this[10]=f,this[11]=g,this[12]=s,this[13]=c,this[14]=u,this[15]=m,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(Jrt)}fromObject(t){return this.check()}fromQuaternion(t){return mF(this,t),this.check()}frustum(t){let{left:r,right:n,bottom:s,top:i,near:o=MM,far:a=EM}=t;return a===1/0?ent(this,r,n,s,i,o):_F(this,r,n,s,i,o,a),this.check()}lookAt(t){let{eye:r,center:n=[0,0,0],up:s=[0,1,0]}=t;return AF(this,r,n,s),this.check()}ortho(t){let{left:r,right:n,bottom:s,top:i,near:o=MM,far:a=EM}=t;return yF(this,r,n,s,i,o,a),this.check()}orthographic(t){let{fovy:r=Krt,aspect:n=Zrt,focalDistance:s=1,near:i=MM,far:o=EM}=t;MF(r);let a=r/2,c=s*Math.tan(a),l=c*n;return this.ortho({left:-l,right:l,bottom:-c,top:c,near:i,far:o})}perspective(t){let{fovy:r=45*Math.PI/180,aspect:n=1,near:s=.1,far:i=500}=t;return MF(r),xF(this,r,n,s,i),this.check()}determinant(){return lF(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let n=this.getScale(r),s=1/n[0],i=1/n[1],o=1/n[2];return t[0]=this[0]*s,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*s,t[5]=this[5]*i,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*s,t[9]=this[9]*i,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let n=this.getScale(r),s=1/n[0],i=1/n[1],o=1/n[2];return t[0]=this[0]*s,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=this[4]*s,t[4]=this[5]*i,t[5]=this[6]*o,t[6]=this[8]*s,t[7]=this[9]*i,t[8]=this[10]*o,t}transpose(){return aF(this,this),this.check()}invert(){return cF(this,this),this.check()}multiplyLeft(t){return TM(this,t,this),this.check()}multiplyRight(t){return TM(this,this,t),this.check()}rotateX(t){return dF(this,this,t),this.check()}rotateY(t){return pF(this,this,t),this.check()}rotateZ(t){return gF(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,r){return uF(this,this,t,r),this.check()}scale(t){return fF(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return hF(this,this,t),this.check()}transform(t,r){return t.length===4?(r=TF(r||[-0,-0,-0,-0],t,this),m0(r,4),r):this.transformAsPoint(t,r)}transformAsPoint(t,r){let{length:n}=t,s;switch(n){case 2:s=KB(r||[-0,-0],t,this);break;case 3:s=du(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return m0(s,t.length),s}transformAsVector(t,r){let n;switch(t.length){case 2:n=ZB(r||[-0,-0],t,this);break;case 3:n=x0(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return m0(n,t.length),n}transformPoint(t,r){return this.transformAsPoint(t,r)}transformVector(t,r){return this.transformAsPoint(t,r)}transformDirection(t,r){return this.transformAsVector(t,r)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,r,n){return this.identity().translate([t,r,n])}},T0,M0;function Qrt(){return T0||(T0=new di([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(T0)),T0}function tnt(){return M0||(M0=new di,Object.freeze(M0)),M0}function MF(e){if(e>Math.PI*2)throw Error("expected radians")}function ent(e,t,r,n,s,i){let o=2*i/(r-t),a=2*i/(s-n),c=(r+t)/(r-t),l=(s+n)/(s-n),h=-1,f=-1,u=-2*i;return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=c,e[9]=l,e[10]=h,e[11]=f,e[12]=0,e[13]=0,e[14]=u,e[15]=0,e}var pi={};Bt(pi,{EPSILON1:()=>rnt,EPSILON10:()=>fnt,EPSILON11:()=>unt,EPSILON12:()=>dnt,EPSILON13:()=>pnt,EPSILON14:()=>gnt,EPSILON15:()=>mnt,EPSILON16:()=>_nt,EPSILON17:()=>xnt,EPSILON18:()=>ynt,EPSILON19:()=>Ant,EPSILON2:()=>nnt,EPSILON20:()=>Tnt,EPSILON3:()=>snt,EPSILON4:()=>int,EPSILON5:()=>ont,EPSILON6:()=>ant,EPSILON7:()=>cnt,EPSILON8:()=>lnt,EPSILON9:()=>hnt,PI_OVER_FOUR:()=>Ent,PI_OVER_SIX:()=>bnt,PI_OVER_TWO:()=>Mnt,TWO_PI:()=>Snt});var rnt=.1,nnt=.01,snt=.001,int=1e-4,ont=1e-5,ant=1e-6,cnt=1e-7,lnt=1e-8,hnt=1e-9,fnt=1e-10,unt=1e-11,dnt=1e-12,pnt=1e-13,gnt=1e-14,mnt=1e-15,_nt=1e-16,xnt=1e-17,ynt=1e-18,Ant=1e-19,Tnt=1e-20,Mnt=Math.PI/2,Ent=Math.PI/4,bnt=Math.PI/6,Snt=Math.PI*2;var us=6356752314245179e-9,vnt={radii:[6378137,6378137,us],radiiSquared:[6378137*6378137,6378137*6378137,us*us],oneOverRadii:[1/6378137,1/6378137,1/us],oneOverRadiiSquared:[1/(6378137*6378137),1/(6378137*6378137),1/(us*us)],maximumRadius:Math.max(6378137,6378137,us),centerToleranceSquared:.1};function E0(e){return e}var hWt=new lt;function wnt(e,t=[],r=E0){return"longitude"in e?(t[0]=r(e.longitude),t[1]=r(e.latitude),t[2]=e.height):"x"in e?(t[0]=r(e.x),t[1]=r(e.y),t[2]=e.z):(t[0]=r(e[0]),t[1]=r(e[1]),t[2]=e[2]),t}function EF(e,t=[]){return wnt(e,t,te._cartographicRadians?E0:lM)}function Cnt(e,t,r=E0){return"longitude"in t?(t.longitude=r(e[0]),t.latitude=r(e[1]),t.height=e[2]):"x"in t?(t.x=r(e[0]),t.y=r(e[1]),t.z=e[2]):(t[0]=r(e[0]),t[1]=r(e[1]),t[2]=e[2]),t}function bF(e,t){return Cnt(e,t,te._cartographicRadians?E0:hM)}var SF=1e-14,Pnt=new lt,vF={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},SM={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},pu={east:new lt,north:new lt,up:new lt,west:new lt,south:new lt,down:new lt},Rnt=new lt,Int=new lt,Ont=new lt;function vM(e,t,r,n,s,i){let o=vF[t]&&vF[t][r];Cr(o&&(!n||n===o));let a,c,l,h=Pnt.copy(s);if(hs(h.x,0,SF)&&hs(h.y,0,SF)){let u=Math.sign(h.z);a=Rnt.fromArray(SM[t]),t!=="east"&&t!=="west"&&a.scale(u),c=Int.fromArray(SM[r]),r!=="east"&&r!=="west"&&c.scale(u),l=Ont.fromArray(SM[n]),n!=="east"&&n!=="west"&&l.scale(u)}else{let{up:u,east:d,north:p}=pu;d.set(-h.y,h.x,0).normalize(),e.geodeticSurfaceNormal(h,u),p.copy(u).cross(d);let{down:g,west:m,south:_}=pu;g.copy(u).scale(-1),m.copy(d).scale(-1),_.copy(p).scale(-1),a=pu[t],c=pu[r],l=pu[n]}return i[0]=a.x,i[1]=a.y,i[2]=a.z,i[3]=0,i[4]=c.x,i[5]=c.y,i[6]=c.z,i[7]=0,i[8]=l.x,i[9]=l.y,i[10]=l.z,i[11]=0,i[12]=h.x,i[13]=h.y,i[14]=h.z,i[15]=1,i}var Ac=new lt,Lnt=new lt,Nnt=new lt;function wF(e,t,r=[]){let{oneOverRadii:n,oneOverRadiiSquared:s,centerToleranceSquared:i}=t;Ac.from(e);let o=Ac.x,a=Ac.y,c=Ac.z,l=n.x,h=n.y,f=n.z,u=o*o*l*l,d=a*a*h*h,p=c*c*f*f,g=u+d+p,m=Math.sqrt(1/g);if(!Number.isFinite(m))return;let _=Lnt;if(_.copy(e).scale(m),g<i)return _.to(r);let y=s.x,x=s.y,A=s.z,M=Nnt;M.set(_.x*y*2,_.y*x*2,_.z*A*2);let E=(1-m)*Ac.len()/(.5*M.len()),w=0,v,b,T,I;do{E-=w,v=1/(1+E*y),b=1/(1+E*x),T=1/(1+E*A);let N=v*v,B=b*b,C=T*T,V=N*v,rt=B*b,J=C*T;I=u*N+d*B+p*C-1;let ht=-2*(u*V*y+d*rt*x+p*J*A);w=I/ht}while(Math.abs(I)>pi.EPSILON12);return Ac.scale([v,b,T]).to(r)}var b0=new lt,CF=new lt,Dnt=new lt,Qr=new lt,knt=new lt,S0=new lt,ot=class{constructor(t=0,r=0,n=0){this.centerToleranceSquared=pi.EPSILON1,Cr(t>=0),Cr(r>=0),Cr(n>=0),this.radii=new lt(t,r,n),this.radiiSquared=new lt(t*t,r*r,n*n),this.radiiToTheFourth=new lt(t*t*t*t,r*r*r*r,n*n*n*n),this.oneOverRadii=new lt(t===0?0:1/t,r===0?0:1/r,n===0?0:1/n),this.oneOverRadiiSquared=new lt(t===0?0:1/(t*t),r===0?0:1/(r*r),n===0?0:1/(n*n)),this.minimumRadius=Math.min(t,r,n),this.maximumRadius=Math.max(t,r,n),this.radiiSquared.z!==0&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(t){return this===t||Boolean(t&&this.radii.equals(t.radii))}toString(){return this.radii.toString()}cartographicToCartesian(t,r=[0,0,0]){let n=CF,s=Dnt,[,,i]=t;this.geodeticSurfaceNormalCartographic(t,n),s.copy(this.radiiSquared).scale(n);let o=Math.sqrt(n.dot(s));return s.scale(1/o),n.scale(i),s.add(n),s.to(r)}cartesianToCartographic(t,r=[0,0,0]){S0.from(t);let n=this.scaleToGeodeticSurface(S0,Qr);if(!n)return;let s=this.geodeticSurfaceNormal(n,CF),i=knt;i.copy(S0).subtract(n);let o=Math.atan2(s.y,s.x),a=Math.asin(s.z),c=Math.sign(yc.dot(i,S0))*yc.length(i);return bF([o,a,c],r)}eastNorthUpToFixedFrame(t,r=new di){return vM(this,"east","north","up",t,r)}localFrameToFixedFrame(t,r,n,s,i=new di){return vM(this,t,r,n,s,i)}geocentricSurfaceNormal(t,r=[0,0,0]){return b0.from(t).normalize().to(r)}geodeticSurfaceNormalCartographic(t,r=[0,0,0]){let n=EF(t),s=n[0],i=n[1],o=Math.cos(i);return b0.set(o*Math.cos(s),o*Math.sin(s),Math.sin(i)).normalize(),b0.to(r)}geodeticSurfaceNormal(t,r=[0,0,0]){return b0.from(t).scale(this.oneOverRadiiSquared).normalize().to(r)}scaleToGeodeticSurface(t,r){return wF(t,this,r)}scaleToGeocentricSurface(t,r=[0,0,0]){Qr.from(t);let n=Qr.x,s=Qr.y,i=Qr.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(n*n*o.x+s*s*o.y+i*i*o.z);return Qr.multiplyScalar(a).to(r)}transformPositionToScaledSpace(t,r=[0,0,0]){return Qr.from(t).scale(this.oneOverRadii).to(r)}transformPositionFromScaledSpace(t,r=[0,0,0]){return Qr.from(t).scale(this.radii).to(r)}getSurfaceNormalIntersectionWithZAxis(t,r=0,n=[0,0,0]){Cr(hs(this.radii.x,this.radii.y,pi.EPSILON15)),Cr(this.radii.z>0),Qr.from(t);let s=Qr.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(s)>=this.radii.z-r))return Qr.set(0,0,s).to(n)}};ot.WGS84=new ot(6378137,6378137,us);var v0=class{item;previous;next;constructor(t,r,n){this.item=t,this.previous=r,this.next=n}};var w0=class{head=null;tail=null;_length=0;get length(){return this._length}add(t){let r=new v0(t,this.tail,null);return this.tail?(this.tail.next=r,this.tail=r):(this.head=r,this.tail=r),++this._length,r}remove(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}splice(t,r){t!==r&&(this.remove(r),this._insert(t,r))}_insert(t,r){let n=t.next;t.next=r,this.tail===t?this.tail=r:n.previous=r,r.next=n,r.previous=t,++this._length}};var C0=class{_list;_sentinel;_trimTiles;constructor(){this._list=new w0,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(t){let r=t._cacheNode;r&&this._list.splice(this._sentinel,r)}add(t,r,n){r._cacheNode||(r._cacheNode=this._list.add(r),n&&n(t,r))}unloadTile(t,r,n){let s=r._cacheNode;s&&(this._list.remove(s),r._cacheNode=null,n&&n(t,r))}unloadTiles(t,r){let n=this._trimTiles;this._trimTiles=!1;let s=this._list,i=t.maximumMemoryUsage*1024*1024,o=this._sentinel,a=s.head;for(;a!==o&&(t.gpuMemoryUsageInBytes>i||n);){let c=a.item;a=a.next,this.unloadTile(t,c,r)}}trim(){this._trimTiles=!0}};function PF(e,t){nt(e),nt(t);let{rtcCenter:r,gltfUpAxis:n}=t,{computedTransform:s,boundingVolume:{center:i}}=e,o=new wt(s);switch(r&&o.translate(r),n){case"Z":break;case"Y":let f=new wt().rotateX(Math.PI/2);o=o.multiplyRight(f);break;case"X":let u=new wt().rotateY(-Math.PI/2);o=o.multiplyRight(u);break;default:break}t.isQuantized&&o.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);let a=new q(i);t.cartesianModelMatrix=o,t.cartesianOrigin=a;let c=ot.WGS84.cartesianToCartographic(a,new q),h=ot.WGS84.eastNorthUpToFixedFrame(a).invert();t.cartographicModelMatrix=h.multiplyRight(o),t.cartographicOrigin=c,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}var me={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};var FWt=1/Math.PI*180,DWt=1/180*Math.PI,Unt={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...Unt}};var ee=globalThis.mathgl.config;function wM(e,{precision:t=ee.precision}={}){return e=znt(e),`${parseFloat(e.toPrecision(t))}`}function ds(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function gi(e,t,r){let n=ee.EPSILON;r&&(ee.EPSILON=r);try{if(e===t)return!0;if(ds(e)&&ds(t)){if(e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(!gi(e[s],t[s]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=ee.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{ee.EPSILON=n}}function znt(e){return Math.round(e/ee.EPSILON)*ee.EPSILON}var mi=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,r=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+r];return this.check()}toArray(t=[],r=0){for(let n=0;n<this.ELEMENTS;++n)t[r+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:ds(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ee)}formatString(t){let r="";for(let n=0;n<this.ELEMENTS;++n)r+=(n>0?", ":"")+wM(this[n],t);return`${t.printTypes?this.constructor.name:""}[${r}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!gi(this[r],t[r]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==t[r])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,r,n){if(n===void 0)return this.lerp(this,t,r);for(let s=0;s<this.ELEMENTS;++s){let i=t[s],o=typeof r=="number"?r:r[s];this[s]=i+n*(o-i)}return this.check()}min(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(t[r],this[r]);return this.check()}max(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(t[r],this[r]);return this.check()}clamp(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),r[n]);return this.check()}add(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]+=r[n];return this.check()}subtract(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]-=r[n];return this.check()}scale(t){if(typeof t=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;else for(let r=0;r<this.ELEMENTS&&r<t.length;++r)this[r]*=t[r];return this.check()}multiplyByScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}check(){if(ee.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)t=t&&Number.isFinite(this[r]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=t;return this.check()}addScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),r);return this.check()}get elements(){return this}};function Vnt(e,t){if(e.length!==t)return!1;for(let r=0;r<e.length;++r)if(!Number.isFinite(e[r]))return!1;return!0}function pt(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function P0(e,t,r=""){if(ee.debug&&!Vnt(e,t))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return e}function wn(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}var Tc=class extends mi{get x(){return this[0]}set x(t){this[0]=pt(t)}get y(){return this[1]}set y(t){this[1]=pt(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*this[r];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let r=0;for(let n=0;n<this.ELEMENTS;++n){let s=this[n]-t[n];r+=s*s}return pt(r)}dot(t){let r=0;for(let n=0;n<this.ELEMENTS;++n)r+=this[n]*t[n];return pt(r)}normalize(){let t=this.magnitude();if(t!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t;return this.check()}multiply(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]*=r[n];return this.check()}divide(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]/=r[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return wn(t>=0&&t<this.ELEMENTS,"index is out of range"),pt(this[t])}setComponent(t,r){return wn(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=r,this.check()}addVectors(t,r){return this.copy(t).add(r)}subVectors(t,r){return this.copy(t).subtract(r)}multiplyVectors(t,r){return this.copy(t).multiply(r)}addScaledVector(t,r){return this.add(new this.constructor(t).multiplyScalar(r))}};var Vt=typeof Float32Array<"u"?Float32Array:Array;var YWt=Math.PI/180;function Hnt(){let e=new Vt(2);return Vt!=Float32Array&&(e[0]=0,e[1]=0),e}function OF(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[3]*s+r[6],e[1]=r[1]*n+r[4]*s+r[7],e}var $Wt=function(){let e=Hnt();return function(t,r,n,s,i,o){let a,c;for(r||(r=2),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],i(e,e,o),t[a]=e[0],t[a+1]=e[1];return t}}();function LF(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[3]*n+r[7]*s+r[11]*i||1;return e[0]=(r[0]*n+r[4]*s+r[8]*i)/o,e[1]=(r[1]*n+r[5]*s+r[9]*i)/o,e[2]=(r[2]*n+r[6]*s+r[10]*i)/o,e}function NF(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[2]*s,e[1]=r[1]*n+r[3]*s,e[2]=t[2],e}function BF(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[2]*s,e[1]=r[1]*n+r[3]*s,e[2]=t[2],e[3]=t[3],e}function R0(e,t,r){let n=t[0],s=t[1],i=t[2];return e[0]=r[0]*n+r[3]*s+r[6]*i,e[1]=r[1]*n+r[4]*s+r[7]*i,e[2]=r[2]*n+r[5]*s+r[8]*i,e[3]=t[3],e}function CM(){let e=new Vt(3);return Vt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Wnt(e){let t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function PM(e,t,r){let n=new Vt(3);return n[0]=e,n[1]=t,n[2]=r,n}function FF(e,t){let r=t[0],n=t[1],s=t[2],i=r*r+n*n+s*s;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function RM(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Ec(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[0],a=r[1],c=r[2];return e[0]=s*c-i*a,e[1]=i*o-n*c,e[2]=n*a-s*o,e}function I0(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[3]*n+r[7]*s+r[11]*i+r[15];return o=o||1,e[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/o,e[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/o,e[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/o,e}function O0(e,t,r){let n=t[0],s=t[1],i=t[2];return e[0]=n*r[0]+s*r[3]+i*r[6],e[1]=n*r[1]+s*r[4]+i*r[7],e[2]=n*r[2]+s*r[5]+i*r[8],e}function L0(e,t,r){let n=r[0],s=r[1],i=r[2],o=r[3],a=t[0],c=t[1],l=t[2],h=s*l-i*c,f=i*a-n*l,u=n*c-s*a,d=s*u-i*f,p=i*h-n*u,g=n*f-s*h,m=o*2;return h*=m,f*=m,u*=m,d*=2,p*=2,g*=2,e[0]=a+h+d,e[1]=c+f+p,e[2]=l+u+g,e}function DF(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[0],i[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),i[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function kF(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),i[1]=s[1],i[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function UF(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),i[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),i[2]=s[2],e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function zF(e,t){let r=e[0],n=e[1],s=e[2],i=t[0],o=t[1],a=t[2],c=Math.sqrt((r*r+n*n+s*s)*(i*i+o*o+a*a)),l=c&&RM(e,t)/c;return Math.acos(Math.min(Math.max(l,-1),1))}var VF=Wnt;var JWt=function(){let e=CM();return function(t,r,n,s,i,o){let a,c;for(r||(r=3),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}}();var IM=[0,0,0],N0,j=class extends Tc{static get ZERO(){return N0||(N0=new j(0,0,0),Object.freeze(N0)),N0}constructor(t=0,r=0,n=0){super(-0,-0,-0),arguments.length===1&&ds(t)?this.copy(t):(ee.debug&&(pt(t),pt(r),pt(n)),this[0]=t,this[1]=r,this[2]=n)}set(t,r,n){return this[0]=t,this[1]=r,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return ee.debug&&(pt(t.x),pt(t.y),pt(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=pt(t)}angle(t){return zF(this,t)}cross(t){return Ec(this,this,t),this.check()}rotateX({radians:t,origin:r=IM}){return DF(this,this,r,t),this.check()}rotateY({radians:t,origin:r=IM}){return kF(this,this,r,t),this.check()}rotateZ({radians:t,origin:r=IM}){return UF(this,this,r,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return I0(this,this,t),this.check()}transformAsVector(t){return LF(this,this,t),this.check()}transformByMatrix3(t){return O0(this,this,t),this.check()}transformByMatrix2(t){return NF(this,this,t),this.check()}transformByQuaternion(t){return L0(this,this,t),this.check()}};var B0,bc=class extends Tc{static get ZERO(){return B0||(B0=new bc(0,0,0,0),Object.freeze(B0)),B0}constructor(t=0,r=0,n=0,s=0){super(-0,-0,-0,-0),ds(t)&&arguments.length===1?this.copy(t):(ee.debug&&(pt(t),pt(r),pt(n),pt(s)),this[0]=t,this[1]=r,this[2]=n,this[3]=s)}set(t,r,n,s){return this[0]=t,this[1]=r,this[2]=n,this[3]=s,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return ee.debug&&(pt(t.x),pt(t.y),pt(t.z),pt(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=pt(t)}get w(){return this[3]}set w(t){this[3]=pt(t)}transform(t){return I0(this,this,t),this.check()}transformByMatrix3(t){return R0(this,this,t),this.check()}transformByMatrix2(t){return BF(this,this,t),this.check()}transformByQuaternion(t){return L0(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}};var F0=class extends mi{toString(){let t="[";if(ee.printRowMajor){t+="row-major:";for(let r=0;r<this.RANK;++r)for(let n=0;n<this.RANK;++n)t+=` ${this[n*this.RANK+r]}`}else{t+="column-major:";for(let r=0;r<this.ELEMENTS;++r)t+=` ${this[r]}`}return t+="]",t}getElementIndex(t,r){return r*this.RANK+t}getElement(t,r){return this[r*this.RANK+t]}setElement(t,r,n){return this[r*this.RANK+t]=pt(n),this}getColumn(t,r=new Array(this.RANK).fill(-0)){let n=t*this.RANK;for(let s=0;s<this.RANK;++s)r[s]=this[n+s];return r}setColumn(t,r){let n=t*this.RANK;for(let s=0;s<this.RANK;++s)this[n+s]=r[s];return this}};function HF(){let e=new Vt(9);return Vt!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function WF(e,t){if(e===t){let r=t[1],n=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function GF(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=t[4],a=t[5],c=t[6],l=t[7],h=t[8],f=h*o-a*l,u=-h*i+a*c,d=l*i-o*c,p=r*f+n*u+s*d;return p?(p=1/p,e[0]=f*p,e[1]=(-h*n+s*l)*p,e[2]=(a*n-s*o)*p,e[3]=u*p,e[4]=(h*r-s*c)*p,e[5]=(-a*r+s*i)*p,e[6]=d*p,e[7]=(-l*r+n*c)*p,e[8]=(o*r-n*i)*p,e):null}function jF(e){let t=e[0],r=e[1],n=e[2],s=e[3],i=e[4],o=e[5],a=e[6],c=e[7],l=e[8];return t*(l*i-o*c)+r*(-l*s+o*a)+n*(c*s-i*a)}function OM(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=r[0],d=r[1],p=r[2],g=r[3],m=r[4],_=r[5],y=r[6],x=r[7],A=r[8];return e[0]=u*n+d*o+p*l,e[1]=u*s+d*a+p*h,e[2]=u*i+d*c+p*f,e[3]=g*n+m*o+_*l,e[4]=g*s+m*a+_*h,e[5]=g*i+m*c+_*f,e[6]=y*n+x*o+A*l,e[7]=y*s+x*a+A*h,e[8]=y*i+x*c+A*f,e}function qF(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=r[0],d=r[1];return e[0]=n,e[1]=s,e[2]=i,e[3]=o,e[4]=a,e[5]=c,e[6]=u*n+d*o+l,e[7]=u*s+d*a+h,e[8]=u*i+d*c+f,e}function XF(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=Math.sin(r),d=Math.cos(r);return e[0]=d*n+u*o,e[1]=d*s+u*a,e[2]=d*i+u*c,e[3]=d*o-u*n,e[4]=d*a-u*s,e[5]=d*c-u*i,e[6]=l,e[7]=h,e[8]=f,e}function LM(e,t,r){let n=r[0],s=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function YF(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=r+r,a=n+n,c=s+s,l=r*o,h=n*o,f=n*a,u=s*o,d=s*a,p=s*c,g=i*o,m=i*a,_=i*c;return e[0]=1-f-p,e[3]=h-_,e[6]=u+m,e[1]=h+_,e[4]=1-l-p,e[7]=d-g,e[2]=u-m,e[5]=d+g,e[8]=1-l-f,e}var NM;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"})(NM||(NM={}));var qnt=Object.freeze([1,0,0,0,1,0,0,0,1]),Ht=class extends F0{static get IDENTITY(){return Ynt()}static get ZERO(){return Xnt()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return NM}constructor(t,...r){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):r.length>0?this.copy([t,...r]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(qnt)}fromObject(t){return this.check()}fromQuaternion(t){return YF(this,t),this.check()}set(t,r,n,s,i,o,a,c,l){return this[0]=t,this[1]=r,this[2]=n,this[3]=s,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this.check()}setRowMajor(t,r,n,s,i,o,a,c,l){return this[0]=t,this[1]=s,this[2]=a,this[3]=r,this[4]=i,this[5]=c,this[6]=n,this[7]=o,this[8]=l,this.check()}determinant(){return jF(this)}transpose(){return WF(this,this),this.check()}invert(){return GF(this,this),this.check()}multiplyLeft(t){return OM(this,t,this),this.check()}multiplyRight(t){return OM(this,this,t),this.check()}rotate(t){return XF(this,this,t),this.check()}scale(t){return Array.isArray(t)?LM(this,this,t):LM(this,this,[t,t]),this.check()}translate(t){return qF(this,this,t),this.check()}transform(t,r){let n;switch(t.length){case 2:n=OF(r||[-0,-0],t,this);break;case 3:n=O0(r||[-0,-0,-0],t,this);break;case 4:n=R0(r||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return P0(n,t.length),n}transformVector(t,r){return this.transform(t,r)}transformVector2(t,r){return this.transform(t,r)}transformVector3(t,r){return this.transform(t,r)}},D0,k0=null;function Xnt(){return D0||(D0=new Ht([0,0,0,0,0,0,0,0,0]),Object.freeze(D0)),D0}function Ynt(){return k0||(k0=new Ht,Object.freeze(k0)),k0}var gu={};Bt(gu,{add:()=>Lst,adjoint:()=>rst,clone:()=>Knt,copy:()=>Znt,create:()=>$nt,decompose:()=>yst,determinant:()=>nst,equals:()=>Dst,exactEquals:()=>Fst,frob:()=>Ost,fromQuat:()=>Mst,fromQuat2:()=>mst,fromRotation:()=>ust,fromRotationTranslation:()=>ZF,fromRotationTranslationScale:()=>Ast,fromRotationTranslationScaleOrigin:()=>Tst,fromScaling:()=>fst,fromTranslation:()=>hst,fromValues:()=>Jnt,fromXRotation:()=>dst,fromYRotation:()=>pst,fromZRotation:()=>gst,frustum:()=>Est,getRotation:()=>xst,getScaling:()=>JF,getTranslation:()=>_st,identity:()=>$F,invert:()=>est,lookAt:()=>Pst,mul:()=>kst,multiply:()=>KF,multiplyScalar:()=>Nst,multiplyScalarAndAdd:()=>Bst,ortho:()=>wst,orthoNO:()=>t4,orthoZO:()=>Cst,perspective:()=>bst,perspectiveFromFieldOfView:()=>vst,perspectiveNO:()=>QF,perspectiveZO:()=>Sst,rotate:()=>ost,rotateX:()=>ast,rotateY:()=>cst,rotateZ:()=>lst,scale:()=>ist,set:()=>Qnt,str:()=>Ist,sub:()=>Ust,subtract:()=>e4,targetTo:()=>Rst,translate:()=>sst,transpose:()=>tst});function $nt(){let e=new Vt(16);return Vt!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Knt(e){let t=new Vt(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Znt(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Jnt(e,t,r,n,s,i,o,a,c,l,h,f,u,d,p,g){let m=new Vt(16);return m[0]=e,m[1]=t,m[2]=r,m[3]=n,m[4]=s,m[5]=i,m[6]=o,m[7]=a,m[8]=c,m[9]=l,m[10]=h,m[11]=f,m[12]=u,m[13]=d,m[14]=p,m[15]=g,m}function Qnt(e,t,r,n,s,i,o,a,c,l,h,f,u,d,p,g,m){return e[0]=t,e[1]=r,e[2]=n,e[3]=s,e[4]=i,e[5]=o,e[6]=a,e[7]=c,e[8]=l,e[9]=h,e[10]=f,e[11]=u,e[12]=d,e[13]=p,e[14]=g,e[15]=m,e}function $F(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function tst(e,t){if(e===t){let r=t[1],n=t[2],s=t[3],i=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=i,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function est(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=t[4],a=t[5],c=t[6],l=t[7],h=t[8],f=t[9],u=t[10],d=t[11],p=t[12],g=t[13],m=t[14],_=t[15],y=r*a-n*o,x=r*c-s*o,A=r*l-i*o,M=n*c-s*a,E=n*l-i*a,w=s*l-i*c,v=h*g-f*p,b=h*m-u*p,T=h*_-d*p,I=f*m-u*g,N=f*_-d*g,B=u*_-d*m,C=y*B-x*N+A*I+M*T-E*b+w*v;return C?(C=1/C,e[0]=(a*B-c*N+l*I)*C,e[1]=(s*N-n*B-i*I)*C,e[2]=(g*w-m*E+_*M)*C,e[3]=(u*E-f*w-d*M)*C,e[4]=(c*T-o*B-l*b)*C,e[5]=(r*B-s*T+i*b)*C,e[6]=(m*A-p*w-_*x)*C,e[7]=(h*w-u*A+d*x)*C,e[8]=(o*N-a*T+l*v)*C,e[9]=(n*T-r*N-i*v)*C,e[10]=(p*E-g*A+_*y)*C,e[11]=(f*A-h*E-d*y)*C,e[12]=(a*b-o*I-c*v)*C,e[13]=(r*I-n*b+s*v)*C,e[14]=(g*x-p*M-m*y)*C,e[15]=(h*M-f*x+u*y)*C,e):null}function rst(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=t[4],a=t[5],c=t[6],l=t[7],h=t[8],f=t[9],u=t[10],d=t[11],p=t[12],g=t[13],m=t[14],_=t[15],y=r*a-n*o,x=r*c-s*o,A=r*l-i*o,M=n*c-s*a,E=n*l-i*a,w=s*l-i*c,v=h*g-f*p,b=h*m-u*p,T=h*_-d*p,I=f*m-u*g,N=f*_-d*g,B=u*_-d*m;return e[0]=a*B-c*N+l*I,e[1]=s*N-n*B-i*I,e[2]=g*w-m*E+_*M,e[3]=u*E-f*w-d*M,e[4]=c*T-o*B-l*b,e[5]=r*B-s*T+i*b,e[6]=m*A-p*w-_*x,e[7]=h*w-u*A+d*x,e[8]=o*N-a*T+l*v,e[9]=n*T-r*N-i*v,e[10]=p*E-g*A+_*y,e[11]=f*A-h*E-d*y,e[12]=a*b-o*I-c*v,e[13]=r*I-n*b+s*v,e[14]=g*x-p*M-m*y,e[15]=h*M-f*x+u*y,e}function nst(e){let t=e[0],r=e[1],n=e[2],s=e[3],i=e[4],o=e[5],a=e[6],c=e[7],l=e[8],h=e[9],f=e[10],u=e[11],d=e[12],p=e[13],g=e[14],m=e[15],_=t*o-r*i,y=t*a-n*i,x=r*a-n*o,A=l*p-h*d,M=l*g-f*d,E=h*g-f*p,w=t*E-r*M+n*A,v=i*E-o*M+a*A,b=l*x-h*y+f*_,T=d*x-p*y+g*_;return c*w-s*v+m*b-u*T}function KF(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=t[9],d=t[10],p=t[11],g=t[12],m=t[13],_=t[14],y=t[15],x=r[0],A=r[1],M=r[2],E=r[3];return e[0]=x*n+A*a+M*f+E*g,e[1]=x*s+A*c+M*u+E*m,e[2]=x*i+A*l+M*d+E*_,e[3]=x*o+A*h+M*p+E*y,x=r[4],A=r[5],M=r[6],E=r[7],e[4]=x*n+A*a+M*f+E*g,e[5]=x*s+A*c+M*u+E*m,e[6]=x*i+A*l+M*d+E*_,e[7]=x*o+A*h+M*p+E*y,x=r[8],A=r[9],M=r[10],E=r[11],e[8]=x*n+A*a+M*f+E*g,e[9]=x*s+A*c+M*u+E*m,e[10]=x*i+A*l+M*d+E*_,e[11]=x*o+A*h+M*p+E*y,x=r[12],A=r[13],M=r[14],E=r[15],e[12]=x*n+A*a+M*f+E*g,e[13]=x*s+A*c+M*u+E*m,e[14]=x*i+A*l+M*d+E*_,e[15]=x*o+A*h+M*p+E*y,e}function sst(e,t,r){let n=r[0],s=r[1],i=r[2],o,a,c,l,h,f,u,d,p,g,m,_;return t===e?(e[12]=t[0]*n+t[4]*s+t[8]*i+t[12],e[13]=t[1]*n+t[5]*s+t[9]*i+t[13],e[14]=t[2]*n+t[6]*s+t[10]*i+t[14],e[15]=t[3]*n+t[7]*s+t[11]*i+t[15]):(o=t[0],a=t[1],c=t[2],l=t[3],h=t[4],f=t[5],u=t[6],d=t[7],p=t[8],g=t[9],m=t[10],_=t[11],e[0]=o,e[1]=a,e[2]=c,e[3]=l,e[4]=h,e[5]=f,e[6]=u,e[7]=d,e[8]=p,e[9]=g,e[10]=m,e[11]=_,e[12]=o*n+h*s+p*i+t[12],e[13]=a*n+f*s+g*i+t[13],e[14]=c*n+u*s+m*i+t[14],e[15]=l*n+d*s+_*i+t[15]),e}function ist(e,t,r){let n=r[0],s=r[1],i=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ost(e,t,r,n){let s=n[0],i=n[1],o=n[2],a=Math.sqrt(s*s+i*i+o*o),c,l,h,f,u,d,p,g,m,_,y,x,A,M,E,w,v,b,T,I,N,B,C,V;return a<1e-6?null:(a=1/a,s*=a,i*=a,o*=a,l=Math.sin(r),c=Math.cos(r),h=1-c,f=t[0],u=t[1],d=t[2],p=t[3],g=t[4],m=t[5],_=t[6],y=t[7],x=t[8],A=t[9],M=t[10],E=t[11],w=s*s*h+c,v=i*s*h+o*l,b=o*s*h-i*l,T=s*i*h-o*l,I=i*i*h+c,N=o*i*h+s*l,B=s*o*h+i*l,C=i*o*h-s*l,V=o*o*h+c,e[0]=f*w+g*v+x*b,e[1]=u*w+m*v+A*b,e[2]=d*w+_*v+M*b,e[3]=p*w+y*v+E*b,e[4]=f*T+g*I+x*N,e[5]=u*T+m*I+A*N,e[6]=d*T+_*I+M*N,e[7]=p*T+y*I+E*N,e[8]=f*B+g*C+x*V,e[9]=u*B+m*C+A*V,e[10]=d*B+_*C+M*V,e[11]=p*B+y*C+E*V,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function ast(e,t,r){let n=Math.sin(r),s=Math.cos(r),i=t[4],o=t[5],a=t[6],c=t[7],l=t[8],h=t[9],f=t[10],u=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*s+l*n,e[5]=o*s+h*n,e[6]=a*s+f*n,e[7]=c*s+u*n,e[8]=l*s-i*n,e[9]=h*s-o*n,e[10]=f*s-a*n,e[11]=u*s-c*n,e}function cst(e,t,r){let n=Math.sin(r),s=Math.cos(r),i=t[0],o=t[1],a=t[2],c=t[3],l=t[8],h=t[9],f=t[10],u=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*s-l*n,e[1]=o*s-h*n,e[2]=a*s-f*n,e[3]=c*s-u*n,e[8]=i*n+l*s,e[9]=o*n+h*s,e[10]=a*n+f*s,e[11]=c*n+u*s,e}function lst(e,t,r){let n=Math.sin(r),s=Math.cos(r),i=t[0],o=t[1],a=t[2],c=t[3],l=t[4],h=t[5],f=t[6],u=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*s+l*n,e[1]=o*s+h*n,e[2]=a*s+f*n,e[3]=c*s+u*n,e[4]=l*s-i*n,e[5]=h*s-o*n,e[6]=f*s-a*n,e[7]=u*s-c*n,e}function hst(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function fst(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ust(e,t,r){let n=r[0],s=r[1],i=r[2],o=Math.sqrt(n*n+s*s+i*i),a,c,l;return o<1e-6?null:(o=1/o,n*=o,s*=o,i*=o,c=Math.sin(t),a=Math.cos(t),l=1-a,e[0]=n*n*l+a,e[1]=s*n*l+i*c,e[2]=i*n*l-s*c,e[3]=0,e[4]=n*s*l-i*c,e[5]=s*s*l+a,e[6]=i*s*l+n*c,e[7]=0,e[8]=n*i*l+s*c,e[9]=s*i*l-n*c,e[10]=i*i*l+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function dst(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pst(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function gst(e,t){let r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ZF(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=n+n,c=s+s,l=i+i,h=n*a,f=n*c,u=n*l,d=s*c,p=s*l,g=i*l,m=o*a,_=o*c,y=o*l;return e[0]=1-(d+g),e[1]=f+y,e[2]=u-_,e[3]=0,e[4]=f-y,e[5]=1-(h+g),e[6]=p+m,e[7]=0,e[8]=u+_,e[9]=p-m,e[10]=1-(h+d),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function mst(e,t){let r=new Vt(3),n=-t[0],s=-t[1],i=-t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=n*n+s*s+i*i+o*o;return f>0?(r[0]=(a*o+h*n+c*i-l*s)*2/f,r[1]=(c*o+h*s+l*n-a*i)*2/f,r[2]=(l*o+h*i+a*s-c*n)*2/f):(r[0]=(a*o+h*n+c*i-l*s)*2,r[1]=(c*o+h*s+l*n-a*i)*2,r[2]=(l*o+h*i+a*s-c*n)*2),ZF(e,t,r),e}function _st(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function JF(e,t){let r=t[0],n=t[1],s=t[2],i=t[4],o=t[5],a=t[6],c=t[8],l=t[9],h=t[10];return e[0]=Math.sqrt(r*r+n*n+s*s),e[1]=Math.sqrt(i*i+o*o+a*a),e[2]=Math.sqrt(c*c+l*l+h*h),e}function xst(e,t){let r=new Vt(3);JF(r,t);let n=1/r[0],s=1/r[1],i=1/r[2],o=t[0]*n,a=t[1]*s,c=t[2]*i,l=t[4]*n,h=t[5]*s,f=t[6]*i,u=t[8]*n,d=t[9]*s,p=t[10]*i,g=o+h+p,m=0;return g>0?(m=Math.sqrt(g+1)*2,e[3]=.25*m,e[0]=(f-d)/m,e[1]=(u-c)/m,e[2]=(a-l)/m):o>h&&o>p?(m=Math.sqrt(1+o-h-p)*2,e[3]=(f-d)/m,e[0]=.25*m,e[1]=(a+l)/m,e[2]=(u+c)/m):h>p?(m=Math.sqrt(1+h-o-p)*2,e[3]=(u-c)/m,e[0]=(a+l)/m,e[1]=.25*m,e[2]=(f+d)/m):(m=Math.sqrt(1+p-o-h)*2,e[3]=(a-l)/m,e[0]=(u+c)/m,e[1]=(f+d)/m,e[2]=.25*m),e}function yst(e,t,r,n){t[0]=n[12],t[1]=n[13],t[2]=n[14];let s=n[0],i=n[1],o=n[2],a=n[4],c=n[5],l=n[6],h=n[8],f=n[9],u=n[10];r[0]=Math.sqrt(s*s+i*i+o*o),r[1]=Math.sqrt(a*a+c*c+l*l),r[2]=Math.sqrt(h*h+f*f+u*u);let d=1/r[0],p=1/r[1],g=1/r[2],m=s*d,_=i*p,y=o*g,x=a*d,A=c*p,M=l*g,E=h*d,w=f*p,v=u*g,b=m+A+v,T=0;return b>0?(T=Math.sqrt(b+1)*2,e[3]=.25*T,e[0]=(M-w)/T,e[1]=(E-y)/T,e[2]=(_-x)/T):m>A&&m>v?(T=Math.sqrt(1+m-A-v)*2,e[3]=(M-w)/T,e[0]=.25*T,e[1]=(_+x)/T,e[2]=(E+y)/T):A>v?(T=Math.sqrt(1+A-m-v)*2,e[3]=(E-y)/T,e[0]=(_+x)/T,e[1]=.25*T,e[2]=(M+w)/T):(T=Math.sqrt(1+v-m-A)*2,e[3]=(_-x)/T,e[0]=(E+y)/T,e[1]=(M+w)/T,e[2]=.25*T),e}function Ast(e,t,r,n){let s=t[0],i=t[1],o=t[2],a=t[3],c=s+s,l=i+i,h=o+o,f=s*c,u=s*l,d=s*h,p=i*l,g=i*h,m=o*h,_=a*c,y=a*l,x=a*h,A=n[0],M=n[1],E=n[2];return e[0]=(1-(p+m))*A,e[1]=(u+x)*A,e[2]=(d-y)*A,e[3]=0,e[4]=(u-x)*M,e[5]=(1-(f+m))*M,e[6]=(g+_)*M,e[7]=0,e[8]=(d+y)*E,e[9]=(g-_)*E,e[10]=(1-(f+p))*E,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Tst(e,t,r,n,s){let i=t[0],o=t[1],a=t[2],c=t[3],l=i+i,h=o+o,f=a+a,u=i*l,d=i*h,p=i*f,g=o*h,m=o*f,_=a*f,y=c*l,x=c*h,A=c*f,M=n[0],E=n[1],w=n[2],v=s[0],b=s[1],T=s[2],I=(1-(g+_))*M,N=(d+A)*M,B=(p-x)*M,C=(d-A)*E,V=(1-(u+_))*E,rt=(m+y)*E,J=(p+x)*w,St=(m-y)*w,ht=(1-(u+g))*w;return e[0]=I,e[1]=N,e[2]=B,e[3]=0,e[4]=C,e[5]=V,e[6]=rt,e[7]=0,e[8]=J,e[9]=St,e[10]=ht,e[11]=0,e[12]=r[0]+v-(I*v+C*b+J*T),e[13]=r[1]+b-(N*v+V*b+St*T),e[14]=r[2]+T-(B*v+rt*b+ht*T),e[15]=1,e}function Mst(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=r+r,a=n+n,c=s+s,l=r*o,h=n*o,f=n*a,u=s*o,d=s*a,p=s*c,g=i*o,m=i*a,_=i*c;return e[0]=1-f-p,e[1]=h+_,e[2]=u-m,e[3]=0,e[4]=h-_,e[5]=1-l-p,e[6]=d+g,e[7]=0,e[8]=u+m,e[9]=d-g,e[10]=1-l-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Est(e,t,r,n,s,i,o){let a=1/(r-t),c=1/(s-n),l=1/(i-o);return e[0]=i*2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i*2*c,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(s+n)*c,e[10]=(o+i)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*l,e[15]=0,e}function QF(e,t,r,n,s){let i=1/Math.tan(t/2);if(e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0){let o=1/(n-s);e[10]=(s+n)*o,e[14]=2*s*n*o}else e[10]=-1,e[14]=-2*n;return e}var bst=QF;function Sst(e,t,r,n,s){let i=1/Math.tan(t/2);if(e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0){let o=1/(n-s);e[10]=s*o,e[14]=s*n*o}else e[10]=-1,e[14]=-n;return e}function vst(e,t,r,n){let s=Math.tan(t.upDegrees*Math.PI/180),i=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),c=2/(o+a),l=2/(s+i);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-((o-a)*c*.5),e[9]=(s-i)*l*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function t4(e,t,r,n,s,i,o){let a=1/(t-r),c=1/(n-s),l=1/(i-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*a,e[13]=(s+n)*c,e[14]=(o+i)*l,e[15]=1,e}var wst=t4;function Cst(e,t,r,n,s,i,o){let a=1/(t-r),c=1/(n-s),l=1/(i-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=l,e[11]=0,e[12]=(t+r)*a,e[13]=(s+n)*c,e[14]=i*l,e[15]=1,e}function Pst(e,t,r,n){let s,i,o,a,c,l,h,f,u,d,p=t[0],g=t[1],m=t[2],_=n[0],y=n[1],x=n[2],A=r[0],M=r[1],E=r[2];return Math.abs(p-A)<1e-6&&Math.abs(g-M)<1e-6&&Math.abs(m-E)<1e-6?$F(e):(f=p-A,u=g-M,d=m-E,s=1/Math.sqrt(f*f+u*u+d*d),f*=s,u*=s,d*=s,i=y*d-x*u,o=x*f-_*d,a=_*u-y*f,s=Math.sqrt(i*i+o*o+a*a),s?(s=1/s,i*=s,o*=s,a*=s):(i=0,o=0,a=0),c=u*a-d*o,l=d*i-f*a,h=f*o-u*i,s=Math.sqrt(c*c+l*l+h*h),s?(s=1/s,c*=s,l*=s,h*=s):(c=0,l=0,h=0),e[0]=i,e[1]=c,e[2]=f,e[3]=0,e[4]=o,e[5]=l,e[6]=u,e[7]=0,e[8]=a,e[9]=h,e[10]=d,e[11]=0,e[12]=-(i*p+o*g+a*m),e[13]=-(c*p+l*g+h*m),e[14]=-(f*p+u*g+d*m),e[15]=1,e)}function Rst(e,t,r,n){let s=t[0],i=t[1],o=t[2],a=n[0],c=n[1],l=n[2],h=s-r[0],f=i-r[1],u=o-r[2],d=h*h+f*f+u*u;d>0&&(d=1/Math.sqrt(d),h*=d,f*=d,u*=d);let p=c*u-l*f,g=l*h-a*u,m=a*f-c*h;return d=p*p+g*g+m*m,d>0&&(d=1/Math.sqrt(d),p*=d,g*=d,m*=d),e[0]=p,e[1]=g,e[2]=m,e[3]=0,e[4]=f*m-u*g,e[5]=u*p-h*m,e[6]=h*g-f*p,e[7]=0,e[8]=h,e[9]=f,e[10]=u,e[11]=0,e[12]=s,e[13]=i,e[14]=o,e[15]=1,e}function Ist(e){return`mat4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]}, ${e[4]}, ${e[5]}, ${e[6]}, ${e[7]}, ${e[8]}, ${e[9]}, ${e[10]}, ${e[11]}, ${e[12]}, ${e[13]}, ${e[14]}, ${e[15]})`}function Ost(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]+e[4]*e[4]+e[5]*e[5]+e[6]*e[6]+e[7]*e[7]+e[8]*e[8]+e[9]*e[9]+e[10]*e[10]+e[11]*e[11]+e[12]*e[12]+e[13]*e[13]+e[14]*e[14]+e[15]*e[15])}function Lst(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function e4(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function Nst(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function Bst(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e[9]=t[9]+r[9]*n,e[10]=t[10]+r[10]*n,e[11]=t[11]+r[11]*n,e[12]=t[12]+r[12]*n,e[13]=t[13]+r[13]*n,e[14]=t[14]+r[14]*n,e[15]=t[15]+r[15]*n,e}function Fst(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Dst(e,t){let r=e[0],n=e[1],s=e[2],i=e[3],o=e[4],a=e[5],c=e[6],l=e[7],h=e[8],f=e[9],u=e[10],d=e[11],p=e[12],g=e[13],m=e[14],_=e[15],y=t[0],x=t[1],A=t[2],M=t[3],E=t[4],w=t[5],v=t[6],b=t[7],T=t[8],I=t[9],N=t[10],B=t[11],C=t[12],V=t[13],rt=t[14],J=t[15];return Math.abs(r-y)<=1e-6*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(n-x)<=1e-6*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(s-A)<=1e-6*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(i-M)<=1e-6*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(o-E)<=1e-6*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(a-w)<=1e-6*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(c-v)<=1e-6*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(l-b)<=1e-6*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(h-T)<=1e-6*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(f-I)<=1e-6*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(u-N)<=1e-6*Math.max(1,Math.abs(u),Math.abs(N))&&Math.abs(d-B)<=1e-6*Math.max(1,Math.abs(d),Math.abs(B))&&Math.abs(p-C)<=1e-6*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(g-V)<=1e-6*Math.max(1,Math.abs(g),Math.abs(V))&&Math.abs(m-rt)<=1e-6*Math.max(1,Math.abs(m),Math.abs(rt))&&Math.abs(_-J)<=1e-6*Math.max(1,Math.abs(_),Math.abs(J))}var kst=KF,Ust=e4;function zst(){let e=new Vt(4);return Vt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function r4(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function n4(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function s4(e){let t=e[0],r=e[1],n=e[2],s=e[3];return Math.sqrt(t*t+r*r+n*n+s*s)}function i4(e){let t=e[0],r=e[1],n=e[2],s=e[3];return t*t+r*r+n*n+s*s}function o4(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=r*r+n*n+s*s+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=n*o,e[2]=s*o,e[3]=i*o,e}function a4(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function c4(e,t,r,n){let s=t[0],i=t[1],o=t[2],a=t[3];return e[0]=s+n*(r[0]-s),e[1]=i+n*(r[1]-i),e[2]=o+n*(r[2]-o),e[3]=a+n*(r[3]-a),e}function l4(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[0],a=r[1],c=r[2],l=r[3],h=l*n+a*i-c*s,f=l*s+c*n-o*i,u=l*i+o*s-a*n,d=-o*n-a*s-c*i;return e[0]=h*l+d*-o+f*-c-u*-a,e[1]=f*l+d*-a+u*-o-h*-c,e[2]=u*l+d*-c+h*-a-f*-o,e[3]=t[3],e}var MGt=function(){let e=zst();return function(t,r,n,s,i,o){let a,c;for(r||(r=4),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}();function h4(){let e=new Vt(4);return Vt!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function f4(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function BM(e,t,r){r=r*.5;let n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function FM(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=r[0],c=r[1],l=r[2],h=r[3];return e[0]=n*h+o*a+s*l-i*c,e[1]=s*h+o*c+i*a-n*l,e[2]=i*h+o*l+n*c-s*a,e[3]=o*h-n*a-s*c-i*l,e}function u4(e,t,r){r*=.5;let n=t[0],s=t[1],i=t[2],o=t[3],a=Math.sin(r),c=Math.cos(r);return e[0]=n*c+o*a,e[1]=s*c+i*a,e[2]=i*c-s*a,e[3]=o*c-n*a,e}function d4(e,t,r){r*=.5;let n=t[0],s=t[1],i=t[2],o=t[3],a=Math.sin(r),c=Math.cos(r);return e[0]=n*c-i*a,e[1]=s*c+o*a,e[2]=i*c+n*a,e[3]=o*c-s*a,e}function p4(e,t,r){r*=.5;let n=t[0],s=t[1],i=t[2],o=t[3],a=Math.sin(r),c=Math.cos(r);return e[0]=n*c+s*a,e[1]=s*c-n*a,e[2]=i*c+o*a,e[3]=o*c-i*a,e}function g4(e,t){let r=t[0],n=t[1],s=t[2];return e[0]=r,e[1]=n,e[2]=s,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-s*s)),e}function mu(e,t,r,n){let s=t[0],i=t[1],o=t[2],a=t[3],c=r[0],l=r[1],h=r[2],f=r[3],u,d,p,g,m;return u=s*c+i*l+o*h+a*f,u<0&&(u=-u,c=-c,l=-l,h=-h,f=-f),1-u>1e-6?(d=Math.acos(u),m=Math.sin(d),p=Math.sin((1-n)*d)/m,g=Math.sin(n*d)/m):(p=1-n,g=n),e[0]=p*s+g*c,e[1]=p*i+g*l,e[2]=p*o+g*h,e[3]=p*a+g*f,e}function m4(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=r*r+n*n+s*s+i*i,a=o?1/o:0;return e[0]=-r*a,e[1]=-n*a,e[2]=-s*a,e[3]=i*a,e}function _4(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function DM(e,t){let r=t[0]+t[4]+t[8],n;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[s*3+s]&&(s=2);let i=(s+1)%3,o=(s+2)%3;n=Math.sqrt(t[s*3+s]-t[i*3+i]-t[o*3+o]+1),e[s]=.5*n,n=.5/n,e[3]=(t[i*3+o]-t[o*3+i])*n,e[i]=(t[i*3+s]+t[s*3+i])*n,e[o]=(t[o*3+s]+t[s*3+o])*n}return e}var x4=r4;var y4=n4,A4=a4,T4=c4,M4=s4;var E4=i4;var b4=o4;var S4=function(){let e=CM(),t=PM(1,0,0),r=PM(0,1,0);return function(n,s,i){let o=RM(s,i);return o<-.999999?(Ec(e,t,s),VF(e)<1e-6&&Ec(e,r,s),FF(e,e),BM(n,e,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Ec(e,s,i),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+o,b4(n,n))}}(),CGt=function(){let e=h4(),t=h4();return function(r,n,s,i,o,a){return mu(e,n,o,a),mu(t,s,i,a),mu(r,e,t,2*a*(1-a)),r}}(),PGt=function(){let e=HF();return function(t,r,n,s){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=s[0],e[4]=s[1],e[7]=s[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],b4(t,DM(t,e))}}();var Hst=[0,0,0,1],Sc=class extends mi{constructor(t=0,r=0,n=0,s=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,r,n,s)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,r,n,s){return this[0]=t,this[1]=r,this[2]=n,this[3]=s,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return DM(this,t),this.check()}fromAxisRotation(t,r){return BM(this,t,r),this.check()}identity(){return f4(this),this.check()}setAxisAngle(t,r){return this.fromAxisRotation(t,r)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=pt(t)}get y(){return this[1]}set y(t){this[1]=pt(t)}get z(){return this[2]}set z(t){this[2]=pt(t)}get w(){return this[3]}set w(t){this[3]=pt(t)}len(){return M4(this)}lengthSquared(){return E4(this)}dot(t){return A4(this,t)}rotationTo(t,r){return S4(this,t,r),this.check()}add(t){return x4(this,this,t),this.check()}calculateW(){return g4(this,this),this.check()}conjugate(){return _4(this,this),this.check()}invert(){return m4(this,this),this.check()}lerp(t,r,n){return n===void 0?this.lerp(this,t,r):(T4(this,t,r,n),this.check())}multiplyRight(t){return FM(this,this,t),this.check()}multiplyLeft(t){return FM(this,t,this),this.check()}normalize(){let t=this.len(),r=t>0?1/t:0;return this[0]=this[0]*r,this[1]=this[1]*r,this[2]=this[2]*r,this[3]=this[3]*r,t===0&&(this[3]=1),this.check()}rotateX(t){return u4(this,this,t),this.check()}rotateY(t){return d4(this,this,t),this.check()}rotateZ(t){return p4(this,this,t),this.check()}scale(t){return y4(this,this,t),this.check()}slerp(t,r,n){let s,i,o;switch(arguments.length){case 1:({start:s=Hst,target:i,ratio:o}=t);break;case 2:s=this,i=t,o=r;break;default:s=t,i=r,o=n}return mu(this,s,i,o),this.check()}transformVector4(t,r=new bc){return l4(r,t,this),P0(r,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,r){return this.setAxisAngle(t,r)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}};var vc={};Bt(vc,{EPSILON1:()=>Wst,EPSILON10:()=>Jst,EPSILON11:()=>Qst,EPSILON12:()=>tit,EPSILON13:()=>eit,EPSILON14:()=>rit,EPSILON15:()=>nit,EPSILON16:()=>sit,EPSILON17:()=>iit,EPSILON18:()=>oit,EPSILON19:()=>ait,EPSILON2:()=>Gst,EPSILON20:()=>cit,EPSILON3:()=>jst,EPSILON4:()=>qst,EPSILON5:()=>Xst,EPSILON6:()=>Yst,EPSILON7:()=>$st,EPSILON8:()=>Kst,EPSILON9:()=>Zst,PI_OVER_FOUR:()=>hit,PI_OVER_SIX:()=>fit,PI_OVER_TWO:()=>lit,TWO_PI:()=>uit});var Wst=.1,Gst=.01,jst=.001,qst=1e-4,Xst=1e-5,Yst=1e-6,$st=1e-7,Kst=1e-8,Zst=1e-9,Jst=1e-10,Qst=1e-11,tit=1e-12,eit=1e-13,rit=1e-14,nit=1e-15,sit=1e-16,iit=1e-17,oit=1e-18,ait=1e-19,cit=1e-20,lit=Math.PI/2,hit=Math.PI/4,fit=Math.PI/6,uit=Math.PI*2;var a7t=new j,c7t=new j;var _u=new j,v4=new j,Pr=class{constructor(t=[0,0,0],r=0){this.radius=-0,this.center=new j,this.fromCenterRadius(t,r)}fromCenterRadius(t,r){return this.center.from(t),this.radius=r,this}fromCornerPoints(t,r){return r=_u.from(r),this.center=new j().from(t).add(r).scale(.5),this.radius=this.center.distance(r),this}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}clone(){return new Pr(this.center,this.radius)}union(t){let r=this.center,n=this.radius,s=t.center,i=t.radius,o=_u.copy(s).subtract(r),a=o.magnitude();if(n>=a+i)return this.clone();if(i>=a+n)return t.clone();let c=(n+a+i)*.5;return v4.copy(o).scale((-n+c)/a).add(r),this.center.copy(v4),this.radius=c,this}expand(t){let n=_u.from(t).subtract(this.center).magnitude();return n>this.radius&&(this.radius=n),this}transform(t){this.center.transform(t);let r=gu.getScaling(_u,t);return this.radius=Math.max(r[0],Math.max(r[1],r[2]))*this.radius,this}distanceSquaredTo(t){let r=this.distanceTo(t);return r*r}distanceTo(t){let n=_u.from(t).subtract(this.center);return Math.max(0,n.len()-this.radius)}intersectPlane(t){let r=this.center,n=this.radius,i=t.normal.dot(r)+t.distance;return i<-n?me.OUTSIDE:i<n?me.INTERSECTING:me.INSIDE}};var dit=new j,pit=new j,U0=new j,z0=new j,V0=new j,git=new j,mit=new j,ps={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8},tn=class{constructor(t=[0,0,0],r=[0,0,0,0,0,0,0,0,0]){this.center=new j().from(t),this.halfAxes=new Ht(r)}get halfSize(){let t=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2);return[new j(t).len(),new j(r).len(),new j(n).len()]}get quaternion(){let t=this.halfAxes.getColumn(0),r=this.halfAxes.getColumn(1),n=this.halfAxes.getColumn(2),s=new j(t).normalize(),i=new j(r).normalize(),o=new j(n).normalize();return new Sc().fromMatrix3(new Ht([...s,...i,...o]))}fromCenterHalfSizeQuaternion(t,r,n){let s=new Sc(n),i=new Ht().fromQuaternion(s);return i[0]=i[0]*r[0],i[1]=i[1]*r[0],i[2]=i[2]*r[0],i[3]=i[3]*r[1],i[4]=i[4]*r[1],i[5]=i[5]*r[1],i[6]=i[6]*r[2],i[7]=i[7]*r[2],i[8]=i[8]*r[2],this.center=new j().from(t),this.halfAxes=i,this}clone(){return new tn(this.center,this.halfAxes)}equals(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}getBoundingSphere(t=new Pr){let r=this.halfAxes,n=r.getColumn(0,U0),s=r.getColumn(1,z0),i=r.getColumn(2,V0),o=dit.copy(n).add(s).add(i);return t.center.copy(this.center),t.radius=o.magnitude(),t}intersectPlane(t){let r=this.center,n=t.normal,s=this.halfAxes,i=n.x,o=n.y,a=n.z,c=Math.abs(i*s[ps.COLUMN0ROW0]+o*s[ps.COLUMN0ROW1]+a*s[ps.COLUMN0ROW2])+Math.abs(i*s[ps.COLUMN1ROW0]+o*s[ps.COLUMN1ROW1]+a*s[ps.COLUMN1ROW2])+Math.abs(i*s[ps.COLUMN2ROW0]+o*s[ps.COLUMN2ROW1]+a*s[ps.COLUMN2ROW2]),l=n.dot(r)+t.distance;return l<=-c?me.OUTSIDE:l>=c?me.INSIDE:me.INTERSECTING}distanceTo(t){return Math.sqrt(this.distanceSquaredTo(t))}distanceSquaredTo(t){let r=pit.from(t).subtract(this.center),n=this.halfAxes,s=n.getColumn(0,U0),i=n.getColumn(1,z0),o=n.getColumn(2,V0),a=s.magnitude(),c=i.magnitude(),l=o.magnitude();s.normalize(),i.normalize(),o.normalize();let h=0,f;return f=Math.abs(r.dot(s))-a,f>0&&(h+=f*f),f=Math.abs(r.dot(i))-c,f>0&&(h+=f*f),f=Math.abs(r.dot(o))-l,f>0&&(h+=f*f),h}computePlaneDistances(t,r,n=[-0,-0]){let s=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,o=this.center,a=this.halfAxes,c=a.getColumn(0,U0),l=a.getColumn(1,z0),h=a.getColumn(2,V0),f=git.copy(c).add(l).add(h).add(o),u=mit.copy(f).subtract(t),d=r.dot(u);return s=Math.min(d,s),i=Math.max(d,i),f.copy(o).add(c).add(l).subtract(h),u.copy(f).subtract(t),d=r.dot(u),s=Math.min(d,s),i=Math.max(d,i),f.copy(o).add(c).subtract(l).add(h),u.copy(f).subtract(t),d=r.dot(u),s=Math.min(d,s),i=Math.max(d,i),f.copy(o).add(c).subtract(l).subtract(h),u.copy(f).subtract(t),d=r.dot(u),s=Math.min(d,s),i=Math.max(d,i),o.copy(f).subtract(c).add(l).add(h),u.copy(f).subtract(t),d=r.dot(u),s=Math.min(d,s),i=Math.max(d,i),o.copy(f).subtract(c).add(l).subtract(h),u.copy(f).subtract(t),d=r.dot(u),s=Math.min(d,s),i=Math.max(d,i),o.copy(f).subtract(c).subtract(l).add(h),u.copy(f).subtract(t),d=r.dot(u),s=Math.min(d,s),i=Math.max(d,i),o.copy(f).subtract(c).subtract(l).subtract(h),u.copy(f).subtract(t),d=r.dot(u),s=Math.min(d,s),i=Math.max(d,i),n[0]=s,n[1]=i,n}transform(t){this.center.transformAsPoint(t);let r=this.halfAxes.getColumn(0,U0);r.transformAsPoint(t);let n=this.halfAxes.getColumn(1,z0);n.transformAsPoint(t);let s=this.halfAxes.getColumn(2,V0);return s.transformAsPoint(t),this.halfAxes=new Ht([...r,...n,...s]),this}getTransform(){throw new Error("not implemented")}};var w4=new j,C4=new j,Be=class{constructor(t=[0,0,1],r=0){this.normal=new j,this.distance=-0,this.fromNormalDistance(t,r)}fromNormalDistance(t,r){return wn(Number.isFinite(r)),this.normal.from(t).normalize(),this.distance=r,this}fromPointNormal(t,r){t=w4.from(t),this.normal.from(r).normalize();let n=-this.normal.dot(t);return this.distance=n,this}fromCoefficients(t,r,n,s){return this.normal.set(t,r,n),wn(gi(this.normal.len(),1)),this.distance=s,this}clone(){return new Be(this.normal,this.distance)}equals(t){return gi(this.distance,t.distance)&&gi(this.normal,t.normal)}getPointDistance(t){return this.normal.dot(t)+this.distance}transform(t){let r=C4.copy(this.normal).transformAsVector(t).normalize(),n=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(n,r)}projectPointOntoPlane(t,r=[0,0,0]){let n=w4.from(t),s=this.getPointDistance(n),i=C4.copy(this.normal).scale(s);return n.subtract(i).to(r)}};var P4=[new j([1,0,0]),new j([0,1,0]),new j([0,0,1])],R4=new j,_it=new j,_e=class{constructor(t=[]){this.planes=t}fromBoundingSphere(t){this.planes.length=2*P4.length;let r=t.center,n=t.radius,s=0;for(let i of P4){let o=this.planes[s],a=this.planes[s+1];o||(o=this.planes[s]=new Be),a||(a=this.planes[s+1]=new Be);let c=R4.copy(i).scale(-n).add(r);o.fromPointNormal(c,i);let l=R4.copy(i).scale(n).add(r),h=_it.copy(i).negate();a.fromPointNormal(l,h),s+=2}return this}computeVisibility(t){let r=me.INSIDE;for(let n of this.planes)switch(t.intersectPlane(n)){case me.OUTSIDE:return me.OUTSIDE;case me.INTERSECTING:r=me.INTERSECTING;break;default:}return r}computeVisibilityWithPlaneMask(t,r){if(wn(Number.isFinite(r),"parentPlaneMask is required."),r===_e.MASK_OUTSIDE||r===_e.MASK_INSIDE)return r;let n=_e.MASK_INSIDE,s=this.planes;for(let i=0;i<this.planes.length;++i){let o=i<31?1<<i:0;if(i<31&&!(r&o))continue;let a=s[i],c=t.intersectPlane(a);if(c===me.OUTSIDE)return _e.MASK_OUTSIDE;c===me.INTERSECTING&&(n|=o)}return n}};_e.MASK_OUTSIDE=4294967295;_e.MASK_INSIDE=0;_e.MASK_INDETERMINATE=2147483647;var w7t=new j,C7t=new j,P7t=new j,R7t=new j,I7t=new j;var D7t=new j,k7t=new j,U7t=new j,z7t=new j,V7t=new j,H7t=new j,W7t=new j,G7t=new j,j7t=new j,q7t=new j,X7t=new j,Y7t=new j;var Cn=new Ht,yit=new Ht,Ait=new Ht,H0=new Ht,I4=new Ht;function zM(e,t={}){let r=vc.EPSILON20,n=10,s=0,i=0,o=yit,a=Ait;o.identity(),a.copy(e);let c=r*Tit(a);for(;i<n&&Mit(a)>c;)Eit(a,H0),I4.copy(H0).transpose(),a.multiplyRight(H0),a.multiplyLeft(I4),o.multiplyRight(H0),++s>2&&(++i,s=0);return t.unitary=o.toTarget(t.unitary),t.diagonal=a.toTarget(t.diagonal),t}function Tit(e){let t=0;for(let r=0;r<9;++r){let n=e[r];t+=n*n}return Math.sqrt(t)}var kM=[1,0,0],UM=[2,2,1];function Mit(e){let t=0;for(let r=0;r<3;++r){let n=e[Cn.getElementIndex(UM[r],kM[r])];t+=2*n*n}return Math.sqrt(t)}function Eit(e,t){let r=vc.EPSILON15,n=0,s=1;for(let l=0;l<3;++l){let h=Math.abs(e[Cn.getElementIndex(UM[l],kM[l])]);h>n&&(s=l,n=h)}let i=kM[s],o=UM[s],a=1,c=0;if(Math.abs(e[Cn.getElementIndex(o,i)])>r){let l=e[Cn.getElementIndex(o,o)],h=e[Cn.getElementIndex(i,i)],f=e[Cn.getElementIndex(o,i)],u=(l-h)/2/f,d;u<0?d=-1/(-u+Math.sqrt(1+u*u)):d=1/(u+Math.sqrt(1+u*u)),a=1/Math.sqrt(1+d*d),c=d*a}return Ht.IDENTITY.to(t),t[Cn.getElementIndex(i,i)]=t[Cn.getElementIndex(o,o)]=a,t[Cn.getElementIndex(o,i)]=c,t[Cn.getElementIndex(i,o)]=-c,t}var _i=new j,Sit=new j,vit=new j,wit=new j,Cit=new j,Pit=new Ht,Rit={diagonal:new Ht,unitary:new Ht};function VM(e,t=new tn){if(!e||e.length===0)return t.halfAxes=new Ht([0,0,0,0,0,0,0,0,0]),t.center=new j,t;let r=e.length,n=new j(0,0,0);for(let b of e)n.add(b);let s=1/r;n.multiplyByScalar(s);let i=0,o=0,a=0,c=0,l=0,h=0;for(let b of e){let T=_i.copy(b).subtract(n);i+=T.x*T.x,o+=T.x*T.y,a+=T.x*T.z,c+=T.y*T.y,l+=T.y*T.z,h+=T.z*T.z}i*=s,o*=s,a*=s,c*=s,l*=s,h*=s;let f=Pit;f[0]=i,f[1]=o,f[2]=a,f[3]=o,f[4]=c,f[5]=l,f[6]=a,f[7]=l,f[8]=h;let{unitary:u}=zM(f,Rit),d=t.halfAxes.copy(u),p=d.getColumn(0,vit),g=d.getColumn(1,wit),m=d.getColumn(2,Cit),_=-Number.MAX_VALUE,y=-Number.MAX_VALUE,x=-Number.MAX_VALUE,A=Number.MAX_VALUE,M=Number.MAX_VALUE,E=Number.MAX_VALUE;for(let b of e)_i.copy(b),_=Math.max(_i.dot(p),_),y=Math.max(_i.dot(g),y),x=Math.max(_i.dot(m),x),A=Math.min(_i.dot(p),A),M=Math.min(_i.dot(g),M),E=Math.min(_i.dot(m),E);p=p.multiplyByScalar(.5*(A+_)),g=g.multiplyByScalar(.5*(M+y)),m=m.multiplyByScalar(.5*(E+x)),t.center.copy(p).add(g).add(m);let w=Sit.set(_-A,y-M,x-E).multiplyByScalar(.5),v=new Ht([w[0],0,0,0,w[1],0,0,0,w[2]]);return t.halfAxes.multiplyRight(v),t}var O4=new q,HM=new q,WM=new _e([new Be,new Be,new Be,new Be,new Be,new Be]);function N4(e,t){let{cameraDirection:r,cameraUp:n,height:s}=e,{metersPerUnit:i}=e.distanceScales,o=W0(e,e.center),a=ot.WGS84.eastNorthUpToFixedFrame(o),c=e.unprojectPosition(e.cameraPosition),l=ot.WGS84.cartographicToCartesian(c,new q),h=new q(a.transformAsVector(new q(r).scale(i))).normalize(),f=new q(a.transformAsVector(new q(n).scale(i))).normalize();Iit(e);let u=e.constructor,{longitude:d,latitude:p,width:g,bearing:m,zoom:_}=e,y=new u({longitude:d,latitude:p,height:s,width:g,bearing:m,zoom:_,pitch:0});return{camera:{position:l,direction:h,up:f},viewport:e,topDownViewport:y,height:s,cullingVolume:WM,frameNumber:t,sseDenominator:1.15}}function B4(e,t,r){if(r===0||e.length<=r)return[e,[]];let n=[],{longitude:s,latitude:i}=t.viewport;for(let[l,h]of e.entries()){let[f,u]=h.header.mbs,d=Math.abs(s-f),p=Math.abs(i-u),g=Math.sqrt(p*p+d*d);n.push([l,g])}let o=n.sort((l,h)=>l[1]-h[1]),a=[];for(let l=0;l<r;l++)a.push(e[o[l][0]]);let c=[];for(let l=r;l<o.length;l++)c.push(e[o[l][0]]);return[a,c]}function Iit(e){let t=e.getFrustumPlanes(),r=L4(t.near,e.cameraPosition),n=W0(e,r),s=W0(e,e.cameraPosition,HM),i=0;WM.planes[i++].fromPointNormal(n,O4.copy(n).subtract(s));for(let o in t){if(o==="near")continue;let a=t[o],c=L4(a,r,HM),l=W0(e,c,HM);WM.planes[i++].fromPointNormal(l,O4.copy(n).subtract(l))}}function L4(e,t,r=new q){let n=e.normal.dot(t);return r.copy(e.normal).scale(e.distance-n).add(t),r}function W0(e,t,r=new q){let n=e.unprojectPosition(t);return ot.WGS84.cartographicToCartesian(n,r)}var Oit=6378137,Lit=6378137,GM=6356752314245179e-9,wc=new q;function F4(e,t){if(e instanceof tn){let{halfAxes:r}=e,n=Nit(r);return Math.log2(GM/(n+t[2]))}else if(e instanceof Pr){let{radius:r}=e;return Math.log2(GM/(r+t[2]))}else if(e.width&&e.height){let{width:r,height:n}=e,s=Math.log2(Oit/r),i=Math.log2(Lit/n);return(s+i)/2}return 1}function jM(e,t,r){ot.WGS84.cartographicToCartesian([e.xmax,e.ymax,e.zmax],wc);let n=Math.sqrt(Math.pow(wc[0]-r[0],2)+Math.pow(wc[1]-r[1],2)+Math.pow(wc[2]-r[2],2));return Math.log2(GM/(n+t[2]))}function D4(e,t,r){let[n,s,i,o]=e;return jM({xmin:n,xmax:i,ymin:s,ymax:o,zmin:0,zmax:0},t,r)}function Nit(e){e.getColumn(0,wc);let t=e.getColumn(1),r=e.getColumn(2);return wc.add(t).add(r).len()}var Xe={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},Fe;(function(e){e[e.ADD=1]="ADD",e[e.REPLACE=2]="REPLACE"})(Fe||(Fe={}));var Rr;(function(e){e.EMPTY="empty",e.SCENEGRAPH="scenegraph",e.POINTCLOUD="pointcloud",e.MESH="mesh"})(Rr||(Rr={}));var xe;(function(e){e.I3S="I3S",e.TILES3D="TILES3D"})(xe||(xe={}));var gs;(function(e){e.GEOMETRIC_ERROR="geometricError",e.MAX_SCREEN_THRESHOLD="maxScreenThreshold"})(gs||(gs={}));var k4={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0};function H4(e){return e!=null}var De=new q,G0=new q,Bit=new q,Fit=new q,Oo=new q,U4=new q,z4=new q,V4=new q;function j0(e,t,r){if(nt(e,"3D Tile: boundingVolume must be defined"),e.box)return G4(e.box,t,r);if(e.region)return kit(e.region);if(e.sphere)return Dit(e.sphere,t,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function W4(e,t){if(e.box)return Uit(t);if(e.region){let[r,n,s,i,o,a]=e.region;return[[wr(r),wr(n),o],[wr(s),wr(i),a]]}if(e.sphere)return zit(t);throw new Error("Unkown boundingVolume type")}function G4(e,t,r){let n=new q(e[0],e[1],e[2]);t.transform(n,n);let s=[];if(e.length===10){let l=e.slice(3,6),h=new fu;h.fromArray(e,6);let f=new q([1,0,0]),u=new q([0,1,0]),d=new q([0,0,1]);f.transformByQuaternion(h),f.scale(l[0]),u.transformByQuaternion(h),u.scale(l[1]),d.transformByQuaternion(h),d.scale(l[2]),s=[...f.toArray(),...u.toArray(),...d.toArray()]}else s=[...e.slice(3,6),...e.slice(6,9),...e.slice(9,12)];let i=t.transformAsVector(s.slice(0,3)),o=t.transformAsVector(s.slice(3,6)),a=t.transformAsVector(s.slice(6,9)),c=new Io([i[0],i[1],i[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return H4(r)?(r.center=n,r.halfAxes=c,r):new tn(n,c)}function Dit(e,t,r){let n=new q(e[0],e[1],e[2]);t.transform(n,n);let s=t.getScale(G0),i=Math.max(Math.max(s[0],s[1]),s[2]),o=e[3]*i;return H4(r)?(r.center=n,r.radius=o,r):new Pr(n,o)}function kit(e){let[t,r,n,s,i,o]=e,a=ot.WGS84.cartographicToCartesian([wr(t),wr(s),i],Bit),c=ot.WGS84.cartographicToCartesian([wr(n),wr(r),o],Fit),l=new q().addVectors(a,c).multiplyByScalar(.5);return ot.WGS84.cartesianToCartographic(l,Oo),ot.WGS84.cartographicToCartesian([wr(n),Oo[1],Oo[2]],U4),ot.WGS84.cartographicToCartesian([Oo[0],wr(s),Oo[2]],z4),ot.WGS84.cartographicToCartesian([Oo[0],Oo[1],o],V4),G4([...l,...U4.subtract(l),...z4.subtract(l),...V4.subtract(l)],new wt)}function Uit(e){let t=j4(),{halfAxes:r}=e,n=new q(r.getColumn(0)),s=new q(r.getColumn(1)),i=new q(r.getColumn(2));for(let o=0;o<2;o++){for(let a=0;a<2;a++){for(let c=0;c<2;c++)De.copy(e.center),De.add(n),De.add(s),De.add(i),q4(t,De),i.negate();s.negate()}n.negate()}return t}function zit(e){let t=j4(),{center:r,radius:n}=e,s=ot.WGS84.scaleToGeodeticSurface(r,De),i;s?i=ot.WGS84.geodeticSurfaceNormal(s):i=new q(0,0,1);let o=new q(i[2],-i[1],0);o.len()>0?o.normalize():o=new q(0,1,0);let a=o.clone().cross(i);for(let c of[o,a,i]){G0.copy(c).scale(n);for(let l=0;l<2;l++)De.copy(r),De.add(G0),q4(t,De),G0.negate()}return t}function j4(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function q4(e,t){ot.WGS84.cartesianToCartographic(t,De),e[0][0]=Math.min(e[0][0],De[0]),e[0][1]=Math.min(e[0][1],De[1]),e[0][2]=Math.min(e[0][2],De[2]),e[1][0]=Math.max(e[1][0],De[0]),e[1][1]=Math.max(e[1][1],De[1]),e[1][2]=Math.max(e[1][2],De[2])}var Ljt=new q,Njt=new q,Bjt=new wt,Fjt=new q,Djt=new q,kjt=new q;function Vit(e,t){let r=e*t;return 1-Math.exp(-(r*r))}function Hit(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){let r=e.dynamicScreenSpaceErrorComputedDensity,n=e.dynamicScreenSpaceErrorFactor;return Vit(t,r)*n}return 0}function X4(e,t,r){let n=e.tileset,s=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,i=r?s:e.lodMetricValue;if(i===0)return 0;let o=Math.max(e._distanceToCamera,1e-7),{height:a,sseDenominator:c}=t,{viewDistanceScale:l}=n.options,h=i*a*(l||1)/(o*c);return h-=Hit(n,o),h}var qM=new q,Y4=new q,xi=new q,$4=new q,Wit=new q,XM=new wt,K4=new wt;function Z4(e,t){if(e.lodMetricValue===0||isNaN(e.lodMetricValue))return"DIG";let r=2*YM(e,t);return r<2?"OUT":!e.header.children||r<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}function YM(e,t){let{topDownViewport:r}=t,n=e.header.mbs[1],s=e.header.mbs[0],i=e.header.mbs[2],o=e.header.mbs[3],a=[...e.boundingVolume.center],c=r.unprojectPosition(r.cameraPosition);ot.WGS84.cartographicToCartesian(c,qM),Y4.copy(qM).subtract(a).normalize(),ot.WGS84.eastNorthUpToFixedFrame(a,XM),K4.copy(XM).invert(),xi.copy(qM).transform(K4);let l=Math.sqrt(xi[0]*xi[0]+xi[1]*xi[1]),h=l*l/xi[2];$4.copy([xi[0],xi[1],h]);let u=$4.transform(XM).subtract(a).normalize(),p=Y4.cross(u).normalize().scale(o).add(a),g=ot.WGS84.cartesianToCartographic(p),m=r.project([s,n,i]),_=r.project(g);return Wit.copy(m).subtract(_).magnitude()}function J4(e){return{assetGltfUpAxis:e.asset&&e.asset.gltfUpAxis||"Y"}}var xu=class{_map=new Map;_array;_length;constructor(t=0){this._array=new Array(t),this._length=t}get length(){return this._length}set length(t){this._length=t,t>this._array.length&&(this._array.length=t)}get values(){return this._array}get(t){return nt(t<this._array.length),this._array[t]}set(t,r){nt(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=r,this._map.set(r,t)}delete(t){let r=this._map.get(t);r>=0&&(this._array.splice(r,1),this._map.delete(t),this.length--)}peek(){return this._array[this._length-1]}push(t){if(!this._map.has(t)){let r=this.length++;this._array[r]=t,this._map.set(t,r)}}pop(){let t=this._array[--this.length];return this._map.delete(t),t}reserve(t){nt(t>=0),t>this._array.length&&(this._array.length=t)}resize(t){nt(t>=0),this.length=t}trim(t){t==null&&(t=this.length),this._array.length=t}reset(){this._array=[],this._map=new Map,this._length=0}find(t){return this._map.has(t)}};var Git={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""},Pn=class{options;root=null;selectedTiles={};requestedTiles={};emptyTiles={};lastUpdate=new Date().getTime();updateDebounceTime=1e3;_traversalStack=new xu;_emptyTraversalStack=new xu;_frameNumber=null;traversalFinished(t){return!0}constructor(t){this.options={...Git,...t}}traverse(t,r,n){this.root=t,this.options={...this.options,...n},this.reset(),this.updateTile(t,r),this._frameNumber=r.frameNumber,this.executeTraversal(t,r)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(t,r){let n=this._traversalStack;for(t._selectionDepth=1,n.push(t);n.length>0;){let i=n.pop(),o=!1;this.canTraverse(i,r)&&(this.updateChildTiles(i,r),o=this.updateAndPushChildren(i,r,n,i.hasRenderContent?i._selectionDepth+1:i._selectionDepth));let a=i.parent,c=Boolean(!a||a._shouldRefine),l=!o;i.hasRenderContent?i.refine===Fe.ADD?(this.loadTile(i,r),this.selectTile(i,r)):i.refine===Fe.REPLACE&&(this.loadTile(i,r),l&&this.selectTile(i,r)):(this.emptyTiles[i.id]=i,this.loadTile(i,r),l&&this.selectTile(i,r)),this.touchTile(i,r),i._shouldRefine=o&&c}let s=new Date().getTime();(this.traversalFinished(r)||s-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=s,this.options.onTraversalEnd(r))}updateChildTiles(t,r){let n=t.children;for(let s of n)this.updateTile(s,r)}updateAndPushChildren(t,r,n,s){let{loadSiblings:i,skipLevelOfDetail:o}=this.options,a=t.children;a.sort(this.compareDistanceToCamera.bind(this));let c=t.refine===Fe.REPLACE&&t.hasRenderContent&&!o,l=!1,h=!0;for(let f of a)if(f._selectionDepth=s,f.isVisibleAndInRequestVolume?(n.find(f)&&n.delete(f),n.push(f),l=!0):(c||i)&&(this.loadTile(f,r),this.touchTile(f,r)),c){let u;if(f._inRequestVolume?f.hasRenderContent?u=f.contentAvailable:u=this.executeEmptyTraversal(f,r):u=!1,h=h&&u,!h)return!1}return l||(h=!1),h}updateTile(t,r){this.updateTileVisibility(t,r)}selectTile(t,r){this.shouldSelectTile(t)&&(t._selectedFrame=r.frameNumber,this.selectedTiles[t.id]=t)}loadTile(t,r){this.shouldLoadTile(t)&&(t._requestedFrame=r.frameNumber,t._priority=t._getPriority(),this.requestedTiles[t.id]=t)}touchTile(t,r){t.tileset._cache.touch(t),t._touchedFrame=r.frameNumber}canTraverse(t,r,n=!1,s=!1){return t.hasChildren?t.hasTilesetContent?!t.contentExpired:!s&&!t.isVisibleAndInRequestVolume?!1:this.shouldRefine(t,r,n):!1}shouldLoadTile(t){return t.hasUnloadedContent||t.contentExpired}shouldSelectTile(t){return t.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(t,r,n=!1){let s=t._screenSpaceError;return n&&(s=t.getScreenSpaceError(r,!0)),s>t.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(t,r){let n=[];if(this.options.viewportTraversersMap)for(let s in this.options.viewportTraversersMap)this.options.viewportTraversersMap[s]===r.viewport.id&&n.push(s);else n.push(r.viewport.id);t.updateVisibility(r,n)}compareDistanceToCamera(t,r){return t._distanceToCamera-r._distanceToCamera}anyChildrenVisible(t,r){let n=!1;for(let s of t.children)s.updateVisibility(r),n=n||s.isVisibleAndInRequestVolume;return n}executeEmptyTraversal(t,r){let n=!0,s=this._emptyTraversalStack;for(s.push(t);s.length>0;){let i=s.pop(),o=!i.hasRenderContent&&this.canTraverse(i,r,!1,!1),a=!i.hasRenderContent&&i.children.length===0;if(!o&&!i.contentAvailable&&!a&&(n=!1),this.updateTile(i,r),i.isVisibleAndInRequestVolume||(this.loadTile(i,r),this.touchTile(i,r)),o){let c=i.children;for(let l of c)s.push(l)}}return n}};var Q4=new q;function jit(e){return e!=null}var Lo=class{tileset;header;id;url;parent;refine;type;contentUrl;lodMetricType="geometricError";lodMetricValue=0;boundingVolume=null;content=null;contentState=Xe.UNLOADED;gpuMemoryUsageInBytes=0;children=[];depth=0;viewportIds=[];transform=new wt;extensions=null;implicitTiling=null;userData={};computedTransform;hasEmptyContent=!1;hasTilesetContent=!1;traverser=new Pn({});_cacheNode=null;_frameNumber=null;_expireDate=null;_expiredContent=null;_boundingBox=void 0;_distanceToCamera=0;_screenSpaceError=0;_visibilityPlaneMask;_visible=void 0;_contentBoundingVolume;_viewerRequestVolume;_initialTransform=new wt;_priority=0;_selectedFrame=0;_requestedFrame=0;_selectionDepth=0;_touchedFrame=0;_centerZDepth=0;_shouldRefine=!1;_stackLength=0;_visitedFrame=0;_inRequestVolume=!1;_lodJudge=null;constructor(t,r,n,s=""){this.header=r,this.tileset=t,this.id=s||r.id,this.url=r.url,this.parent=n,this.refine=this._getRefine(r.refine),this.type=r.type,this.contentUrl=r.contentUrl,this._initializeLodMetric(r),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeRenderingState(r),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return this.header===null}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===Xe.READY||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===Xe.UNLOADED}get contentExpired(){return this.contentState===Xe.EXPIRED}get contentFailed(){return this.contentState===Xe.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=W4(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(t,r){switch(this.tileset.type){case xe.I3S:return YM(this,t);case xe.TILES3D:return X4(this,t,r);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){let t=this.tileset._traverser,{skipLevelOfDetail:r}=t.options,n=this.refine===Fe.ADD||r;if(n&&!this.isVisible&&this._visible!==void 0||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===Xe.UNLOADED)return-1;let s=this.parent,o=s&&(!n||this._screenSpaceError===0||s.hasTilesetContent)?s._screenSpaceError:this._screenSpaceError,a=t.root?t.root._screenSpaceError:0;return Math.max(a-o,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=Xe.LOADING;let r=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!r)return this.contentState=Xe.UNLOADED,!1;try{let n=this.tileset.getTileUrl(this.contentUrl),s=this.tileset.loader,i={...this.tileset.loadOptions,[s.id]:{...this.tileset.loadOptions[s.id],isTileset:this.type==="json",...this._getLoaderSpecificOptions(s.id)}};return this.content=await se(n,s,i),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=Xe.READY,this._onContentLoaded(),!0}catch(n){throw this.contentState=Xe.FAILED,n}finally{r.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=Xe.UNLOADED,!0}updateVisibility(t,r){if(this._frameNumber===t.frameNumber)return;let n=this.parent,s=n?n._visibilityPlaneMask:_e.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){let i=n?n.computedTransform:this.tileset.modelMatrix;this._updateTransform(i)}this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,s),this._visible=this._visibilityPlaneMask!==_e.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._frameNumber=t.frameNumber,this.viewportIds=r}visibility(t,r){let{cullingVolume:n}=t,{boundingVolume:s}=this;return n.computeVisibilityWithPlaneMask(s,r)}contentVisibility(){return!0}distanceToTile(t){let r=this.boundingVolume;return Math.sqrt(Math.max(r.distanceSquaredTo(t.camera.position),0))}cameraSpaceZDepth({camera:t}){let r=this.boundingVolume;return Q4.subVectors(r.center,t.position),t.direction.dot(Q4)}insideViewerRequestVolume(t){let r=this._viewerRequestVolume;return!r||r.distanceSquaredTo(t.camera.position)<=0}updateExpiration(){if(jit(this._expireDate)&&this.contentReady&&!this.hasEmptyContent){let t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=Xe.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(t){this.transform=t.transform?new wt(t.transform):new wt;let r=this.parent,n=this.tileset,s=r&&r.computedTransform?r.computedTransform.clone():n.modelMatrix.clone();this.computedTransform=new wt(s).multiplyRight(this.transform);let i=r&&r._initialTransform?r._initialTransform.clone():new wt;this._initialTransform=new wt(i).multiplyRight(this.transform)}_initializeBoundingVolumes(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}_initializeContent(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=Xe.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(t){this.depth=t.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=_e.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(t){return t||this.parent&&this.parent.refine||Fe.REPLACE}_isTileset(){return this.contentUrl.indexOf(".json")!==-1}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0;break;default:}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(t){this.boundingVolume=j0(t.boundingVolume,this.computedTransform,this.boundingVolume);let r=t.content;r&&(r.boundingVolume&&(this._contentBoundingVolume=j0(r.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=j0(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(t=new wt){let r=t.clone().multiplyRight(this.transform);r.equals(this.computedTransform)||(this.computedTransform=r,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(t){switch(t){case"i3s":return{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1};case"3d-tiles":case"cesium-ion":default:return J4(this.tileset.tileset)}}};var q0=class extends Pn{compareDistanceToCamera(t,r){return r._distanceToCamera===0&&t._distanceToCamera===0?r._centerZDepth-t._centerZDepth:r._distanceToCamera-t._distanceToCamera}updateTileVisibility(t,r){if(super.updateTileVisibility(t,r),!t.isVisibleAndInRequestVolume)return;let n=t.children.length>0;if(t.hasTilesetContent&&n){let o=t.children[0];this.updateTileVisibility(o,r),t._visible=o._visible;return}if(this.meetsScreenSpaceErrorEarly(t,r)){t._visible=!1;return}let s=t.refine===Fe.REPLACE,i=t._optimChildrenWithinParent===k4.USE_OPTIMIZATION;if(s&&i&&n&&!this.anyChildrenVisible(t,r)){t._visible=!1;return}}meetsScreenSpaceErrorEarly(t,r){let{parent:n}=t;return!n||n.hasTilesetContent||n.refine!==Fe.ADD?!1:!this.shouldRefine(t,r,!0)}};var X0=class{frameNumberMap=new Map;register(t,r){let n=this.frameNumberMap.get(t)||new Map,s=n.get(r)||0;n.set(r,s+1),this.frameNumberMap.set(t,n)}deregister(t,r){let n=this.frameNumberMap.get(t);if(!n)return;let s=n.get(r)||1;n.set(r,s-1)}isZero(t,r){return(this.frameNumberMap.get(t)?.get(r)||0)===0}};var $M={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"},Y0=class{_statusMap;pendingTilesRegister=new X0;constructor(){this._statusMap={}}add(t,r,n,s){if(!this._statusMap[r]){let{frameNumber:i,viewport:{id:o}}=s;this._statusMap[r]={request:t,callback:n,key:r,frameState:s,status:$M.REQUESTED},this.pendingTilesRegister.register(o,i),t().then(a=>{this._statusMap[r].status=$M.COMPLETED;let{frameNumber:c,viewport:{id:l}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(l,c),this._statusMap[r].callback(a,s)}).catch(a=>{this._statusMap[r].status=$M.ERROR;let{frameNumber:c,viewport:{id:l}}=this._statusMap[r].frameState;this.pendingTilesRegister.deregister(l,c),n(a)})}}update(t,r){if(this._statusMap[t]){let{frameNumber:n,viewport:{id:s}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(s,n);let{frameNumber:i,viewport:{id:o}}=r;this.pendingTilesRegister.register(o,i),this._statusMap[t].frameState=r}}find(t){return this._statusMap[t]}hasPendingTiles(t,r){return!this.pendingTilesRegister.isZero(t,r)}};var $0=class extends Pn{_tileManager;constructor(t){super(t),this._tileManager=new Y0}traversalFinished(t){return!this._tileManager.hasPendingTiles(t.viewport.id,this._frameNumber||0)}shouldRefine(t,r){return t._lodJudge=Z4(t,r),t._lodJudge==="DIG"}updateChildTiles(t,r){let n=t.header.children||[],s=t.children,i=t.tileset;for(let o of n){let a=`${o.id}-${r.viewport.id}`,c=s&&s.find(l=>l.id===a);if(c)c&&this.updateTile(c,r);else{let l=()=>this._loadTile(o.id,i);this._tileManager.find(a)?this._tileManager.update(a,r):(i.tileset.nodePages&&(l=()=>i.tileset.nodePagesTile.formTileFromNodePages(o.id)),this._tileManager.add(l,a,f=>this._onTileLoad(f,t,a),r))}}return!1}async _loadTile(t,r){let{loader:n}=r,s=r.getTileUrl(`${r.url}/nodes/${t}`),i={...r.loadOptions,i3s:{...r.loadOptions.i3s,isTileHeader:!0}};return await se(s,n,i)}_onTileLoad(t,r,n){let s=new Lo(r.tileset,t,r,n);r.children.push(s);let i=this._tileManager.find(s.id).frameState;this.updateTile(s,i),this._frameNumber===i.frameNumber&&(this.traversalFinished(i)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(s,i)}};var qit={description:"",ellipsoid:ot.WGS84,modelMatrix:new wt,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:e=>e,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},K0="Tiles In Tileset(s)",KM="Tiles In Memory",tD="Tiles In View",eD="Tiles To Render",rD="Tiles Loaded",ZM="Tiles Loading",nD="Tiles Unloaded",sD="Failed Tile Loads",iD="Points/Vertices",JM="Tile Memory Use",oD="Maximum Screen Space Error",yu=class{options;loadOptions;type;tileset;loader;url;basePath;modelMatrix;ellipsoid;lodMetricType;lodMetricValue;refine;root=null;roots={};asset={};description="";properties;extras=null;attributions={};credits={};stats;contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1};cartographicCenter=null;cartesianCenter=null;zoom=1;boundingVolume=null;dynamicScreenSpaceErrorComputedDensity=0;maximumMemoryUsage=32;gpuMemoryUsageInBytes=0;memoryAdjustedScreenSpaceError=0;_cacheBytes=0;_cacheOverflowBytes=0;_frameNumber=0;_queryParams={};_extensionsUsed=[];_tiles={};_pendingCount=0;selectedTiles=[];traverseCounter=0;geometricError=0;lastUpdatedVieports=null;_requestedTiles=[];_emptyTiles=[];frameStateData={};_traverser;_cache=new C0;_requestScheduler;updatePromise=null;tilesetInitializationPromise;constructor(t,r){this.options={...qit,...r},this.tileset=t,this.loader=t.loader,this.type=t.type,this.url=t.url,this.basePath=t.basePath||ir.dirname(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=t.lodMetricType,this.lodMetricValue=t.lodMetricValue,this.refine=t.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new Es({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=this.options.maximumMemoryUsage*1024*1024,this._cacheOverflowBytes=this.options.memoryCacheOverflow*1024*1024,this.stats=new we({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(t)}destroy(){this._destroy()}isLoaded(){return this._pendingCount===0&&this._frameNumber!==0&&this._requestedTiles.length===0}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(t){this.options={...this.options,...t}}getTileUrl(t){if(t.startsWith("data:"))return t;let n=t;return this.queryParams.length&&(n=`${t}${t.includes("?")?"&":"?"}${this.queryParams}`),n}hasExtension(t){return Boolean(this._extensionsUsed.indexOf(t)>-1)}update(t=null){this.tilesetInitializationPromise.then(()=>{!t&&this.lastUpdatedVieports?t=this.lastUpdatedVieports:this.lastUpdatedVieports=t,t&&this.doUpdate(t)})}async selectTiles(t=null){return await this.tilesetInitializationPromise,t&&(this.lastUpdatedVieports=t),this.updatePromise||(this.updatePromise=new Promise(r=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),r(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(t){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;let r=t instanceof Array?t:[t];this._cache.reset(),this._frameNumber++,this.traverseCounter=r.length;let n=[];for(let s of r){let i=s.id;this._needTraverse(i)?n.push(i):this.traverseCounter--}for(let s of r){let i=s.id;if(this.roots[i]||(this.roots[i]=this._initializeTileHeaders(this.tileset,null)),!n.includes(i))continue;let o=N4(s,this._frameNumber);this._traverser.traverse(this.roots[i],o,this.options)}}_needTraverse(t){let r=t;return this.options.viewportTraversersMap&&(r=this.options.viewportTraversersMap[t]),r===t}_onTraversalEnd(t){let r=t.viewport.id;this.frameStateData[r]||(this.frameStateData[r]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});let n=this.frameStateData[r],s=Object.values(this._traverser.selectedTiles),[i,o]=B4(s,t,this.options.maximumTilesSelected);n.selectedTiles=i;for(let a of o)a.unselect();n._requestedTiles=Object.values(this._traverser.requestedTiles),n._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(let t in this.frameStateData){let r=this.frameStateData[t];this.selectedTiles=this.selectedTiles.concat(r.selectedTiles),this._requestedTiles=this._requestedTiles.concat(r._requestedTiles),this._emptyTiles=this._emptyTiles.concat(r._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(let t of this.selectedTiles)this._tiles[t.id]=t;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(t,r){if(t.length!==r.length)return!0;let n=new Set(t.map(o=>o.id)),s=new Set(r.map(o=>o.id)),i=t.filter(o=>!s.has(o.id)).length>0;return i=i||r.filter(o=>!n.has(o.id)).length>0,i}_loadTiles(){for(let t of this._requestedTiles)t.contentUnloaded&&this._loadTile(t)}_unloadTiles(){this._cache.unloadTiles(this,(t,r)=>t._unloadTile(r))}_updateStats(){let t=0,r=0;for(let n of this.selectedTiles)n.contentAvailable&&n.content&&(t++,n.content.pointCount?r+=n.content.pointCount:r+=n.content.vertexCount);this.stats.get(tD).count=this.selectedTiles.length,this.stats.get(eD).count=t,this.stats.get(iD).count=r,this.stats.get(oD).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(t){this.type===xe.I3S&&(this.calculateViewPropsI3S(),t.root=await t.root),this.root=this._initializeTileHeaders(t,null),this.type===xe.TILES3D&&(this._initializeTiles3DTileset(t),this.calculateViewPropsTiles3D()),this.type===xe.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){let t=this.tileset.fullExtent;if(t){let{xmin:n,xmax:s,ymin:i,ymax:o,zmin:a,zmax:c}=t;this.cartographicCenter=new q(n+(s-n)/2,i+(o-i)/2,a+(c-a)/2),this.cartesianCenter=new q,ot.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=jM(t,this.cartographicCenter,this.cartesianCenter);return}let r=this.tileset.store?.extent;if(r){let[n,s,i,o]=r;this.cartographicCenter=new q(n+(i-n)/2,s+(o-s)/2,0),this.cartesianCenter=new q,ot.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=D4(r,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new q,this.zoom=1}calculateViewPropsTiles3D(){let t=this.root,{center:r}=t.boundingVolume;if(!r){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new q,this.zoom=1;return}r[0]!==0||r[1]!==0||r[2]!==0?(this.cartographicCenter=new q,ot.WGS84.cartesianToCartographic(r,this.cartographicCenter)):this.cartographicCenter=new q(0,0,-ot.WGS84.radii[0]),this.cartesianCenter=r,this.zoom=F4(t.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(K0),this.stats.get(ZM),this.stats.get(KM),this.stats.get(tD),this.stats.get(eD),this.stats.get(rD),this.stats.get(nD),this.stats.get(sD),this.stats.get(iD),this.stats.get(JM,"memory"),this.stats.get(oD)}_initializeTileHeaders(t,r){let n=new Lo(this,t.root,r);if(r&&(r.children.push(n),n.depth=r.depth+1),this.type===xe.TILES3D){let s=[];for(s.push(n);s.length>0;){let i=s.pop();this.stats.get(K0).incrementCount();let o=i.header.children||[];for(let a of o){let c=new Lo(this,a,i);if(c.contentUrl?.includes("?session=")){let h=new URL(c.contentUrl).searchParams.get("session");h&&(this._queryParams.session=h)}i.children.push(c),c.depth=i.depth+1,s.push(c)}}}return n}_initializeTraverser(){let t;switch(this.type){case xe.TILES3D:t=q0;break;case xe.I3S:t=$0;break;default:t=Pn}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(t){this._destroySubtree(t)}async _loadTile(t){let r;try{this._onStartTileLoading(),r=await t.loadContent()}catch(n){this._onTileLoadError(t,n instanceof Error?n:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(t,r)}}_onTileLoadError(t,r){this.stats.get(sD).incrementCount();let n=r.message||r.toString(),s=t.url;console.error(`A 3D tile failed to load: ${t.url} ${n}`),this.options.onTileError(t,n,s)}_onTileLoad(t,r){if(r){if(this.type===xe.I3S){let n=this.tileset?.nodePagesTile?.nodesInNodePages||0;this.stats.get(K0).reset(),this.stats.get(K0).addCount(n)}t&&t.content&&PF(t,t.content),this.updateContentTypes(t),this._addTileToCache(t),this.options.onTileLoad(t)}}updateContentTypes(t){if(this.type===xe.I3S)switch(t.header.isDracoGeometry&&(this.contentFormats.draco=!0),t.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0;break;default:}else if(this.type===xe.TILES3D){let{extensionsRemoved:r=[]}=t.content?.gltf||{};r.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),r.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),r.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(ZM).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(ZM).decrementCount()}_addTileToCache(t){this._cache.add(this,t,r=>r._updateCacheStats(t))}_updateCacheStats(t){this.stats.get(rD).incrementCount(),this.stats.get(KM).incrementCount(),this.gpuMemoryUsageInBytes+=t.gpuMemoryUsageInBytes||0,this.stats.get(JM).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(t){this.gpuMemoryUsageInBytes-=t.gpuMemoryUsageInBytes||0,this.stats.get(KM).decrementCount(),this.stats.get(nD).incrementCount(),this.stats.get(JM).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}_destroy(){let t=[];for(this.root&&t.push(this.root);t.length>0;){let r=t.pop();for(let n of r.children)t.push(n);this._destroyTile(r)}this.root=null}_destroySubtree(t){let r=t,n=[];for(n.push(r);n.length>0;){t=n.pop();for(let s of t.children)n.push(s);t!==r&&this._destroyTile(t)}r.children=[]}_destroyTile(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}_initializeTiles3DTileset(t){if(t.queryString){let r=new URLSearchParams(t.queryString),n=Object.fromEntries(r.entries());this._queryParams={...this._queryParams,...n}}if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if(this.asset.version!=="0.0"&&this.asset.version!=="1.0"&&this.asset.version!=="1.1")throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed||[],this.extras=t.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}};var Z0="4.2.1";var No={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"},Bqt=Object.keys(No);function QM(e,t,r){nt(e instanceof ArrayBuffer);let n=new TextDecoder("utf8"),s=new Uint8Array(e,t,r);return n.decode(s)}function aD(e,t=0){let r=new DataView(e);return`${String.fromCharCode(r.getUint8(t+0))}${String.fromCharCode(r.getUint8(t+1))}${String.fromCharCode(r.getUint8(t+2))}${String.fromCharCode(r.getUint8(t+3))}`}var Xit={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},re={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},et={...Xit,...re};var tE={[re.DOUBLE]:Float64Array,[re.FLOAT]:Float32Array,[re.UNSIGNED_SHORT]:Uint16Array,[re.UNSIGNED_INT]:Uint32Array,[re.UNSIGNED_BYTE]:Uint8Array,[re.BYTE]:Int8Array,[re.SHORT]:Int16Array,[re.INT]:Int32Array},Yit={DOUBLE:re.DOUBLE,FLOAT:re.FLOAT,UNSIGNED_SHORT:re.UNSIGNED_SHORT,UNSIGNED_INT:re.UNSIGNED_INT,UNSIGNED_BYTE:re.UNSIGNED_BYTE,BYTE:re.BYTE,SHORT:re.SHORT,INT:re.INT},eE="Failed to convert GL type",ke=class{static fromTypedArray(t){t=ArrayBuffer.isView(t)?t.constructor:t;for(let r in tE)if(tE[r]===t)return r;throw new Error(eE)}static fromName(t){let r=Yit[t];if(!r)throw new Error(eE);return r}static getArrayType(t){switch(t){case re.UNSIGNED_SHORT_5_6_5:case re.UNSIGNED_SHORT_4_4_4_4:case re.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:let r=tE[t];if(!r)throw new Error(eE);return r}}static getByteSize(t){return ke.getArrayType(t).BYTES_PER_ELEMENT}static validate(t){return Boolean(ke.getArrayType(t))}static createTypedArray(t,r,n=0,s){s===void 0&&(s=(r.byteLength-n)/ke.getByteSize(t));let i=ke.getArrayType(t);return new i(r,n,s)}};var Hqt=1/Math.PI*180,Wqt=1/180*Math.PI,$it={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...$it}};var ve=globalThis.mathgl.config;function rE(e,{precision:t=ve.precision}={}){return e=Kit(e),`${parseFloat(e.toPrecision(t))}`}function Rn(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function nE(e,t,r){return Jit(e,n=>Math.max(t,Math.min(r,n)))}function J0(e,t,r){let n=ve.EPSILON;r&&(ve.EPSILON=r);try{if(e===t)return!0;if(Rn(e)&&Rn(t)){if(e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(!J0(e[s],t[s]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=ve.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{ve.EPSILON=n}}function Kit(e){return Math.round(e/ve.EPSILON)*ve.EPSILON}function Zit(e){return e.clone?e.clone():new Array(e.length)}function Jit(e,t,r){if(Rn(e)){let n=e;r=r||Zit(n);for(let s=0;s<r.length&&s<n.length;++s){let i=typeof e=="number"?e:e[s];r[s]=t(i,s,r)}return r}return t(e)}var Q0=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,r=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+r];return this.check()}toArray(t=[],r=0){for(let n=0;n<this.ELEMENTS;++n)t[r+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:Rn(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ve)}formatString(t){let r="";for(let n=0;n<this.ELEMENTS;++n)r+=(n>0?", ":"")+rE(this[n],t);return`${t.printTypes?this.constructor.name:""}[${r}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!J0(this[r],t[r]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==t[r])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,r,n){if(n===void 0)return this.lerp(this,t,r);for(let s=0;s<this.ELEMENTS;++s){let i=t[s],o=typeof r=="number"?r:r[s];this[s]=i+n*(o-i)}return this.check()}min(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(t[r],this[r]);return this.check()}max(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(t[r],this[r]);return this.check()}clamp(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),r[n]);return this.check()}add(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]+=r[n];return this.check()}subtract(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]-=r[n];return this.check()}scale(t){if(typeof t=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;else for(let r=0;r<this.ELEMENTS&&r<t.length;++r)this[r]*=t[r];return this.check()}multiplyByScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}check(){if(ve.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)t=t&&Number.isFinite(this[r]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=t;return this.check()}addScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),r);return this.check()}get elements(){return this}};function ue(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function sE(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}var Cc=class extends Q0{get x(){return this[0]}set x(t){this[0]=ue(t)}get y(){return this[1]}set y(t){this[1]=ue(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*this[r];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let r=0;for(let n=0;n<this.ELEMENTS;++n){let s=this[n]-t[n];r+=s*s}return ue(r)}dot(t){let r=0;for(let n=0;n<this.ELEMENTS;++n)r+=this[n]*t[n];return ue(r)}normalize(){let t=this.magnitude();if(t!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t;return this.check()}multiply(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]*=r[n];return this.check()}divide(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]/=r[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return sE(t>=0&&t<this.ELEMENTS,"index is out of range"),ue(this[t])}setComponent(t,r){return sE(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=r,this.check()}addVectors(t,r){return this.copy(t).add(r)}subVectors(t,r){return this.copy(t).subtract(r)}multiplyVectors(t,r){return this.copy(t).multiply(r)}addScaledVector(t,r){return this.add(new this.constructor(t).multiplyScalar(r))}};var Pc=typeof Float32Array<"u"?Float32Array:Array;var Qqt=Math.PI/180;function rot(){let e=new Pc(2);return Pc!=Float32Array&&(e[0]=0,e[1]=0),e}function lD(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[2]*s,e[1]=r[1]*n+r[3]*s,e}function hD(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[2]*s+r[4],e[1]=r[1]*n+r[3]*s+r[5],e}function fD(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[3]*s+r[6],e[1]=r[1]*n+r[4]*s+r[7],e}function uD(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[4]*s+r[12],e[1]=r[1]*n+r[5]*s+r[13],e}var tXt=function(){let e=rot();return function(t,r,n,s,i,o){let a,c;for(r||(r=2),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],i(e,e,o),t[a]=e[0],t[a+1]=e[1];return t}}();function dD(e,t,r){let n=t[0],s=t[1],i=r[3]*n+r[7]*s||1;return e[0]=(r[0]*n+r[4]*s)/i,e[1]=(r[1]*n+r[5]*s)/i,e}function pD(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[3]*n+r[7]*s+r[11]*i||1;return e[0]=(r[0]*n+r[4]*s+r[8]*i)/o,e[1]=(r[1]*n+r[5]*s+r[9]*i)/o,e[2]=(r[2]*n+r[6]*s+r[10]*i)/o,e}function gD(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[2]*s,e[1]=r[1]*n+r[3]*s,e[2]=t[2],e}var Bo=class extends Cc{constructor(t=0,r=0){super(2),Rn(t)&&arguments.length===1?this.copy(t):(ve.debug&&(ue(t),ue(r)),this[0]=t,this[1]=r)}set(t,r){return this[0]=t,this[1]=r,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this.check()}fromObject(t){return ve.debug&&(ue(t.x),ue(t.y)),this[0]=t.x,this[1]=t.y,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return uD(this,this,t),this.check()}transformAsVector(t){return dD(this,this,t),this.check()}transformByMatrix3(t){return fD(this,this,t),this.check()}transformByMatrix2x3(t){return hD(this,this,t),this.check()}transformByMatrix2(t){return lD(this,this,t),this.check()}};function not(){let e=new Pc(3);return Pc!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function sot(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function mD(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[0],a=r[1],c=r[2];return e[0]=s*c-i*a,e[1]=i*o-n*c,e[2]=n*a-s*o,e}function _D(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[3]*n+r[7]*s+r[11]*i+r[15];return o=o||1,e[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/o,e[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/o,e[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/o,e}function xD(e,t,r){let n=t[0],s=t[1],i=t[2];return e[0]=n*r[0]+s*r[3]+i*r[6],e[1]=n*r[1]+s*r[4]+i*r[7],e[2]=n*r[2]+s*r[5]+i*r[8],e}function yD(e,t,r){let n=r[0],s=r[1],i=r[2],o=r[3],a=t[0],c=t[1],l=t[2],h=s*l-i*c,f=i*a-n*l,u=n*c-s*a,d=s*u-i*f,p=i*h-n*u,g=n*f-s*h,m=o*2;return h*=m,f*=m,u*=m,d*=2,p*=2,g*=2,e[0]=a+h+d,e[1]=c+f+p,e[2]=l+u+g,e}function AD(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[0],i[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),i[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function TD(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),i[1]=s[1],i[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function MD(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),i[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),i[2]=s[2],e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function ED(e,t){let r=e[0],n=e[1],s=e[2],i=t[0],o=t[1],a=t[2],c=Math.sqrt((r*r+n*n+s*s)*(i*i+o*o+a*a)),l=c&&sot(e,t)/c;return Math.acos(Math.min(Math.max(l,-1),1))}var lXt=function(){let e=not();return function(t,r,n,s,i,o){let a,c;for(r||(r=3),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}}();var iE=[0,0,0],t1,Fo=class extends Cc{static get ZERO(){return t1||(t1=new Fo(0,0,0),Object.freeze(t1)),t1}constructor(t=0,r=0,n=0){super(-0,-0,-0),arguments.length===1&&Rn(t)?this.copy(t):(ve.debug&&(ue(t),ue(r),ue(n)),this[0]=t,this[1]=r,this[2]=n)}set(t,r,n){return this[0]=t,this[1]=r,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return ve.debug&&(ue(t.x),ue(t.y),ue(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=ue(t)}angle(t){return ED(this,t)}cross(t){return mD(this,this,t),this.check()}rotateX({radians:t,origin:r=iE}){return AD(this,this,r,t),this.check()}rotateY({radians:t,origin:r=iE}){return TD(this,this,r,t),this.check()}rotateZ({radians:t,origin:r=iE}){return MD(this,this,r,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return _D(this,this,t),this.check()}transformAsVector(t){return pD(this,this,t),this.check()}transformByMatrix3(t){return xD(this,this,t),this.check()}transformByMatrix2(t){return gD(this,this,t),this.check()}transformByQuaternion(t){return yD(this,this,t),this.check()}};function bD(e,t){if(!e)throw new Error(`math.gl assertion failed. ${t}`)}function oE(e,t=[0,0,0]){let r=e>>11&31,n=e>>5&63,s=e&31;return t[0]=r<<3,t[1]=n<<2,t[2]=s<<3,t}var VXt=1/256;var HXt=new Bo,WXt=new Fo,GXt=new Bo,jXt=new Bo,qXt=new Uint8Array(1);function SD(e,t=255){return nE(e,0,t)/t*2-1}function vD(e){return e<0?-1:1}function wD(e,t,r,n){if(bD(n),e<0||e>r||t<0||t>r)throw new Error(`x and y must be unsigned normalized integers between 0 and ${r}`);if(n.x=SD(e,r),n.y=SD(t,r),n.z=1-(Math.abs(n.x)+Math.abs(n.y)),n.z<0){let s=n.x;n.x=(1-Math.abs(n.y))*vD(s),n.y=(1-Math.abs(s))*vD(n.y)}return n.normalize()}function aE(e,t,r){return wD(e,t,255,r)}var uYt=1/Math.PI*180,dYt=1/180*Math.PI,iot={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...iot}};var le=globalThis.mathgl.config;function CD(e,{precision:t=le.precision}={}){return e=oot(e),`${parseFloat(e.toPrecision(t))}`}function yi(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function cE(e,t,r){let n=le.EPSILON;r&&(le.EPSILON=r);try{if(e===t)return!0;if(yi(e)&&yi(t)){if(e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(!cE(e[s],t[s]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):typeof e=="number"&&typeof t=="number"?Math.abs(e-t)<=le.EPSILON*Math.max(1,Math.abs(e),Math.abs(t)):!1}finally{le.EPSILON=n}}function oot(e){return Math.round(e/le.EPSILON)*le.EPSILON}var Ai=class extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,r=0){for(let n=0;n<this.ELEMENTS;++n)this[n]=t[n+r];return this.check()}toArray(t=[],r=0){for(let n=0;n<this.ELEMENTS;++n)t[r+n]=this[n];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:yi(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(le)}formatString(t){let r="";for(let n=0;n<this.ELEMENTS;++n)r+=(n>0?", ":"")+CD(this[n],t);return`${t.printTypes?this.constructor.name:""}[${r}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(!cE(this[r],t[r]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let r=0;r<this.ELEMENTS;++r)if(this[r]!==t[r])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,r,n){if(n===void 0)return this.lerp(this,t,r);for(let s=0;s<this.ELEMENTS;++s){let i=t[s],o=typeof r=="number"?r:r[s];this[s]=i+n*(o-i)}return this.check()}min(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(t[r],this[r]);return this.check()}max(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.max(t[r],this[r]);return this.check()}clamp(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t[n]),r[n]);return this.check()}add(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]+=r[n];return this.check()}subtract(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]-=r[n];return this.check()}scale(t){if(typeof t=="number")for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;else for(let r=0;r<this.ELEMENTS&&r<t.length;++r)this[r]*=t[r];return this.check()}multiplyByScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}check(){if(le.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let r=0;r<this.ELEMENTS;++r)t=t&&Number.isFinite(this[r]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]=t;return this.check()}addScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let r=0;r<this.ELEMENTS;++r)this[r]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,r){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],t),r);return this.check()}get elements(){return this}};function aot(e,t){if(e.length!==t)return!1;for(let r=0;r<e.length;++r)if(!Number.isFinite(e[r]))return!1;return!0}function gt(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function Ti(e,t,r=""){if(le.debug&&!aot(e,t))throw new Error(`math.gl: ${r} some fields set to invalid numbers'`);return e}function lE(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}var Rc=class extends Ai{get x(){return this[0]}set x(t){this[0]=gt(t)}get y(){return this[1]}set y(t){this[1]=gt(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*this[r];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let r=0;for(let n=0;n<this.ELEMENTS;++n){let s=this[n]-t[n];r+=s*s}return gt(r)}dot(t){let r=0;for(let n=0;n<this.ELEMENTS;++n)r+=this[n]*t[n];return gt(r)}normalize(){let t=this.magnitude();if(t!==0)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t;return this.check()}multiply(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]*=r[n];return this.check()}divide(...t){for(let r of t)for(let n=0;n<this.ELEMENTS;++n)this[n]/=r[n];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return lE(t>=0&&t<this.ELEMENTS,"index is out of range"),gt(this[t])}setComponent(t,r){return lE(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=r,this.check()}addVectors(t,r){return this.copy(t).add(r)}subVectors(t,r){return this.copy(t).subtract(r)}multiplyVectors(t,r){return this.copy(t).multiply(r)}addScaledVector(t,r){return this.add(new this.constructor(t).multiplyScalar(r))}};var Ue=typeof Float32Array<"u"?Float32Array:Array;var bYt=Math.PI/180;function cot(){let e=new Ue(2);return Ue!=Float32Array&&(e[0]=0,e[1]=0),e}function ID(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[3]*s+r[6],e[1]=r[1]*n+r[4]*s+r[7],e}function OD(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[4]*s+r[12],e[1]=r[1]*n+r[5]*s+r[13],e}var SYt=function(){let e=cot();return function(t,r,n,s,i,o){let a,c;for(r||(r=2),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],i(e,e,o),t[a]=e[0],t[a+1]=e[1];return t}}();function LD(e,t,r){let n=t[0],s=t[1],i=r[3]*n+r[7]*s||1;return e[0]=(r[0]*n+r[4]*s)/i,e[1]=(r[1]*n+r[5]*s)/i,e}function e1(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[3]*n+r[7]*s+r[11]*i||1;return e[0]=(r[0]*n+r[4]*s+r[8]*i)/o,e[1]=(r[1]*n+r[5]*s+r[9]*i)/o,e[2]=(r[2]*n+r[6]*s+r[10]*i)/o,e}function ND(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[2]*s,e[1]=r[1]*n+r[3]*s,e[2]=t[2],e}function BD(e,t,r){let n=t[0],s=t[1];return e[0]=r[0]*n+r[2]*s,e[1]=r[1]*n+r[3]*s,e[2]=t[2],e[3]=t[3],e}function r1(e,t,r){let n=t[0],s=t[1],i=t[2];return e[0]=r[0]*n+r[3]*s+r[6]*i,e[1]=r[1]*n+r[4]*s+r[7]*i,e[2]=r[2]*n+r[5]*s+r[8]*i,e[3]=t[3],e}function hE(){let e=new Ue(3);return Ue!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function lot(e){let t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function fE(e,t,r){let n=new Ue(3);return n[0]=e,n[1]=t,n[2]=r,n}function FD(e,t){let r=t[0],n=t[1],s=t[2],i=r*r+n*n+s*s;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function uE(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Ic(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[0],a=r[1],c=r[2];return e[0]=s*c-i*a,e[1]=i*o-n*c,e[2]=n*a-s*o,e}function Oc(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[3]*n+r[7]*s+r[11]*i+r[15];return o=o||1,e[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/o,e[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/o,e[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/o,e}function n1(e,t,r){let n=t[0],s=t[1],i=t[2];return e[0]=n*r[0]+s*r[3]+i*r[6],e[1]=n*r[1]+s*r[4]+i*r[7],e[2]=n*r[2]+s*r[5]+i*r[8],e}function s1(e,t,r){let n=r[0],s=r[1],i=r[2],o=r[3],a=t[0],c=t[1],l=t[2],h=s*l-i*c,f=i*a-n*l,u=n*c-s*a,d=s*u-i*f,p=i*h-n*u,g=n*f-s*h,m=o*2;return h*=m,f*=m,u*=m,d*=2,p*=2,g*=2,e[0]=a+h+d,e[1]=c+f+p,e[2]=l+u+g,e}function DD(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[0],i[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),i[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function kD(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),i[1]=s[1],i[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function UD(e,t,r,n){let s=[],i=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],i[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),i[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),i[2]=s[2],e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e}function zD(e,t){let r=e[0],n=e[1],s=e[2],i=t[0],o=t[1],a=t[2],c=Math.sqrt((r*r+n*n+s*s)*(i*i+o*o+a*a)),l=c&&uE(e,t)/c;return Math.acos(Math.min(Math.max(l,-1),1))}var VD=lot;var CYt=function(){let e=hE();return function(t,r,n,s,i,o){let a,c;for(r||(r=3),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2];return t}}();var dE=[0,0,0],i1,Mt=class extends Rc{static get ZERO(){return i1||(i1=new Mt(0,0,0),Object.freeze(i1)),i1}constructor(t=0,r=0,n=0){super(-0,-0,-0),arguments.length===1&&yi(t)?this.copy(t):(le.debug&&(gt(t),gt(r),gt(n)),this[0]=t,this[1]=r,this[2]=n)}set(t,r,n){return this[0]=t,this[1]=r,this[2]=n,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return le.debug&&(gt(t.x),gt(t.y),gt(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=gt(t)}angle(t){return zD(this,t)}cross(t){return Ic(this,this,t),this.check()}rotateX({radians:t,origin:r=dE}){return DD(this,this,r,t),this.check()}rotateY({radians:t,origin:r=dE}){return kD(this,this,r,t),this.check()}rotateZ({radians:t,origin:r=dE}){return UD(this,this,r,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Oc(this,this,t),this.check()}transformAsVector(t){return e1(this,this,t),this.check()}transformByMatrix3(t){return n1(this,this,t),this.check()}transformByMatrix2(t){return ND(this,this,t),this.check()}transformByQuaternion(t){return s1(this,this,t),this.check()}};var o1,Lc=class extends Rc{static get ZERO(){return o1||(o1=new Lc(0,0,0,0),Object.freeze(o1)),o1}constructor(t=0,r=0,n=0,s=0){super(-0,-0,-0,-0),yi(t)&&arguments.length===1?this.copy(t):(le.debug&&(gt(t),gt(r),gt(n),gt(s)),this[0]=t,this[1]=r,this[2]=n,this[3]=s)}set(t,r,n,s){return this[0]=t,this[1]=r,this[2]=n,this[3]=s,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}fromObject(t){return le.debug&&(gt(t.x),gt(t.y),gt(t.z),gt(t.w)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t.w=this[3],t}get ELEMENTS(){return 4}get z(){return this[2]}set z(t){this[2]=gt(t)}get w(){return this[3]}set w(t){this[3]=gt(t)}transform(t){return Oc(this,this,t),this.check()}transformByMatrix3(t){return r1(this,this,t),this.check()}transformByMatrix2(t){return BD(this,this,t),this.check()}transformByQuaternion(t){return s1(this,this,t),this.check()}applyMatrix4(t){return t.transform(this,this),this}};var Nc=class extends Ai{toString(){let t="[";if(le.printRowMajor){t+="row-major:";for(let r=0;r<this.RANK;++r)for(let n=0;n<this.RANK;++n)t+=` ${this[n*this.RANK+r]}`}else{t+="column-major:";for(let r=0;r<this.ELEMENTS;++r)t+=` ${this[r]}`}return t+="]",t}getElementIndex(t,r){return r*this.RANK+t}getElement(t,r){return this[r*this.RANK+t]}setElement(t,r,n){return this[r*this.RANK+t]=gt(n),this}getColumn(t,r=new Array(this.RANK).fill(-0)){let n=t*this.RANK;for(let s=0;s<this.RANK;++s)r[s]=this[n+s];return r}setColumn(t,r){let n=t*this.RANK;for(let s=0;s<this.RANK;++s)this[n+s]=r[s];return this}};function HD(){let e=new Ue(9);return Ue!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function WD(e,t){if(e===t){let r=t[1],n=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function GD(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=t[4],a=t[5],c=t[6],l=t[7],h=t[8],f=h*o-a*l,u=-h*i+a*c,d=l*i-o*c,p=r*f+n*u+s*d;return p?(p=1/p,e[0]=f*p,e[1]=(-h*n+s*l)*p,e[2]=(a*n-s*o)*p,e[3]=u*p,e[4]=(h*r-s*c)*p,e[5]=(-a*r+s*i)*p,e[6]=d*p,e[7]=(-l*r+n*c)*p,e[8]=(o*r-n*i)*p,e):null}function jD(e){let t=e[0],r=e[1],n=e[2],s=e[3],i=e[4],o=e[5],a=e[6],c=e[7],l=e[8];return t*(l*i-o*c)+r*(-l*s+o*a)+n*(c*s-i*a)}function pE(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=r[0],d=r[1],p=r[2],g=r[3],m=r[4],_=r[5],y=r[6],x=r[7],A=r[8];return e[0]=u*n+d*o+p*l,e[1]=u*s+d*a+p*h,e[2]=u*i+d*c+p*f,e[3]=g*n+m*o+_*l,e[4]=g*s+m*a+_*h,e[5]=g*i+m*c+_*f,e[6]=y*n+x*o+A*l,e[7]=y*s+x*a+A*h,e[8]=y*i+x*c+A*f,e}function qD(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=r[0],d=r[1];return e[0]=n,e[1]=s,e[2]=i,e[3]=o,e[4]=a,e[5]=c,e[6]=u*n+d*o+l,e[7]=u*s+d*a+h,e[8]=u*i+d*c+f,e}function XD(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=Math.sin(r),d=Math.cos(r);return e[0]=d*n+u*o,e[1]=d*s+u*a,e[2]=d*i+u*c,e[3]=d*o-u*n,e[4]=d*a-u*s,e[5]=d*c-u*i,e[6]=l,e[7]=h,e[8]=f,e}function gE(e,t,r){let n=r[0],s=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function YD(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=r+r,a=n+n,c=s+s,l=r*o,h=n*o,f=n*a,u=s*o,d=s*a,p=s*c,g=i*o,m=i*a,_=i*c;return e[0]=1-f-p,e[3]=h-_,e[6]=u+m,e[1]=h+_,e[4]=1-l-p,e[7]=d-g,e[2]=u-m,e[5]=d+g,e[8]=1-l-f,e}var mE;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"})(mE||(mE={}));var uot=Object.freeze([1,0,0,0,1,0,0,0,1]),Do=class extends Nc{static get IDENTITY(){return pot()}static get ZERO(){return dot()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return mE}constructor(t,...r){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):r.length>0?this.copy([t,...r]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(uot)}fromObject(t){return this.check()}fromQuaternion(t){return YD(this,t),this.check()}set(t,r,n,s,i,o,a,c,l){return this[0]=t,this[1]=r,this[2]=n,this[3]=s,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this.check()}setRowMajor(t,r,n,s,i,o,a,c,l){return this[0]=t,this[1]=s,this[2]=a,this[3]=r,this[4]=i,this[5]=c,this[6]=n,this[7]=o,this[8]=l,this.check()}determinant(){return jD(this)}transpose(){return WD(this,this),this.check()}invert(){return GD(this,this),this.check()}multiplyLeft(t){return pE(this,t,this),this.check()}multiplyRight(t){return pE(this,this,t),this.check()}rotate(t){return XD(this,this,t),this.check()}scale(t){return Array.isArray(t)?gE(this,this,t):gE(this,this,[t,t]),this.check()}translate(t){return qD(this,this,t),this.check()}transform(t,r){let n;switch(t.length){case 2:n=ID(r||[-0,-0],t,this);break;case 3:n=n1(r||[-0,-0,-0],t,this);break;case 4:n=r1(r||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ti(n,t.length),n}transformVector(t,r){return this.transform(t,r)}transformVector2(t,r){return this.transform(t,r)}transformVector3(t,r){return this.transform(t,r)}},a1,c1=null;function dot(){return a1||(a1=new Do([0,0,0,0,0,0,0,0,0]),Object.freeze(a1)),a1}function pot(){return c1||(c1=new Do,Object.freeze(c1)),c1}function got(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $D(e,t){if(e===t){let r=t[1],n=t[2],s=t[3],i=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=i,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function KD(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=t[4],a=t[5],c=t[6],l=t[7],h=t[8],f=t[9],u=t[10],d=t[11],p=t[12],g=t[13],m=t[14],_=t[15],y=r*a-n*o,x=r*c-s*o,A=r*l-i*o,M=n*c-s*a,E=n*l-i*a,w=s*l-i*c,v=h*g-f*p,b=h*m-u*p,T=h*_-d*p,I=f*m-u*g,N=f*_-d*g,B=u*_-d*m,C=y*B-x*N+A*I+M*T-E*b+w*v;return C?(C=1/C,e[0]=(a*B-c*N+l*I)*C,e[1]=(s*N-n*B-i*I)*C,e[2]=(g*w-m*E+_*M)*C,e[3]=(u*E-f*w-d*M)*C,e[4]=(c*T-o*B-l*b)*C,e[5]=(r*B-s*T+i*b)*C,e[6]=(m*A-p*w-_*x)*C,e[7]=(h*w-u*A+d*x)*C,e[8]=(o*N-a*T+l*v)*C,e[9]=(n*T-r*N-i*v)*C,e[10]=(p*E-g*A+_*y)*C,e[11]=(f*A-h*E-d*y)*C,e[12]=(a*b-o*I-c*v)*C,e[13]=(r*I-n*b+s*v)*C,e[14]=(g*x-p*M-m*y)*C,e[15]=(h*M-f*x+u*y)*C,e):null}function ZD(e){let t=e[0],r=e[1],n=e[2],s=e[3],i=e[4],o=e[5],a=e[6],c=e[7],l=e[8],h=e[9],f=e[10],u=e[11],d=e[12],p=e[13],g=e[14],m=e[15],_=t*o-r*i,y=t*a-n*i,x=r*a-n*o,A=l*p-h*d,M=l*g-f*d,E=h*g-f*p,w=t*E-r*M+n*A,v=i*E-o*M+a*A,b=l*x-h*y+f*_,T=d*x-p*y+g*_;return c*w-s*v+m*b-u*T}function _E(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=t[4],c=t[5],l=t[6],h=t[7],f=t[8],u=t[9],d=t[10],p=t[11],g=t[12],m=t[13],_=t[14],y=t[15],x=r[0],A=r[1],M=r[2],E=r[3];return e[0]=x*n+A*a+M*f+E*g,e[1]=x*s+A*c+M*u+E*m,e[2]=x*i+A*l+M*d+E*_,e[3]=x*o+A*h+M*p+E*y,x=r[4],A=r[5],M=r[6],E=r[7],e[4]=x*n+A*a+M*f+E*g,e[5]=x*s+A*c+M*u+E*m,e[6]=x*i+A*l+M*d+E*_,e[7]=x*o+A*h+M*p+E*y,x=r[8],A=r[9],M=r[10],E=r[11],e[8]=x*n+A*a+M*f+E*g,e[9]=x*s+A*c+M*u+E*m,e[10]=x*i+A*l+M*d+E*_,e[11]=x*o+A*h+M*p+E*y,x=r[12],A=r[13],M=r[14],E=r[15],e[12]=x*n+A*a+M*f+E*g,e[13]=x*s+A*c+M*u+E*m,e[14]=x*i+A*l+M*d+E*_,e[15]=x*o+A*h+M*p+E*y,e}function JD(e,t,r){let n=r[0],s=r[1],i=r[2],o,a,c,l,h,f,u,d,p,g,m,_;return t===e?(e[12]=t[0]*n+t[4]*s+t[8]*i+t[12],e[13]=t[1]*n+t[5]*s+t[9]*i+t[13],e[14]=t[2]*n+t[6]*s+t[10]*i+t[14],e[15]=t[3]*n+t[7]*s+t[11]*i+t[15]):(o=t[0],a=t[1],c=t[2],l=t[3],h=t[4],f=t[5],u=t[6],d=t[7],p=t[8],g=t[9],m=t[10],_=t[11],e[0]=o,e[1]=a,e[2]=c,e[3]=l,e[4]=h,e[5]=f,e[6]=u,e[7]=d,e[8]=p,e[9]=g,e[10]=m,e[11]=_,e[12]=o*n+h*s+p*i+t[12],e[13]=a*n+f*s+g*i+t[13],e[14]=c*n+u*s+m*i+t[14],e[15]=l*n+d*s+_*i+t[15]),e}function QD(e,t,r){let n=r[0],s=r[1],i=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function t6(e,t,r,n){let s=n[0],i=n[1],o=n[2],a=Math.sqrt(s*s+i*i+o*o),c,l,h,f,u,d,p,g,m,_,y,x,A,M,E,w,v,b,T,I,N,B,C,V;return a<1e-6?null:(a=1/a,s*=a,i*=a,o*=a,l=Math.sin(r),c=Math.cos(r),h=1-c,f=t[0],u=t[1],d=t[2],p=t[3],g=t[4],m=t[5],_=t[6],y=t[7],x=t[8],A=t[9],M=t[10],E=t[11],w=s*s*h+c,v=i*s*h+o*l,b=o*s*h-i*l,T=s*i*h-o*l,I=i*i*h+c,N=o*i*h+s*l,B=s*o*h+i*l,C=i*o*h-s*l,V=o*o*h+c,e[0]=f*w+g*v+x*b,e[1]=u*w+m*v+A*b,e[2]=d*w+_*v+M*b,e[3]=p*w+y*v+E*b,e[4]=f*T+g*I+x*N,e[5]=u*T+m*I+A*N,e[6]=d*T+_*I+M*N,e[7]=p*T+y*I+E*N,e[8]=f*B+g*C+x*V,e[9]=u*B+m*C+A*V,e[10]=d*B+_*C+M*V,e[11]=p*B+y*C+E*V,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function e6(e,t,r){let n=Math.sin(r),s=Math.cos(r),i=t[4],o=t[5],a=t[6],c=t[7],l=t[8],h=t[9],f=t[10],u=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*s+l*n,e[5]=o*s+h*n,e[6]=a*s+f*n,e[7]=c*s+u*n,e[8]=l*s-i*n,e[9]=h*s-o*n,e[10]=f*s-a*n,e[11]=u*s-c*n,e}function r6(e,t,r){let n=Math.sin(r),s=Math.cos(r),i=t[0],o=t[1],a=t[2],c=t[3],l=t[8],h=t[9],f=t[10],u=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*s-l*n,e[1]=o*s-h*n,e[2]=a*s-f*n,e[3]=c*s-u*n,e[8]=i*n+l*s,e[9]=o*n+h*s,e[10]=a*n+f*s,e[11]=c*n+u*s,e}function n6(e,t,r){let n=Math.sin(r),s=Math.cos(r),i=t[0],o=t[1],a=t[2],c=t[3],l=t[4],h=t[5],f=t[6],u=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*s+l*n,e[1]=o*s+h*n,e[2]=a*s+f*n,e[3]=c*s+u*n,e[4]=l*s-i*n,e[5]=h*s-o*n,e[6]=f*s-a*n,e[7]=u*s-c*n,e}function s6(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=r+r,a=n+n,c=s+s,l=r*o,h=n*o,f=n*a,u=s*o,d=s*a,p=s*c,g=i*o,m=i*a,_=i*c;return e[0]=1-f-p,e[1]=h+_,e[2]=u-m,e[3]=0,e[4]=h-_,e[5]=1-l-p,e[6]=d+g,e[7]=0,e[8]=u+m,e[9]=d-g,e[10]=1-l-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function i6(e,t,r,n,s,i,o){let a=1/(r-t),c=1/(s-n),l=1/(i-o);return e[0]=i*2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i*2*c,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(s+n)*c,e[10]=(o+i)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*l,e[15]=0,e}function mot(e,t,r,n,s){let i=1/Math.tan(t/2);if(e[0]=i/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0){let o=1/(n-s);e[10]=(s+n)*o,e[14]=2*s*n*o}else e[10]=-1,e[14]=-2*n;return e}var o6=mot;function _ot(e,t,r,n,s,i,o){let a=1/(t-r),c=1/(n-s),l=1/(i-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*a,e[13]=(s+n)*c,e[14]=(o+i)*l,e[15]=1,e}var a6=_ot;function c6(e,t,r,n){let s,i,o,a,c,l,h,f,u,d,p=t[0],g=t[1],m=t[2],_=n[0],y=n[1],x=n[2],A=r[0],M=r[1],E=r[2];return Math.abs(p-A)<1e-6&&Math.abs(g-M)<1e-6&&Math.abs(m-E)<1e-6?got(e):(f=p-A,u=g-M,d=m-E,s=1/Math.sqrt(f*f+u*u+d*d),f*=s,u*=s,d*=s,i=y*d-x*u,o=x*f-_*d,a=_*u-y*f,s=Math.sqrt(i*i+o*o+a*a),s?(s=1/s,i*=s,o*=s,a*=s):(i=0,o=0,a=0),c=u*a-d*o,l=d*i-f*a,h=f*o-u*i,s=Math.sqrt(c*c+l*l+h*h),s?(s=1/s,c*=s,l*=s,h*=s):(c=0,l=0,h=0),e[0]=i,e[1]=c,e[2]=f,e[3]=0,e[4]=o,e[5]=l,e[6]=u,e[7]=0,e[8]=a,e[9]=h,e[10]=d,e[11]=0,e[12]=-(i*p+o*g+a*m),e[13]=-(c*p+l*g+h*m),e[14]=-(f*p+u*g+d*m),e[15]=1,e)}function xot(){let e=new Ue(4);return Ue!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function l6(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function h6(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function f6(e){let t=e[0],r=e[1],n=e[2],s=e[3];return Math.sqrt(t*t+r*r+n*n+s*s)}function u6(e){let t=e[0],r=e[1],n=e[2],s=e[3];return t*t+r*r+n*n+s*s}function d6(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=r*r+n*n+s*s+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=n*o,e[2]=s*o,e[3]=i*o,e}function p6(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function g6(e,t,r,n){let s=t[0],i=t[1],o=t[2],a=t[3];return e[0]=s+n*(r[0]-s),e[1]=i+n*(r[1]-i),e[2]=o+n*(r[2]-o),e[3]=a+n*(r[3]-a),e}function m6(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3];return e[0]=r[0]*n+r[4]*s+r[8]*i+r[12]*o,e[1]=r[1]*n+r[5]*s+r[9]*i+r[13]*o,e[2]=r[2]*n+r[6]*s+r[10]*i+r[14]*o,e[3]=r[3]*n+r[7]*s+r[11]*i+r[15]*o,e}function _6(e,t,r){let n=t[0],s=t[1],i=t[2],o=r[0],a=r[1],c=r[2],l=r[3],h=l*n+a*i-c*s,f=l*s+c*n-o*i,u=l*i+o*s-a*n,d=-o*n-a*s-c*i;return e[0]=h*l+d*-o+f*-c-u*-a,e[1]=f*l+d*-a+u*-o-h*-c,e[2]=u*l+d*-c+h*-a-f*-o,e[3]=t[3],e}var QYt=function(){let e=xot();return function(t,r,n,s,i,o){let a,c;for(r||(r=4),n||(n=0),s?c=Math.min(s*r+n,t.length):c=t.length,a=n;a<c;a+=r)e[0]=t[a],e[1]=t[a+1],e[2]=t[a+2],e[3]=t[a+3],i(e,e,o),t[a]=e[0],t[a+1]=e[1],t[a+2]=e[2],t[a+3]=e[3];return t}}();var AE;(function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"})(AE||(AE={}));var Aot=45*Math.PI/180,Tot=1,xE=.1,yE=500,Mot=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Mi=class extends Nc{static get IDENTITY(){return bot()}static get ZERO(){return Eot()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return AE}constructor(t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}set(t,r,n,s,i,o,a,c,l,h,f,u,d,p,g,m){return this[0]=t,this[1]=r,this[2]=n,this[3]=s,this[4]=i,this[5]=o,this[6]=a,this[7]=c,this[8]=l,this[9]=h,this[10]=f,this[11]=u,this[12]=d,this[13]=p,this[14]=g,this[15]=m,this.check()}setRowMajor(t,r,n,s,i,o,a,c,l,h,f,u,d,p,g,m){return this[0]=t,this[1]=i,this[2]=l,this[3]=d,this[4]=r,this[5]=o,this[6]=h,this[7]=p,this[8]=n,this[9]=a,this[10]=f,this[11]=g,this[12]=s,this[13]=c,this[14]=u,this[15]=m,this.check()}toRowMajor(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}identity(){return this.copy(Mot)}fromObject(t){return this.check()}fromQuaternion(t){return s6(this,t),this.check()}frustum(t){let{left:r,right:n,bottom:s,top:i,near:o=xE,far:a=yE}=t;return a===1/0?Sot(this,r,n,s,i,o):i6(this,r,n,s,i,o,a),this.check()}lookAt(t){let{eye:r,center:n=[0,0,0],up:s=[0,1,0]}=t;return c6(this,r,n,s),this.check()}ortho(t){let{left:r,right:n,bottom:s,top:i,near:o=xE,far:a=yE}=t;return a6(this,r,n,s,i,o,a),this.check()}orthographic(t){let{fovy:r=Aot,aspect:n=Tot,focalDistance:s=1,near:i=xE,far:o=yE}=t;x6(r);let a=r/2,c=s*Math.tan(a),l=c*n;return this.ortho({left:-l,right:l,bottom:-c,top:c,near:i,far:o})}perspective(t){let{fovy:r=45*Math.PI/180,aspect:n=1,near:s=.1,far:i=500}=t;return x6(r),o6(this,r,n,s,i),this.check()}determinant(){return ZD(this)}getScale(t=[-0,-0,-0]){return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}getTranslation(t=[-0,-0,-0]){return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}getRotation(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let n=this.getScale(r),s=1/n[0],i=1/n[1],o=1/n[2];return t[0]=this[0]*s,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*s,t[5]=this[5]*i,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*s,t[9]=this[9]*i,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}getRotationMatrix3(t,r){t=t||[-0,-0,-0,-0,-0,-0,-0,-0,-0],r=r||[-0,-0,-0];let n=this.getScale(r),s=1/n[0],i=1/n[1],o=1/n[2];return t[0]=this[0]*s,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=this[4]*s,t[4]=this[5]*i,t[5]=this[6]*o,t[6]=this[8]*s,t[7]=this[9]*i,t[8]=this[10]*o,t}transpose(){return $D(this,this),this.check()}invert(){return KD(this,this),this.check()}multiplyLeft(t){return _E(this,t,this),this.check()}multiplyRight(t){return _E(this,this,t),this.check()}rotateX(t){return e6(this,this,t),this.check()}rotateY(t){return r6(this,this,t),this.check()}rotateZ(t){return n6(this,this,t),this.check()}rotateXYZ(t){return this.rotateX(t[0]).rotateY(t[1]).rotateZ(t[2])}rotateAxis(t,r){return t6(this,this,t,r),this.check()}scale(t){return QD(this,this,Array.isArray(t)?t:[t,t,t]),this.check()}translate(t){return JD(this,this,t),this.check()}transform(t,r){return t.length===4?(r=m6(r||[-0,-0,-0,-0],t,this),Ti(r,4),r):this.transformAsPoint(t,r)}transformAsPoint(t,r){let{length:n}=t,s;switch(n){case 2:s=OD(r||[-0,-0],t,this);break;case 3:s=Oc(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ti(s,t.length),s}transformAsVector(t,r){let n;switch(t.length){case 2:n=LD(r||[-0,-0],t,this);break;case 3:n=e1(r||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return Ti(n,t.length),n}transformPoint(t,r){return this.transformAsPoint(t,r)}transformVector(t,r){return this.transformAsPoint(t,r)}transformDirection(t,r){return this.transformAsVector(t,r)}makeRotationX(t){return this.identity().rotateX(t)}makeTranslation(t,r,n){return this.identity().translate([t,r,n])}},l1,h1;function Eot(){return l1||(l1=new Mi([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(l1)),l1}function bot(){return h1||(h1=new Mi,Object.freeze(h1)),h1}function x6(e){if(e>Math.PI*2)throw Error("expected radians")}function Sot(e,t,r,n,s,i){let o=2*i/(r-t),a=2*i/(s-n),c=(r+t)/(r-t),l=(s+n)/(s-n),h=-1,f=-1,u=-2*i;return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=c,e[9]=l,e[10]=h,e[11]=f,e[12]=0,e[13]=0,e[14]=u,e[15]=0,e}function y6(){let e=new Ue(4);return Ue!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function A6(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function TE(e,t,r){r=r*.5;let n=Math.sin(r);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function ME(e,t,r){let n=t[0],s=t[1],i=t[2],o=t[3],a=r[0],c=r[1],l=r[2],h=r[3];return e[0]=n*h+o*a+s*l-i*c,e[1]=s*h+o*c+i*a-n*l,e[2]=i*h+o*l+n*c-s*a,e[3]=o*h-n*a-s*c-i*l,e}function T6(e,t,r){r*=.5;let n=t[0],s=t[1],i=t[2],o=t[3],a=Math.sin(r),c=Math.cos(r);return e[0]=n*c+o*a,e[1]=s*c+i*a,e[2]=i*c-s*a,e[3]=o*c-n*a,e}function M6(e,t,r){r*=.5;let n=t[0],s=t[1],i=t[2],o=t[3],a=Math.sin(r),c=Math.cos(r);return e[0]=n*c-i*a,e[1]=s*c+o*a,e[2]=i*c+n*a,e[3]=o*c-s*a,e}function E6(e,t,r){r*=.5;let n=t[0],s=t[1],i=t[2],o=t[3],a=Math.sin(r),c=Math.cos(r);return e[0]=n*c+s*a,e[1]=s*c-n*a,e[2]=i*c+o*a,e[3]=o*c-i*a,e}function b6(e,t){let r=t[0],n=t[1],s=t[2];return e[0]=r,e[1]=n,e[2]=s,e[3]=Math.sqrt(Math.abs(1-r*r-n*n-s*s)),e}function Tu(e,t,r,n){let s=t[0],i=t[1],o=t[2],a=t[3],c=r[0],l=r[1],h=r[2],f=r[3],u,d,p,g,m;return u=s*c+i*l+o*h+a*f,u<0&&(u=-u,c=-c,l=-l,h=-h,f=-f),1-u>1e-6?(d=Math.acos(u),m=Math.sin(d),p=Math.sin((1-n)*d)/m,g=Math.sin(n*d)/m):(p=1-n,g=n),e[0]=p*s+g*c,e[1]=p*i+g*l,e[2]=p*o+g*h,e[3]=p*a+g*f,e}function S6(e,t){let r=t[0],n=t[1],s=t[2],i=t[3],o=r*r+n*n+s*s+i*i,a=o?1/o:0;return e[0]=-r*a,e[1]=-n*a,e[2]=-s*a,e[3]=i*a,e}function v6(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function EE(e,t){let r=t[0]+t[4]+t[8],n;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let s=0;t[4]>t[0]&&(s=1),t[8]>t[s*3+s]&&(s=2);let i=(s+1)%3,o=(s+2)%3;n=Math.sqrt(t[s*3+s]-t[i*3+i]-t[o*3+o]+1),e[s]=.5*n,n=.5/n,e[3]=(t[i*3+o]-t[o*3+i])*n,e[i]=(t[i*3+s]+t[s*3+i])*n,e[o]=(t[o*3+s]+t[s*3+o])*n}return e}var w6=l6;var C6=h6,P6=p6,R6=g6,I6=f6;var O6=u6;var L6=d6;var N6=function(){let e=hE(),t=fE(1,0,0),r=fE(0,1,0);return function(n,s,i){let o=uE(s,i);return o<-.999999?(Ic(e,t,s),VD(e)<1e-6&&Ic(e,r,s),FD(e,e),TE(n,e,Math.PI),n):o>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Ic(e,s,i),n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1+o,L6(n,n))}}(),d$t=function(){let e=y6(),t=y6();return function(r,n,s,i,o,a){return Tu(e,n,o,a),Tu(t,s,i,a),Tu(r,e,t,2*a*(1-a)),r}}(),p$t=function(){let e=HD();return function(t,r,n,s){return e[0]=n[0],e[3]=n[1],e[6]=n[2],e[1]=s[0],e[4]=s[1],e[7]=s[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],L6(t,EE(t,e))}}();var vot=[0,0,0,1],Mu=class extends Ai{constructor(t=0,r=0,n=0,s=1){super(-0,-0,-0,-0),Array.isArray(t)&&arguments.length===1?this.copy(t):this.set(t,r,n,s)}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}set(t,r,n,s){return this[0]=t,this[1]=r,this[2]=n,this[3]=s,this.check()}fromObject(t){return this[0]=t.x,this[1]=t.y,this[2]=t.z,this[3]=t.w,this.check()}fromMatrix3(t){return EE(this,t),this.check()}fromAxisRotation(t,r){return TE(this,t,r),this.check()}identity(){return A6(this),this.check()}setAxisAngle(t,r){return this.fromAxisRotation(t,r)}get ELEMENTS(){return 4}get x(){return this[0]}set x(t){this[0]=gt(t)}get y(){return this[1]}set y(t){this[1]=gt(t)}get z(){return this[2]}set z(t){this[2]=gt(t)}get w(){return this[3]}set w(t){this[3]=gt(t)}len(){return I6(this)}lengthSquared(){return O6(this)}dot(t){return P6(this,t)}rotationTo(t,r){return N6(this,t,r),this.check()}add(t){return w6(this,this,t),this.check()}calculateW(){return b6(this,this),this.check()}conjugate(){return v6(this,this),this.check()}invert(){return S6(this,this),this.check()}lerp(t,r,n){return n===void 0?this.lerp(this,t,r):(R6(this,t,r,n),this.check())}multiplyRight(t){return ME(this,this,t),this.check()}multiplyLeft(t){return ME(this,t,this),this.check()}normalize(){let t=this.len(),r=t>0?1/t:0;return this[0]=this[0]*r,this[1]=this[1]*r,this[2]=this[2]*r,this[3]=this[3]*r,t===0&&(this[3]=1),this.check()}rotateX(t){return T6(this,this,t),this.check()}rotateY(t){return M6(this,this,t),this.check()}rotateZ(t){return E6(this,this,t),this.check()}scale(t){return C6(this,this,t),this.check()}slerp(t,r,n){let s,i,o;switch(arguments.length){case 1:({start:s=vot,target:i,ratio:o}=t);break;case 2:s=this,i=t,o=r;break;default:s=t,i=r,o=n}return Tu(this,s,i,o),this.check()}transformVector4(t,r=new Lc){return _6(r,t,this),Ti(r,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(t,r){return this.setAxisAngle(t,r)}premultiply(t){return this.multiplyLeft(t)}multiply(t){return this.multiplyRight(t)}};var _s=class{json;buffer;featuresLength=0;_cachedTypedArrays={};constructor(t,r){this.json=t,this.buffer=r}getExtension(t){return this.json.extensions&&this.json.extensions[t]}hasProperty(t){return Boolean(this.json[t])}getGlobalProperty(t,r=et.UNSIGNED_INT,n=1){let s=this.json[t];return s&&Number.isFinite(s.byteOffset)?this._getTypedArrayFromBinary(t,r,n,1,s.byteOffset):s}getPropertyArray(t,r,n){let s=this.json[t];return s&&Number.isFinite(s.byteOffset)?("componentType"in s&&(r=ke.fromName(s.componentType)),this._getTypedArrayFromBinary(t,r,n,this.featuresLength,s.byteOffset)):this._getTypedArrayFromArray(t,r,s)}getProperty(t,r,n,s,i){let o=this.json[t];if(!o)return o;let a=this.getPropertyArray(t,r,n);if(n===1)return a[s];for(let c=0;c<n;++c)i[c]=a[n*s+c];return i}_getTypedArrayFromBinary(t,r,n,s,i){let o=this._cachedTypedArrays,a=o[t];return a||(a=ke.createTypedArray(r,this.buffer.buffer,this.buffer.byteOffset+i,s*n),o[t]=a),a}_getTypedArrayFromArray(t,r,n){let s=this._cachedTypedArrays,i=s[t];return i||(i=ke.createTypedArray(r,n),s[t]=i),i}};var wot={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Cot={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},Pot={SCALAR:(e,t,r)=>{t[r]=e},VEC2:(e,t,r)=>{t[2*r+0]=e[0],t[2*r+1]=e[1]},VEC3:(e,t,r)=>{t[3*r+0]=e[0],t[3*r+1]=e[1],t[3*r+2]=e[2]},VEC4:(e,t,r)=>{t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT2:(e,t,r)=>{t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT3:(e,t,r)=>{t[9*r+0]=e[0],t[9*r+1]=e[1],t[9*r+2]=e[2],t[9*r+3]=e[3],t[9*r+4]=e[4],t[9*r+5]=e[5],t[9*r+6]=e[6],t[9*r+7]=e[7],t[9*r+8]=e[8],t[9*r+9]=e[9]},MAT4:(e,t,r)=>{t[16*r+0]=e[0],t[16*r+1]=e[1],t[16*r+2]=e[2],t[16*r+3]=e[3],t[16*r+4]=e[4],t[16*r+5]=e[5],t[16*r+6]=e[6],t[16*r+7]=e[7],t[16*r+8]=e[8],t[16*r+9]=e[9],t[16*r+10]=e[10],t[16*r+11]=e[11],t[16*r+12]=e[12],t[16*r+13]=e[13],t[16*r+14]=e[14],t[16*r+15]=e[15]}};function B6(e,t,r,n){let{componentType:s}=e;nt(e.componentType);let i=typeof s=="string"?ke.fromName(s):s,o=wot[e.type],a=Cot[e.type],c=Pot[e.type];return r+=e.byteOffset,{values:ke.createTypedArray(i,t,r,o*n),type:i,size:o,unpacker:a,packer:c}}var In=e=>e!==void 0;function F6(e,t,r){if(!t)return null;let n=e.getExtension("3DTILES_batch_table_hierarchy"),s=t.HIERARCHY;return s&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=s,n=s),n?Rot(n,r):null}function Rot(e,t){let r,n,s,i=e.instancesLength,o=e.classes,a=e.classIds,c=e.parentCounts,l=e.parentIds,h=i;In(a.byteOffset)&&(a.componentType=defaultValue(a.componentType,GL.UNSIGNED_SHORT),a.type=AttributeType.SCALAR,s=getBinaryAccessor(a),a=s.createArrayBufferView(t.buffer,t.byteOffset+a.byteOffset,i));let f;if(In(c))for(In(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,s=getBinaryAccessor(c),c=s.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,i)),f=new Uint16Array(i),h=0,r=0;r<i;++r)f[r]=h,h+=c[r];In(l)&&In(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,s=getBinaryAccessor(l),l=s.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,h));let u=o.length;for(r=0;r<u;++r){let m=o[r].length,_=o[r].instances,y=getBinaryProperties(m,_,t);o[r].instances=combine(y,_)}let d=new Array(u).fill(0),p=new Uint16Array(i);for(r=0;r<i;++r)n=a[r],p[r]=d[n],++d[n];let g={classes:o,classIds:a,classIndexes:p,parentCounts:c,parentIndexes:f,parentIds:l};return Lot(g),g}function Bc(e,t,r){if(!e)return;let n=e.parentCounts;return e.parentIds?r(e,t):n>0?Iot(e,t,r):Oot(e,t,r)}function Iot(e,t,r){let n=e.classIds,s=e.parentCounts,i=e.parentIds,o=e.parentIndexes,a=n.length,c=scratchVisited;c.length=Math.max(c.length,a);let l=++marker,h=scratchStack;for(h.length=0,h.push(t);h.length>0;){if(t=h.pop(),c[t]===l)continue;c[t]=l;let f=r(e,t);if(In(f))return f;let u=s[t],d=o[t];for(let p=0;p<u;++p){let g=i[d+p];g!==t&&h.push(g)}}return null}function Oot(e,t,r){let n=!0;for(;n;){let s=r(e,t);if(In(s))return s;let i=e.parentIds[t];n=i!==t,t=i}throw new Error("traverseHierarchySingleParent")}function Lot(e){let t=[],n=e.classIds.length;for(let s=0;s<n;++s)D6(e,s,stack)}function D6(e,t,r){let n=e.parentCounts,s=e.parentIds,i=e.parentIndexes,a=e.classIds.length;if(!In(s))return;assert(t<a,`Parent index ${t} exceeds the total number of instances: ${a}`),assert(r.indexOf(t)===-1,"Circular dependency detected in the batch table hierarchy."),r.push(t);let c=In(n)?n[t]:1,l=In(n)?i[t]:t;for(let h=0;h<c;++h){let f=s[l+h];f!==t&&D6(e,f,r)}r.pop(t)}function rr(e){return e!=null}var f1=(e,t)=>e,Not={HIERARCHY:!0,extensions:!0,extras:!0},ko=class{json;binary;featureCount;_extensions;_properties;_binaryProperties;_hierarchy;constructor(t,r,n,s={}){nt(n>=0),this.json=t||{},this.binary=r,this.featureCount=n,this._extensions=this.json?.extensions||{},this._properties={};for(let i in this.json)Not[i]||(this._properties[i]=this.json[i]);this._binaryProperties=this._initializeBinaryProperties(),s["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=F6(this,this.json,this.binary))}getExtension(t){return this.json&&this.json.extensions&&this.json.extensions[t]}memorySizeInBytes(){return 0}isClass(t,r){if(this._checkBatchId(t),nt(typeof r=="string",r),this._hierarchy){let n=Bc(this._hierarchy,t,(s,i)=>{let o=s.classIds[i];return s.classes[o].name===r});return rr(n)}return!1}isExactClass(t,r){return nt(typeof r=="string",r),this.getExactClassName(t)===r}getExactClassName(t){if(this._checkBatchId(t),this._hierarchy){let r=this._hierarchy.classIds[t];return this._hierarchy.classes[r].name}}hasProperty(t,r){return this._checkBatchId(t),nt(typeof r=="string",r),rr(this._properties[r])||this._hasPropertyInHierarchy(t,r)}getPropertyNames(t,r){this._checkBatchId(t),r=rr(r)?r:[],r.length=0;let n=Object.keys(this._properties);return r.push(...n),this._hierarchy&&this._getPropertyNamesInHierarchy(t,r),r}getProperty(t,r){if(this._checkBatchId(t),nt(typeof r=="string",r),this._binaryProperties){let s=this._binaryProperties[r];if(rr(s))return this._getBinaryProperty(s,t)}let n=this._properties[r];if(rr(n))return f1(n[t],!0);if(this._hierarchy){let s=this._getHierarchyProperty(t,r);if(rr(s))return s}}setProperty(t,r,n){let s=this.featureCount;if(this._checkBatchId(t),nt(typeof r=="string",r),this._binaryProperties){let o=this._binaryProperties[r];if(o){this._setBinaryProperty(o,t,n);return}}if(this._hierarchy&&this._setHierarchyProperty(this,t,r,n))return;let i=this._properties[r];rr(i)||(this._properties[r]=new Array(s),i=this._properties[r]),i[t]=f1(n,!0)}_checkBatchId(t){if(!(t>=0&&t<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(t,r){return t.unpack(t.typedArray,r)}_setBinaryProperty(t,r,n){t.pack(n,t.typedArray,r)}_initializeBinaryProperties(){let t=null;for(let r in this._properties){let n=this._properties[r],s=this._initializeBinaryProperty(r,n);s&&(t=t||{},t[r]=s)}return t}_initializeBinaryProperty(t,r){if("byteOffset"in r){let n=r;nt(this.binary,`Property ${t} requires a batch table binary.`),nt(n.type,`Property ${t} requires a type.`);let s=B6(n,this.binary.buffer,this.binary.byteOffset|0,this.featureCount);return{typedArray:s.values,componentCount:s.size,unpack:s.unpacker,pack:s.packer}}return null}_hasPropertyInHierarchy(t,r){if(!this._hierarchy)return!1;let n=Bc(this._hierarchy,t,(s,i)=>{let o=s.classIds[i],a=s.classes[o].instances;return rr(a[r])});return rr(n)}_getPropertyNamesInHierarchy(t,r){Bc(this._hierarchy,t,(n,s)=>{let i=n.classIds[s],o=n.classes[i].instances;for(let a in o)o.hasOwnProperty(a)&&r.indexOf(a)===-1&&r.push(a)})}_getHierarchyProperty(t,r){return Bc(this._hierarchy,t,(n,s)=>{let i=n.classIds[s],o=n.classes[i],a=n.classIndexes[s],c=o.instances[r];return rr(c)?rr(c.typedArray)?this._getBinaryProperty(c,a):f1(c[a],!0):null})}_setHierarchyProperty(t,r,n,s){let i=Bc(this._hierarchy,r,(o,a)=>{let c=o.classIds[a],l=o.classes[c],h=o.classIndexes[a],f=l.instances[n];return rr(f)?(nt(a===r,`Inherited property "${n}" is read-only.`),rr(f.typedArray)?this._setBinaryProperty(f,h,s):f[h]=f1(s,!0),!0):!1});return rr(i)}};function Ei(e,t,r=0){let n=new DataView(t);if(e.magic=n.getUint32(r,!0),r+=4,e.version=n.getUint32(r,!0),r+=4,e.byteLength=n.getUint32(r,!0),r+=4,e.version!==1)throw new Error(`3D Tile Version ${e.version} not supported`);return r}var Fc=4,k6="b3dm tile in legacy format.";function Dc(e,t,r){let n=new DataView(t),s;e.header=e.header||{};let i=n.getUint32(r,!0);r+=Fc;let o=n.getUint32(r,!0);r+=Fc;let a=n.getUint32(r,!0);r+=Fc;let c=n.getUint32(r,!0);return r+=Fc,a>=570425344?(r-=Fc*2,s=i,a=o,c=0,i=0,o=0,console.warn(k6)):c>=570425344&&(r-=Fc,s=a,a=i,c=o,i=0,o=0,console.warn(k6)),e.header.featureTableJsonByteLength=i,e.header.featureTableBinaryByteLength=o,e.header.batchTableJsonByteLength=a,e.header.batchTableBinaryByteLength=c,e.header.batchLength=s,r}function kc(e,t,r,n){return r=Bot(e,t,r,n),r=Fot(e,t,r,n),r}function Bot(e,t,r,n){let{featureTableJsonByteLength:s,featureTableBinaryByteLength:i,batchLength:o}=e.header||{};if(e.featureTableJson={BATCH_LENGTH:o||0},s&&s>0){let a=QM(t,r,s);e.featureTableJson=JSON.parse(a)}return r+=s||0,e.featureTableBinary=new Uint8Array(t,r,i),r+=i||0,r}function Fot(e,t,r,n){let{batchTableJsonByteLength:s,batchTableBinaryByteLength:i}=e.header||{};if(s&&s>0){let o=QM(t,r,s);e.batchTableJson=JSON.parse(o),r+=s,i&&i>0&&(e.batchTableBinary=new Uint8Array(t,r,i),e.batchTableBinary=new Uint8Array(e.batchTableBinary),r+=i)}return r}function bE(e,t,r){if(!t&&(!e||!e.batchIds||!r))return null;let{batchIds:n,isRGB565:s,pointCount:i=0}=e;if(n&&r){let o=new Uint8ClampedArray(i*3);for(let a=0;a<i;a++){let c=n[a],h=r.getProperty(c,"dimensions").map(f=>f*255);o[a*3]=h[0],o[a*3+1]=h[1],o[a*3+2]=h[2]}return{type:et.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}if(t&&s){let o=new Uint8ClampedArray(i*3);for(let a=0;a<i;a++){let c=oE(t[a]);o[a*3]=c[0],o[a*3+1]=c[1],o[a*3+2]=c[2]}return{type:et.UNSIGNED_BYTE,value:o,size:3,normalized:!0}}return t&&t.length===i*3?{type:et.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:et.UNSIGNED_BYTE,value:t||new Uint8ClampedArray,size:4,normalized:!0}}var U6=new Mt;function z6(e,t){if(!t)return null;if(e.isOctEncoded16P){let r=new Float32Array((e.pointsLength||0)*3);for(let n=0;n<(e.pointsLength||0);n++)aE(t[n*2],t[n*2+1],U6),U6.toArray(r,n*3);return{type:et.FLOAT,size:2,value:r}}return{type:et.FLOAT,size:2,value:t}}function V6(e,t,r){return e.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,Dot(e,t)):{type:et.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}function Dot(e,t){let r=new Mt,n=new Float32Array(e.pointCount*3);for(let s=0;s<e.pointCount;s++)r.set(t[s*3],t[s*3+1],t[s*3+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(n,s*3);return n}async function H6(e,t,r,n,s){r=Ei(e,t,r),r=Dc(e,t,r),r=kc(e,t,r,n),kot(e);let{featureTable:i,batchTable:o}=Uot(e);return await Got(e,i,o,n,s),zot(e,i,n),Vot(e,i,o),Hot(e,i),r}function kot(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}function Uot(e){let t=new _s(e.featureTableJson,e.featureTableBinary),r=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=r,e.featuresLength=r,e.pointsLength=r,e.pointCount=r,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",et.FLOAT,3);let n=Wot(e,t);return{featureTable:t,batchTable:n}}function zot(e,t,r){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.positions){if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",et.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){let n=t.getPropertyArray("POSITION_QUANTIZED",et.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=(1<<16)-1,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",et.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",et.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=V6(e,n,r)}}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}function Vot(e,t,r){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.colors){let n=null;t.hasProperty("RGBA")?(n=t.getPropertyArray("RGBA",et.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?n=t.getPropertyArray("RGB",et.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(n=t.getPropertyArray("RGB565",et.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=bE(e,n,r)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",et.UNSIGNED_BYTE,4))}function Hot(e,t){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.normals){let r=null;t.hasProperty("NORMAL")?r=t.getPropertyArray("NORMAL",et.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(r=t.getPropertyArray("NORMAL_OCT16P",et.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=z6(e,r)}}function Wot(e,t){let r=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",et.UNSIGNED_SHORT,1),e.batchIds)){let n=t.getGlobalProperty("BATCH_LENGTH");if(!n)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");let{batchTableJson:s,batchTableBinary:i}=e;r=new ko(s,i,n)}return r}async function Got(e,t,r,n,s){let i,o,a,c=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"];c&&(a=c.properties);let l=t.getExtension("3DTILES_draco_point_compression");if(l){o=l.properties;let f=l.byteOffset,u=l.byteLength;if(!o||!Number.isFinite(f)||!u)throw new Error("Draco properties, byteOffset, and byteLength must be defined");i=(e.featureTableBinary||[]).slice(f,f+u),e.hasPositions=Number.isFinite(o.POSITION),e.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),e.hasNormals=Number.isFinite(o.NORMAL),e.hasBatchIds=Number.isFinite(o.BATCH_ID),e.isTranslucent=Number.isFinite(o.RGBA)}if(!i)return!0;let h={buffer:i,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await jot(e,h,n,s)}async function jot(e,t,r,n){if(!n)return;let s={...r,draco:{...r?.draco,extraAttributes:t.batchTableProperties||{}}};delete s["3d-tiles"];let i=await sr(t.buffer,$m,s,n),o=i.attributes.POSITION&&i.attributes.POSITION.value,a=i.attributes.COLOR_0&&i.attributes.COLOR_0.value,c=i.attributes.NORMAL&&i.attributes.NORMAL.value,l=i.attributes.BATCH_ID&&i.attributes.BATCH_ID.value,h=o&&i.attributes.POSITION.value.quantization,f=c&&i.attributes.NORMAL.value.quantization;if(h){let d=i.POSITION.data.quantization,p=d.range;e.quantizedVolumeScale=new Mt(p,p,p),e.quantizedVolumeOffset=new Mt(d.minValues),e.quantizedRange=(1<<d.quantizationBits)-1,e.isQuantizedDraco=!0}f&&(e.octEncodedRange=(1<<i.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0);let u={};if(t.batchTableProperties)for(let d of Object.keys(t.batchTableProperties))i.attributes[d]&&i.attributes[d].value&&(u[d.toLowerCase()]=i.attributes[d].value);e.attributes={positions:o,colors:bE(e,a,void 0),normals:c,batchIds:l,...u}}var u1={URI:0,EMBEDDED:1};function d1(e,t,r,n){e.rotateYtoZ=!0;let s=(e.byteOffset||0)+(e.byteLength||0)-r;if(s===0)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=n?.["3d-tiles"]&&n["3d-tiles"].assetGltfUpAxis?n["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=Pi(t,r,s),e.gltfByteOffset=0,e.gltfByteLength=s,r%4===0||console.warn(`${e.type}: embedded glb is not aligned to a 4-byte boundary.`),(e.byteOffset||0)+(e.byteLength||0)}async function p1(e,t,r,n){let s=r?.["3d-tiles"]||{};if(qot(e,t,r),s.loadGLTF){if(!n)return;if(e.gltfUrl){let{fetch:i}=n,o=await i(e.gltfUrl,r);e.gltfArrayBuffer=await o.arrayBuffer(),e.gltfByteOffset=0}if(e.gltfArrayBuffer){let i=await sr(e.gltfArrayBuffer,cs,r,n);e.gltf=Ro(i),e.gpuMemoryUsageInBytes=ru(e.gltf),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength}}}function qot(e,t,r){switch(t){case u1.URI:if(e.gltfArrayBuffer){let n=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),i=new TextDecoder().decode(n);e.gltfUrl=i.replace(/[\s\0]+$/,"")}delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case u1.EMBEDDED:break;default:throw new Error("b3dm: Illegal glTF format field")}}async function W6(e,t,r,n,s){r=Xot(e,t,r,n,s),await p1(e,u1.EMBEDDED,n,s);let i=e?.gltf?.extensions;return i&&i.CESIUM_RTC&&(e.rtcCenter=i.CESIUM_RTC.center),r}function Xot(e,t,r,n,s){r=Ei(e,t,r),r=Dc(e,t,r),r=kc(e,t,r,n),r=d1(e,t,r,n);let i=new _s(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=i.getGlobalProperty("RTC_CENTER",et.FLOAT,3),r}async function G6(e,t,r,n,s){return r=Yot(e,t,r,n,s),await p1(e,e.gltfFormat||0,n,s),r}function Yot(e,t,r,n,s){if(r=Ei(e,t,r),e.version!==1)throw new Error(`Instanced 3D Model version ${e.version} is not supported`);r=Dc(e,t,r);let i=new DataView(t);if(e.gltfFormat=i.getUint32(r,!0),r+=4,r=kc(e,t,r,n),r=d1(e,t,r,n),!e?.header?.featureTableJsonByteLength||e.header.featureTableJsonByteLength===0)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");let o=new _s(e.featureTableJson,e.featureTableBinary),a=o.getGlobalProperty("INSTANCES_LENGTH");if(o.featuresLength=a,!Number.isFinite(a))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=o.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=o.getGlobalProperty("RTC_CENTER",et.FLOAT,3);let c=new ko(e.batchTableJson,e.batchTableBinary,a);return $ot(e,o,c,a),r}function $ot(e,t,r,n){let s=new Array(n),i=new Mt,o=new Mt,a=new Mt,c=new Mt,l=new Do,h=new Mu,f=new Mt,u={},d=new Mi,p=[],g=[],m=[],_=[];for(let y=0;y<n;y++){let x;if(t.hasProperty("POSITION"))x=t.getProperty("POSITION",et.FLOAT,3,y,i);else if(t.hasProperty("POSITION_QUANTIZED")){x=t.getProperty("POSITION_QUANTIZED",et.UNSIGNED_SHORT,3,y,i);let T=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",et.FLOAT,3);if(!T)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");let I=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",et.FLOAT,3);if(!I)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");let N=65535;for(let B=0;B<3;B++)x[B]=x[B]/N*I[B]+T[B]}if(!x)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");i.copy(x),u.translation=i,e.normalUp=t.getProperty("NORMAL_UP",et.FLOAT,3,y,p),e.normalRight=t.getProperty("NORMAL_RIGHT",et.FLOAT,3,y,g);let A=!1;if(e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",et.UNSIGNED_SHORT,2,y,p),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",et.UNSIGNED_SHORT,2,y,g),e.octNormalUp)throw e.octNormalRight?new Error("i3dm: oct-encoded orientation not implemented"):new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");e.eastNorthUp?(ot.WGS84.eastNorthUpToFixedFrame(i,d),d.getRotationMatrix3(l)):l.identity()}A&&(c.copy(o).cross(a).normalize(),l.setColumn(0,o),l.setColumn(1,a),l.setColumn(2,c)),h.fromMatrix3(l),u.rotation=h,f.set(1,1,1);let M=t.getProperty("SCALE",et.FLOAT,1,y,m);Number.isFinite(M)&&f.multiplyByScalar(M);let E=t.getProperty("SCALE_NON_UNIFORM",et.FLOAT,3,y,p);E&&f.scale(E),u.scale=f;let w=t.getProperty("BATCH_ID",et.UNSIGNED_SHORT,1,y,_);w===void 0&&(w=y);let v=new Mi().fromQuaternion(u.rotation);d.identity(),d.translate(u.translation),d.multiplyRight(v),d.scale(u.scale);let b=d.clone();s[y]={modelMatrix:b,batchId:w}}e.instances=s}async function j6(e,t,r,n,s,i){r=Ei(e,t,r);let o=new DataView(t);for(e.tilesLength=o.getUint32(r,!0),r+=4,e.tiles=[];e.tiles.length<e.tilesLength&&(e.byteLength||0)-r>12;){let a={shape:"tile3d"};e.tiles.push(a),r=await i(t,r,n,s,a)}return r}async function q6(e,t,r,n){if(e.rotateYtoZ=!0,e.gltfUpAxis=r?.["3d-tiles"]?.assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",r?.["3d-tiles"]?.loadGLTF){if(!n)return t.byteLength;let s=await sr(t,cs,r,n);e.gltf=Ro(s),e.gpuMemoryUsageInBytes=ru(e.gltf)}else e.gltfArrayBuffer=t;return t.byteLength}async function SE(e,t=0,r,n,s={shape:"tile3d"}){switch(s.byteOffset=t,s.type=aD(e,t),s.type){case No.COMPOSITE:return await j6(s,e,t,r,n,SE);case No.BATCHED_3D_MODEL:return await W6(s,e,t,r,n);case No.GLTF:return await q6(s,e,r,n);case No.INSTANCED_3D_MODEL:return await G6(s,e,t,r,n);case No.POINT_CLOUD:return await H6(s,e,t,r,n);default:throw new Error(`3DTileLoader: unknown type ${s.type}`)}}async function vE(e,t,r){if(new Uint32Array(e.slice(0,4))[0]!==1952609651)throw new Error("Wrong subtree file magic number");if(new Uint32Array(e.slice(4,8))[0]!==1)throw new Error("Wrong subtree file verson, must be 1");let i=X6(e.slice(8,16)),o=new Uint8Array(e,24,i),c=new TextDecoder("utf8").decode(o),l=JSON.parse(c),h=X6(e.slice(16,24)),f=new ArrayBuffer(0);if(h&&(f=e.slice(24+i)),await g1(l,l.tileAvailability,f,r),Array.isArray(l.contentAvailability))for(let u of l.contentAvailability)await g1(l,u,f,r);else await g1(l,l.contentAvailability,f,r);return await g1(l,l.childSubtreeAvailability,f,r),l}async function g1(e,t,r,n){let s=Number.isFinite(t.bitstream)?t.bitstream:t.bufferView;if(typeof s!="number")return;let i=e.bufferViews[s],o=e.buffers[i.buffer];if(!n?.baseUrl)throw new Error("Url is not provided");if(!n.fetch)throw new Error("fetch is not provided");if(o.uri){let c=`${n?.baseUrl||""}/${o.uri}`,h=await(await n.fetch(c)).arrayBuffer();t.explicitBitstream=new Uint8Array(h,i.byteOffset,i.byteLength);return}let a=e.buffers.slice(0,i.buffer).reduce((c,l)=>c+l.byteLength,0);t.explicitBitstream=new Uint8Array(r.slice(a,a+o.byteLength),i.byteOffset,i.byteLength)}function X6(e){let t=new DataView(e),r=t.getUint32(0,!0),n=t.getUint32(4,!0);return r+2**32*n}var m1={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:Z0,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:vE,options:{}};var Ir=null;try{Ir=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function It(e,t,r){this.low=e|0,this.high=t|0,this.unsigned=!!r}It.prototype.__isLong__;Object.defineProperty(It.prototype,"__isLong__",{value:!0});function ze(e){return(e&&e.__isLong__)===!0}function Y6(e){var t=Math.clz32(e&-e);return e?31-t:t}It.isLong=ze;var $6={},K6={};function Uo(e,t){var r,n,s;return t?(e>>>=0,(s=0<=e&&e<256)&&(n=K6[e],n)?n:(r=mt(e,0,!0),s&&(K6[e]=r),r)):(e|=0,(s=-128<=e&&e<128)&&(n=$6[e],n)?n:(r=mt(e,e<0?-1:0,!1),s&&($6[e]=r),r))}It.fromInt=Uo;function Or(e,t){if(isNaN(e))return t?xs:en;if(t){if(e<0)return xs;if(e>=tk)return nk}else{if(e<=-J6)return nr;if(e+1>=J6)return rk}return e<0?Or(-e,t).neg():mt(e%zc|0,e/zc|0,t)}It.fromNumber=Or;function mt(e,t,r){return new It(e,t,r)}It.fromBits=mt;var _1=Math.pow;function CE(e,t,r){if(e.length===0)throw Error("empty string");if(typeof t=="number"?(r=t,t=!1):t=!!t,e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return t?xs:en;if(r=r||10,r<2||36<r)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return CE(e.substring(1),t,r).neg();for(var s=Or(_1(r,8)),i=en,o=0;o<e.length;o+=8){var a=Math.min(8,e.length-o),c=parseInt(e.substring(o,o+a),r);if(a<8){var l=Or(_1(r,a));i=i.mul(l).add(Or(c))}else i=i.mul(s),i=i.add(Or(c))}return i.unsigned=t,i}It.fromString=CE;function rn(e,t){return typeof e=="number"?Or(e,t):typeof e=="string"?CE(e,t):mt(e.low,e.high,typeof t=="boolean"?t:e.unsigned)}It.fromValue=rn;var Z6=1<<16,Kot=1<<24,zc=Z6*Z6,tk=zc*zc,J6=tk/2,Q6=Uo(Kot),en=Uo(0);It.ZERO=en;var xs=Uo(0,!0);It.UZERO=xs;var Uc=Uo(1);It.ONE=Uc;var ek=Uo(1,!0);It.UONE=ek;var wE=Uo(-1);It.NEG_ONE=wE;var rk=mt(-1,2147483647,!1);It.MAX_VALUE=rk;var nk=mt(-1,-1,!0);It.MAX_UNSIGNED_VALUE=nk;var nr=mt(0,-2147483648,!1);It.MIN_VALUE=nr;var U=It.prototype;U.toInt=function(){return this.unsigned?this.low>>>0:this.low};U.toNumber=function(){return this.unsigned?(this.high>>>0)*zc+(this.low>>>0):this.high*zc+(this.low>>>0)};U.toString=function(t){if(t=t||10,t<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(nr)){var r=Or(t),n=this.div(r),s=n.mul(r).sub(this);return n.toString(t)+s.toInt().toString(t)}else return"-"+this.neg().toString(t);for(var i=Or(_1(t,6),this.unsigned),o=this,a="";;){var c=o.div(i),l=o.sub(c.mul(i)).toInt()>>>0,h=l.toString(t);if(o=c,o.isZero())return h+a;for(;h.length<6;)h="0"+h;a=""+h+a}};U.getHighBits=function(){return this.high};U.getHighBitsUnsigned=function(){return this.high>>>0};U.getLowBits=function(){return this.low};U.getLowBitsUnsigned=function(){return this.low>>>0};U.getNumBitsAbs=function(){if(this.isNegative())return this.eq(nr)?64:this.neg().getNumBitsAbs();for(var t=this.high!=0?this.high:this.low,r=31;r>0&&!(t&1<<r);r--);return this.high!=0?r+33:r+1};U.isZero=function(){return this.high===0&&this.low===0};U.eqz=U.isZero;U.isNegative=function(){return!this.unsigned&&this.high<0};U.isPositive=function(){return this.unsigned||this.high>=0};U.isOdd=function(){return(this.low&1)===1};U.isEven=function(){return(this.low&1)===0};U.equals=function(t){return ze(t)||(t=rn(t)),this.unsigned!==t.unsigned&&this.high>>>31===1&&t.high>>>31===1?!1:this.high===t.high&&this.low===t.low};U.eq=U.equals;U.notEquals=function(t){return!this.eq(t)};U.neq=U.notEquals;U.ne=U.notEquals;U.lessThan=function(t){return this.comp(t)<0};U.lt=U.lessThan;U.lessThanOrEqual=function(t){return this.comp(t)<=0};U.lte=U.lessThanOrEqual;U.le=U.lessThanOrEqual;U.greaterThan=function(t){return this.comp(t)>0};U.gt=U.greaterThan;U.greaterThanOrEqual=function(t){return this.comp(t)>=0};U.gte=U.greaterThanOrEqual;U.ge=U.greaterThanOrEqual;U.compare=function(t){if(ze(t)||(t=rn(t)),this.eq(t))return 0;var r=this.isNegative(),n=t.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1};U.comp=U.compare;U.negate=function(){return!this.unsigned&&this.eq(nr)?nr:this.not().add(Uc)};U.neg=U.negate;U.add=function(t){ze(t)||(t=rn(t));var r=this.high>>>16,n=this.high&65535,s=this.low>>>16,i=this.low&65535,o=t.high>>>16,a=t.high&65535,c=t.low>>>16,l=t.low&65535,h=0,f=0,u=0,d=0;return d+=i+l,u+=d>>>16,d&=65535,u+=s+c,f+=u>>>16,u&=65535,f+=n+a,h+=f>>>16,f&=65535,h+=r+o,h&=65535,mt(u<<16|d,h<<16|f,this.unsigned)};U.subtract=function(t){return ze(t)||(t=rn(t)),this.add(t.neg())};U.sub=U.subtract;U.multiply=function(t){if(this.isZero())return this;if(ze(t)||(t=rn(t)),Ir){var r=Ir.mul(this.low,this.high,t.low,t.high);return mt(r,Ir.get_high(),this.unsigned)}if(t.isZero())return this.unsigned?xs:en;if(this.eq(nr))return t.isOdd()?nr:en;if(t.eq(nr))return this.isOdd()?nr:en;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(Q6)&&t.lt(Q6))return Or(this.toNumber()*t.toNumber(),this.unsigned);var n=this.high>>>16,s=this.high&65535,i=this.low>>>16,o=this.low&65535,a=t.high>>>16,c=t.high&65535,l=t.low>>>16,h=t.low&65535,f=0,u=0,d=0,p=0;return p+=o*h,d+=p>>>16,p&=65535,d+=i*h,u+=d>>>16,d&=65535,d+=o*l,u+=d>>>16,d&=65535,u+=s*h,f+=u>>>16,u&=65535,u+=i*l,f+=u>>>16,u&=65535,u+=o*c,f+=u>>>16,u&=65535,f+=n*h+s*l+i*c+o*a,f&=65535,mt(d<<16|p,f<<16|u,this.unsigned)};U.mul=U.multiply;U.divide=function(t){if(ze(t)||(t=rn(t)),t.isZero())throw Error("division by zero");if(Ir){if(!this.unsigned&&this.high===-2147483648&&t.low===-1&&t.high===-1)return this;var r=(this.unsigned?Ir.div_u:Ir.div_s)(this.low,this.high,t.low,t.high);return mt(r,Ir.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?xs:en;var n,s,i;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return xs;if(t.gt(this.shru(1)))return ek;i=xs}else{if(this.eq(nr)){if(t.eq(Uc)||t.eq(wE))return nr;if(t.eq(nr))return Uc;var o=this.shr(1);return n=o.div(t).shl(1),n.eq(en)?t.isNegative()?Uc:wE:(s=this.sub(t.mul(n)),i=n.add(s.div(t)),i)}else if(t.eq(nr))return this.unsigned?xs:en;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=en}for(s=this;s.gte(t);){n=Math.max(1,Math.floor(s.toNumber()/t.toNumber()));for(var a=Math.ceil(Math.log(n)/Math.LN2),c=a<=48?1:_1(2,a-48),l=Or(n),h=l.mul(t);h.isNegative()||h.gt(s);)n-=c,l=Or(n,this.unsigned),h=l.mul(t);l.isZero()&&(l=Uc),i=i.add(l),s=s.sub(h)}return i};U.div=U.divide;U.modulo=function(t){if(ze(t)||(t=rn(t)),Ir){var r=(this.unsigned?Ir.rem_u:Ir.rem_s)(this.low,this.high,t.low,t.high);return mt(r,Ir.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))};U.mod=U.modulo;U.rem=U.modulo;U.not=function(){return mt(~this.low,~this.high,this.unsigned)};U.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32};U.clz=U.countLeadingZeros;U.countTrailingZeros=function(){return this.low?Y6(this.low):Y6(this.high)+32};U.ctz=U.countTrailingZeros;U.and=function(t){return ze(t)||(t=rn(t)),mt(this.low&t.low,this.high&t.high,this.unsigned)};U.or=function(t){return ze(t)||(t=rn(t)),mt(this.low|t.low,this.high|t.high,this.unsigned)};U.xor=function(t){return ze(t)||(t=rn(t)),mt(this.low^t.low,this.high^t.high,this.unsigned)};U.shiftLeft=function(t){return ze(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?mt(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):mt(0,this.low<<t-32,this.unsigned)};U.shl=U.shiftLeft;U.shiftRight=function(t){return ze(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?mt(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):mt(this.high>>t-32,this.high>=0?0:-1,this.unsigned)};U.shr=U.shiftRight;U.shiftRightUnsigned=function(t){return ze(t)&&(t=t.toInt()),(t&=63)===0?this:t<32?mt(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):t===32?mt(this.high,0,this.unsigned):mt(this.high>>>t-32,0,this.unsigned)};U.shru=U.shiftRightUnsigned;U.shr_u=U.shiftRightUnsigned;U.rotateLeft=function(t){var r;return ze(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?mt(this.high,this.low,this.unsigned):t<32?(r=32-t,mt(this.low<<t|this.high>>>r,this.high<<t|this.low>>>r,this.unsigned)):(t-=32,r=32-t,mt(this.high<<t|this.low>>>r,this.low<<t|this.high>>>r,this.unsigned))};U.rotl=U.rotateLeft;U.rotateRight=function(t){var r;return ze(t)&&(t=t.toInt()),(t&=63)===0?this:t===32?mt(this.high,this.low,this.unsigned):t<32?(r=32-t,mt(this.high<<r|this.low>>>t,this.low<<r|this.high>>>t,this.unsigned)):(t-=32,r=32-t,mt(this.low<<r|this.high>>>t,this.high<<r|this.low>>>t,this.unsigned))};U.rotr=U.rotateRight;U.toSigned=function(){return this.unsigned?mt(this.low,this.high,!1):this};U.toUnsigned=function(){return this.unsigned?this:mt(this.low,this.high,!0)};U.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()};U.toBytesLE=function(){var t=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,t&255,t>>>8&255,t>>>16&255,t>>>24]};U.toBytesBE=function(){var t=this.high,r=this.low;return[t>>>24,t>>>16&255,t>>>8&255,t&255,r>>>24,r>>>16&255,r>>>8&255,r&255]};It.fromBytes=function(t,r,n){return n?It.fromBytesLE(t,r):It.fromBytesBE(t,r)};It.fromBytesLE=function(t,r){return new It(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,r)};It.fromBytesBE=function(t,r){return new It(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],r)};var Vc=It;var Zot=16;function Eu(e){e==="X"&&(e="");let t=e.padEnd(Zot,"0");return Vc.fromString(t,!0,16)}function PE(e){if(e.isZero())return"X";let t=e.countTrailingZeros(),r=t%4;t=(t-r)/4;let n=t;t*=4;let i=e.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-n-i.length).join("0")+i}function RE(e,t){let r=Jot(e).shiftRightUnsigned(2);return e.add(Vc.fromNumber(2*t+1-4).multiply(r))}function Jot(e){return e.and(e.not().add(1))}var Qot=3,tat=30,eat=2*tat+1,sk=180/Math.PI;function ok(e){if(e.length===0)throw new Error(`Invalid Hilbert quad key ${e}`);let t=e.split("/"),r=parseInt(t[0],10),n=t[1],s=n.length,i=0,o=[0,0];for(let a=s-1;a>=0;a--){i=s-a;let c=n[a],l=0,h=0;c==="1"?h=1:c==="2"?(l=1,h=1):c==="3"&&(l=1);let f=Math.pow(2,i-1);rat(f,o,l,h),o[0]+=f*l,o[1]+=f*h}if(r%2===1){let a=o[0];o[0]=o[1],o[1]=a}return{face:r,ij:o,level:i}}function ak(e){if(e.isZero())return"";let t=e.toString(2);for(;t.length<Qot+eat;)t="0"+t;let r=t.lastIndexOf("1"),n=t.substring(0,3),s=t.substring(3,r),i=s.length/2,o=Vc.fromString(n,!0,2).toString(10),a="";if(i!==0)for(a=Vc.fromString(s,!0,2).toString(4);a.length<i;)a="0"+a;return`${o}/${a}`}function IE(e,t,r){let n=1<<t;return[(e[0]+r[0])/n,(e[1]+r[1])/n]}function ik(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function OE(e){return[ik(e[0]),ik(e[1])]}function LE(e,[t,r]){switch(e){case 0:return[1,t,r];case 1:return[-t,1,r];case 2:return[-t,-r,1];case 3:return[-1,-r,-t];case 4:return[r,-1,-t];case 5:return[r,t,-1];default:throw new Error("Invalid face")}}function NE([e,t,r]){let n=Math.atan2(r,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*sk,n*sk]}function rat(e,t,r,n){if(n===0){r===1&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);let s=t[0];t[0]=t[1],t[1]=s}}function ck(e){let t=IE(e.ij,e.level,[.5,.5]),r=OE(t),n=LE(e.face,r);return NE(n)}var nat=100;function BE(e){let{face:t,ij:r,level:n}=e,s=[[0,0],[0,1],[1,1],[1,0],[0,0]],i=Math.max(1,Math.ceil(nat*Math.pow(2,-n))),o=new Float64Array(4*i*2+2),a=0,c=0;for(let l=0;l<4;l++){let h=s[l].slice(0),f=s[l+1],u=(f[0]-h[0])/i,d=(f[1]-h[1])/i;for(let p=0;p<i;p++){h[0]+=u,h[1]+=d;let g=IE(r,n,h),m=OE(g),_=LE(t,m),y=NE(_);Math.abs(y[1])>89.999&&(y[0]=c);let x=y[0]-c;y[0]+=x>180?-360:x<-180?360:0,o[a++]=y[0],o[a++]=y[1],c=y[0]}}return o[a++]=o[0],o[a++]=o[1],o}function Hc(e){let t=sat(e);return ok(t)}function sat(e){if(e.indexOf("/")>0)return e;let t=Eu(e);return ak(t)}function FE(e){let t=Hc(e);return ck(t)}function hk(e){let t;if(e.face===2||e.face===5){let r=null,n=0;for(let s=0;s<4;s++){let i=`${e.face}/${s}`,o=Hc(i),a=BE(o);(typeof r>"u"||r===null)&&(r=new Float64Array(4*a.length)),r.set(a,n),n+=a.length}t=lk(r)}else{let r=BE(e);t=lk(r)}return t}function lk(e){if(e.length%2!==0)throw new Error("Invalid corners");let t=[],r=[];for(let n=0;n<e.length;n+=2)t.push(e[n]),r.push(e[n+1]);return t.sort((n,s)=>n-s),r.sort((n,s)=>n-s),{west:t[0],east:t[t.length-1],north:r[r.length-1],south:r[0]}}function DE(e,t){let r=t?.minimumHeight||0,n=t?.maximumHeight||0,s=Hc(e),i=hk(s),o=i.west,a=i.south,c=i.east,l=i.north,h=[];return h.push(new Mt(o,l,r)),h.push(new Mt(c,l,r)),h.push(new Mt(c,a,r)),h.push(new Mt(o,a,r)),h.push(new Mt(o,l,n)),h.push(new Mt(c,l,n)),h.push(new Mt(c,a,n)),h.push(new Mt(o,a,n)),h}function x1(e){let t=e.token,r={minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight},n=DE(t,r),s=FE(t),i=s[0],o=s[1],a=ot.WGS84.cartographicToCartesian([i,o,r.maximumHeight]),c=new Mt(a[0],a[1],a[2]);n.push(c);let l=VM(n);return[...l.center,...l.halfAxes]}var iat=4,oat=8,aat={QUADTREE:iat,OCTREE:oat};function cat(e,t,r){if(e?.box){let n=Eu(e.s2VolumeInfo.token),s=RE(n,t),i=PE(s),o={...e.s2VolumeInfo};switch(o.token=i,r){case"OCTREE":let l=e.s2VolumeInfo,h=l.maximumHeight-l.minimumHeight,f=h/2,u=l.minimumHeight+h/2;l.minimumHeight=u-f,l.maximumHeight=u+f;break;default:break}return{box:x1(o),s2VolumeInfo:o}}}async function UE(e){let{implicitOptions:t,parentData:r={mortonIndex:0,x:0,y:0,z:0},childIndex:n=0,s2VolumeBox:s,loaderOptions:i}=e,{subtree:o,level:a=0,globalData:c={level:0,mortonIndex:0,x:0,y:0,z:0}}=e,{subdivisionScheme:l,subtreeLevels:h,maximumLevel:f,contentUrlTemplate:u,subtreesUriTemplate:d,basePath:p}=t,g={children:[],lodMetricValue:0,contentUrl:""};if(!f)return E_.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${u} won't be loaded...`),g;let m=a+c.level;if(m>f)return g;let _=aat[l],y=Math.log2(_),x=n&1,A=n>>1&1,M=n>>2&1,E=(_**a-1)/(_-1),w=zo(r.mortonIndex,n,y),v=E+w,b=zo(r.x,x,1),T=zo(r.y,A,1),I=zo(r.z,M,1),N=!1;a>=h&&(N=kE(o.childSubtreeAvailability,w));let B=zo(c.x,b,a),C=zo(c.y,T,a),V=zo(c.z,I,a);if(N){let vt=`${p}/${d}`,Dt=y1(vt,m,B,C,V);o=await se(Dt,m1,i),c={mortonIndex:w,x:b,y:T,z:I,level:a},w=0,v=0,b=0,T=0,I=0,a=0}if(!kE(o.tileAvailability,v))return g;kE(o.contentAvailability,v)&&(g.contentUrl=y1(u,m,B,C,V));let St=a+1,ht={mortonIndex:w,x:b,y:T,z:I};for(let vt=0;vt<_;vt++){let Dt=cat(s,vt,l),$e=await UE({subtree:o,implicitOptions:t,loaderOptions:i,parentData:ht,childIndex:vt,level:St,globalData:{...c},s2VolumeBox:Dt});if($e.contentUrl||$e.children.length){let z8=m+1,V8=lat($e,z8,{childTileX:b,childTileY:T,childTileZ:I},t,s);g.children.push(V8)}}return g}function kE(e,t){let r;return Array.isArray(e)?(r=e[0],e.length>1&&E_.once('Not supported extension "3DTILES_multiple_contents" has been detected')):r=e,"constant"in r?Boolean(r.constant):r.explicitBitstream?uat(t,r.explicitBitstream):!1}function lat(e,t,r,n,s){let{basePath:i,refine:o,getRefine:a,lodMetricType:c,getTileType:l,rootLodMetricValue:h,rootBoundingVolume:f}=n,u=e.contentUrl&&e.contentUrl.replace(`${i}/`,""),d=h/2**t,p=s?.box?{box:s.box}:f,g=hat(t,p,r);return{children:e.children,contentUrl:e.contentUrl,content:{uri:u},id:e.contentUrl,refine:a(o),type:l(e),lodMetricType:c,lodMetricValue:d,geometricError:d,transform:e.transform,boundingVolume:g}}function hat(e,t,r){if(t.region){let{childTileX:n,childTileY:s,childTileZ:i}=r,[o,a,c,l,h,f]=t.region,u=2**e,d=(c-o)/u,p=(l-a)/u,g=(f-h)/u,[m,_]=[o+d*n,o+d*(n+1)],[y,x]=[a+p*s,a+p*(s+1)],[A,M]=[h+g*i,h+g*(i+1)];return{region:[m,y,_,x,A,M]}}if(t.box)return t;throw new Error(`Unsupported bounding volume type ${JSON.stringify(t)}`)}function zo(e,t,r){return(e<<r)+t}function y1(e,t,r,n,s){let i=fat({level:t,x:r,y:n,z:s});return e.replace(/{level}|{x}|{y}|{z}/gi,o=>i[o])}function fat(e){let t={};for(let r in e)t[`{${r}}`]=e[r];return t}function uat(e,t){let r=Math.floor(e/8),n=e%8;return(t[r]>>n&1)===1}function VE(e,t=""){if(!t)return Rr.EMPTY;let n=t.split("?")[0].split(".").pop();switch(n){case"pnts":return Rr.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return Rr.SCENEGRAPH;default:return n||Rr.EMPTY}}function HE(e){switch(e){case"REPLACE":case"replace":return Fe.REPLACE;case"ADD":case"add":return Fe.ADD;default:return e}}function zE(e,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){let n=new URL(e,`${t}/`);return decodeURI(n.toString())}else if(e.startsWith("/"))return e;return ir.resolve(t,e)}function fk(e,t){if(!e)return null;let r;if(e.content){let s=e.content.uri||e.content?.url;typeof s<"u"&&(r=zE(s,t))}return{...e,id:r,contentUrl:r,lodMetricType:gs.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:VE(e,r),refine:HE(e.refine)}}async function pk(e,t,r){let n=null,s=dk(e.root);s&&e.root?n=await uk(e.root,e,t,s,r):n=fk(e.root,t);let i=[];for(i.push(n);i.length>0;){let o=i.pop()||{},a=o.children||[],c=[];for(let l of a){let h=dk(l),f;h?f=await uk(l,e,t,h,r):f=fk(l,t),f&&(c.push(f),i.push(f))}o.children=c}return n}async function uk(e,t,r,n,s){let{subdivisionScheme:i,maximumLevel:o,availableLevels:a,subtreeLevels:c,subtrees:{uri:l}}=n,h=y1(l,0,0,0,0),f=zE(h,r),u=await se(f,m1,s),d=e.content?.uri,p=d?zE(d,r):"",g=t?.root?.refine,m=e.geometricError,_=e.boundingVolume.extensions?.["3DTILES_bounding_volume_S2"];if(_){let M={box:x1(_),s2VolumeInfo:_};e.boundingVolume=M}let y=e.boundingVolume,x={contentUrlTemplate:p,subtreesUriTemplate:l,subdivisionScheme:i,subtreeLevels:c,maximumLevel:Number.isFinite(a)?a-1:o,refine:g,basePath:r,lodMetricType:gs.GEOMETRIC_ERROR,rootLodMetricValue:m,rootBoundingVolume:y,getTileType:VE,getRefine:HE};return await dat(e,r,u,x,s)}async function dat(e,t,r,n,s){if(!e)return null;let{children:i,contentUrl:o}=await UE({subtree:r,implicitOptions:n,loaderOptions:s}),a,c=null;return o&&(a=o,c={uri:o.replace(`${t}/`,"")}),{...e,id:a,contentUrl:a,lodMetricType:gs.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:VE(e,a),refine:HE(e.refine),content:c||e.content,children:i}}function dk(e){return e?.extensions?.["3DTILES_implicit_tiling"]||e?.implicitTiling}var A1={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:Z0,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:pat,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function pat(e,t={},r){let n=t["3d-tiles"]||{},s;return n.isTileset==="auto"?s=r?.url&&r.url.indexOf(".json")!==-1:s=n.isTileset,s?gat(e,t,r):mat(e,t,r)}async function gat(e,t,r){let n=JSON.parse(new TextDecoder().decode(e)),s=r?.url||"",i=_at(s),o=await pk(n,i,t||{});return{...n,shape:"tileset3d",loader:A1,url:s,queryString:r?.queryString||"",basePath:i,root:o||n.root,type:xe.TILES3D,lodMetricType:gs.GEOMETRIC_ERROR,lodMetricValue:n.root?.geometricError||0}}async function mat(e,t,r){let n={content:{shape:"tile3d",featureIds:null}};return await SE(e,0,t,r,n.content),n.content}function _at(e){return ir.dirname(e)}var gk=[0],xat={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:A1,onTilesetLoad:{type:"function",value:e=>{}},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:(e,t,r)=>{}},_getMeshColor:{type:"function",value:e=>[255,255,255]}},bu=class extends Ft{initializeState(){"onTileLoadFail"in this.props&&k.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){return Boolean(this.state?.tileset3d?.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState({props:t,oldProps:r,changeFlags:n}){if(t.data&&t.data!==r.data&&this._loadTileset(t.data),n.viewportChanged){let{activeViewports:s}=this.state;Object.keys(s).length&&(this._updateTileset(s),this.state.lastUpdatedViewports=s,this.state.activeViewports={})}if(n.propsChanged){let{layerMap:s}=this.state;for(let i in s)s[i].needsUpdate=!0}}activateViewport(t){let{activeViewports:r,lastUpdatedViewports:n}=this.state;this.internalState.viewport=t,r[t.id]=t;let s=n?.[t.id];(!s||!t.equals(s))&&(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:t,sourceLayer:r}){let n=r&&r.props.tile;return t.picked&&(t.object=n),t.sourceTile=n,t}filterSubLayer({layer:t,viewport:r}){let{tile:n}=t.props,{id:s}=r;return n.selected&&n.viewportIds.includes(s)}_updateAutoHighlight(t){let r=t.sourceTile,n=this.state.layerMap[r?.id];n&&n.layer&&n.layer.updateAutoHighlight(t)}async _loadTileset(t){let{loadOptions:r={}}=this.props,n=this.props.loader||this.props.loaders,s=Array.isArray(n)?n[0]:n,i={loadOptions:{...r}},o=t;if(s.preload){let l=await s.preload(t,r);l.url&&(o=l.url),l.headers&&(i.loadOptions.fetch={...i.loadOptions.fetch,headers:l.headers}),Object.assign(i,l)}let a=await se(o,s,i.loadOptions),c=new yu(a,{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...i});this.setState({tileset3d:c,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(c)}_onTileLoad(t){let{lastUpdatedViewports:r}=this.state;this.props.onTileLoad(t),this._updateTileset(r),this.setNeedsUpdate()}_onTileUnload(t){delete this.state.layerMap[t.id],this.props.onTileUnload(t)}_updateTileset(t){if(!t)return;let{tileset3d:r}=this.state,{timeline:n}=this.context,s=Object.keys(t).length;!n||!s||!r||r.selectTiles(Object.values(t)).then(i=>{this.state.frameNumber!==i&&this.setState({frameNumber:i})})}_getSubLayer(t,r){if(!t.content)return null;switch(t.type){case Rr.POINTCLOUD:return this._makePointCloudLayer(t,r);case Rr.SCENEGRAPH:return this._make3DModelLayer(t);case Rr.MESH:return this._makeSimpleMeshLayer(t,r);default:throw new Error(`Tile3DLayer: Failed to render layer of type ${t.content.type}`)}}_makePointCloudLayer(t,r){let{attributes:n,pointCount:s,constantRGBA:i,cartographicOrigin:o,modelMatrix:a}=t.content,{positions:c,normals:l,colors:h}=n;if(!c)return null;let f=r&&r.props.data||{header:{vertexCount:s},attributes:{POSITION:c,NORMAL:l,COLOR_0:h}},{pointSize:u,getPointColor:d}=this.props,p=this.getSubLayerClass("pointcloud",Zg);return new p({pointSize:u},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${t.id}`,tile:t,data:f,coordinateSystem:W.METER_OFFSETS,coordinateOrigin:o,modelMatrix:a,getColor:i||d,_offset:0})}_make3DModelLayer(t){let{gltf:r,instances:n,cartographicOrigin:s,modelMatrix:i}=t.content,o=this.getSubLayerClass("scenegraph",s0);return new o({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${t.id}`,tile:t,data:n||gk,scenegraph:r,coordinateSystem:W.METER_OFFSETS,coordinateOrigin:s,modelMatrix:i,getTransformMatrix:a=>a.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(t,r){let n=t.content,{attributes:s,indices:i,modelMatrix:o,cartographicOrigin:a,coordinateSystem:c=W.METER_OFFSETS,material:l,featureIds:h}=n,{_getMeshColor:f}=this.props,u=r&&r.props.mesh||new it({topology:"triangle-list",attributes:yat(s),indices:i}),d=this.getSubLayerClass("mesh",zN);return new d(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${t.id}`,tile:t,mesh:u,data:gk,getColor:f(t),pbrMaterial:l,modelMatrix:o,coordinateOrigin:a,coordinateSystem:c,featureIds:h,_offset:0})}renderLayers(){let{tileset3d:t,layerMap:r}=this.state;return t?t.tiles.map(n=>{let s=r[n.id]=r[n.id]||{tile:n},{layer:i}=s;return n.selected&&(i?s.needsUpdate&&(i=this._getSubLayer(n,i),s.needsUpdate=!1):i=this._getSubLayer(n)),s.layer=i,i}).filter(Boolean):null}};bu.defaultProps=xat;bu.layerName="Tile3DLayer";var mk=bu;function yat(e){let t={};return t.positions={...e.positions,value:new Float32Array(e.positions.value)},e.normals&&(t.normals=e.normals),e.texCoords&&(t.texCoords=e.texCoords),e.colors&&(t.colors=e.colors),e.uvRegions&&(t.uvRegions=e.uvRegions),t}var Aat=new Map([["centerX",Float64Array.BYTES_PER_ELEMENT],["centerY",Float64Array.BYTES_PER_ELEMENT],["centerZ",Float64Array.BYTES_PER_ELEMENT],["minHeight",Float32Array.BYTES_PER_ELEMENT],["maxHeight",Float32Array.BYTES_PER_ELEMENT],["boundingSphereCenterX",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterY",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterZ",Float64Array.BYTES_PER_ELEMENT],["boundingSphereRadius",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointX",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointY",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointZ",Float64Array.BYTES_PER_ELEMENT]]);function WE(e){return e>>1^-(e&1)}function Tat(e){let t=0,r={};for(let[n,s]of Aat){let i=s===8?e.getFloat64:e.getFloat32;r[n]=i.call(e,t,!0),t+=s}return{header:r,headerEndPosition:t}}function Mat(e,t){let r=t,n=3,s=e.getUint32(r,!0),i=new Uint16Array(s*n);r+=Uint32Array.BYTES_PER_ELEMENT;let o=Uint16Array.BYTES_PER_ELEMENT,a=s*o,c=r,l=c+a,h=l+a,f=0,u=0,d=0;for(let p=0;p<s;p++)f+=WE(e.getUint16(c+o*p,!0)),u+=WE(e.getUint16(l+o*p,!0)),d+=WE(e.getUint16(h+o*p,!0)),i[p]=f,i[p+s]=u,i[p+s*2]=d;return r+=a*3,{vertexData:i,vertexDataEndPosition:r}}function Su(e,t,r,n,s=!0){let i;if(n===2?i=new Uint16Array(e,t,r):i=new Uint32Array(e,t,r),!s)return i;let o=0;for(let a=0;a<i.length;++a){let c=i[a];i[a]=o-c,c===0&&++o}return i}function Eat(e,t,r){let n=r,s=3,o=t.length/s>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT;n%o!==0&&(n+=o-n%o);let a=e.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;let c=a*3,l=Su(e.buffer,n,c,o);return n+=c*o,{triangleIndicesEndPosition:n,triangleIndices:l}}function bat(e,t,r){let n=r,s=3,o=t.length/s>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT,a=e.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;let c=Su(e.buffer,n,a,o,!1);n+=a*o;let l=e.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;let h=Su(e.buffer,n,l,o,!1);n+=l*o;let f=e.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;let u=Su(e.buffer,n,f,o,!1);n+=f*o;let d=e.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;let p=Su(e.buffer,n,d,o,!1);return n+=d*o,{edgeIndicesEndPosition:n,westIndices:c,southIndices:h,eastIndices:u,northIndices:p}}function Sat(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}function vat(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}function wat(e,t){let r={};if(e.byteLength<=t)return{extensions:r,extensionsEndPosition:t};let n=t;for(;n<e.byteLength;){let s=e.getUint8(n,!0);n+=Uint8Array.BYTES_PER_ELEMENT;let i=e.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;let o=new DataView(e.buffer,n,i);switch(s){case 1:{r.vertexNormals=Sat(o);break}case 2:{r.waterMask=vat(o);break}default:}n+=i}return{extensions:r,extensionsEndPosition:n}}var Vo={header:0,vertices:1,triangleIndices:2,edgeIndices:3,extensions:4},Cat={maxDecodingStep:Vo.extensions};function GE(e,t){let r=Object.assign({},Cat,t),n=new DataView(e),{header:s,headerEndPosition:i}=Tat(n);if(r.maxDecodingStep<Vo.vertices)return{header:s};let{vertexData:o,vertexDataEndPosition:a}=Mat(n,i);if(r.maxDecodingStep<Vo.triangleIndices)return{header:s,vertexData:o};let{triangleIndices:c,triangleIndicesEndPosition:l}=Eat(n,o,a);if(r.maxDecodingStep<Vo.edgeIndices)return{header:s,vertexData:o,triangleIndices:c};let{westIndices:h,southIndices:f,eastIndices:u,northIndices:d,edgeIndicesEndPosition:p}=bat(n,o,l);if(r.maxDecodingStep<Vo.extensions)return{header:s,vertexData:o,triangleIndices:c,westIndices:h,northIndices:d,eastIndices:u,southIndices:f};let{extensions:g}=wat(n,p);return{header:s,vertexData:o,triangleIndices:c,westIndices:h,northIndices:d,eastIndices:u,southIndices:f,extensions:g}}function T1(e,t,r,n){let s=n?Rat(n,e.POSITION.value):Pat(t),i=new e.POSITION.value.constructor(s.length*6),o=new e.TEXCOORD_0.value.constructor(s.length*4),a=new t.constructor(s.length*6);for(let l=0;l<s.length;l++){let h=s[l];Iat({edge:h,edgeIndex:l,attributes:e,skirtHeight:r,newPosition:i,newTexcoord0:o,newTriangles:a})}e.POSITION.value=yl(e.POSITION.value,i),e.TEXCOORD_0.value=yl(e.TEXCOORD_0.value,o);let c=t instanceof Array?t.concat(a):yl(t,a);return{attributes:e,triangles:c}}function Pat(e){let t=[];for(let s=0;s<e.length;s+=3)t.push([e[s],e[s+1]]),t.push([e[s+1],e[s+2]]),t.push([e[s+2],e[s]]);t.sort((s,i)=>Math.min(...s)-Math.min(...i)||Math.max(...s)-Math.max(...i));let r=[],n=0;for(;n<t.length;)t[n][0]===t[n+1]?.[1]&&t[n][1]===t[n+1]?.[0]?n+=2:(r.push(t[n]),n++);return r}function Rat(e,t){e.westIndices.sort((n,s)=>t[3*n+1]-t[3*s+1]),e.eastIndices.sort((n,s)=>t[3*s+1]-t[3*n+1]),e.southIndices.sort((n,s)=>t[3*s]-t[3*n]),e.northIndices.sort((n,s)=>t[3*n]-t[3*s]);let r=[];for(let n in e){let s=e[n];for(let i=0;i<s.length-1;i++)r.push([s[i],s[i+1]])}return r}function Iat({edge:e,edgeIndex:t,attributes:r,skirtHeight:n,newPosition:s,newTexcoord0:i,newTriangles:o}){let a=r.POSITION.value.length,c=t*2,l=t*2+1;s.set(r.POSITION.value.subarray(e[0]*3,e[0]*3+3),c*3),s[c*3+2]=s[c*3+2]-n,s.set(r.POSITION.value.subarray(e[1]*3,e[1]*3+3),l*3),s[l*3+2]=s[l*3+2]-n,i.set(r.TEXCOORD_0.value.subarray(e[0]*2,e[0]*2+2),c*2),i.set(r.TEXCOORD_0.value.subarray(e[1]*2,e[1]*2+2),l*2);let h=t*2*3;o[h]=e[0],o[h+1]=a/3+l,o[h+2]=e[1],o[h+3]=a/3+l,o[h+4]=e[0],o[h+5]=a/3+c}function jE(e,t={}){let{bounds:r}=t,{header:n,vertexData:s,triangleIndices:i,westIndices:o,northIndices:a,eastIndices:c,southIndices:l}=GE(e,Vo.triangleIndices),h=i,f=Oat(s,n,r),u=Fn(f);if(t?.skirtHeight){let{attributes:d,triangles:p}=T1(f,h,t.skirtHeight,{westIndices:o,northIndices:a,eastIndices:c,southIndices:l});f=d,h=p}return{loaderData:{header:{}},header:{vertexCount:h.length,boundingBox:u},schema:void 0,topology:"triangle-list",mode:4,indices:{value:h,size:1},attributes:f}}function Oat(e,t,r){let{minHeight:n,maxHeight:s}=t,[i,o,a,c]=r||[0,0,1,1],l=a-i,h=c-o,f=s-n,u=e.length/3,d=new Float32Array(u*3),p=new Float32Array(u*2);for(let g=0;g<u;g++){let m=e[g]/32767,_=e[g+u]/32767,y=e[g+u*2]/32767;d[3*g+0]=m*l+i,d[3*g+1]=_*h+o,d[3*g+2]=y*f+n,p[2*g+0]=m,p[2*g+1]=_}return{POSITION:{value:d,size:3},TEXCOORD_0:{value:p,size:2}}}var vu=class{constructor(t=257){this.gridSize=t;let r=t-1;if(r&r-1)throw new Error(`Expected grid size to be 2^n+1, got ${t}.`);this.numTriangles=r*r*2-2,this.numParentTriangles=this.numTriangles-r*r,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(this.numTriangles*4);for(let n=0;n<this.numTriangles;n++){let s=n+2,i=0,o=0,a=0,c=0,l=0,h=0;for(s&1?a=c=l=r:i=o=h=r;(s>>=1)>1;){let u=i+a>>1,d=o+c>>1;s&1?(a=i,c=o,i=l,o=h):(i=a,o=c,a=l,c=h),l=u,h=d}let f=n*4;this.coords[f+0]=i,this.coords[f+1]=o,this.coords[f+2]=a,this.coords[f+3]=c}}createTile(t){return new qE(t,this)}},qE=class{constructor(t,r){let n=r.gridSize;if(t.length!==n*n)throw new Error(`Expected terrain data of length ${n*n} (${n} x ${n}), got ${t.length}.`);this.terrain=t,this.martini=r,this.errors=new Float32Array(t.length),this.update()}update(){let{numTriangles:t,numParentTriangles:r,coords:n,gridSize:s}=this.martini,{terrain:i,errors:o}=this;for(let a=t-1;a>=0;a--){let c=a*4,l=n[c+0],h=n[c+1],f=n[c+2],u=n[c+3],d=l+f>>1,p=h+u>>1,g=d+p-h,m=p+l-d,_=(i[h*s+l]+i[u*s+f])/2,y=p*s+d,x=Math.abs(_-i[y]);if(o[y]=Math.max(o[y],x),a<r){let A=(h+m>>1)*s+(l+g>>1),M=(u+m>>1)*s+(f+g>>1);o[y]=Math.max(o[y],o[A],o[M])}}}getMesh(t=0){let{gridSize:r,indices:n}=this.martini,{errors:s}=this,i=0,o=0,a=r-1;n.fill(0);function c(d,p,g,m,_,y){let x=d+g>>1,A=p+m>>1;Math.abs(d-_)+Math.abs(p-y)>1&&s[A*r+x]>t?(c(_,y,d,p,x,A),c(g,m,_,y,x,A)):(n[p*r+d]=n[p*r+d]||++i,n[m*r+g]=n[m*r+g]||++i,n[y*r+_]=n[y*r+_]||++i,o++)}c(0,0,a,a,a,0),c(a,a,0,0,0,a);let l=new Uint16Array(i*2),h=new Uint32Array(o*3),f=0;function u(d,p,g,m,_,y){let x=d+g>>1,A=p+m>>1;if(Math.abs(d-_)+Math.abs(p-y)>1&&s[A*r+x]>t)u(_,y,d,p,x,A),u(g,m,_,y,x,A);else{let M=n[p*r+d]-1,E=n[m*r+g]-1,w=n[y*r+_]-1;l[2*M]=d,l[2*M+1]=p,l[2*E]=g,l[2*E+1]=m,l[2*w]=_,l[2*w+1]=y,h[f++]=M,h[f++]=E,h[f++]=w}}return u(0,0,a,a,a,0),u(a,a,0,0,0,a),{vertices:l,triangles:h}}};var wu=class{constructor(t,r,n=r){this.data=t,this.width=r,this.height=n,this.coords=[],this.triangles=[],this._halfedges=[],this._candidates=[],this._queueIndices=[],this._queue=[],this._errors=[],this._rms=[],this._pending=[],this._pendingLen=0,this._rmsSum=0;let s=r-1,i=n-1,o=this._addPoint(0,0),a=this._addPoint(s,0),c=this._addPoint(0,i),l=this._addPoint(s,i),h=this._addTriangle(l,o,c,-1,-1,-1);this._addTriangle(o,l,a,h,-1,-1),this._flush()}run(t=1){for(;this.getMaxError()>t;)this.refine()}refine(){this._step(),this._flush()}getMaxError(){return this._errors[0]}getRMSD(){return this._rmsSum>0?Math.sqrt(this._rmsSum/(this.width*this.height)):0}heightAt(t,r){return this.data[this.width*r+t]}_flush(){let t=this.coords;for(let r=0;r<this._pendingLen;r++){let n=this._pending[r],s=2*this.triangles[n*3+0],i=2*this.triangles[n*3+1],o=2*this.triangles[n*3+2];this._findCandidate(t[s],t[s+1],t[i],t[i+1],t[o],t[o+1],n)}this._pendingLen=0}_findCandidate(t,r,n,s,i,o,a){let c=Math.min(t,n,i),l=Math.min(r,s,o),h=Math.max(t,n,i),f=Math.max(r,s,o),u=Ho(n,s,i,o,c,l),d=Ho(i,o,t,r,c,l),p=Ho(t,r,n,s,c,l),g=s-r,m=t-n,_=o-s,y=n-i,x=r-o,A=i-t,M=Ho(t,r,n,s,i,o),E=this.heightAt(t,r)/M,w=this.heightAt(n,s)/M,v=this.heightAt(i,o)/M,b=0,T=0,I=0,N=0;for(let B=l;B<=f;B++){let C=0;u<0&&_!==0&&(C=Math.max(C,Math.floor(-u/_))),d<0&&x!==0&&(C=Math.max(C,Math.floor(-d/x))),p<0&&g!==0&&(C=Math.max(C,Math.floor(-p/g)));let V=u+_*C,rt=d+x*C,J=p+g*C,St=!1;for(let ht=c+C;ht<=h;ht++){if(V>=0&&rt>=0&&J>=0){St=!0;let vt=E*V+w*rt+v*J,Dt=Math.abs(vt-this.heightAt(ht,B));N+=Dt*Dt,Dt>b&&(b=Dt,T=ht,I=B)}else if(St)break;V+=_,rt+=x,J+=g}u+=y,d+=A,p+=m}(T===t&&I===r||T===n&&I===s||T===i&&I===o)&&(b=0),this._candidates[2*a]=T,this._candidates[2*a+1]=I,this._rms[a]=N,this._queuePush(a,b,N)}_step(){let t=this._queuePop(),r=t*3+0,n=t*3+1,s=t*3+2,i=this.triangles[r],o=this.triangles[n],a=this.triangles[s],c=this.coords[2*i],l=this.coords[2*i+1],h=this.coords[2*o],f=this.coords[2*o+1],u=this.coords[2*a],d=this.coords[2*a+1],p=this._candidates[2*t],g=this._candidates[2*t+1],m=this._addPoint(p,g);if(Ho(c,l,h,f,p,g)===0)this._handleCollinear(m,r);else if(Ho(h,f,u,d,p,g)===0)this._handleCollinear(m,n);else if(Ho(u,d,c,l,p,g)===0)this._handleCollinear(m,s);else{let _=this._halfedges[r],y=this._halfedges[n],x=this._halfedges[s],A=this._addTriangle(i,o,m,_,-1,-1,r),M=this._addTriangle(o,a,m,y,-1,A+1),E=this._addTriangle(a,i,m,x,A+2,M+1);this._legalize(A),this._legalize(M),this._legalize(E)}}_addPoint(t,r){let n=this.coords.length>>1;return this.coords.push(t,r),n}_addTriangle(t,r,n,s,i,o,a=this.triangles.length){let c=a/3;return this.triangles[a+0]=t,this.triangles[a+1]=r,this.triangles[a+2]=n,this._halfedges[a+0]=s,this._halfedges[a+1]=i,this._halfedges[a+2]=o,s>=0&&(this._halfedges[s]=a+0),i>=0&&(this._halfedges[i]=a+1),o>=0&&(this._halfedges[o]=a+2),this._candidates[2*c+0]=0,this._candidates[2*c+1]=0,this._queueIndices[c]=-1,this._rms[c]=0,this._pending[this._pendingLen++]=c,a}_legalize(t){let r=this._halfedges[t];if(r<0)return;let n=t-t%3,s=r-r%3,i=n+(t+1)%3,o=n+(t+2)%3,a=s+(r+2)%3,c=s+(r+1)%3,l=this.triangles[o],h=this.triangles[t],f=this.triangles[i],u=this.triangles[a],d=this.coords;if(!Lat(d[2*l],d[2*l+1],d[2*h],d[2*h+1],d[2*f],d[2*f+1],d[2*u],d[2*u+1]))return;let p=this._halfedges[i],g=this._halfedges[o],m=this._halfedges[a],_=this._halfedges[c];this._queueRemove(n/3),this._queueRemove(s/3);let y=this._addTriangle(l,u,f,-1,m,p,n),x=this._addTriangle(u,l,h,y,g,_,s);this._legalize(y+1),this._legalize(x+2)}_handleCollinear(t,r){let n=r-r%3,s=n+(r+1)%3,i=n+(r+2)%3,o=this.triangles[i],a=this.triangles[r],c=this.triangles[s],l=this._halfedges[s],h=this._halfedges[i],f=this._halfedges[r];if(f<0){let E=this._addTriangle(t,o,a,-1,h,-1,n),w=this._addTriangle(o,t,c,E,-1,l);this._legalize(E+1),this._legalize(w+2);return}let u=f-f%3,d=u+(f+2)%3,p=u+(f+1)%3,g=this.triangles[d],m=this._halfedges[d],_=this._halfedges[p];this._queueRemove(u/3);let y=this._addTriangle(o,a,t,h,-1,-1,n),x=this._addTriangle(a,g,t,_,-1,y+1,u),A=this._addTriangle(g,c,t,m,-1,x+1),M=this._addTriangle(c,o,t,l,y+2,A+1);this._legalize(y),this._legalize(x),this._legalize(A),this._legalize(M)}_queuePush(t,r,n){let s=this._queue.length;this._queueIndices[t]=s,this._queue.push(t),this._errors.push(r),this._rmsSum+=n,this._queueUp(s)}_queuePop(){let t=this._queue.length-1;return this._queueSwap(0,t),this._queueDown(0,t),this._queuePopBack()}_queuePopBack(){let t=this._queue.pop();return this._errors.pop(),this._rmsSum-=this._rms[t],this._queueIndices[t]=-1,t}_queueRemove(t){let r=this._queueIndices[t];if(r<0){let s=this._pending.indexOf(t);if(s!==-1)this._pending[s]=this._pending[--this._pendingLen];else throw new Error("Broken triangulation (something went wrong).");return}let n=this._queue.length-1;n!==r&&(this._queueSwap(r,n),this._queueDown(r,n)||this._queueUp(r)),this._queuePopBack()}_queueLess(t,r){return this._errors[t]>this._errors[r]}_queueSwap(t,r){let n=this._queue[t],s=this._queue[r];this._queue[t]=s,this._queue[r]=n,this._queueIndices[n]=r,this._queueIndices[s]=t;let i=this._errors[t];this._errors[t]=this._errors[r],this._errors[r]=i}_queueUp(t){let r=t;for(;;){let n=r-1>>1;if(n===r||!this._queueLess(r,n))break;this._queueSwap(n,r),r=n}}_queueDown(t,r){let n=t;for(;;){let s=2*n+1;if(s>=r||s<0)break;let i=s+1,o=s;if(i<r&&this._queueLess(i,s)&&(o=i),!this._queueLess(o,n))break;this._queueSwap(n,o),n=o}return n>t}};function Ho(e,t,r,n,s,i){return(r-s)*(t-i)-(n-i)*(e-s)}function Lat(e,t,r,n,s,i,o,a){let c=e-o,l=t-a,h=r-o,f=n-a,u=s-o,d=i-a,p=c*c+l*l,g=h*h+f*f,m=u*u+d*d;return c*(f*m-g*d)-l*(h*m-g*u)+p*(h*d-f*u)<0}function yk(e,t){let{meshMaxError:r,bounds:n,elevationDecoder:s}=t,{data:i,width:o,height:a}=e,c,l;switch(t.tesselator){case"martini":c=M1(i,o,a,s,t.tesselator),l=_k(r,o,c);break;case"delatin":c=M1(i,o,a,s,t.tesselator),l=xk(r,o,a,c);break;default:o===a&&!(a&o-1)?(c=M1(i,o,a,s,"martini"),l=_k(r,o,c)):(c=M1(i,o,a,s,"delatin"),l=xk(r,o,a,c));break}let{vertices:h}=l,{triangles:f}=l,u=Nat(h,c,o,a,n),d=Fn(u);if(t.skirtHeight){let{attributes:p,triangles:g}=T1(u,f,t.skirtHeight);u=p,f=g}return{loaderData:{header:{}},header:{vertexCount:f.length,boundingBox:d},mode:4,indices:{value:Uint32Array.from(f),size:1},attributes:u}}function _k(e,t,r){let n=t+1,i=new vu(n).createTile(r),{vertices:o,triangles:a}=i.getMesh(e);return{vertices:o,triangles:a}}function xk(e,t,r,n){let s=new wu(n,t+1,r+1);s.run(e);let{coords:i,triangles:o}=s;return{vertices:i,triangles:o}}function M1(e,t,r,n,s){let{rScaler:i,bScaler:o,gScaler:a,offset:c}=n,l=new Float32Array((t+1)*(r+1));for(let h=0,f=0;f<r;f++)for(let u=0;u<t;u++,h++){let d=h*4,p=e[d+0],g=e[d+1],m=e[d+2];l[h+f]=p*i+g*a+m*o+c}if(s==="martini"){for(let h=(t+1)*t,f=0;f<t;f++,h++)l[h]=l[h-t-1];for(let h=r,f=0;f<r+1;f++,h+=r+1)l[h]=l[h-1]}return l}function Nat(e,t,r,n,s){let i=r+1,o=e.length/2,a=new Float32Array(o*3),c=new Float32Array(o*2),[l,h,f,u]=s||[0,0,r,n],d=(f-l)/r,p=(u-h)/n;for(let g=0;g<o;g++){let m=e[g*2],_=e[g*2+1],y=_*i+m;a[3*g+0]=m*d+l,a[3*g+1]=-_*p+u,a[3*g+2]=t[y],c[2*g+0]=m/r,c[2*g+1]=_/n}return{POSITION:{value:a,size:3},TEXCOORD_0:{value:c,size:2}}}var E1="4.2.1";var b1={dataType:null,batchType:null,name:"Terrain",id:"terrain",module:"terrain",version:E1,worker:!0,extensions:["png","pngraw","jpg","jpeg","gif","webp","bmp"],mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/bmp"],options:{terrain:{tesselator:"auto",bounds:void 0,meshMaxError:10,elevationDecoder:{rScaler:1,gScaler:0,bScaler:0,offset:0},skirtHeight:void 0}}};var Ak={dataType:null,batchType:null,name:"Quantized Mesh",id:"quantized-mesh",module:"terrain",version:E1,worker:!0,extensions:["terrain"],mimeTypes:["application/vnd.quantized-mesh"],options:{"quantized-mesh":{bounds:[0,0,1,1],skirtHeight:null}}};var Bat={...b1,parse:Fat};async function Fat(e,t,r){let n={...t,mimeType:"application/x.image",image:{...t?.image,type:"data"}},s=await sr(e,[],n,r),i={...Bat.options.terrain,...t?.terrain};return yk(s,i)}var xJt={...Ak,parseSync:(e,t)=>jE(e,t?.["quantized-mesh"]),parse:async(e,t)=>jE(e,t?.["quantized-mesh"])};var Tk=[1],Dat={...bo.defaultProps,elevationData:ai,texture:{...ai,optional:!0},meshMaxError:{type:"number",value:4},bounds:{type:"array",value:null,optional:!0,compare:!0},color:{type:"color",value:[255,255,255]},elevationDecoder:{type:"object",value:{rScaler:1,gScaler:0,bScaler:0,offset:0}},workerUrl:"",wireframe:!1,material:!0,loaders:[b1]};function Mk(e){return Array.isArray(e)?e.join(";"):e||""}var Cu=class extends Ft{updateState({props:t,oldProps:r}){let n=t.elevationData!==r.elevationData;if(n){let{elevationData:i}=t,o=i&&(Array.isArray(i)||i.includes("{x}")&&i.includes("{y}"));this.setState({isTiled:o})}let s=n||t.meshMaxError!==r.meshMaxError||t.elevationDecoder!==r.elevationDecoder||t.bounds!==r.bounds;if(!this.state.isTiled&&s){let i=this.loadTerrain(t);this.setState({terrain:i})}t.workerUrl&&k.removed("workerUrl","loadOptions.terrain.workerUrl")()}loadTerrain({elevationData:t,bounds:r,elevationDecoder:n,meshMaxError:s,signal:i}){if(!t)return null;let o=this.getLoadOptions();o={...o,terrain:{skirtHeight:this.state.isTiled?s*2:0,...o?.terrain,bounds:r,meshMaxError:s,elevationDecoder:n}};let{fetch:a}=this.props;return a(t,{propName:"elevationData",layer:this,loadOptions:o,signal:i})}getTiledTerrainData(t){let{elevationData:r,fetch:n,texture:s,elevationDecoder:i,meshMaxError:o}=this.props,{viewport:a}=this.context,c=Sn(r,t),l=s&&Sn(s,t),{signal:h}=t,f=[0,0],u=[0,0];if(a.isGeospatial){let m=t.bbox;f=a.projectFlat([m.west,m.south]),u=a.projectFlat([m.east,m.north])}else{let m=t.bbox;f=[m.left,m.bottom],u=[m.right,m.top]}let d=[f[0],f[1],u[0],u[1]],p=this.loadTerrain({elevationData:c,bounds:d,elevationDecoder:i,meshMaxError:o,signal:h}),g=l?n(l,{propName:"texture",layer:this,loaders:[],signal:h}).catch(m=>null):Promise.resolve(null);return Promise.all([p,g])}renderSubLayers(t){let r=this.getSubLayerClass("mesh",So),{color:n,wireframe:s,material:i}=this.props,{data:o}=t;if(!o)return null;let[a,c]=o;return new r(t,{data:Tk,mesh:a,texture:c,_instanced:!1,coordinateSystem:W.CARTESIAN,getPosition:l=>[0,0,0],getColor:n,wireframe:s,material:i})}onViewportLoad(t){if(!t)return;let{zRange:r}=this.state,n=t.map(o=>o.content).filter(Boolean).map(o=>o[0].header.boundingBox.map(c=>c[2]));if(n.length===0)return;let s=Math.min(...n.map(o=>o[0])),i=Math.max(...n.map(o=>o[1]));(!r||s<r[0]||i>r[1])&&this.setState({zRange:[s,i]})}renderLayers(){let{color:t,material:r,elevationData:n,texture:s,wireframe:i,meshMaxError:o,elevationDecoder:a,tileSize:c,maxZoom:l,minZoom:h,extent:f,maxRequests:u,onTileLoad:d,onTileUnload:p,onTileError:g,maxCacheSize:m,maxCacheByteSize:_,refinementStrategy:y}=this.props;if(this.state.isTiled)return new bo(this.getSubLayerProps({id:"tiles"}),{getTileData:this.getTiledTerrainData.bind(this),renderSubLayers:this.renderSubLayers.bind(this),updateTriggers:{getTileData:{elevationData:Mk(n),texture:Mk(s),meshMaxError:o,elevationDecoder:a}},onViewportLoad:this.onViewportLoad.bind(this),zRange:this.state.zRange||null,tileSize:c,maxZoom:l,minZoom:h,extent:f,maxRequests:u,onTileLoad:d,onTileUnload:p,onTileError:g,maxCacheSize:m,maxCacheByteSize:_,refinementStrategy:y});if(!n)return null;let x=this.getSubLayerClass("mesh",So);return new x(this.getSubLayerProps({id:"mesh"}),{data:Tk,mesh:this.state.terrain,texture:s,_instanced:!1,getPosition:A=>[0,0,0],getColor:t,material:r,wireframe:i})}};Cu.defaultProps=Dat;Cu.layerName="TerrainLayer";var Ek=Cu;var bk=`uniform brushingUniforms {
    bool enabled;
    highp int target;
    vec2 mousePos;
    float radius;
  } brushing;
  `,kat=`
    in vec2 brushingTargets;
  
    out float brushing_isVisible;
  
    bool brushing_isPointInRange(vec2 position) {
      if (!brushing.enabled) {
        return true;
      }
      vec2 source_commonspace = project_position(position);
      vec2 target_commonspace = project_position(brushing.mousePos);
      float distance = length((target_commonspace - source_commonspace) / project.commonUnitsPerMeter.xy);
  
      return distance <= brushing.radius;
    }
  
    bool brushing_arePointsInRange(vec2 sourcePos, vec2 targetPos) {
      return brushing_isPointInRange(sourcePos) || brushing_isPointInRange(targetPos);
    }
  
    void brushing_setVisible(bool visible) {
      brushing_isVisible = float(visible);
    }
  `,Uat=`
  ${bk}
  ${kat}
  `,zat=`
    in float brushing_isVisible;
  `,Vat=`
  ${bk}
  ${zat}
  `,Hat={source:0,target:1,custom:2,source_target:3},Wat={"vs:DECKGL_FILTER_GL_POSITION":`
      vec2 brushingTarget;
      vec2 brushingSource;
      if (brushing.target == 3) {
        brushingTarget = geometry.worldPositionAlt.xy;
        brushingSource = geometry.worldPosition.xy;
      } else if (brushing.target == 0) {
        brushingTarget = geometry.worldPosition.xy;
      } else if (brushing.target == 1) {
        brushingTarget = geometry.worldPositionAlt.xy;
      } else {
        brushingTarget = brushingTargets;
      }
      bool visible;
      if (brushing.target == 3) {
        visible = brushing_arePointsInRange(brushingSource, brushingTarget);
      } else {
        visible = brushing_isPointInRange(brushingTarget);
      }
      brushing_setVisible(visible);
    `,"fs:DECKGL_FILTER_COLOR":`
      if (brushing.enabled && brushing_isVisible < 0.5) {
        discard;
      }
    `},Sk={name:"brushing",dependencies:[qt],vs:Uat,fs:Vat,inject:Wat,getUniforms:e=>{if(!e||!("viewport"in e))return{};let{brushingEnabled:t=!0,brushingRadius:r=1e4,brushingTarget:n="source",mousePosition:s,viewport:i}=e;return{enabled:Boolean(t&&s&&i.containsPixel(s)),radius:r,target:Hat[n]||0,mousePos:s?i.unproject([s.x-i.x,s.y-i.y]):[0,0]}},uniformTypes:{enabled:"i32",target:"i32",mousePos:"vec2<f32>",radius:"f32"}};var Gat={getBrushingTarget:{type:"accessor",value:[0,0]},brushingTarget:"source",brushingEnabled:!0,brushingRadius:1e4},Pu=class extends ce{getShaders(){return{modules:[Sk]}}initializeState(t,r){let n=this.getAttributeManager();n&&n.add({brushingTargets:{size:2,stepMode:"dynamic",accessor:"getBrushingTarget"}});let s=()=>{this.getCurrentLayer()?.setNeedsRedraw()};this.state.onMouseMove=s,t.deck&&t.deck.eventManager.on({pointermove:s,pointerleave:s})}finalizeState(t,r){if(t.deck){let n=this.state.onMouseMove;t.deck.eventManager.off({pointermove:n,pointerleave:n})}}draw(t,r){let{viewport:n,mousePosition:s}=t.context,{brushingEnabled:i,brushingRadius:o,brushingTarget:a}=this.props,c={viewport:n,mousePosition:s,brushingEnabled:i,brushingRadius:o,brushingTarget:a};this.setShaderModuleProps({brushing:c})}};Pu.defaultProps=Gat;Pu.extensionName="BrushingExtension";var vk=Pu;var wk=`uniform dataFilterUniforms {
    bool useSoftMargin;
    bool enabled;
    bool transformSize;
    bool transformColor;
  #ifdef DATAFILTER_TYPE
    DATAFILTER_TYPE min;
    DATAFILTER_TYPE softMin;
    DATAFILTER_TYPE softMax;
    DATAFILTER_TYPE max;
  #ifdef DATAFILTER_DOUBLE
    DATAFILTER_TYPE min64High;
    DATAFILTER_TYPE max64High;
  #endif
  #endif
  #ifdef DATACATEGORY_TYPE
    highp uvec4 categoryBitMask;
  #endif
  } dataFilter;
  `,jat=`
  #ifdef DATAFILTER_TYPE
    in DATAFILTER_TYPE filterValues;
  #ifdef DATAFILTER_DOUBLE
    in DATAFILTER_TYPE filterValues64Low;
  #endif
  #endif
  
  #ifdef DATACATEGORY_TYPE
    in DATACATEGORY_TYPE filterCategoryValues;
  #endif
  
  out float dataFilter_value;
  
  float dataFilter_reduceValue(float value) {
    return value;
  }
  float dataFilter_reduceValue(vec2 value) {
    return min(value.x, value.y);
  }
  float dataFilter_reduceValue(vec3 value) {
    return min(min(value.x, value.y), value.z);
  }
  float dataFilter_reduceValue(vec4 value) {
    return min(min(value.x, value.y), min(value.z, value.w));
  }
  
  #ifdef DATAFILTER_TYPE
    void dataFilter_setValue(DATAFILTER_TYPE valueFromMin, DATAFILTER_TYPE valueFromMax) {
      if (dataFilter.useSoftMargin) {
        // smoothstep results are undefined if edge0 \u2265 edge1
        // Fallback to ignore filterSoftRange if it is truncated by filterRange
        DATAFILTER_TYPE leftInRange = mix(
          smoothstep(dataFilter.min, dataFilter.softMin, valueFromMin),
          step(dataFilter.min, valueFromMin),
          step(dataFilter.softMin, dataFilter.min)
        );
        DATAFILTER_TYPE rightInRange = mix(
          1.0 - smoothstep(dataFilter.softMax, dataFilter.max, valueFromMax),
          step(valueFromMax, dataFilter.max),
          step(dataFilter.max, dataFilter.softMax)
        );
        dataFilter_value = dataFilter_reduceValue(leftInRange * rightInRange);
      } else {
        dataFilter_value = dataFilter_reduceValue(
          step(dataFilter.min, valueFromMin) * step(valueFromMax, dataFilter.max)
        );
      }
    }
  #endif
  
  #ifdef DATACATEGORY_TYPE
    void dataFilter_setCategoryValue(DATACATEGORY_TYPE category) {
      #if DATACATEGORY_CHANNELS == 1 // One 128-bit mask
      uint dataFilter_masks = dataFilter.categoryBitMask[category / 32u];
      #elif DATACATEGORY_CHANNELS == 2 // Two 64-bit masks
      uvec2 dataFilter_masks = uvec2(
        dataFilter.categoryBitMask[category.x / 32u],
        dataFilter.categoryBitMask[category.y / 32u + 2u]
      );
      #elif DATACATEGORY_CHANNELS == 3 // Three 32-bit masks
      uvec3 dataFilter_masks = dataFilter.categoryBitMask.xyz;
      #else // Four 32-bit masks
      uvec4 dataFilter_masks = dataFilter.categoryBitMask;
      #endif
  
      // Shift mask and extract relevant bits
      DATACATEGORY_TYPE dataFilter_bits = DATACATEGORY_TYPE(dataFilter_masks) >> (category & 31u);
      dataFilter_bits &= 1u;
  
      #if DATACATEGORY_CHANNELS == 1
      if(dataFilter_bits == 0u) dataFilter_value = 0.0;
      #else
      if(any(equal(dataFilter_bits, DATACATEGORY_TYPE(0u)))) dataFilter_value = 0.0;
      #endif
    }
  #endif
  `,Ck=`
  ${wk}
  ${jat}
  `,qat=`
  in float dataFilter_value;
  `,Pk=`
  ${wk}
  ${qat}
  `;function Rk(e){if(!e||!("extensions"in e))return{};let{filterRange:t=[-1,1],filterEnabled:r=!0,filterTransformSize:n=!0,filterTransformColor:s=!0,categoryBitMask:i}=e,o=e.filterSoftRange||t;return{...Number.isFinite(t[0])?{min:t[0],softMin:o[0],softMax:o[1],max:t[1]}:{min:t.map(a=>a[0]),softMin:o.map(a=>a[0]),softMax:o.map(a=>a[1]),max:t.map(a=>a[1])},enabled:r,useSoftMargin:Boolean(e.filterSoftRange),transformSize:r&&n,transformColor:r&&s,...i&&{categoryBitMask:i}}}function Xat(e){if(!e||!("extensions"in e))return{};let t=Rk(e);if(Number.isFinite(t.min)){let r=Math.fround(t.min);t.min-=r,t.softMin-=r,t.min64High=r;let n=Math.fround(t.max);t.max-=n,t.softMax-=n,t.max64High=n}else{let r=t.min.map(Math.fround);t.min=t.min.map((s,i)=>s-r[i]),t.softMin=t.softMin.map((s,i)=>s-r[i]),t.min64High=r;let n=t.max.map(Math.fround);t.max=t.max.map((s,i)=>s-n[i]),t.softMax=t.softMax.map((s,i)=>s-n[i]),t.max64High=n}return t}var Ik={"vs:#main-start":`
      dataFilter_value = 1.0;
      if (dataFilter.enabled) {
        #ifdef DATAFILTER_TYPE
          #ifdef DATAFILTER_DOUBLE
            dataFilter_setValue(
              filterValues - dataFilter.min64High + filterValues64Low,
              filterValues - dataFilter.max64High + filterValues64Low
            );
          #else
            dataFilter_setValue(filterValues, filterValues);
          #endif
        #endif
  
        #ifdef DATACATEGORY_TYPE
          dataFilter_setCategoryValue(filterCategoryValues);
        #endif
      }
    `,"vs:#main-end":`
      if (dataFilter_value == 0.0) {
        gl_Position = vec4(0.);
      }
    `,"vs:DECKGL_FILTER_SIZE":`
      if (dataFilter.transformSize) {
        size = size * dataFilter_value;
      }
    `,"fs:DECKGL_FILTER_COLOR":`
      if (dataFilter_value == 0.0) discard;
      if (dataFilter.transformColor) {
        color.a *= dataFilter_value;
      }
    `};function Ok(e){let{categorySize:t,filterSize:r,fp64:n}=e,s={useSoftMargin:"i32",enabled:"i32",transformSize:"i32",transformColor:"i32"};if(r){let i=r===1?"f32":`vec${r}<f32>`;s.min=i,s.softMin=i,s.softMax=i,s.max=i,n&&(s.min64High=i,s.max64High=i)}return t&&(s.categoryBitMask="vec4<i32>"),s}var Lk={name:"dataFilter",vs:Ck,fs:Pk,inject:Ik,getUniforms:Rk,uniformTypesFromOptions:Ok},Nk={name:"dataFilter",vs:Ck,fs:Pk,inject:Ik,getUniforms:Xat,uniformTypesFromOptions:Ok};var Yat=`#version 300 es
  #define SHADER_NAME data-filter-vertex-shader
  
  #ifdef FLOAT_TARGET
    in float filterIndices;
    in float filterPrevIndices;
  #else
    in vec2 filterIndices;
    in vec2 filterPrevIndices;
  #endif
  
  out vec4 vColor;
  const float component = 1.0 / 255.0;
  
  void main() {
    #ifdef FLOAT_TARGET
      dataFilter_value *= float(filterIndices != filterPrevIndices);
      gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
      vColor = vec4(0.0, 0.0, 0.0, 1.0);
    #else
      // Float texture is not supported: pack result into 4 channels x 256 px x 64px
      dataFilter_value *= float(filterIndices.x != filterPrevIndices.x);
      float col = filterIndices.x;
      float row = filterIndices.y * 4.0;
      float channel = floor(row);
      row = fract(row);
      vColor = component * vec4(bvec4(channel == 0.0, channel == 1.0, channel == 2.0, channel == 3.0));
      gl_Position = vec4(col * 2.0 - 1.0, row * 2.0 - 1.0, 0.0, 1.0);
    #endif
    gl_PointSize = 1.0;
  }
  `,$at=`#version 300 es
  #define SHADER_NAME data-filter-fragment-shader
  precision highp float;
  
  in vec4 vColor;
  
  out vec4 fragColor;
  
  void main() {
    if (dataFilter_value < 0.5) {
      discard;
    }
    fragColor = vColor;
  }
  `,Kat=["float32-renderable-webgl","texture-blend-float-webgl"];function Bk(e){return Kat.every(t=>e.features.has(t))}function Fk(e,t){return t?e.createFramebuffer({width:1,height:1,colorAttachments:[e.createTexture({format:"rgba32float",mipmaps:!1})]}):e.createFramebuffer({width:256,height:64,colorAttachments:[e.createTexture({format:"rgba8unorm",mipmaps:!1})]})}function Dk(e,t,r,n){return r.defines.NON_INSTANCED_MODEL=1,n&&(r.defines.FLOAT_TARGET=1),new Y(e,{id:"data-filter-aggregation-model",vertexCount:1,isInstanced:!1,topology:"point-list",disableWarnings:!0,vs:Yat,fs:$at,bufferLayout:t,...r})}var kk={blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:"add",blendAlphaOperation:"add",depthCompare:"never"};var Jat={getFilterValue:{type:"accessor",value:0},getFilterCategory:{type:"accessor",value:0},onFilteredItemsChange:{type:"function",value:null,optional:!0},filterEnabled:!0,filterRange:[-1,1],filterSoftRange:null,filterCategories:[0],filterTransformSize:!0,filterTransformColor:!0},Qat={categorySize:0,filterSize:1,fp64:!1,countItems:!1},tct={1:"uint",2:"uvec2",3:"uvec3",4:"uvec4"},ect={1:"float",2:"vec2",3:"vec3",4:"vec4"},Ru=class extends ce{constructor(t={}){super({...Qat,...t})}getShaders(t){let{categorySize:r,filterSize:n,fp64:s}=t.opts,i={};r&&(i.DATACATEGORY_TYPE=tct[r],i.DATACATEGORY_CHANNELS=r),n&&(i.DATAFILTER_TYPE=ect[n],i.DATAFILTER_DOUBLE=Boolean(s));let o=s?Nk:Lk;return o.uniformTypes=o.uniformTypesFromOptions(t.opts),{modules:[o],defines:i}}initializeState(t,r){let n=this.getAttributeManager(),{categorySize:s,filterSize:i,fp64:o}=r.opts;n&&(i&&n.add({filterValues:{size:i,type:o?"float64":"float32",stepMode:"dynamic",accessor:"getFilterValue"}}),s&&n.add({filterCategoryValues:{size:s,stepMode:"dynamic",accessor:"getFilterCategory",type:"uint32",transform:s===1?c=>r._getCategoryKey.call(this,c,0):c=>c.map((l,h)=>r._getCategoryKey.call(this,l,h))}}));let{device:a}=this.context;if(n&&r.opts.countItems){let c=Bk(a);n.add({filterVertexIndices:{size:c?1:2,vertexOffset:1,type:"unorm8",accessor:(f,{index:u})=>{let d=f&&f.__source?f.__source.index:u;return c?(d+1)%255:[(d+1)%255,Math.floor(d/255)%255]},shaderAttributes:{filterPrevIndices:{vertexOffset:0},filterIndices:{vertexOffset:1}}}});let l=Fk(a,c),h=Dk(a,n.getBufferLayouts({isInstanced:!1}),r.getShaders.call(this,r),c);this.setState({filterFBO:l,filterModel:h})}}updateState({props:t,oldProps:r,changeFlags:n},s){let i=this.getAttributeManager(),{categorySize:o}=s.opts;if(this.state.filterModel){let a=i.attributes.filterValues?.needsUpdate()||i.attributes.filterCategoryValues?.needsUpdate()||t.filterEnabled!==r.filterEnabled||t.filterRange!==r.filterRange||t.filterSoftRange!==r.filterSoftRange||t.filterCategories!==r.filterCategories;a&&this.setState({filterNeedsUpdate:a})}i?.attributes.filterCategoryValues&&((i.attributes.filterCategoryValues.needsUpdate()||!tt(t.filterCategories,r.filterCategories,2))&&this.setState({categoryBitMask:null}),n.dataChanged&&(this.setState({categoryMap:Array(o).fill(0).map(()=>({}))}),i.attributes.filterCategoryValues.setNeedsUpdate("categoryMap")))}draw(t,r){let n=this.state.filterFBO,s=this.state.filterModel,i=this.state.filterNeedsUpdate;this.state.categoryBitMask||r._updateCategoryBitMask.call(this,t,r);let{onFilteredItemsChange:o,extensions:a,filterEnabled:c,filterRange:l,filterSoftRange:h,filterTransformSize:f,filterTransformColor:u,filterCategories:d}=this.props,p={extensions:a,filterEnabled:c,filterRange:l,filterSoftRange:h,filterTransformSize:f,filterTransformColor:u,filterCategories:d};if(this.state.categoryBitMask&&(p.categoryBitMask=this.state.categoryBitMask),this.setShaderModuleProps({dataFilter:p}),i&&o&&s){let g=this.getAttributeManager(),{attributes:{filterValues:m,filterCategoryValues:_,filterVertexIndices:y}}=g;s.setVertexCount(this.getNumInstances());let x={...m?.getValue(),..._?.getValue(),...y?.getValue()};s.setAttributes(x),s.shaderInputs.setProps({dataFilter:p});let A=[0,0,n.width,n.height],M=s.device.beginRenderPass({id:"data-filter-aggregation",framebuffer:n,parameters:{viewport:A},clearColor:[0,0,0,0]});s.setParameters(kk),s.draw(M),M.end();let E=s.device.readPixelsToArrayWebGL(n),w=0;for(let v=0;v<E.length;v++)w+=E[v];o({id:this.id,count:w}),this.state.filterNeedsUpdate=!1}}finalizeState(){let t=this.state.filterFBO,r=this.state.filterModel;t?.destroy(),r?.destroy()}_updateCategoryBitMask(t,r){let{categorySize:n}=r.opts;if(!n)return;let{filterCategories:s}=this.props,i=new Uint32Array([0,0,0,0]),o=n===1?[s]:s,a=n===1?128:n===2?64:32;for(let c=0;c<o.length;c++){let l=o[c];for(let h of l){let f=r._getCategoryKey.call(this,h,c);if(f<a){let u=c*(a/32)+Math.floor(f/32);i[u]+=Math.pow(2,f%32)}else k.warn(`Exceeded maximum number of categories (${a})`)()}}this.state.categoryBitMask=i}_getCategoryKey(t,r){let n=this.state.categoryMap[r];return t in n||(n[t]=Object.keys(n).length),n[t]}};Ru.defaultProps=Jat;Ru.extensionName="DataFilterExtension";var Uk=Ru;var zk=`const vec2 WORLD_SCALE_FP64 = vec2(81.4873275756836, 0.0000032873668232014097);
  uniform project64Uniforms {
  vec2 scale;
  mat4 viewProjectionMatrix;
  mat4 viewProjectionMatrix64Low;
  } project64;
  void mercatorProject_fp64(vec4 lnglat_fp64, out vec2 out_val[2]) {
  #if defined(NVIDIA_FP64_WORKAROUND)
  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64 * ONE);
  #else
  out_val[0] = sum_fp64(radians_fp64(lnglat_fp64.xy), PI_FP64);
  #endif
  out_val[1] = sum_fp64(PI_FP64,
  log_fp64(tan_fp64(sum_fp64(PI_4_FP64, radians_fp64(lnglat_fp64.zw) / 2.0))));
  return;
  }
  void project_position_fp64(vec4 position_fp64, out vec2 out_val[2]) {
  vec2 pos_fp64[2];
  mercatorProject_fp64(position_fp64, pos_fp64);
  out_val[0] = mul_fp64(pos_fp64[0], WORLD_SCALE_FP64);
  out_val[1] = mul_fp64(pos_fp64[1], WORLD_SCALE_FP64);
  return;
  }
  void project_position_fp64(vec2 position, vec2 position64xyLow, out vec2 out_val[2]) {
  vec4 position64xy = vec4(
  position.x, position64xyLow.x,
  position.y, position64xyLow.y);
  project_position_fp64(position64xy, out_val);
  }
  vec4 project_common_position_to_clipspace_fp64(vec2 vertex_pos_modelspace[4]) {
  vec2 vertex_pos_clipspace[4];
  vec2 viewProjectionMatrixFP64[16];
  for (int i = 0; i < 4; i++) {
  for (int j = 0; j < 4; j++) {
  viewProjectionMatrixFP64[4 * i + j] = vec2(
  project64.viewProjectionMatrix[j][i],
  project64.viewProjectionMatrix64Low[j][i]
  );
  }
  }
  mat4_vec4_mul_fp64(viewProjectionMatrixFP64, vertex_pos_modelspace,
  vertex_pos_clipspace);
  return vec4(
  vertex_pos_clipspace[0].x,
  vertex_pos_clipspace[1].x,
  vertex_pos_clipspace[2].x,
  vertex_pos_clipspace[3].x
  );
  }
  vec4 project_position_to_clipspace(
  vec3 position, vec3 position64xyLow, vec3 offset, out vec4 commonPosition
  ) {
  vec2 offset64[4];
  vec4_fp64(vec4(offset, 0.0), offset64);
  float z = project_size(position.z);
  vec2 projectedPosition64xy[2];
  project_position_fp64(position.xy, position64xyLow.xy, projectedPosition64xy);
  vec2 commonPosition64[4];
  commonPosition64[0] = sum_fp64(offset64[0], projectedPosition64xy[0]);
  commonPosition64[1] = sum_fp64(offset64[1], projectedPosition64xy[1]);
  commonPosition64[2] = sum_fp64(offset64[2], vec2(z, 0.0));
  commonPosition64[3] = vec2(1.0, 0.0);
  commonPosition = vec4(projectedPosition64xy[0].x, projectedPosition64xy[1].x, z, 1.0);
  return project_common_position_to_clipspace_fp64(commonPosition64);
  }
  vec4 project_position_to_clipspace(
  vec3 position, vec3 position64xyLow, vec3 offset
  ) {
  vec4 commonPosition;
  return project_position_to_clipspace(
  position, position64xyLow, offset, commonPosition
  );
  }
  `;var{fp64ify:rct,fp64ifyMatrix4:nct}=bp,S1={name:"project64",dependencies:[qt,bp],vs:zk,getUniforms:ict,uniformTypes:{scale:"vec2<f32>",viewProjectionMatrix:"mat4x4<f32>",viewProjectionMatrix64Low:"mat4x4<f32>"}},sct=Je(oct);function ict(e){if(e&&"viewport"in e){let{viewProjectionMatrix:t,scale:r}=e.viewport;return sct({viewProjectionMatrix:t,scale:r})}return{}}function oct({viewProjectionMatrix:e,scale:t}){let r=nct(e),n=new Float32Array(16),s=new Float32Array(16);for(let i=0;i<4;i++)for(let o=0;o<4;o++){let a=4*i+o,c=4*o+i;n[c]=r[2*a],s[c]=r[2*a+1]}return{scale:rct(t),viewProjectionMatrix:[...n],viewProjectionMatrix64Low:[...s]}}var v1=class extends ce{getShaders(){let{coordinateSystem:t}=this.props;if(t!==W.LNGLAT&&t!==W.DEFAULT)throw new Error("fp64: coordinateSystem must be LNGLAT");return{modules:[S1]}}draw(t,r){let{viewport:n}=t.context;this.setShaderModuleProps({project64:{viewport:n}})}};v1.extensionName="Fp64Extension";var Vk=v1;var Hk={inject:{"vs:#decl":`
  in vec2 instanceDashArrays;
  in float instanceDashOffsets;
  out vec2 vDashArray;
  out float vDashOffset;
  `,"vs:#main-end":`
  vDashArray = instanceDashArrays;
  vDashOffset = instanceDashOffsets / width.x;
  `,"fs:#decl":`
  uniform pathStyleUniforms {
  float dashAlignMode;
  bool dashGapPickable;
  } pathStyle;
  in vec2 vDashArray;
  in float vDashOffset;
  `,"fs:#main-start":`
  float solidLength = vDashArray.x;
  float gapLength = vDashArray.y;
  float unitLength = solidLength + gapLength;
  float offset;
  if (unitLength > 0.0) {
  if (pathStyle.dashAlignMode == 0.0) {
  offset = vDashOffset;
  } else {
  unitLength = vPathLength / round(vPathLength / unitLength);
  offset = solidLength / 2.0;
  }
  float unitOffset = mod(vPathPosition.y + offset, unitLength);
  if (gapLength > 0.0 && unitOffset > solidLength) {
  if (path.capType <= 0.5) {
  if (!(pathStyle.dashGapPickable && bool(picking.isActive))) {
  discard;
  }
  } else {
  float distToEnd = length(vec2(
  min(unitOffset - solidLength, unitLength - unitOffset),
  vPathPosition.x
  ));
  if (distToEnd > 1.0) {
  if (!(pathStyle.dashGapPickable && bool(picking.isActive))) {
  discard;
  }
  }
  }
  }
  }
  `}},Wk={inject:{"vs:#decl":`
  in float instanceOffsets;
  `,"vs:DECKGL_FILTER_SIZE":`
  float offsetWidth = abs(instanceOffsets * 2.0) + 1.0;
  size *= offsetWidth;
  `,"vs:#main-end":`
  float offsetWidth = abs(instanceOffsets * 2.0) + 1.0;
  float offsetDir = sign(instanceOffsets);
  vPathPosition.x = (vPathPosition.x + offsetDir) * offsetWidth - offsetDir;
  vPathPosition.y *= offsetWidth;
  vPathLength *= offsetWidth;
  `,"fs:#main-start":`
  float isInside;
  isInside = step(-1.0, vPathPosition.x) * step(vPathPosition.x, 1.0);
  if (isInside == 0.0) {
  discard;
  }
  `}};var act={getDashArray:{type:"accessor",value:[0,0]},getOffset:{type:"accessor",value:0},dashJustified:!1,dashGapPickable:!1},Iu=class extends ce{constructor({dash:t=!1,offset:r=!1,highPrecisionDash:n=!1}={}){super({dash:t||n,offset:r,highPrecisionDash:n})}isEnabled(t){return"pathTesselator"in t.state}getShaders(t){if(!t.isEnabled(this))return null;let r={};t.opts.dash&&(r=Ks(r,Hk)),t.opts.offset&&(r=Ks(r,Wk));let{inject:n}=r;return{modules:[{name:"pathStyle",inject:n,uniformTypes:{dashAlignMode:"f32",dashGapPickable:"i32"}}]}}initializeState(t,r){let n=this.getAttributeManager();!n||!r.isEnabled(this)||(r.opts.dash&&n.addInstanced({instanceDashArrays:{size:2,accessor:"getDashArray"},instanceDashOffsets:r.opts.highPrecisionDash?{size:1,accessor:"getPath",transform:r.getDashOffsets.bind(this)}:{size:1,update:s=>{s.constant=!0,s.value=[0]}}}),r.opts.offset&&n.addInstanced({instanceOffsets:{size:1,accessor:"getOffset"}}))}updateState(t,r){if(r.isEnabled(this)&&r.opts.dash){let n={dashAlignMode:this.props.dashJustified?1:0,dashGapPickable:Boolean(this.props.dashGapPickable)};this.setShaderModuleProps({pathStyle:n})}}getDashOffsets(t){let r=[0],n=this.props.positionFormat==="XY"?2:3,s=Array.isArray(t[0]),i=s?t.length:t.length/n,o,a;for(let c=0;c<i-1;c++)o=s?t[c]:t.slice(c*n,c*n+n),o=this.projectPosition(o),c>0&&(r[c]=r[c-1]+pe.dist(a,o)),a=o;return r[i-1]=0,r}};Iu.defaultProps=act;Iu.extensionName="PathStyleExtension";var Gk=Iu;var jk=`uniform fillUniforms {
    vec2 patternTextureSize;
    bool patternEnabled;
    bool patternMask;
    vec2 uvCoordinateOrigin;
    vec2 uvCoordinateOrigin64Low;
  } fill;
  `,cct=`
  in vec4 fillPatternFrames;
  in float fillPatternScales;
  in vec2 fillPatternOffsets;
  
  out vec2 fill_uv;
  out vec4 fill_patternBounds;
  out vec4 fill_patternPlacement;
  `,lct=`
  ${jk}
  ${cct}
  `,hct=`
  uniform sampler2D fill_patternTexture;
  
  in vec4 fill_patternBounds;
  in vec4 fill_patternPlacement;
  in vec2 fill_uv;
  
  const float FILL_UV_SCALE = 512.0 / 40000000.0;
  `,fct=`
  ${jk}
  ${hct}
  `,uct={"vs:DECKGL_FILTER_GL_POSITION":`
      fill_uv = geometry.position.xy;
    `,"vs:DECKGL_FILTER_COLOR":`
      if (fill.patternEnabled) {
        fill_patternBounds = fillPatternFrames / vec4(fill.patternTextureSize, fill.patternTextureSize);
        fill_patternPlacement.xy = fillPatternOffsets;
        fill_patternPlacement.zw = fillPatternScales * fillPatternFrames.zw;
      }
    `,"fs:DECKGL_FILTER_COLOR":`
      if (fill.patternEnabled) {
        vec2 scale = FILL_UV_SCALE * fill_patternPlacement.zw;
        vec2 patternUV = mod(mod(fill.uvCoordinateOrigin, scale) + fill.uvCoordinateOrigin64Low + fill_uv, scale) / scale;
        patternUV = mod(fill_patternPlacement.xy + patternUV, 1.0);
  
        vec2 texCoords = fill_patternBounds.xy + fill_patternBounds.zw * patternUV;
  
        vec4 patternColor = texture(fill_patternTexture, texCoords);
        color.a *= patternColor.a;
        if (!fill.patternMask) {
          color.rgb = patternColor.rgb;
        }
      }
    `};function dct(e){if(!e)return{};let t={};if("fillPatternTexture"in e){let{fillPatternTexture:r}=e;t.fill_patternTexture=r,t.patternTextureSize=[r.width,r.height]}if("project"in e){let{fillPatternMask:r=!0,fillPatternEnabled:n=!0}=e,s=qt.getUniforms(e.project),{commonOrigin:i}=s,o=[Oa(i[0]),Oa(i[1])];t.uvCoordinateOrigin=i.slice(0,2),t.uvCoordinateOrigin64Low=o,t.patternMask=r,t.patternEnabled=n}return t}var qk={name:"fill",vs:lct,fs:fct,inject:uct,dependencies:[qt],getUniforms:dct,uniformTypes:{patternTextureSize:"vec2<f32>",patternEnabled:"i32",patternMask:"i32",uvCoordinateOrigin:"vec2<f32>",uvCoordinateOrigin64Low:"vec2<f32>"}};var pct={fillPatternEnabled:!0,fillPatternAtlas:{type:"image",value:null,async:!0,parameters:{lodMaxClamp:0}},fillPatternMapping:{type:"object",value:{},async:!0},fillPatternMask:!0,getFillPattern:{type:"accessor",value:e=>e.pattern},getFillPatternScale:{type:"accessor",value:1},getFillPatternOffset:{type:"accessor",value:[0,0]}},Ou=class extends ce{constructor({pattern:t=!1}={}){super({pattern:t})}isEnabled(t){return t.getAttributeManager()!==null&&!("pathTesselator"in t.state)}getShaders(t){return t.isEnabled(this)?{modules:[t.opts.pattern&&qk].filter(Boolean)}:null}initializeState(t,r){if(!r.isEnabled(this))return;let n=this.getAttributeManager();r.opts.pattern&&n.add({fillPatternFrames:{size:4,stepMode:"dynamic",accessor:"getFillPattern",transform:r.getPatternFrame.bind(this)},fillPatternScales:{size:1,stepMode:"dynamic",accessor:"getFillPatternScale",defaultValue:1},fillPatternOffsets:{size:2,stepMode:"dynamic",accessor:"getFillPatternOffset"}}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState({props:t,oldProps:r},n){n.isEnabled(this)&&t.fillPatternMapping&&t.fillPatternMapping!==r.fillPatternMapping&&this.getAttributeManager().invalidate("getFillPattern")}draw(t,r){if(!r.isEnabled(this))return;let{fillPatternAtlas:n,fillPatternEnabled:s,fillPatternMask:i}=this.props,o={project:t.shaderModuleProps.project,fillPatternEnabled:s,fillPatternMask:i,fillPatternTexture:n||this.state.emptyTexture};this.setShaderModuleProps({fill:o})}finalizeState(){this.state.emptyTexture?.delete()}getPatternFrame(t){let{fillPatternMapping:r}=this.getCurrentLayer().props,n=r&&r[t];return n?[n.x,n.y,n.width,n.height]:[0,0,0,0]}};Ou.defaultProps=pct;Ou.extensionName="FillStyleExtension";var Xk=Ou;var gct={clipBounds:[0,0,1,1],clipByInstance:void 0},Yk=`
  uniform clipUniforms {
    vec4 bounds;
  } clip;
  
  bool clip_isInBounds(vec2 position) {
    return position.x >= clip.bounds[0] && position.y >= clip.bounds[1] && position.x < clip.bounds[2] && position.y < clip.bounds[3];
  }
  `,mct={name:"clip",vs:Yk,uniformTypes:{bounds:"vec4<f32>"}},_ct={"vs:#decl":`
  out float clip_isVisible;
  `,"vs:DECKGL_FILTER_GL_POSITION":`
    clip_isVisible = float(clip_isInBounds(geometry.worldPosition.xy));
  `,"fs:#decl":`
  in float clip_isVisible;
  `,"fs:DECKGL_FILTER_COLOR":`
    if (clip_isVisible < 0.5) discard;
  `},xct={name:"clip",fs:Yk,uniformTypes:{bounds:"vec4<f32>"}},yct={"vs:#decl":`
  out vec2 clip_commonPosition;
  `,"vs:DECKGL_FILTER_GL_POSITION":`
    clip_commonPosition = geometry.position.xy;
  `,"fs:#decl":`
  in vec2 clip_commonPosition;
  `,"fs:DECKGL_FILTER_COLOR":`
    if (!clip_isInBounds(clip_commonPosition)) discard;
  `},Lu=class extends ce{getShaders(){let t="instancePositions"in this.getAttributeManager().attributes;return this.props.clipByInstance!==void 0&&(t=Boolean(this.props.clipByInstance)),this.state.clipByInstance=t,t?{modules:[mct],inject:_ct}:{modules:[xct],inject:yct}}draw(){let{clipBounds:t}=this.props,r={};if(this.state.clipByInstance)r.bounds=t;else{let n=this.projectPosition([t[0],t[1],0]),s=this.projectPosition([t[2],t[3],0]);r.bounds=[Math.min(n[0],s[0]),Math.min(n[1],s[1]),Math.max(n[0],s[0]),Math.max(n[1],s[1])]}this.setShaderModuleProps({clip:r})}};Lu.defaultProps=gct;Lu.extensionName="ClipExtension";var w1=Lu;var Act=`
  in float collisionPriorities;
  
  uniform sampler2D collision_texture;
  
  uniform collisionUniforms {
    bool sort;
    bool enabled;
  } collision;
  
  vec2 collision_getCoords(vec4 position) {
    vec4 collision_clipspace = project_common_position_to_clipspace(position);
    return (1.0 + collision_clipspace.xy / collision_clipspace.w) / 2.0;
  }
  
  float collision_match(vec2 tex, vec3 pickingColor) {
    vec4 collision_pickingColor = texture(collision_texture, tex);
    float delta = dot(abs(collision_pickingColor.rgb - pickingColor), vec3(1.0));
    float e = 0.001;
    return step(delta, e);
  }
  
  float collision_isVisible(vec2 texCoords, vec3 pickingColor) {
    if (!collision.enabled) {
      return 1.0;
    }
  
    // Visibility test, sample area of 5x5 pixels in order to fade in/out.
    // Due to the locality, the lookups will be cached
    // This reduces the flicker present when objects are shown/hidden
    const int N = 2;
    float accumulator = 0.0;
    vec2 step = vec2(1.0 / project.viewportSize);
  
    const float floatN = float(N);
    vec2 delta = -floatN * step;
    for(int i = -N; i <= N; i++) {
      delta.x = -step.x * floatN;
      for(int j = -N; j <= N; j++) {
        accumulator += collision_match(texCoords + delta, pickingColor);
        delta.x += step.x;
      }
      delta.y += step.y;
    }
  
    float W = 2.0 * floatN + 1.0;
    return pow(accumulator / (W * W), 2.2);
  }
  `,Tct={"vs:#decl":`
    float collision_fade = 1.0;
  `,"vs:DECKGL_FILTER_GL_POSITION":`
    if (collision.sort) {
      float collisionPriority = collisionPriorities;
      position.z = -0.001 * collisionPriority * position.w; // Support range -1000 -> 1000
    }
  
    if (collision.enabled) {
      vec4 collision_common_position = project_position(vec4(geometry.worldPosition, 1.0));
      vec2 collision_texCoords = collision_getCoords(collision_common_position);
      collision_fade = collision_isVisible(collision_texCoords, geometry.pickingColor / 255.0);
      if (collision_fade < 0.0001) {
        // Position outside clip space bounds to discard
        position = vec4(0.0, 0.0, 2.0, 1.0);
      }
    }
    `,"vs:DECKGL_FILTER_COLOR":`
    color.a *= collision_fade;
    `},Mct=e=>{if(!e||!("dummyCollisionMap"in e))return{};let{enabled:t,collisionFBO:r,drawToCollisionMap:n,dummyCollisionMap:s}=e;return{enabled:t&&!n,sort:Boolean(n),collision_texture:!n&&r?r.colorAttachments[0]:s}},$k={name:"collision",dependencies:[qt],vs:Act,inject:Tct,getUniforms:Mct,uniformTypes:{sort:"i32",enabled:"i32"}};var Nu=class extends Me{renderCollisionMap(t,r){let s=[0,0,0,0],i=[1,1,t.width-2*1,t.height-2*1];this.render({...r,clearColor:s,scissorRect:i,target:t,pass:"collision"})}getLayerParameters(t,r,n){return{...t.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}getShaderModuleProps(){return{collision:{drawToCollisionMap:!0},picking:{isActive:1,isAttribute:!1},lighting:{enabled:!1}}}};var XE=2,Bu=class{constructor(){this.id="collision-filter-effect",this.props=null,this.useInPicking=!0,this.order=1,this.channels={},this.collisionFBOs={}}setup(t){this.context=t;let{device:r}=t;this.dummyCollisionMap=r.createTexture({width:1,height:1}),this.collisionFilterPass=new Nu(r,{id:"default-collision-filter"})}preRender({effects:t,layers:r,layerFilter:n,viewports:s,onViewportActive:i,views:o,isPicking:a,preRenderStats:c={}}){let{device:l}=this.context;if(a)return;let h=r.filter(({props:{visible:m,collisionEnabled:_}})=>m&&_);if(h.length===0){this.channels={};return}let f=t?.filter(m=>m.useInPicking&&c[m.id]),u=c["mask-effect"]?.didRender,d=this._groupByCollisionGroup(l,h),p=s[0],g=!this.lastViewport||!this.lastViewport.equals(p)||u;for(let m in d){let _=this.collisionFBOs[m],y=d[m],[x,A]=l.canvasContext.getPixelSize();_.resize({width:x/XE,height:A/XE}),this._render(y,{effects:f,layerFilter:n,onViewportActive:i,views:o,viewport:p,viewportChanged:g})}}_render(t,{effects:r,layerFilter:n,onViewportActive:s,views:i,viewport:o,viewportChanged:a}){let{collisionGroup:c}=t,l=this.channels[c];if(!l)return;let h=a||t===l||!tt(l.layers,t.layers,1)||t.layerBounds.some((f,u)=>!kt(f,l.layerBounds[u]))||t.allLayersLoaded!==l.allLayersLoaded||t.layers.some(f=>f.props.transitions);if(this.channels[c]=t,h){this.lastViewport=o;let f=this.collisionFBOs[c];this.collisionFilterPass.renderCollisionMap(f,{pass:"collision-filter",isPicking:!0,layers:t.layers,effects:r,layerFilter:n,viewports:o?[o]:[],onViewportActive:s,views:i,shaderModuleProps:{collision:{enabled:!0,dummyCollisionMap:this.dummyCollisionMap},project:{devicePixelRatio:f.device.canvasContext.getDevicePixelRatio()/XE}}})}}_groupByCollisionGroup(t,r){let n={};for(let s of r){let i=s.props.collisionGroup,o=n[i];o||(o={collisionGroup:i,layers:[],layerBounds:[],allLayersLoaded:!0},n[i]=o),o.layers.push(s),o.layerBounds.push(s.getBounds()),s.isLoaded||(o.allLayersLoaded=!1)}for(let s of Object.keys(n))this.collisionFBOs[s]||this.createFBO(t,s),this.channels[s]||(this.channels[s]=n[s]);for(let s of Object.keys(this.collisionFBOs))n[s]||this.destroyFBO(s);return n}getShaderModuleProps(t){let{collisionGroup:r,collisionEnabled:n}=t.props,{collisionFBOs:s,dummyCollisionMap:i}=this,o=s[r];return{collision:{enabled:n&&Boolean(o),collisionFBO:o,dummyCollisionMap:i}}}cleanup(){this.dummyCollisionMap&&(this.dummyCollisionMap.delete(),this.dummyCollisionMap=void 0),this.channels={};for(let t of Object.keys(this.collisionFBOs))this.destroyFBO(t);this.collisionFBOs={},this.lastViewport=void 0}createFBO(t,r){let{width:n,height:s}=t.gl.canvas,i=t.createTexture({format:"rgba8unorm",width:n,height:s,sampler:{minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),o=t.createTexture({format:"depth16unorm",width:n,height:s,mipmaps:!1});this.collisionFBOs[r]=t.createFramebuffer({id:`collision-${r}`,width:n,height:s,colorAttachments:[i],depthStencilAttachment:o})}destroyFBO(t){let r=this.collisionFBOs[t];r.colorAttachments[0]?.destroy(),r.depthStencilAttachment?.destroy(),r.destroy(),delete this.collisionFBOs[t]}};var Ect={getCollisionPriority:{type:"accessor",value:0},collisionEnabled:!0,collisionGroup:{type:"string",value:"default"},collisionTestProps:{}},Fu=class extends ce{getShaders(){return{modules:[$k]}}draw({shaderModuleProps:t}){t.collision?.drawToCollisionMap&&(this.props=this.clone(this.props.collisionTestProps).props)}initializeState(t,r){if(this.getAttributeManager()===null)return;this.context.deck?._addDefaultEffect(new Bu),this.getAttributeManager().add({collisionPriorities:{size:1,stepMode:"dynamic",accessor:"getCollisionPriority"}})}getNeedsPickingBuffer(){return this.props.collisionEnabled}};Fu.defaultProps=Ect;Fu.extensionName="CollisionFilterExtension";var Kk=Fu;var Zk=`uniform maskUniforms {
    vec4 bounds;
    highp int channel;
    bool enabled;
    bool inverted;
    bool maskByInstance;
  } mask;
  `,bct=`
  vec2 mask_getCoords(vec4 position) {
    return (position.xy - mask.bounds.xy) / (mask.bounds.zw - mask.bounds.xy);
  }
  `,Sct=`
  ${Zk}
  ${bct}
  `,vct=`
  uniform sampler2D mask_texture;
  
  bool mask_isInBounds(vec2 texCoords) {
    if (!mask.enabled) {
      return true;
    }
    vec4 maskColor = texture(mask_texture, texCoords);
    float maskValue = 1.0;
    if (mask.channel == 0) {
      maskValue = maskColor.r;
    } else if (mask.channel == 1) {
      maskValue = maskColor.g;
    } else if (mask.channel == 2) {
      maskValue = maskColor.b;
    } else if (mask.channel == 3) {
      maskValue = maskColor.a;
    }
  
    if (mask.inverted) {
      return maskValue >= 0.5;
    } else {
      return maskValue < 0.5;
    }
  }
  `,wct=`
  ${Zk}
  ${vct}
  `,Cct={"vs:#decl":`
  out vec2 mask_texCoords;
  `,"vs:#main-end":`
     vec4 mask_common_position;
     if (mask.maskByInstance) {
       mask_common_position = project_position(vec4(geometry.worldPosition, 1.0));
     } else {
       mask_common_position = geometry.position;
     }
     mask_texCoords = mask_getCoords(mask_common_position);
  `,"fs:#decl":`
  in vec2 mask_texCoords;
  `,"fs:#main-start":`
    if (mask.enabled) {
      bool mask = mask_isInBounds(mask_texCoords);
  
      // Debug: show extent of render target
      // fragColor = vec4(mask_texCoords, 0.0, 1.0);
      // fragColor = texture(mask_texture, mask_texCoords);
  
      if (!mask) discard;
    }
  `},Pct=e=>e&&"maskMap"in e?{mask_texture:e.maskMap}:e||{},Jk={name:"mask",dependencies:[qt],vs:Sct,fs:wct,inject:Cct,getUniforms:Pct,uniformTypes:{bounds:"vec4<f32>",channel:"i32",enabled:"i32",inverted:"i32",maskByInstance:"i32"}};var Rct={blendColorOperation:"subtract",blendColorSrcFactor:"zero",blendColorDstFactor:"one",blendAlphaOperation:"subtract",blendAlphaSrcFactor:"zero",blendAlphaDstFactor:"one"},Du=class extends Me{constructor(t,r){super(t,r);let{mapSize:n=2048}=r;this.maskMap=t.createTexture({format:"rgba8unorm",width:n,height:n,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.fbo=t.createFramebuffer({id:"maskmap",width:n,height:n,colorAttachments:[this.maskMap]})}render(t){let r=2**t.channel,n=[255,255,255,255];super.render({...t,clearColor:n,colorMask:r,target:this.fbo,pass:"mask"})}getLayerParameters(t,r,n){return{...t.props.parameters,blend:!0,depthCompare:"always",...Rct}}shouldDrawLayer(t){return t.props.operation.includes("mask")}delete(){this.fbo.delete(),this.maskMap.delete()}};function Wc(e,t){let r=[1/0,1/0,-1/0,-1/0];for(let n of e){let s=n.getBounds();if(s){let i=n.projectPosition(s[0],{viewport:t,autoOffset:!1}),o=n.projectPosition(s[1],{viewport:t,autoOffset:!1});r[0]=Math.min(r[0],i[0]),r[1]=Math.min(r[1],i[1]),r[2]=Math.max(r[2],o[0]),r[3]=Math.max(r[3],o[1])}}return Number.isFinite(r[0])?r:null}var Ict=2048;function Gc(e){let{bounds:t,viewport:r,border:n=0}=e,{isGeospatial:s}=r;if(t[2]<=t[0]||t[3]<=t[1])return null;let i=r.unprojectPosition([(t[0]+t[2])/2,(t[1]+t[3])/2,0]),{width:o,height:a,zoom:c}=e;if(c===void 0){o=o-n*2,a=a-n*2;let l=Math.min(o/(t[2]-t[0]),a/(t[3]-t[1]));c=Math.min(Math.log2(l),20)}else if(!o||!a){let l=2**c;o=Math.round(Math.abs(t[2]-t[0])*l),a=Math.round(Math.abs(t[3]-t[1])*l);let h=Ict-n*2;if(o>h||a>h){let f=h/Math.max(o,a);o=Math.round(o*f),a=Math.round(a*f),c+=Math.log2(f)}}return s?new Re({id:r.id,x:n,y:n,width:o,height:a,longitude:i[0],latitude:i[1],zoom:c,orthographic:!0}):new es({id:r.id,x:n,y:n,width:o,height:a,target:i,zoom:c,flipY:!1})}function Oct(e,t){let r;if(t&&t.length===2){let[i,o]=t,a=e.getBounds({z:i}),c=e.getBounds({z:o});r=[Math.min(a[0],c[0]),Math.min(a[1],c[1]),Math.max(a[2],c[2]),Math.max(a[3],c[3])]}else r=e.getBounds();let n=e.projectPosition(r.slice(0,2)),s=e.projectPosition(r.slice(2,4));return[n[0],n[1],s[0],s[1]]}function jc(e,t,r){if(!e)return[0,0,1,1];let n=Oct(t,r),s=Lct(n);return e[2]-e[0]<=s[2]-s[0]&&e[3]-e[1]<=s[3]-s[1]?e:[Math.max(e[0],s[0]),Math.max(e[1],s[1]),Math.min(e[2],s[2]),Math.min(e[3],s[3])]}function Lct(e){let t=e[2]-e[0],r=e[3]-e[1],n=(e[0]+e[2])/2,s=(e[1]+e[3])/2;return[n-t,s-r,n+t,s+r]}var ku=class{constructor(){this.id="mask-effect",this.props=null,this.useInPicking=!0,this.order=0,this.channels=[],this.masks=null}setup({device:t}){this.dummyMaskMap=t.createTexture({width:1,height:1}),this.maskPass=new Du(t,{id:"default-mask"}),this.maskMap=this.maskPass.maskMap}preRender({layers:t,layerFilter:r,viewports:n,onViewportActive:s,views:i,isPicking:o}){let a=!1;if(o)return{didRender:a};let c=t.filter(u=>u.props.visible&&u.props.operation.includes("mask"));if(c.length===0)return this.masks=null,this.channels.length=0,{didRender:a};this.masks={};let l=this._sortMaskChannels(c),h=n[0],f=!this.lastViewport||!this.lastViewport.equals(h);if(h.resolution!==void 0)return k.warn("MaskExtension is not supported in GlobeView")(),{didRender:a};for(let u in l){let d=this._renderChannel(l[u],{layerFilter:r,onViewportActive:s,views:i,viewport:h,viewportChanged:f});a||(a=d)}return{didRender:a}}_renderChannel(t,{layerFilter:r,onViewportActive:n,views:s,viewport:i,viewportChanged:o}){let a=!1,c=this.channels[t.index];if(!c)return a;let l=t===c||t.layers.length!==c.layers.length||t.layers.some((h,f)=>h!==c.layers[f]||h.props.transitions)||t.layerBounds.some((h,f)=>h!==c.layerBounds[f]);if(t.bounds=c.bounds,t.maskBounds=c.maskBounds,this.channels[t.index]=t,l||o){this.lastViewport=i;let h=Wc(t.layers,i);if(t.bounds=h&&jc(h,i),l||!kt(t.bounds,c.bounds)){let{maskPass:f,maskMap:u}=this,d=h&&Gc({bounds:t.bounds,viewport:i,width:u.width,height:u.height,border:1});t.maskBounds=d?d.getBounds():[0,0,1,1],f.render({pass:"mask",channel:t.index,layers:t.layers,layerFilter:r,viewports:d?[d]:[],onViewportActive:n,views:s,shaderModuleProps:{project:{devicePixelRatio:1}}}),a=!0}}return this.masks[t.id]={index:t.index,bounds:t.maskBounds,coordinateOrigin:t.coordinateOrigin,coordinateSystem:t.coordinateSystem},a}_sortMaskChannels(t){let r={},n=0;for(let s of t){let{id:i}=s.root,o=r[i];if(!o){if(++n>4){k.warn("Too many mask layers. The max supported is 4")();continue}o={id:i,index:this.channels.findIndex(a=>a?.id===i),layers:[],layerBounds:[],coordinateOrigin:s.root.props.coordinateOrigin,coordinateSystem:s.root.props.coordinateSystem},r[i]=o}o.layers.push(s),o.layerBounds.push(s.getBounds())}for(let s=0;s<4;s++){let i=this.channels[s];(!i||!(i.id in r))&&(this.channels[s]=null)}for(let s in r){let i=r[s];i.index<0&&(i.index=this.channels.findIndex(o=>!o),this.channels[i.index]=i)}return r}getShaderModuleProps(){return{mask:{maskMap:this.masks?this.maskMap:this.dummyMaskMap,maskChannels:this.masks}}}cleanup(){this.dummyMaskMap&&(this.dummyMaskMap.delete(),this.dummyMaskMap=void 0),this.maskPass&&(this.maskPass.delete(),this.maskPass=void 0,this.maskMap=void 0),this.lastViewport=void 0,this.masks=null,this.channels.length=0}};var Nct={maskId:"",maskByInstance:void 0,maskInverted:!1},Uu=class extends ce{initializeState(){this.context.deck?._addDefaultEffect(new ku)}getShaders(){let t="instancePositions"in this.getAttributeManager().attributes;return this.props.maskByInstance!==void 0&&(t=Boolean(this.props.maskByInstance)),this.state.maskByInstance=t,{modules:[Jk]}}draw({context:t,shaderModuleProps:r}){let n={};n.maskByInstance=Boolean(this.state.maskByInstance);let{maskId:s,maskInverted:i}=this.props,{maskChannels:o}=r.mask||{},{viewport:a}=t;if(o&&o[s]){let{index:c,bounds:l,coordinateOrigin:h}=o[s],{coordinateSystem:f}=o[s];n.enabled=!0,n.channel=c,n.inverted=i,f===W.DEFAULT&&(f=a.isGeospatial?W.LNGLAT:W.CARTESIAN);let u={modelMatrix:null,fromCoordinateOrigin:h,fromCoordinateSystem:f},d=this.projectPosition([l[0],l[1],0],u),p=this.projectPosition([l[2],l[3],0],u);n.bounds=[d[0],d[1],p[0],p[1]]}else s&&k.warn(`Could not find a mask layer with id: ${s}`)(),n.enabled=!1;this.setShaderModuleProps({mask:n})}};Uu.defaultProps=Nct;Uu.extensionName="MaskExtension";var Qk=Uu;var On={NONE:0,WRITE_HEIGHT_MAP:1,USE_HEIGHT_MAP:2,USE_COVER:3,USE_COVER_ONLY:4,SKIP:5},Bct=Object.keys(On).map(e=>`const float TERRAIN_MODE_${e} = ${On[e]}.0;`).join(`
  `),tU=Bct+`
  uniform terrainUniforms {
    float mode;
    vec4 bounds;
  } terrain;
  
  uniform sampler2D terrain_map;
  `,zu={name:"terrain",dependencies:[qt],vs:tU+"out vec3 commonPos;",fs:tU+"in vec3 commonPos;",inject:{"vs:#main-start":`
  if (terrain.mode == TERRAIN_MODE_SKIP) {
    gl_Position = vec4(0.0);
    return;
  }
  `,"vs:DECKGL_FILTER_GL_POSITION":`
  commonPos = geometry.position.xyz;
  if (terrain.mode == TERRAIN_MODE_WRITE_HEIGHT_MAP) {
    vec2 texCoords = (commonPos.xy - terrain.bounds.xy) / terrain.bounds.zw;
    position = vec4(texCoords * 2.0 - 1.0, 0.0, 1.0);
    commonPos.z += project.commonOrigin.z;
  }
  if (terrain.mode == TERRAIN_MODE_USE_HEIGHT_MAP) {
    vec3 anchor = geometry.worldPosition;
    anchor.z = 0.0;
    vec3 anchorCommon = project_position(anchor);
    vec2 texCoords = (anchorCommon.xy - terrain.bounds.xy) / terrain.bounds.zw;
    if (texCoords.x >= 0.0 && texCoords.y >= 0.0 && texCoords.x <= 1.0 && texCoords.y <= 1.0) {
      float terrainZ = texture(terrain_map, texCoords).r;
      geometry.position.z += terrainZ;
      position = project_common_position_to_clipspace(geometry.position);
    }
  }
      `,"fs:#main-start":`
  if (terrain.mode == TERRAIN_MODE_WRITE_HEIGHT_MAP) {
    fragColor = vec4(commonPos.z, 0.0, 0.0, 1.0);
    return;
  }
      `,"fs:DECKGL_FILTER_COLOR":`
  if ((terrain.mode == TERRAIN_MODE_USE_COVER) || (terrain.mode == TERRAIN_MODE_USE_COVER_ONLY)) {
    vec2 texCoords = (commonPos.xy - terrain.bounds.xy) / terrain.bounds.zw;
    vec4 pixel = texture(terrain_map, texCoords);
    if (terrain.mode == TERRAIN_MODE_USE_COVER_ONLY) {
      color = pixel;
    } else {
      // pixel is premultiplied
      color = pixel + color * (1.0 - pixel.a);
    }
    return;
  }
      `},getUniforms:(e={})=>{if("dummyHeightMap"in e){let{drawToTerrainHeightMap:t,heightMap:r,heightMapBounds:n,dummyHeightMap:s,terrainCover:i,useTerrainHeightMap:o,terrainSkipRender:a}=e,c=qt.getUniforms(e.project),{commonOrigin:l}=c,h=a?On.SKIP:On.NONE,f=s,u=null;return t?(h=On.WRITE_HEIGHT_MAP,u=n):o&&r?(h=On.USE_HEIGHT_MAP,f=r,u=n):i&&(f=(e.isPicking?i.getPickingFramebuffer():i.getRenderFramebuffer())?.colorAttachments[0].texture,e.isPicking&&(h=On.SKIP),f?(h=h===On.SKIP?On.USE_COVER_ONLY:On.USE_COVER,u=i.bounds):f=s),{mode:h,terrain_map:f,bounds:u?[u[0]-l[0],u[1]-l[1],u[2]-u[0],u[3]-u[1]]:[0,0,0,0]}}return{}},uniformTypes:{mode:"f32",bounds:"vec4<f32>"}};function Vu(e,t){return e.createFramebuffer({id:t.id,colorAttachments:[e.createTexture({id:t.id,...t.float&&{format:"rgba32float",type:5126},mipmaps:!1,sampler:t.interpolate===!1?{minFilter:"nearest",magFilter:"nearest"}:{minFilter:"linear",magFilter:"linear"}})]})}var C1=class{constructor(t){this.isDirty=!0,this.renderViewport=null,this.bounds=null,this.layers=[],this.targetBounds=null,this.targetBoundsCommon=null,this.targetLayer=t,this.tile=eU(t)}get id(){return this.targetLayer.id}get isActive(){return Boolean(this.targetLayer.getCurrentLayer())}shouldUpdate({targetLayer:t,viewport:r,layers:n,layerNeedsRedraw:s}){t&&(this.targetLayer=t);let i=r?this._updateViewport(r):!1,o=n?this._updateLayers(n):!1;if(s){for(let a of this.layers)if(s[a]){o=!0;break}}return o||i}_updateLayers(t){let r=!1;if(t=this.tile?Fct(this.tile,t):t,t.length!==this.layers.length)r=!0;else for(let n=0;n<t.length;n++)if(t[n].id!==this.layers[n]){r=!0;break}return r&&(this.layers=t.map(n=>n.id)),r}_updateViewport(t){let r=this.targetLayer,n=!1;if(this.tile&&"boundingBox"in this.tile){if(!this.targetBounds){n=!0,this.targetBounds=this.tile.boundingBox;let i=t.projectPosition(this.targetBounds[0]),o=t.projectPosition(this.targetBounds[1]);this.targetBoundsCommon=[i[0],i[1],o[0],o[1]]}}else this.targetBounds!==r.getBounds()&&(n=!0,this.targetBounds=r.getBounds(),this.targetBoundsCommon=Wc([r],t));if(!this.targetBoundsCommon)return!1;let s=Math.ceil(t.zoom+.5);if(this.tile)this.bounds=this.targetBoundsCommon;else{let i=this.renderViewport?.zoom;n=n||s!==i;let o=jc(this.targetBoundsCommon,t),a=this.bounds;n=n||!a||o.some((c,l)=>c!==a[l]),this.bounds=o}return n&&(this.renderViewport=Gc({bounds:this.bounds,zoom:s,viewport:t})),n}getRenderFramebuffer(){return!this.renderViewport||this.layers.length===0?null:(this.fbo||(this.fbo=Vu(this.targetLayer.context.device,{id:this.id})),this.fbo)}getPickingFramebuffer(){return!this.renderViewport||this.layers.length===0&&!this.targetLayer.props.pickable?null:(this.pickingFbo||(this.pickingFbo=Vu(this.targetLayer.context.device,{id:`${this.id}-picking`,interpolate:!1})),this.pickingFbo)}filterLayers(t){return t.filter(({id:r})=>this.layers.includes(r))}delete(){let{fbo:t,pickingFbo:r}=this;t&&(t.colorAttachments[0].destroy(),t.destroy()),r&&(r.colorAttachments[0].destroy(),r.destroy())}};function Fct(e,t){return t.filter(r=>{let n=eU(r);return n?Dct(e.boundingBox,n.boundingBox):!0})}function eU(e){for(;e;){let{tile:t}=e.props;if(t)return t;e=e.parent}return null}function Dct(e,t){return e&&t?e[0][0]<t[1][0]&&t[0][0]<e[1][0]&&e[0][1]<t[1][1]&&t[0][1]<e[1][1]:!1}var kct={blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},P1=class extends Me{getRenderableLayers(t,r){let{layers:n}=r,s=[],i=this._getDrawLayerParams(t,r,!0);for(let o=0;o<n.length;o++){let a=n[o];!a.isComposite&&i[o].shouldDrawLayer&&s.push(a)}return s}renderHeightMap(t,r){let n=t.getRenderFramebuffer(),s=t.renderViewport;!n||!s||(n.resize(s),this.render({...r,target:n,pass:"terrain-height-map",layers:r.layers,viewports:[s],effects:[],clearColor:[0,0,0,0]}))}renderTerrainCover(t,r){let n=t.getRenderFramebuffer(),s=t.renderViewport;if(!n||!s)return;let i=t.filterLayers(r.layers);n.resize(s),this.render({...r,target:n,pass:`terrain-cover-${t.id}`,layers:i,effects:[],viewports:[s],clearColor:[0,0,0,0]})}getLayerParameters(t,r,n){return{...t.props.parameters,blend:!0,depthCompare:"always",...t.props.operation.includes("terrain")&&kct}}getShaderModuleProps(t,r,n){return{terrain:{project:n.project}}}};var R1=class extends Ur{constructor(){super(...arguments),this.drawParameters={}}getRenderableLayers(t,r){let{layers:n}=r,s=[];this.drawParameters={},this._resetColorEncoder(r.pickZ);let i=this._getDrawLayerParams(t,r);for(let o=0;o<n.length;o++){let a=n[o];!a.isComposite&&i[o].shouldDrawLayer&&(s.push(a),this.drawParameters[a.id]=i[o].layerParameters)}return s}renderTerrainCover(t,r){let n=t.getPickingFramebuffer(),s=t.renderViewport;if(!n||!s)return;let i=t.filterLayers(r.layers),o=t.targetLayer;o.props.pickable&&i.unshift(o),n.resize(s),this.render({...r,pickingFBO:n,pass:`terrain-cover-picking-${t.id}`,layers:i,effects:[],viewports:[s],cullRect:void 0,deviceRect:s,pickZ:!1})}getLayerParameters(t,r,n){let s;return this.drawParameters[t.id]?s=this.drawParameters[t.id]:(s=super.getLayerParameters(t,r,n),s.blend=!0),{...s,depthCompare:"always"}}getShaderModuleProps(t,r,n){return{terrain:{project:n.project}}}};var rU=2048,Hu=class{static isSupported(t){return t.isTextureFormatRenderable("rgba32float")}constructor(t){this.renderViewport=null,this.bounds=null,this.layers=[],this.layersBounds=[],this.layersBoundsCommon=null,this.lastViewport=null,this.device=t}getRenderFramebuffer(){return this.renderViewport?(this.fbo||(this.fbo=Vu(this.device,{id:"height-map",float:!0})),this.fbo):null}shouldUpdate({layers:t,viewport:r}){let n=t.length!==this.layers.length||t.some((i,o)=>i!==this.layers[o]||i.props.transitions||i.getBounds()!==this.layersBounds[o]);n&&(this.layers=t,this.layersBounds=t.map(i=>i.getBounds()),this.layersBoundsCommon=Wc(t,r));let s=!this.lastViewport||!r.equals(this.lastViewport);if(!this.layersBoundsCommon)this.renderViewport=null;else if(n||s){let i=jc(this.layersBoundsCommon,r);if(i[2]<=i[0]||i[3]<=i[1])return this.renderViewport=null,!1;this.bounds=i,this.lastViewport=r;let o=r.scale,a=(i[2]-i[0])*o,c=(i[3]-i[1])*o;return this.renderViewport=a>0||c>0?Gc({bounds:[r.center[0]-1,r.center[1]-1,r.center[0]+1,r.center[1]+1],zoom:r.zoom,width:Math.min(a,rU),height:Math.min(c,rU),viewport:r}):null,!0}return!1}delete(){this.fbo&&(this.fbo.colorAttachments[0].delete(),this.fbo.delete())}};var I1=class{constructor(){this.id="terrain-effect",this.props=null,this.useInPicking=!0,this.isPicking=!1,this.isDrapingEnabled=!1,this.terrainCovers=new Map}setup({device:t,deck:r}){this.dummyHeightMap=t.createTexture({width:1,height:1,data:new Uint8Array([0,0,0,0])}),this.terrainPass=new P1(t,{id:"terrain"}),this.terrainPickingPass=new R1(t,{id:"terrain-picking"}),Hu.isSupported(t)?this.heightMap=new Hu(t):k.warn("Terrain offset mode is not supported by this browser")(),r._addDefaultShaderModule(zu)}preRender(t){if(t.pickZ){this.isDrapingEnabled=!1;return}let{viewports:r}=t,n=t.pass.startsWith("picking");this.isPicking=n,this.isDrapingEnabled=!0;let s=r[0],i=(n?this.terrainPickingPass:this.terrainPass).getRenderableLayers(s,t),o=i.filter(c=>c.props.operation.includes("terrain"));if(o.length===0)return;n||i.filter(l=>l.state.terrainDrawMode==="offset").length>0&&this._updateHeightMap(o,s,t);let a=i.filter(c=>c.state.terrainDrawMode==="drape");this._updateTerrainCovers(o,a,s,t)}getShaderModuleProps(t,r){let{terrainDrawMode:n}=t.state;return{terrain:{project:r.project,isPicking:this.isPicking,heightMap:this.heightMap?.getRenderFramebuffer()?.colorAttachments[0].texture||null,heightMapBounds:this.heightMap?.bounds,dummyHeightMap:this.dummyHeightMap,terrainCover:this.isDrapingEnabled?this.terrainCovers.get(t.id):null,useTerrainHeightMap:n==="offset",terrainSkipRender:n==="drape"||!t.props.operation.includes("draw")}}}cleanup({deck:t}){this.dummyHeightMap&&(this.dummyHeightMap.delete(),this.dummyHeightMap=void 0),this.heightMap&&(this.heightMap.delete(),this.heightMap=void 0);for(let r of this.terrainCovers.values())r.delete();this.terrainCovers.clear(),t._removeDefaultShaderModule(zu)}_updateHeightMap(t,r,n){!this.heightMap||!this.heightMap.shouldUpdate({layers:t,viewport:r})||this.terrainPass.renderHeightMap(this.heightMap,{...n,layers:t,shaderModuleProps:{terrain:{heightMapBounds:this.heightMap.bounds,dummyHeightMap:this.dummyHeightMap,drawToTerrainHeightMap:!0},project:{devicePixelRatio:1}}})}_updateTerrainCovers(t,r,n,s){let i={};for(let o of r)o.state.terrainCoverNeedsRedraw&&(i[o.id]=!0,o.state.terrainCoverNeedsRedraw=!1);for(let o of this.terrainCovers.values())o.isDirty=o.isDirty||o.shouldUpdate({layerNeedsRedraw:i});for(let o of t)this._updateTerrainCover(o,r,n,s);this.isPicking||this._pruneTerrainCovers()}_updateTerrainCover(t,r,n,s){let i=this.isPicking?this.terrainPickingPass:this.terrainPass,o=this.terrainCovers.get(t.id);o||(o=new C1(t),this.terrainCovers.set(t.id,o));try{let a=o.shouldUpdate({targetLayer:t,viewport:n,layers:r});(this.isPicking||o.isDirty||a)&&(i.renderTerrainCover(o,{...s,layers:r,shaderModuleProps:{terrain:{dummyHeightMap:this.dummyHeightMap,terrainSkipRender:!1},project:{devicePixelRatio:1}}}),this.isPicking||(o.isDirty=!1))}catch(a){t.raiseError(a,`Error rendering terrain cover ${o.id}`)}}_pruneTerrainCovers(){let t=[];for(let[r,n]of this.terrainCovers)n.isActive||t.push(r);for(let r of t)this.terrainCovers.delete(r)}};var Uct={terrainDrawMode:void 0},Wu=class extends ce{getShaders(){return{modules:[zu]}}initializeState(){this.context.deck?._addDefaultEffect(new I1)}updateState(t){let{props:r,oldProps:n}=t;if(this.state.terrainDrawMode&&r.terrainDrawMode===n.terrainDrawMode&&r.extruded===n.extruded)return;let{terrainDrawMode:s}=r;if(!s){let i=this.props.extruded,o=this.getAttributeManager()?.attributes,a=o&&"instancePositions"in o;s=i||a?"offset":"drape"}this.setState({terrainDrawMode:s})}onNeedsRedraw(){let t=this.state;t.terrainDrawMode==="drape"&&(t.terrainCoverNeedsRedraw=!0)}};Wu.defaultProps=Uct;Wu.extensionName="TerrainExtension";var nU=Wu;var Gu={x:0,y:1,z:2};function Wo(e,t={}){let{start:r=0,end:n=e.length,plane:s="xy"}=t,i=t.size||2,o=0,a=Gu[s[0]],c=Gu[s[1]];for(let l=r,h=n-i;l<n;l+=i)o+=(e[l+a]-e[h+a])*(e[l+c]+e[h+c]),h=l;return o/2}function $E(e,t,r=2,n,s="xy"){let i=t&&t.length,o=i?t[0]*r:e.length,a=iU(e,0,o,r,!0,n&&n[0],s),c=[];if(!a||a.next===a.prev)return c;let l,h,f,u,d,p,g;if(i&&(a=qct(e,t,a,r,n,s)),e.length>80*r){u=h=e[0],d=f=e[1];for(let m=r;m<o;m+=r)p=e[m],g=e[m+1],p<u&&(u=p),g<d&&(d=g),p>h&&(h=p),g>f&&(f=g);l=Math.max(h-u,f-d),l=l!==0?32767/l:0}return ju(a,c,r,u,d,l,0),c}function iU(e,t,r,n,s,i,o){let a,c;i===void 0&&(i=Wo(e,{start:t,end:r,size:n,plane:o}));let l=Gu[o[0]],h=Gu[o[1]];if(s===i<0)for(a=t;a<r;a+=n)c=sU(a,e[a+l],e[a+h],c);else for(a=r-n;a>=t;a-=n)c=sU(a,e[a+l],e[a+h],c);return c&&N1(c,c.next)&&(Xu(c),c=c.next),c}function Go(e,t){if(!e)return e;t||(t=e);let r=e,n;do if(n=!1,!r.steiner&&(N1(r,r.next)||Wt(r.prev,r,r.next)===0)){if(Xu(r),r=t=r.prev,r===r.next)break;n=!0}else r=r.next;while(n||r!==t);return t}function ju(e,t,r,n,s,i,o){if(!e)return;!o&&i&&Zct(e,n,s,i);let a=e,c,l;for(;e.prev!==e.next;){if(c=e.prev,l=e.next,i?Wct(e,n,s,i):Hct(e)){t.push(c.i/r|0),t.push(e.i/r|0),t.push(l.i/r|0),Xu(e),e=l.next,a=l.next;continue}if(e=l,e===a){o?o===1?(e=Gct(Go(e),t,r),ju(e,t,r,n,s,i,2)):o===2&&jct(e,t,r,n,s,i):ju(Go(e),t,r,n,s,i,1);break}}}function Hct(e){let t=e.prev,r=e,n=e.next;if(Wt(t,r,n)>=0)return!1;let s=t.x,i=r.x,o=n.x,a=t.y,c=r.y,l=n.y,h=s<i?s<o?s:o:i<o?i:o,f=a<c?a<l?a:l:c<l?c:l,u=s>i?s>o?s:o:i>o?i:o,d=a>c?a>l?a:l:c>l?c:l,p=n.next;for(;p!==t;){if(p.x>=h&&p.x<=u&&p.y>=f&&p.y<=d&&qc(s,a,i,c,o,l,p.x,p.y)&&Wt(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Wct(e,t,r,n){let s=e.prev,i=e,o=e.next;if(Wt(s,i,o)>=0)return!1;let a=s.x,c=i.x,l=o.x,h=s.y,f=i.y,u=o.y,d=a<c?a<l?a:l:c<l?c:l,p=h<f?h<u?h:u:f<u?f:u,g=a>c?a>l?a:l:c>l?c:l,m=h>f?h>u?h:u:f>u?f:u,_=YE(d,p,t,r,n),y=YE(g,m,t,r,n),x=e.prevZ,A=e.nextZ;for(;x&&x.z>=_&&A&&A.z<=y;){if(x.x>=d&&x.x<=g&&x.y>=p&&x.y<=m&&x!==s&&x!==o&&qc(a,h,c,f,l,u,x.x,x.y)&&Wt(x.prev,x,x.next)>=0||(x=x.prevZ,A.x>=d&&A.x<=g&&A.y>=p&&A.y<=m&&A!==s&&A!==o&&qc(a,h,c,f,l,u,A.x,A.y)&&Wt(A.prev,A,A.next)>=0))return!1;A=A.nextZ}for(;x&&x.z>=_;){if(x.x>=d&&x.x<=g&&x.y>=p&&x.y<=m&&x!==s&&x!==o&&qc(a,h,c,f,l,u,x.x,x.y)&&Wt(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;A&&A.z<=y;){if(A.x>=d&&A.x<=g&&A.y>=p&&A.y<=m&&A!==s&&A!==o&&qc(a,h,c,f,l,u,A.x,A.y)&&Wt(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function Gct(e,t,r){let n=e;do{let s=n.prev,i=n.next.next;!N1(s,i)&&oU(s,n,n.next,i)&&qu(s,i)&&qu(i,s)&&(t.push(s.i/r|0),t.push(n.i/r|0),t.push(i.i/r|0),Xu(n),Xu(n.next),n=e=i),n=n.next}while(n!==e);return Go(n)}function jct(e,t,r,n,s,i){let o=e;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&tlt(o,a)){let c=aU(o,a);o=Go(o,o.next),c=Go(c,c.next),ju(o,t,r,n,s,i,0),ju(c,t,r,n,s,i,0);return}a=a.next}o=o.next}while(o!==e)}function qct(e,t,r,n,s,i){let o=[],a,c,l,h,f;for(a=0,c=t.length;a<c;a++)l=t[a]*n,h=a<c-1?t[a+1]*n:e.length,f=iU(e,l,h,n,!1,s&&s[a+1],i),f===f.next&&(f.steiner=!0),o.push(Qct(f));for(o.sort(Xct),a=0;a<o.length;a++)r=Yct(o[a],r);return r}function Xct(e,t){return e.x-t.x}function Yct(e,t){let r=$ct(e,t);if(!r)return t;let n=aU(r,e);return Go(n,n.next),Go(r,r.next)}function $ct(e,t){let r=t,n=e.x,s=e.y,i=-1/0,o;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){let u=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(u<=n&&u>i&&(i=u,o=r.x<r.next.x?r:r.next,u===n))return o}r=r.next}while(r!==t);if(!o)return null;let a=o,c=o.x,l=o.y,h=1/0,f;r=o;do n>=r.x&&r.x>=c&&n!==r.x&&qc(s<l?n:i,s,c,l,s<l?i:n,s,r.x,r.y)&&(f=Math.abs(s-r.y)/(n-r.x),qu(r,e)&&(f<h||f===h&&(r.x>o.x||r.x===o.x&&Kct(o,r)))&&(o=r,h=f)),r=r.next;while(r!==a);return o}function Kct(e,t){return Wt(e.prev,e,t.prev)<0&&Wt(t.next,e,e.next)<0}function Zct(e,t,r,n){let s=e;do s.z===0&&(s.z=YE(s.x,s.y,t,r,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,Jct(s)}function Jct(e){let t,r,n=1,s,i,o,a,c,l;do{for(i=e,e=null,l=null,s=0;i;){for(s++,a=i,o=0,r=0;r<n&&(o++,a=a.nextZ,!!a);r++);for(c=n;o>0||c>0&&a;)o!==0&&(c===0||!a||i.z<=a.z)?(t=i,i=i.nextZ,o--):(t=a,a=a.nextZ,c--),l?l.nextZ=t:e=t,t.prevZ=l,l=t;i=a}l.nextZ=null,n*=2}while(s>1);return e}function YE(e,t,r,n,s){return e=(e-r)*s|0,t=(t-n)*s|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function Qct(e){let t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function qc(e,t,r,n,s,i,o,a){return(s-o)*(t-a)>=(e-o)*(i-a)&&(e-o)*(n-a)>=(r-o)*(t-a)&&(r-o)*(i-a)>=(s-o)*(n-a)}function tlt(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!elt(e,t)&&(qu(e,t)&&qu(t,e)&&rlt(e,t)&&(Wt(e.prev,e,t.prev)||Wt(e,t.prev,t))||N1(e,t)&&Wt(e.prev,e,e.next)>0&&Wt(t.prev,t,t.next)>0)}function Wt(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function N1(e,t){return e.x===t.x&&e.y===t.y}function oU(e,t,r,n){let s=L1(Wt(e,t,r)),i=L1(Wt(e,t,n)),o=L1(Wt(r,n,e)),a=L1(Wt(r,n,t));return!!(s!==i&&o!==a||s===0&&O1(e,r,t)||i===0&&O1(e,n,t)||o===0&&O1(r,e,n)||a===0&&O1(r,t,n))}function O1(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function L1(e){return e>0?1:e<0?-1:0}function elt(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&oU(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}function qu(e,t){return Wt(e.prev,e,e.next)<0?Wt(e,t,e.next)>=0&&Wt(e,e.prev,t)>=0:Wt(e,t,e.prev)<0||Wt(e,e.next,t)<0}function rlt(e,t){let r=e,n=!1,s=(e.x+t.x)/2,i=(e.y+t.y)/2;do r.y>i!=r.next.y>i&&r.next.y!==r.y&&s<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next;while(r!==e);return n}function aU(e,t){let r=new Yu(e.i,e.x,e.y),n=new Yu(t.i,t.x,t.y),s=e.next,i=t.prev;return e.next=t,t.prev=e,r.next=s,s.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function sU(e,t,r,n){let s=new Yu(e,t,r);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function Xu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}var Yu=class{constructor(t,r,n){this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=r,this.y=n}};function JE(e,t,r){let n=alt(e),s=Object.keys(n).filter(i=>n[i]!==Array);return clt(e,{propArrayTypes:n,...t},{numericPropKeys:r&&r.numericPropKeys||s,PositionDataType:r?r.PositionDataType:Float32Array,triangulate:r?r.triangulate:!0})}function alt(e){let t={};for(let r of e)if(r.properties)for(let n in r.properties){let s=r.properties[n];t[n]=plt(s,t[n])}return t}function clt(e,t,r){let{pointPositionsCount:n,pointFeaturesCount:s,linePositionsCount:i,linePathsCount:o,lineFeaturesCount:a,polygonPositionsCount:c,polygonObjectsCount:l,polygonRingsCount:h,polygonFeaturesCount:f,propArrayTypes:u,coordLength:d}=t,{numericPropKeys:p=[],PositionDataType:g=Float32Array,triangulate:m=!0}=r,_=e[0]&&"id"in e[0],y=e.length>65535?Uint32Array:Uint16Array,x={type:"Point",positions:new g(n*d),globalFeatureIds:new y(n),featureIds:s>65535?new Uint32Array(n):new Uint16Array(n),numericProps:{},properties:[],fields:[]},A={type:"LineString",pathIndices:i>65535?new Uint32Array(o+1):new Uint16Array(o+1),positions:new g(i*d),globalFeatureIds:new y(i),featureIds:a>65535?new Uint32Array(i):new Uint16Array(i),numericProps:{},properties:[],fields:[]},M={type:"Polygon",polygonIndices:c>65535?new Uint32Array(l+1):new Uint16Array(l+1),primitivePolygonIndices:c>65535?new Uint32Array(h+1):new Uint16Array(h+1),positions:new g(c*d),globalFeatureIds:new y(c),featureIds:f>65535?new Uint32Array(c):new Uint16Array(c),numericProps:{},properties:[],fields:[]};m&&(M.triangles=[]);for(let w of[x,A,M])for(let v of p){let b=u[v];w.numericProps[v]=new b(w.positions.length/d)}A.pathIndices[o]=i,M.polygonIndices[l]=c,M.primitivePolygonIndices[h]=c;let E={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(let w of e){let v=w.geometry,b=w.properties||{};switch(v.type){case"Point":llt(v,x,E,d,b),x.properties.push(ZE(b,p)),_&&x.fields.push({id:w.id}),E.pointFeature++;break;case"LineString":hlt(v,A,E,d,b),A.properties.push(ZE(b,p)),_&&A.fields.push({id:w.id}),E.lineFeature++;break;case"Polygon":flt(v,M,E,d,b),M.properties.push(ZE(b,p)),_&&M.fields.push({id:w.id}),E.polygonFeature++;break;default:throw new Error("Invalid geometry type")}E.feature++}return dlt(x,A,M,d)}function llt(e,t,r,n,s){t.positions.set(e.data,r.pointPosition*n);let i=e.data.length/n;QE(t,s,r.pointPosition,i),t.globalFeatureIds.fill(r.feature,r.pointPosition,r.pointPosition+i),t.featureIds.fill(r.pointFeature,r.pointPosition,r.pointPosition+i),r.pointPosition+=i}function hlt(e,t,r,n,s){t.positions.set(e.data,r.linePosition*n);let i=e.data.length/n;QE(t,s,r.linePosition,i),t.globalFeatureIds.fill(r.feature,r.linePosition,r.linePosition+i),t.featureIds.fill(r.lineFeature,r.linePosition,r.linePosition+i);for(let o=0,a=e.indices.length;o<a;++o){let c=e.indices[o],l=o===a-1?e.data.length:e.indices[o+1];t.pathIndices[r.linePath++]=r.linePosition,r.linePosition+=(l-c)/n}}function flt(e,t,r,n,s){t.positions.set(e.data,r.polygonPosition*n);let i=e.data.length/n;QE(t,s,r.polygonPosition,i),t.globalFeatureIds.fill(r.feature,r.polygonPosition,r.polygonPosition+i),t.featureIds.fill(r.polygonFeature,r.polygonPosition,r.polygonPosition+i);for(let o=0,a=e.indices.length;o<a;++o){let c=r.polygonPosition;t.polygonIndices[r.polygonObject++]=c;let l=e.areas[o],h=e.indices[o],f=e.indices[o+1];for(let d=0,p=h.length;d<p;++d){let g=h[d],m=d===p-1?f===void 0?e.data.length:f[0]:h[d+1];t.primitivePolygonIndices[r.polygonRing++]=r.polygonPosition,r.polygonPosition+=(m-g)/n}let u=r.polygonPosition;ult(t,l,h,{startPosition:c,endPosition:u,coordLength:n})}}function ult(e,t,r,{startPosition:n,endPosition:s,coordLength:i}){if(!e.triangles)return;let o=n*i,a=s*i,c=e.positions.subarray(o,a),l=r[0],h=r.slice(1).map(u=>(u-l)/i),f=$E(c,h,i,t);for(let u=0,d=f.length;u<d;++u)e.triangles.push(n+f[u])}function KE(e,t){let r={};for(let n in e)r[n]={value:e[n],size:t};return r}function dlt(e,t,r,n){let s={shape:"binary-feature-collection",points:{...e,positions:{value:e.positions,size:n},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:KE(e.numericProps,1)},lines:{...t,positions:{value:t.positions,size:n},pathIndices:{value:t.pathIndices,size:1},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:KE(t.numericProps,1)},polygons:{...r,positions:{value:r.positions,size:n},polygonIndices:{value:r.polygonIndices,size:1},primitivePolygonIndices:{value:r.primitivePolygonIndices,size:1},globalFeatureIds:{value:r.globalFeatureIds,size:1},featureIds:{value:r.featureIds,size:1},numericProps:KE(r.numericProps,1)}};return s.polygons&&r.triangles&&(s.polygons.triangles={value:new Uint32Array(r.triangles),size:1}),s}function QE(e,t,r,n){for(let s in e.numericProps)if(s in t){let i=t[s];e.numericProps[s].fill(i,r,r+n)}}function ZE(e,t){let r={};for(let n in e)t.includes(n)||(r[n]=e[n]);return r}function plt(e,t){return t===Array||!Number.isFinite(e)?Array:t===Float64Array||Math.fround(e)!==e?Float64Array:Float32Array}function D1(e,t){let r=t?.globalFeatureId;return r!==void 0?glt(e,r):mlt(e,t?.type)}function glt(e,t){let r=fU(e);for(let n of r){let s=0,i=n.featureIds.value[0];for(let o=0;o<n.featureIds.value.length;o++){let a=n.featureIds.value[o];if(a!==i){if(t===n.globalFeatureIds.value[s])return B1(n,s,o);s=o,i=a}}if(t===n.globalFeatureIds.value[s])return B1(n,s,n.featureIds.value.length)}throw new Error(`featureId:${t} not found`)}function mlt(e,t){let r=fU(e,t);return _lt(r)}function hU(e,t,r){switch(e.type){case"Point":return Tlt(e,t,r);case"LineString":return Alt(e,t,r);case"Polygon":return uU(e,t,r);default:let n=e;throw new Error(`Unsupported geometry type: ${n?.type}`)}}function fU(e,t){let r=[];return e.points&&(e.points.type="Point",r.push(e.points)),e.lines&&(e.lines.type="LineString",r.push(e.lines)),e.polygons&&(e.polygons.type="Polygon",r.push(e.polygons)),r}function _lt(e){let t=[];for(let r of e){if(r.featureIds.value.length===0)continue;let n=0,s=r.featureIds.value[0];for(let i=0;i<r.featureIds.value.length;i++){let o=r.featureIds.value[i];o!==s&&(t.push(B1(r,n,i)),n=i,s=o)}t.push(B1(r,n,r.featureIds.value.length))}return t}function B1(e,t,r){let n=hU(e,t,r),s=ylt(e,t,r),i=xlt(e,t,r);return{type:"Feature",geometry:n,properties:s,...i}}function xlt(e,t=0,r){return e.fields&&e.fields[e.featureIds.value[t]]}function ylt(e,t=0,r){let n=Object.assign({},e.properties[e.featureIds.value[t]]);for(let s in e.numericProps)n[s]=e.numericProps[s].value[t];return n}function uU(e,t=-1/0,r=1/0){let{positions:n}=e,s=e.polygonIndices.value.filter(c=>c>=t&&c<=r),i=e.primitivePolygonIndices.value.filter(c=>c>=t&&c<=r);if(!(s.length>2)){let c=[];for(let l=0;l<i.length-1;l++){let h=i[l],f=i[l+1],u=F1(n,h,f);c.push(u)}return{type:"Polygon",coordinates:c}}let a=[];for(let c=0;c<s.length-1;c++){let l=s[c],h=s[c+1],f=uU(e,l,h).coordinates;a.push(f)}return{type:"MultiPolygon",coordinates:a}}function Alt(e,t=-1/0,r=1/0){let{positions:n}=e,s=e.pathIndices.value.filter(a=>a>=t&&a<=r);if(!(s.length>2))return{type:"LineString",coordinates:F1(n,s[0],s[1])};let o=[];for(let a=0;a<s.length-1;a++){let c=F1(n,s[a],s[a+1]);o.push(c)}return{type:"MultiLineString",coordinates:o}}function Tlt(e,t,r){let{positions:n}=e,s=F1(n,t,r);return s.length>1?{type:"MultiPoint",coordinates:s}:{type:"Point",coordinates:s[0]}}function F1(e,t,r){t=t||0,r=r||e.value.length/e.size;let n=[];for(let s=t;s<r;s++){let i=Array();for(let o=s*e.size;o<(s+1)*e.size;o++)i.push(Number(e.value[o]));n.push(i)}return n}var ob=Nn(yU(),1);function AU(e){let t=e.length;if(t<=1)return[e];let r=[],n,s;for(let i=0;i<t;i++){let o=Ult(e[i]);o!==0&&(s===void 0&&(s=o<0),s===o<0?(n&&r.push(n),n=[e[i]]):n&&n.push(e[i]))}return n&&r.push(n),r}function Ult(e){let t=0;for(let r=0,n=e.length-1,s,i;r<e.length;n=r++)s=e[r],i=e[n],t+=(i[0]-s[0])*(s[1]+i[1]);return t}function TU(e,t,r){t&&r&&(e===1?t.id=r.readVarint():e===2?zlt(r,t):e===3?t.type=r.readVarint():e===4&&(t._geometry=r.pos))}function zlt(e,t){let r=e.readVarint()+e.pos;for(;e.pos<r;){let n=t._keys[e.readVarint()],s=t._values[e.readVarint()];t.properties[n]=s}}var $c=class{properties;extent;type;id;_pbf;_geometry;_keys;_values;static get types(){return["Unknown","Point","LineString","Polygon"]}constructor(t,r,n,s,i){this.properties={},this.extent=n,this.type=0,this.id=null,this._pbf=t,this._geometry=-1,this._keys=s,this._values=i,t.readFields(TU,this,r)}loadGeometry(){let t=this._pbf;t.pos=this._geometry;let r=t.readVarint()+t.pos,n=1,s=0,i=0,o=0,a=[],c;for(;t.pos<r;){if(s<=0){let l=t.readVarint();n=l&7,s=l>>3}if(s--,n===1||n===2)i+=t.readSVarint(),o+=t.readSVarint(),n===1&&(c&&a.push(c),c=[]),c&&c.push([i,o]);else if(n===7)c&&c.push(c[0].slice());else throw new Error(`unknown command ${n}`)}return c&&a.push(c),a}bbox(){let t=this._pbf;t.pos=this._geometry;let r=t.readVarint()+t.pos,n=1,s=0,i=0,o=0,a=1/0,c=-1/0,l=1/0,h=-1/0;for(;t.pos<r;){if(s<=0){let f=t.readVarint();n=f&7,s=f>>3}if(s--,n===1||n===2)i+=t.readSVarint(),o+=t.readSVarint(),i<a&&(a=i),i>c&&(c=i),o<l&&(l=o),o>h&&(h=o);else if(n!==7)throw new Error(`unknown command ${n}`)}return[a,l,c,h]}_toGeoJSON(t){let r=this.loadGeometry(),n=$c.types[this.type],s,i;switch(this.type){case 1:let a=[];for(s=0;s<r.length;s++)a[s]=r[s][0];r=a,t(r,this);break;case 2:for(s=0;s<r.length;s++)t(r[s],this);break;case 3:for(r=AU(r),s=0;s<r.length;s++)for(i=0;i<r[s].length;i++)t(r[s][i],this);break}r.length===1?r=r[0]:n=`Multi${n}`;let o={type:"Feature",geometry:{type:n,coordinates:r},properties:this.properties};return this.id!==null&&(o.id=this.id),o}toGeoJSON(t){if(typeof t=="function")return this._toGeoJSON(t);let{x:r,y:n,z:s}=t,i=this.extent*Math.pow(2,s),o=this.extent*r,a=this.extent*n;function c(l){for(let h=0;h<l.length;h++){let f=l[h];f[0]=(f[0]+o)*360/i-180;let u=180-(f[1]+a)*360/i;f[1]=360/Math.PI*Math.atan(Math.exp(u*Math.PI/180))-90}}return this._toGeoJSON(c)}};var z1=class{version;name;extent;length;_pbf;_keys;_values;_features;constructor(t,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Vlt,this,r),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];let r=this._pbf.readVarint()+this._pbf.pos;return new $c(this._pbf,r,this.extent,this._keys,this._values)}};function Vlt(e,t,r){t&&r&&(e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(Hlt(r)))}function Hlt(e){let t=null,r=e.readVarint()+e.pos;for(;e.pos<r;){let n=e.readVarint()>>3;t=n===1?e.readString():n===2?e.readFloat():n===3?e.readDouble():n===4?e.readVarint64():n===5?e.readVarint():n===6?e.readSVarint():n===7?e.readBoolean():null}return t}var V1=class{layers;constructor(t,r){this.layers=t.readFields(Wlt,{},r)}};function Wlt(e,t,r){if(e===3&&r){let n=new z1(r,r.readVarint()+r.pos);n.length&&t&&(t[n.name]=n)}}function MU(e){let t=e.indices.length,r="Polygon";if(t<=1)return{type:r,data:e.data,areas:[[Wo(e.data)]],indices:[e.indices]};let n=[],s=[],i=[],o=[],a,c=0;for(let l,h=0,f;h<t;h++){f=e.indices[h]-c,l=e.indices[h+1]-c||e.data.length;let u=e.data.slice(f,l),d=Wo(u);if(d===0){let p=e.data.slice(0,f),g=e.data.slice(l);e.data=p.concat(g),c+=l-f;continue}a===void 0&&(a=d<0),a===d<0?(o.length&&(n.push(i),s.push(o)),o=[f],i=[d]):(i.push(d),o.push(f))}return i&&n.push(i),o.length&&s.push(o),{type:r,areas:n,indices:s,data:e.data}}function EU(e,t,r,n){for(let s=0,i=e.length;s<i;s+=2){e[s]=(e[s]+t)*360/n-180;let o=180-(e[s+1]+r)*360/n;e[s+1]=360/Math.PI*Math.atan(Math.exp(o*Math.PI/180))-90}}function bU(e,t,r){t&&r&&(e===1?t.id=r.readVarint():e===2?Glt(r,t):e===3?t.type=r.readVarint():e===4&&(t._geometry=r.pos))}function Glt(e,t){let r=e.readVarint()+e.pos;for(;e.pos<r;){let n=t._keys[e.readVarint()],s=t._values[e.readVarint()];t.properties[n]=s}}var SU,jo,rb,H1,nb,sb,$u;var W1=class{properties;extent;type;id;_pbf;_geometry;_keys;_values;_geometryInfo;constructor(t,r,n,s,i,o){this.properties={},this.extent=n,this.type=0,this.id=null,this._pbf=t,this._geometry=-1,this._keys=s,this._values=i,this._geometryInfo=o,t.readFields(bU,this,r)}loadGeometry(){let t=this._pbf;t.pos=this._geometry,SU=t.readVarint()+t.pos,jo=1,H1=0,nb=0,sb=0,$u=0;let r=[],n=[];for(;t.pos<SU;)if(H1<=0&&(rb=t.readVarint(),jo=rb&7,H1=rb>>3),H1--,jo===1||jo===2)nb+=t.readSVarint(),sb+=t.readSVarint(),jo===1&&r.push($u),n.push(nb,sb),$u+=2;else if(jo===7){if($u>0){let s=r[r.length-1];n.push(n[s],n[s+1]),$u+=2}}else throw new Error(`unknown command ${jo}`);return{data:n,indices:r}}_toBinaryCoordinates(t){let r=this.loadGeometry(),n;t(r.data,this);let s=2;switch(this.type){case 1:this._geometryInfo.pointFeaturesCount++,this._geometryInfo.pointPositionsCount+=r.indices.length,n={type:"Point",...r};break;case 2:this._geometryInfo.lineFeaturesCount++,this._geometryInfo.linePathsCount+=r.indices.length,this._geometryInfo.linePositionsCount+=r.data.length/s,n={type:"LineString",...r};break;case 3:n=MU(r),this._geometryInfo.polygonFeaturesCount++,this._geometryInfo.polygonObjectsCount+=n.indices.length;for(let o of n.indices)this._geometryInfo.polygonRingsCount+=o.length;this._geometryInfo.polygonPositionsCount+=n.data.length/s;break;default:throw new Error(`Invalid geometry type: ${this.type}`)}let i={type:"Feature",geometry:n,properties:this.properties};return this.id!==null&&(i.id=this.id),i}toBinaryCoordinates(t){if(typeof t=="function")return this._toBinaryCoordinates(t);let{x:r,y:n,z:s}=t,i=this.extent*Math.pow(2,s),o=this.extent*r,a=this.extent*n;return this._toBinaryCoordinates(c=>EU(c,o,a,i))}};var G1=class{version;name;extent;length;_pbf;_keys;_values;_features;constructor(t,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(jlt,this,r),this.length=this._features.length}feature(t,r){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];let n=this._pbf.readVarint()+this._pbf.pos;return new W1(this._pbf,n,this.extent,this._keys,this._values,r)}};function jlt(e,t,r){t&&r&&(e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(qlt(r)))}function qlt(e){let t=null,r=e.readVarint()+e.pos;for(;e.pos<r;){let n=e.readVarint()>>3;t=n===1?e.readString():n===2?e.readFloat():n===3?e.readDouble():n===4?e.readVarint64():n===5?e.readVarint():n===6?e.readSVarint():n===7?e.readBoolean():null}return t}var j1=class{layers;constructor(t,r){this.layers=t.readFields(Xlt,{},r)}};function Xlt(e,t,r){if(e===3&&r){let n=new G1(r,r.readVarint()+r.pos);n.length&&t&&(t[n.name]=n)}}function ab(e,t){let r=$lt(t),n=t?.gis?.format||t?.mvt?.shape||t?.shape;switch(n){case"columnar-table":return{shape:"columnar-table",data:ib(e,r)};case"geojson-table":return{shape:"geojson-table",type:"FeatureCollection",features:vU(e,r)};case"geojson":return vU(e,r);case"binary-geometry":return ib(e,r);case"binary":return ib(e,r);default:throw new Error(n||"undefined shape")}}function ib(e,t){let[r,n]=Ylt(e,t),s=JE(r,n);return s.byteLength=e.byteLength,s}function Ylt(e,t){let r=[],n={coordLength:2,pointPositionsCount:0,pointFeaturesCount:0,linePositionsCount:0,linePathsCount:0,lineFeaturesCount:0,polygonPositionsCount:0,polygonObjectsCount:0,polygonRingsCount:0,polygonFeaturesCount:0};if(e.byteLength<=0)return[r,n];let s=new j1(new ob.default(e));return(t&&Array.isArray(t.layers)?t.layers:Object.keys(s.layers)).forEach(o=>{let a=s.layers[o];if(a)for(let c=0;c<a.length;c++){let l=a.feature(c,n),h=Zlt(l,t,o);r.push(h)}}),[r,n]}function vU(e,t){if(e.byteLength<=0)return[];let r=[],n=new V1(new ob.default(e));return(Array.isArray(t.layers)?t.layers:Object.keys(n.layers)).forEach(i=>{let o=n.layers[i];if(o)for(let a=0;a<o.length;a++){let c=o.feature(a),l=Klt(c,t,i);r.push(l)}}),r}function $lt(e){if(!e?.mvt)throw new Error("mvt options required");let t=e.mvt?.coordinates==="wgs84",{tileIndex:r}=e.mvt,n=r&&Number.isFinite(r.x)&&Number.isFinite(r.y)&&Number.isFinite(r.z);if(t&&!n)throw new Error("MVT Loader: WGS84 coordinates need tileIndex property");return e.mvt}function Klt(e,t,r){let n=e.toGeoJSON(t.coordinates==="wgs84"?t.tileIndex:Jlt);return t.layerProperty&&(n.properties[t.layerProperty]=r),n}function Zlt(e,t,r){let n=e.toBinaryCoordinates(t.coordinates==="wgs84"?t.tileIndex:Qlt);return t.layerProperty&&n.properties&&(n.properties[t.layerProperty]=r),n}function Jlt(e,t){let{extent:r}=t;for(let n=0;n<e.length;n++){let s=e[n];s[0]/=r,s[1]/=r}}function Qlt(e,t){let{extent:r}=t;for(let n=0,s=e.length;n<s;++n)e[n]/=r}var tht="4.2.1",q1={dataType:null,batchType:null,name:"Mapbox Vector Tile",id:"mvt",module:"mvt",version:tht,extensions:["mvt","pbf"],mimeTypes:["application/vnd.mapbox-vector-tile","application/x-protobuf"],worker:!0,category:"geometry",options:{mvt:{shape:"geojson",coordinates:"local",layerProperty:"layerName",layers:void 0,tileIndex:null}}},eht={...q1,parse:async(e,t)=>ab(e,t),parseSync:ab,binary:!0};var rht={Point:wU,MultiPoint:nht,LineString:CU,MultiLineString:sht,Polygon:PU,MultiPolygon:iht};function wU([e,t],[r,n],s){let i=he(r[0],n[0],e),o=he(r[1],n[1],t);return s.unprojectFlat([i,o])}function cb(e,t,r){return e.map(n=>wU(n,t,r))}function nht(e,t,r){return cb(e,t,r)}function CU(e,t,r){return cb(e,t,r)}function sht(e,t,r){return e.map(n=>CU(n,t,r))}function PU(e,t,r){return e.map(n=>cb(n,t,r))}function iht(e,t,r){return e.map(n=>PU(n,t,r))}function RU(e,t,r){let n=r.projectFlat([t.west,t.north]),s=r.projectFlat([t.east,t.south]),i=[n,s];return{...e,coordinates:rht[e.type](e.coordinates,i,r)}}var oht=["points","lines","polygons"];function lb(e,t,r,n){for(let s of oht){let i=e[s]&&aht(e[s],t,r,n);if(i>=0)return i}return-1}function aht(e,t,r,n){let s=e.featureIds.value;if(!s.length)return-1;let i=0,o=s[s.length-1]+1;if(n){let c=cht(e,n);if(c)i=c[0],o=c[1]+1;else return-1}let a=-1;if(t in e.numericProps){let c=e.numericProps[t].value.findIndex((l,h)=>l===r&&s[h]>=i&&s[h]<o);return c>=0?e.globalFeatureIds.value[c]:-1}else t?a=IU(e.properties,c=>c[t]===r,i,o):e.fields&&(a=IU(e.fields,c=>c.id===r,i,o));return a>=0?lht(e,a):-1}function cht(e,t){if(!e.__layers){let r={},{properties:n}=e;for(let s=0;s<n.length;s++){let{layerName:i}=n[s];i&&(r[i]?r[i][1]=s:r[i]=[s,s])}e.__layers=r}return e.__layers[t]}function lht(e,t){if(!e.__ids){let r=[],n=e.featureIds.value,s=e.globalFeatureIds.value;for(let i=0;i<n.length;i++)r[n[i]]=s[i];e.__ids=r}return e.__ids[t]}function IU(e,t,r,n){for(let s=r;s<n;s++)if(t(e[s],s))return s;return-1}var hb=512,hht={..._o.defaultProps,data:ai,onDataLoad:{type:"function",value:null,optional:!0,compare:!1},uniqueIdProperty:"",highlightedFeatureId:null,loaders:[q1],binary:!0},Ku=class extends bo{initializeState(){super.initializeState();let t=this.context.viewport.resolution!==void 0?!1:this.props.binary;this.setState({binary:t,data:null,tileJSON:null,hoveredFeatureId:null,hoveredFeatureLayerName:null})}get isLoaded(){return Boolean(this.state?.data&&super.isLoaded)}updateState({props:t,oldProps:r,context:n,changeFlags:s}){s.dataChanged&&this._updateTileData(),this.state?.data&&(super.updateState({props:t,oldProps:r,context:n,changeFlags:s}),this._setWGS84PropertyForTiles());let{highlightColor:i}=t;i!==r.highlightColor&&Array.isArray(i)&&this.setState({highlightColor:i})}async _updateTileData(){let t=this.props.data,r=null;if(typeof t=="string"&&!QA(t)){let{onDataLoad:n,fetch:s}=this.props;this.setState({data:null,tileJSON:null});try{r=await s(t,{propName:"data",layer:this,loaders:[]})}catch(i){this.raiseError(i,"loading TileJSON"),t=null}n&&n(r,{propName:"data",layer:this})}else t&&typeof t=="object"&&"tilejson"in t&&(r=t);r&&(t=r.tiles),this.setState({data:t,tileJSON:r})}_getTilesetOptions(){let t=super._getTilesetOptions(),r=this.state.tileJSON,{minZoom:n,maxZoom:s}=this.props;return r&&(Number.isFinite(r.minzoom)&&r.minzoom>n&&(t.minZoom=r.minzoom),Number.isFinite(r.maxzoom)&&(!Number.isFinite(s)||r.maxzoom<s)&&(t.maxZoom=r.maxzoom)),t}renderLayers(){return this.state?.data?super.renderLayers():null}getTileData(t){let{data:r,binary:n}=this.state,{index:s,signal:i}=t,o=Sn(r,t);if(!o)return Promise.reject("Invalid URL");let a=this.getLoadOptions(),{fetch:c}=this.props;return a={...a,mimeType:"application/x-protobuf",mvt:{...a?.mvt,coordinates:this.context.viewport.resolution?"wgs84":"local",tileIndex:s},gis:n?{format:"binary"}:{}},c(o,{propName:"data",layer:this,loadOptions:a,signal:i})}renderSubLayers(t){let{x:r,y:n,z:s}=t.tile.index,i=Math.pow(2,s),o=hb/i,a=-o,c=hb*r/i,l=hb*(1-n/i),h=new $().scale([o,a,1]);t.autoHighlight=!1,this.context.viewport.resolution||(t.modelMatrix=h,t.coordinateOrigin=[c,l,0],t.coordinateSystem=W.CARTESIAN,t.extensions=[...t.extensions||[],new w1]);let f=super.renderSubLayers(t);return this.state.binary&&!(f instanceof _o)&&k.warn("renderSubLayers() must return GeoJsonLayer when using binary:true")(),f}_updateAutoHighlight(t){let{uniqueIdProperty:r}=this.props,{hoveredFeatureId:n,hoveredFeatureLayerName:s}=this.state,i=t.object,o=null,a=null;i&&(o=fb(i,r),a=OU(i));let{highlightColor:c}=this.props;typeof c=="function"&&(c=c(t)),(n!==o||s!==a)&&this.setState({highlightColor:c,hoveredFeatureId:o,hoveredFeatureLayerName:a})}_isWGS84(){return Boolean(this.context.viewport.resolution)}getPickingInfo(t){let r=super.getPickingInfo(t);if(this.state.binary&&r.index!==-1){let{data:n}=t.sourceLayer.props;r.object=D1(n,{globalFeatureId:r.index})}return r.object&&!this._isWGS84()&&(r.object=NU(r.object,r.tile.bbox,this.context.viewport)),r}getSubLayerPropsByTile(t){return{highlightedObjectIndex:this.getHighlightedObjectIndex(t),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(t){let{hoveredFeatureId:r,hoveredFeatureLayerName:n,binary:s}=this.state,{uniqueIdProperty:i,highlightedFeatureId:o}=this.props,a=t.content,c=LU(o);if(!(LU(r)||c))return-1;let h=c?o:r;return Array.isArray(a)?a.findIndex(f=>{let u=fb(f,i)===h,d=c||OU(f)===n;return u&&d}):a&&s?lb(a,i,h,c?"":n):-1}_pickObjects(t){let{deck:r,viewport:n}=this.context,s=n.width,i=n.height,o=n.x,a=n.y,c=[this.id];return r.pickObjects({x:o,y:a,width:s,height:i,layerIds:c,maxObjects:t})}getRenderedFeatures(t=null){let r=this._pickObjects(t),n=new Set,s=[];for(let i of r){let o=fb(i.object,this.props.uniqueIdProperty);o===void 0?s.push(i.object):n.has(o)||(n.add(o),s.push(i.object))}return s}_setWGS84PropertyForTiles(){let t="dataInWGS84";this.state.tileset.selectedTiles.forEach(n=>{n.hasOwnProperty(t)||Object.defineProperty(n,t,{get:()=>{if(!n.content)return null;if(this.state.binary&&Array.isArray(n.content)&&!n.content.length)return[];let{bbox:s}=n;if(n._contentWGS84===void 0&&tT(s)){let i=this.state.binary?D1(n.content):n.content;n._contentWGS84=i.map(o=>NU(o,s,this.context.viewport))}return n._contentWGS84}})})}};Ku.layerName="MVTLayer";Ku.defaultProps=hht;var BU=Ku;function fb(e,t){if(e.properties&&t)return e.properties[t];if("id"in e)return e.id}function OU(e){return e.properties?.layerName||null}function LU(e){return e!=null&&e!==""}function NU(e,t,r){let n={...e,geometry:{type:e.geometry.type}};return Object.defineProperty(n.geometry,"coordinates",{get:()=>RU(e.geometry,t,r).coordinates}),n}var FU="0123456789bcdefghjkmnpqrstuvwxyz",DU={};for(let e=0;e<FU.length;e++)DU[FU.charAt(e)]=e;var fht=-90,uht=90,dht=-180,pht=180;function ght(e){let t=!0,r=uht,n=fht,s=pht,i=dht,o,a=0;for(let c=0,l=e.length;c<l;c++){let h=e[c].toLowerCase();a=DU[h];for(let f=4;f>=0;f--){let u=a>>f&1;t?(o=(s+i)/2,u===1?i=o:s=o):(o=(r+n)/2,u===1?n=o:r=o),t=!t}}return[n,i,r,s]}function kU(e){let[t,r,n,s]=ght(e);return[s,n,s,t,r,t,r,n,s,n]}var mht={getGeohash:{type:"accessor",value:e=>e.geohash}},Zu=class extends En{indexToBounds(){let{data:t,getGeohash:r}=this.props;return{data:t,_normalize:!1,positionFormat:"XY",getPolygon:(n,s)=>kU(r(n,s))}}};Zu.layerName="GeohashLayer";Zu.defaultProps=mht;var UU=Zu;var ub={};Bt(ub,{Buffer:()=>K,BufferTransform:()=>cr,CubeGeometry:()=>Yn,Device:()=>Ze,Framebuffer:()=>hn,Geometry:()=>it,GroupNode:()=>lr,Model:()=>Y,ModelNode:()=>pn,ScenegraphNode:()=>Er,SphereGeometry:()=>Eh,Texture:()=>Q,TextureTransform:()=>Ws,attachDevice:()=>Mht,createDevice:()=>Eht,enforceWebGL2:()=>bht,getBestAvailableAdapter:()=>Aht,getSupportedAdapters:()=>yht,registerDevices:()=>xht,setDefaultDeviceProps:()=>Tht,stats:()=>_ht});var{stats:_ht,registerDevices:xht,getSupportedAdapters:yht,getBestAvailableAdapter:Aht,setDefaultDeviceProps:Tht,attachDevice:Mht,createDevice:Eht,enforceWebGL2:bht}=ws;var db={};Bt(db,{fetchFile:()=>Jo,load:()=>se,parse:()=>bs,registerLoaders:()=>vl});var X1=class{constructor(t){this.map=null,this.width=0,this.height=0,this.props={...t},this._initialize(this.props)}finalize(){this.map?.remove(),this.map=null}setProps(t){let r=this.props,n={...this.props,...t};if(this.props=n,!this.map)return;this._update(r,n)&&this.redraw()}redraw(){let t=this.map;t.style&&(t._frame&&(t._frame.cancel(),t._frame=null),t._render())}getMap(){return this.map}_initialize(t){let{mapLib:r,container:n}=t;r.accessToken=t.mapboxApiAccessToken||"",this.map=new t.mapLib.Map({container:n,maxZoom:24,...t.mapOptions,...zU(t.viewState),style:t.mapStyle,interactive:!1,trackResize:!1}),Object.defineProperty(n,"offsetWidth",{get:()=>this.width}),Object.defineProperty(n,"clientWidth",{get:()=>this.width}),Object.defineProperty(n,"offsetHeight",{get:()=>this.height}),Object.defineProperty(n,"clientHeight",{get:()=>this.height}),this.map.resize()}_update(t,r){t.mapStyle!==r.mapStyle&&this.map.setStyle(r.mapStyle);let s=t.width!==r.width||t.height!==r.height;s&&(this.width=r.width,this.height=r.height,this.map.resize());let i=t.viewState,o=r.viewState,a=o.latitude!==i.latitude||o.longitude!==i.longitude||o.zoom!==i.zoom||o.pitch!==i.pitch||o.bearing!==i.bearing;return a&&this.map.jumpTo(zU(o)),s||a}};function zU(e){return{center:[e.longitude,e.latitude],zoom:e.zoom,bearing:e.bearing??0,pitch:e.pitch??0}}var VU={position:"absolute",left:0,top:0,width:"100%",height:"100%"};function Sht(e){let{container:t=document.body}=e;if(typeof t=="string"&&(t=document.getElementById(t)),!t)throw Error("Deck: container not found");window.getComputedStyle(t).position==="static"&&(t.style.position="relative");let n=document.createElement("div");t.appendChild(n),Object.assign(n.style,VU);let s=document.createElement("canvas");return t.appendChild(s),Object.assign(s.style,VU),{container:t,mapCanvas:n,deckCanvas:s}}var Ju=class extends jr{constructor(t){if(typeof document>"u")throw Error("Deck can only be used in the browser");let{mapCanvas:r,deckCanvas:n}=Sht(t),s=t.viewState||t.initialViewState,i=Number.isFinite(s&&s.latitude),{map:o=globalThis.mapboxgl||globalThis.maplibregl}=t;super({canvas:n,...t}),o&&o.Map?this._map=i&&new X1({...t,width:0,height:0,viewState:s,container:r,mapLib:o}):this._map=o}getMapboxMap(){return this._map&&this._map.getMap()}finalize(){this._map&&this._map.finalize(),super.finalize()}setProps(t){"mapStyle"in t&&this._map&&this._map.setProps({mapStyle:t.mapStyle}),super.setProps(t)}_drawLayers(t,r){if(this._map){let n=this.getViewports()[0];n&&this._map.setProps({width:n.width,height:n.height,viewState:n})}super._drawLayers(t,r)}};globalThis.luma=globalThis.luma||{};globalThis.loaders=globalThis.loaders||{};Object.assign(globalThis.luma,ub);Object.assign(globalThis.loaders,db);function HU({pointCount:e,getBinId:t}){let r=new Map;for(let n=0;n<e;n++){let s=t(n);if(s===null)continue;let i=r.get(String(s));i?i.points.push(n):(i={id:s,index:r.size,points:[n]},r.set(String(s),i))}return Array.from(r.values())}function WU({bins:e,dimensions:t,target:r}){let n=e.length*t;(!r||r.length<n)&&(r=new Float32Array(n));for(let s=0;s<e.length;s++){let{id:i}=e[s];Array.isArray(i)?r.set(i,s*t):r[s]=i}return r}var vht=e=>e.length,GU=(e,t)=>{let r=0;for(let n of e)r+=t(n);return r},wht=(e,t)=>e.length===0?NaN:GU(e,t)/e.length,Cht=(e,t)=>{let r=1/0;for(let n of e){let s=t(n);s<r&&(r=s)}return r},Pht=(e,t)=>{let r=-1/0;for(let n of e){let s=t(n);s>r&&(r=s)}return r},jU={COUNT:vht,SUM:GU,MEAN:wht,MIN:Cht,MAX:Pht};function qU({bins:e,getValue:t,operation:r,target:n}){(!n||n.length<e.length)&&(n=new Float32Array(e.length));let s=1/0,i=-1/0;for(let o=0;o<e.length;o++){let{points:a}=e[o];n[o]=r(a,t),n[o]<s&&(s=n[o]),n[o]>i&&(i=n[o])}return{value:n,domain:[s,i]}}function pb(e,t,r){let n={};for(let i of e.sources||[]){let o=t[i];if(o)n[i]=Rht(o);else throw new Error(`Cannot find attribute ${i}`)}let s={};return i=>{for(let o in n)s[o]=n[o](i);return e.getValue(s,i,r)}}function Rht(e){let t=e.value,{offset:r=0,stride:n,size:s}=e.getAccessor(),i=t.BYTES_PER_ELEMENT,o=r/i,a=n?n/i:s;if(s===1)return e.isConstant?()=>t[0]:l=>{let h=o+a*l;return t[h]};let c;return e.isConstant?(c=Array.from(t),()=>c):(c=new Array(s),l=>{let h=o+a*l;for(let f=0;f<s;f++)c[f]=t[h+f];return c})}var Ye=class{constructor(t){this.bins=[],this.binIds=null,this.results=[],this.dimensions=t.dimensions,this.channelCount=t.getValue.length,this.props={...t,binOptions:{},pointCount:0,operations:[],customOperations:[],attributes:{}},this.needsUpdate=!0,this.setProps(t)}destroy(){}get binCount(){return this.bins.length}setProps(t){let r=this.props;if(t.binOptions&&(tt(t.binOptions,r.binOptions,2)||this.setNeedsUpdate()),t.operations)for(let n=0;n<this.channelCount;n++)t.operations[n]!==r.operations[n]&&this.setNeedsUpdate(n);if(t.customOperations)for(let n=0;n<this.channelCount;n++)Boolean(t.customOperations[n])!==Boolean(r.customOperations[n])&&this.setNeedsUpdate(n);t.pointCount!==void 0&&t.pointCount!==r.pointCount&&this.setNeedsUpdate(),t.attributes&&(t.attributes={...r.attributes,...t.attributes}),Object.assign(this.props,t)}setNeedsUpdate(t){t===void 0?this.needsUpdate=!0:this.needsUpdate!==!0&&(this.needsUpdate=this.needsUpdate||[],this.needsUpdate[t]=!0)}update(){if(this.needsUpdate===!0){this.bins=HU({pointCount:this.props.pointCount,getBinId:pb(this.props.getBin,this.props.attributes,this.props.binOptions)});let t=WU({bins:this.bins,dimensions:this.dimensions,target:this.binIds?.value});this.binIds={value:t,type:"float32",size:this.dimensions}}for(let t=0;t<this.channelCount;t++)if(this.needsUpdate===!0||this.needsUpdate[t]){let r=this.props.customOperations[t]||jU[this.props.operations[t]],{value:n,domain:s}=qU({bins:this.bins,getValue:pb(this.props.getValue[t],this.props.attributes,void 0),operation:r,target:this.results[t]?.value});this.results[t]={value:n,domain:s,type:"float32",size:1},this.props.onUpdate?.({channel:t})}this.needsUpdate=!1}preDraw(){}getBins(){return this.binIds}getResult(t){return this.results[t]}getResultDomain(t){return this.results[t]?.domain??[1/0,-1/0]}getBin(t){let r=this.bins[t];if(!r)return null;let n=new Array(this.channelCount);for(let s=0;s<n.length;s++){let i=this.results[s];n[s]=i?.value[t]}return{id:r.id,value:n,count:r.points.length,pointIndices:r.points}}};function Y1(e,t,r){return e.createFramebuffer({width:t,height:r,colorAttachments:[e.createTexture({width:t,height:r,format:"rgba32float",mipmaps:!1,sampler:{minFilter:"nearest",magFilter:"nearest"}})]})}var Iht=`uniform binSorterUniforms {
    ivec4 binIdRange;
    ivec2 targetSize;
  } binSorter;
  `,XU={name:"binSorter",vs:Iht,uniformTypes:{binIdRange:"vec4<i32>",targetSize:"vec2<i32>"}};var $U=[1,2,4,8],YU=3e38,Oht={SUM:0,MEAN:0,MIN:0,MAX:0,COUNT:0},Qu=1024,$1=class{constructor(t,r){this.binsFBO=null,this.device=t,this.model=Nht(t,r)}get texture(){return this.binsFBO?this.binsFBO.colorAttachments[0].texture:null}destroy(){this.model.destroy(),this.binsFBO?.colorAttachments[0].texture.destroy(),this.binsFBO?.destroy()}getBinValues(t){if(!this.binsFBO)return null;let r=t%Qu,n=Math.floor(t/Qu),s=this.device.readPixelsToArrayWebGL(this.binsFBO,{sourceX:r,sourceY:n,sourceWidth:1,sourceHeight:1}).buffer;return new Float32Array(s)}setDimensions(t,r){let n=Qu,s=Math.ceil(t/n);this.binsFBO?this.binsFBO.height<s&&this.binsFBO.resize({width:n,height:s}):this.binsFBO=Y1(this.device,n,s);let i={binIdRange:[r[0][0],r[0][1],r[1]?.[0]||0,r[1]?.[1]||0],targetSize:[this.binsFBO.width,this.binsFBO.height]};this.model.shaderInputs.setProps({binSorter:i})}setModelProps(t){let r=this.model;t.attributes&&r.setAttributes(t.attributes),t.constantAttributes&&r.setConstantAttributes(t.constantAttributes),t.vertexCount!==void 0&&r.setVertexCount(t.vertexCount),t.shaderModuleProps&&r.shaderInputs.setProps(t.shaderModuleProps)}update(t){if(!this.binsFBO)return;let r=Lht(t);this._updateBins("SUM",r.SUM+r.MEAN),this._updateBins("MIN",r.MIN),this._updateBins("MAX",r.MAX)}_updateBins(t,r){if(r===0)return;r|=$U[3];let n=this.model,s=this.binsFBO,i=t==="MAX"?-YU:t==="MIN"?YU:0,o=this.device.beginRenderPass({id:`gpu-aggregation-${t}`,framebuffer:s,parameters:{viewport:[0,0,s.width,s.height],colorMask:r},clearColor:[i,i,i,0],clearDepth:!1,clearStencil:!1});n.setParameters({blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendColorOperation:t==="MAX"?"max":t==="MIN"?"min":"add",blendAlphaOperation:"add"}),n.draw(o),o.end()}};function Lht(e){let t={...Oht};for(let r=0;r<e.length;r++){let n=e[r];n&&(t[n]+=$U[r])}return t}function Nht(e,t){let r=t.vs;t.dimensions===2&&(r+=`
  void getBin(out int binId) {
    ivec2 binId2;
    getBin(binId2);
    if (binId2.x < binSorter.binIdRange.x || binId2.x >= binSorter.binIdRange.y) {
      binId = -1;
    } else {
      binId = (binId2.y - binSorter.binIdRange.z) * (binSorter.binIdRange.y - binSorter.binIdRange.x) + binId2.x;
    }
  }
  `);let n=`#version 300 es
  #define SHADER_NAME gpu-aggregation-sort-bins-vertex
  
  ${r}
  
  out vec3 v_Value;
  
  void main() {
    int binIndex;
    getBin(binIndex);
    binIndex = binIndex - binSorter.binIdRange.x;
    if (binIndex < 0) {
      gl_Position = vec4(0.);
      return;
    }
    int row = binIndex / binSorter.targetSize.x;
    int col = binIndex - row * binSorter.targetSize.x;
    vec2 position = (vec2(col, row) + 0.5) / vec2(binSorter.targetSize) * 2.0 - 1.0;
    gl_Position = vec4(position, 0.0, 1.0);
    gl_PointSize = 1.0;
  
  #if NUM_CHANNELS == 3
    getValue(v_Value);
  #elif NUM_CHANNELS == 2
    getValue(v_Value.xy);
  #else
    getValue(v_Value.x);
  #endif
  }
  `,s=`#version 300 es
  #define SHADER_NAME gpu-aggregation-sort-bins-fragment
  
  precision highp float;
  
  in vec3 v_Value;
  out vec4 fragColor;
  
  void main() {
    fragColor.xyz = v_Value;
  
    #ifdef MODULE_GEOMETRY
    geometry.uv = vec2(0.);
    DECKGL_FILTER_COLOR(fragColor, geometry);
    #endif
  
    fragColor.w = 1.0;
  }
  `;return new Y(e,{bufferLayout:t.bufferLayout,modules:[...t.modules||[],XU],defines:{...t.defines,NON_INSTANCED_MODEL:1,NUM_CHANNELS:t.channelCount},isInstanced:!1,vs:n,fs:s,topology:"point-list",disableWarnings:!0})}var Bht=`uniform aggregatorTransformUniforms {
    ivec4 binIdRange;
    bvec3 isCount;
    bvec3 isMean;
    float naN;
  } aggregatorTransform;
  `,KU={name:"aggregatorTransform",vs:Bht,uniformTypes:{binIdRange:"vec4<i32>",isCount:"vec3<f32>",isMean:"vec3<f32>"}};var gb=3e38,K1=class{constructor(t,r){this.binBuffer=null,this.valueBuffer=null,this._domains=null,this.device=t,this.channelCount=r.channelCount,this.transform=Fht(t,r),this.domainFBO=Y1(t,2,1)}destroy(){this.transform.destroy(),this.binBuffer?.destroy(),this.valueBuffer?.destroy(),this.domainFBO.colorAttachments[0].texture.destroy(),this.domainFBO.destroy()}get domains(){if(!this._domains){let t=this.device.readPixelsToArrayWebGL(this.domainFBO).buffer,r=new Float32Array(t);this._domains=[[-r[4],r[0]],[-r[5],r[1]],[-r[6],r[2]]].slice(0,this.channelCount)}return this._domains}setDimensions(t,r){let{model:n,transformFeedback:s}=this.transform;n.setVertexCount(t);let i={binIdRange:[r[0][0],r[0][1],r[1]?.[0]||0,r[1]?.[1]||0]};n.shaderInputs.setProps({aggregatorTransform:i});let o=t*r.length*4;(!this.binBuffer||this.binBuffer.byteLength<o)&&(this.binBuffer?.destroy(),this.binBuffer=this.device.createBuffer({byteLength:o}),s.setBuffer("binIds",this.binBuffer));let a=t*this.channelCount*4;(!this.valueBuffer||this.valueBuffer.byteLength<a)&&(this.valueBuffer?.destroy(),this.valueBuffer=this.device.createBuffer({byteLength:a}),s.setBuffer("values",this.valueBuffer))}update(t,r){if(!t)return;let n=this.transform,s=this.domainFBO,i=[0,1,2].map(c=>r[c]==="COUNT"?1:0),o=[0,1,2].map(c=>r[c]==="MEAN"?1:0),a={isCount:i,isMean:o,bins:t};n.model.shaderInputs.setProps({aggregatorTransform:a}),n.run({id:"gpu-aggregation-domain",framebuffer:s,parameters:{viewport:[0,0,2,1]},clearColor:[-gb,-gb,-gb,0],clearDepth:!1,clearStencil:!1}),this._domains=null}};function Fht(e,t){let r=`#version 300 es
  #define SHADER_NAME gpu-aggregation-domain-vertex
  
  uniform sampler2D bins;
  
  #if NUM_DIMS == 1
  out float binIds;
  #else
  out vec2 binIds;
  #endif
  
  #if NUM_CHANNELS == 1
  flat out float values;
  #elif NUM_CHANNELS == 2
  flat out vec2 values;
  #else
  flat out vec3 values;
  #endif
  
  const float NAN = intBitsToFloat(-1);
  
  void main() {
    int row = gl_VertexID / SAMPLER_WIDTH;
    int col = gl_VertexID - row * SAMPLER_WIDTH;
    vec4 weights = texelFetch(bins, ivec2(col, row), 0);
    vec3 value3 = mix(
      mix(weights.rgb, vec3(weights.a), aggregatorTransform.isCount),
      weights.rgb / max(weights.a, 1.0),
      aggregatorTransform.isMean
    );
    if (weights.a == 0.0) {
      value3 = vec3(NAN);
    }
  
  #if NUM_DIMS == 1
    binIds = float(gl_VertexID + aggregatorTransform.binIdRange.x);
  #else
    int y = gl_VertexID / (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
    int x = gl_VertexID - y * (aggregatorTransform.binIdRange.y - aggregatorTransform.binIdRange.x);
    binIds.y = float(y + aggregatorTransform.binIdRange.z);
    binIds.x = float(x + aggregatorTransform.binIdRange.x);
  #endif
  
  #if NUM_CHANNELS == 3
    values = value3;
  #elif NUM_CHANNELS == 2
    values = value3.xy;
  #else
    values = value3.x;
  #endif
  
    gl_Position = vec4(0., 0., 0., 1.);
    // This model renders into a 2x1 texture to obtain min and max simultaneously.
    // See comments in fragment shader
    gl_PointSize = 2.0;
  }
  `,n=`#version 300 es
  #define SHADER_NAME gpu-aggregation-domain-fragment
  
  precision highp float;
  
  #if NUM_CHANNELS == 1
  flat in float values;
  #elif NUM_CHANNELS == 2
  flat in vec2 values;
  #else
  flat in vec3 values;
  #endif
  
  out vec4 fragColor;
  
  void main() {
    vec3 value3;
  #if NUM_CHANNELS == 3
    value3 = values;
  #elif NUM_CHANNELS == 2
    value3.xy = values;
  #else
    value3.x = values;
  #endif
    if (isnan(value3.x)) discard;
    // This shader renders into a 2x1 texture with blending=max
    // The left pixel yields the max value of each channel
    // The right pixel yields the min value of each channel
    if (gl_FragCoord.x < 1.0) {
      fragColor = vec4(value3, 1.0);
    } else {
      fragColor = vec4(-value3, 1.0);
    }
  }
  `;return new cr(e,{vs:r,fs:n,topology:"point-list",modules:[KU],parameters:{blend:!0,blendColorSrcFactor:"one",blendColorDstFactor:"one",blendColorOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one",blendAlphaOperation:"max"},defines:{NUM_DIMS:t.dimensions,NUM_CHANNELS:t.channelCount,SAMPLER_WIDTH:Qu},varyings:["binIds","values"],disableWarnings:!0})}var ne=class{static isSupported(t){return t.features.has("float32-renderable-webgl")&&t.features.has("texture-blend-float-webgl")}constructor(t,r){this.binCount=0,this.binIds=null,this.results=[],this.device=t,this.dimensions=r.dimensions,this.channelCount=r.channelCount,this.props={...r,pointCount:0,binIdRange:[[0,0]],operations:[],attributes:{},binOptions:{}},this.needsUpdate=new Array(this.channelCount).fill(!0),this.binSorter=new $1(t,r),this.aggregationTransform=new K1(t,r),this.setProps(r)}getBins(){let t=this.aggregationTransform.binBuffer;return t?(this.binIds?.buffer!==t&&(this.binIds={buffer:t,type:"float32",size:this.dimensions}),this.binIds):null}getResult(t){let r=this.aggregationTransform.valueBuffer;return!r||t>=this.channelCount?null:(this.results[t]?.buffer!==r&&(this.results[t]={buffer:r,type:"float32",size:1,stride:this.channelCount*4,offset:t*4}),this.results[t])}getResultDomain(t){return this.aggregationTransform.domains[t]}getBin(t){if(t<0||t>=this.binCount)return null;let{binIdRange:r}=this.props,n;if(this.dimensions===1)n=[t+r[0][0]];else{let[[a,c],[l]]=r,h=c-a;n=[t%h+a,Math.floor(t/h)+l]}let s=this.binSorter.getBinValues(t);if(!s)return null;let i=s[3],o=[];for(let a=0;a<this.channelCount;a++){let c=this.props.operations[a];c==="COUNT"?o[a]=i:i===0?o[a]=NaN:o[a]=c==="MEAN"?s[a]/i:s[a]}return{id:n,value:o,count:i}}destroy(){this.binSorter.destroy(),this.aggregationTransform.destroy()}setProps(t){let r=this.props;if("binIdRange"in t&&!tt(t.binIdRange,r.binIdRange,2)){let n=t.binIdRange;if(k.assert(n.length===this.dimensions),this.dimensions===1){let[[s,i]]=n;this.binCount=i-s}else{let[[s,i],[o,a]]=n;this.binCount=(i-s)*(a-o)}this.binSorter.setDimensions(this.binCount,n),this.aggregationTransform.setDimensions(this.binCount,n),this.setNeedsUpdate()}if(t.operations)for(let n=0;n<this.channelCount;n++)t.operations[n]!==r.operations[n]&&this.setNeedsUpdate(n);if(t.pointCount!==void 0&&t.pointCount!==r.pointCount&&(this.binSorter.setModelProps({vertexCount:t.pointCount}),this.setNeedsUpdate()),t.binOptions&&(tt(t.binOptions,r.binOptions,2)||this.setNeedsUpdate(),this.binSorter.model.shaderInputs.setProps({binOptions:t.binOptions})),t.attributes){let n={},s={};for(let i of Object.values(t.attributes))for(let[o,a]of Object.entries(i.getValue()))ArrayBuffer.isView(a)?s[o]=a:a&&(n[o]=a);this.binSorter.setModelProps({attributes:n,constantAttributes:s})}t.shaderModuleProps&&this.binSorter.setModelProps({shaderModuleProps:t.shaderModuleProps}),Object.assign(this.props,t)}setNeedsUpdate(t){t===void 0?this.needsUpdate.fill(!0):this.needsUpdate[t]=!0}update(){}preDraw(){if(!this.needsUpdate.some(Boolean))return;let{operations:t}=this.props,r=this.needsUpdate.map((n,s)=>n?t[s]:null);this.binSorter.update(r),this.aggregationTransform.update(this.binSorter.texture,t);for(let n=0;n<this.channelCount;n++)this.needsUpdate[n]&&(this.needsUpdate[n]=!1,this.props.onUpdate?.({channel:n}))}};var Z1=class extends Ft{get isDrawable(){return!0}initializeState(){this.getAttributeManager().remove(["instancePickingColors"])}updateState(t){super.updateState(t);let r=this.getAggregatorType();if(t.changeFlags.extensionsChanged||this.state.aggregatorType!==r){this.state.aggregator?.destroy();let n=this.createAggregator(r);return n.setProps({attributes:this.getAttributeManager()?.attributes}),this.setState({aggregator:n,aggregatorType:r}),!0}return!1}finalizeState(t){super.finalizeState(t),this.state.aggregator.destroy()}updateAttributes(t){let{aggregator:r}=this.state;r.setProps({attributes:t});for(let n in t)this.onAttributeChange(n);r.update()}draw({shaderModuleProps:t}){let{aggregator:r}=this.state;r.setProps({shaderModuleProps:t}),r.preDraw()}_getAttributeManager(){return new ur(this.context.device,{id:this.props.id,stats:this.context.stats})}};Z1.layerName="AggregationLayer";var Ln=Z1;var bi=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function mb(e,t=!1,r=Float32Array){let n;if(Number.isFinite(e[0]))n=new r(e);else{n=new r(e.length*4);let s=0;for(let i=0;i<e.length;i++){let o=e[i];n[s++]=o[0],n[s++]=o[1],n[s++]=o[2],n[s++]=Number.isFinite(o[3])?o[3]:255}}if(t)for(let s=0;s<n.length;s++)n[s]/=255;return n}var J1={linear:"linear",quantile:"nearest",quantize:"nearest",ordinal:"nearest"};function Kc(e,t){e.setSampler({minFilter:J1[t],magFilter:J1[t]})}function Zc(e,t,r="linear"){let n=mb(t,!1,Uint8Array);return e.createTexture({format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:J1[r],magFilter:J1[r],addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},data:n,width:n.length/4,height:1})}var ZU=`#version 300 es
  #define SHADER_NAME screen-grid-layer-vertex-shader
  #define RANGE_COUNT 6
  in vec2 positions;
  in vec2 instancePositions;
  in float instanceWeights;
  in vec3 instancePickingColors;
  uniform sampler2D colorRange;
  out vec4 vColor;
  vec4 interp(float value, vec2 domain, sampler2D range) {
  float r = (value - domain.x) / (domain.y - domain.x);
  return texture(range, vec2(r, 0.5));
  }
  void main(void) {
  if (isnan(instanceWeights)) {
  gl_Position = vec4(0.);
  return;
  }
  vec2 pos = instancePositions * screenGrid.gridSizeClipspace + positions * screenGrid.cellSizeClipspace;
  pos.x = pos.x - 1.0;
  pos.y = 1.0 - pos.y;
  gl_Position = vec4(pos, 0., 1.);
  vColor = interp(instanceWeights, screenGrid.colorDomain, colorRange);
  vColor.a *= layer.opacity;
  picking_setPickingColor(instancePickingColors);
  }
  `;var JU=`#version 300 es
  #define SHADER_NAME screen-grid-layer-fragment-shader
  precision highp float;
  in vec4 vColor;
  out vec4 fragColor;
  void main(void) {
  fragColor = vColor;
  DECKGL_FILTER_COLOR(fragColor, geometry);
  }
  `;var Dht=`uniform screenGridUniforms {
    vec2 cellSizeClipspace;
    vec2 gridSizeClipspace;
    vec2 colorDomain;
  } screenGrid;
  `,QU={name:"screenGrid",vs:Dht,uniformTypes:{cellSizeClipspace:"vec2<f32>",gridSizeClipspace:"vec2<f32>",colorDomain:"vec2<f32>"}};var Q1=class extends ut{getShaders(){return super.getShaders({vs:ZU,fs:JU,modules:[Tt,QU]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceWeights:{size:1,type:"float32",accessor:"getWeight"}}),this.state.model=this._getModel()}updateState(t){super.updateState(t);let{props:r,oldProps:n,changeFlags:s}=t,i=this.state.model;if(n.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=Zc(this.context.device,r.colorRange,r.colorScaleType);let o={colorRange:this.state.colorTexture};i.shaderInputs.setProps({screenGrid:o})}else n.colorScaleType!==r.colorScaleType&&Kc(this.state.colorTexture,r.colorScaleType);if(n.cellMarginPixels!==r.cellMarginPixels||n.cellSizePixels!==r.cellSizePixels||s.viewportChanged){let{width:o,height:a}=this.context.viewport,{cellSizePixels:c,cellMarginPixels:l}=this.props,h=Math.max(c-l,0),f={gridSizeClipspace:[c/o*2,c/a*2],cellSizeClipspace:[h/o*2,h/a*2]};i.shaderInputs.setProps({screenGrid:f})}}finalizeState(t){super.finalizeState(t),this.state.colorTexture?.destroy()}draw({uniforms:t}){let r=this.props.colorDomain(),n=this.state.model,s={colorDomain:r};n.shaderInputs.setProps({screenGrid:s}),n.draw(this.context.renderPass)}_getModel(){return new Y(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new it({topology:"triangle-strip",attributes:{positions:{value:new Float32Array([0,0,1,0,0,1,1,1]),size:2}}}),isInstanced:!0})}};Q1.layerName="ScreenGridCellLayer";var t5=Q1;var kht=`uniform binOptionsUniforms {
    float cellSizePixels;
  } binOptions;
  `,e5={name:"binOptions",vs:kht,uniformTypes:{cellSizePixels:"f32"}};var Uht={cellSizePixels:{type:"number",value:100,min:1},cellMarginPixels:{type:"number",value:2,min:0},colorRange:bi,colorScaleType:"linear",getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM"},td=class extends Ln{getAggregatorType(){return this.props.gpuAggregation&&ne.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(t){return t==="cpu"||!ne.isSupported(this.context.device)?new Ye({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},n,s)=>{let i=this.context.viewport,o=i.project(r),a=s.cellSizePixels;return o[0]<0||o[0]>=i.width||o[1]<0||o[1]>=i.height?null:[Math.floor(o[0]/a),Math.floor(o[1]/a)]}},getValue:[{sources:["counts"],getValue:({counts:r})=>r}]}):new ne(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[st,e5],vs:`
    in vec3 positions;
    in vec3 positions64Low;
    in float counts;
    
    void getBin(out ivec2 binId) {
      vec4 pos = project_position_to_clipspace(positions, positions64Low, vec3(0.0));
      vec2 screenCoords = vec2(pos.x / pos.w + 1.0, 1.0 - pos.y / pos.w) / 2.0 * project.viewportSize / project.devicePixelRatio;
      vec2 gridCoords = floor(screenCoords / binOptions.cellSizePixels);
      binId = ivec2(gridCoords);
    }
    void getValue(out float weight) {
      weight = counts;
    }
    `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){let r=super.updateState(t),{props:n,oldProps:s,changeFlags:i}=t,{cellSizePixels:o,aggregation:a}=n;if(r||i.dataChanged||i.updateTriggersChanged||i.viewportChanged||a!==s.aggregation||o!==s.cellSizePixels){let{width:c,height:l}=this.context.viewport,{aggregator:h}=this.state;h instanceof ne&&h.setProps({binIdRange:[[0,Math.ceil(c/o)],[0,Math.ceil(l/o)]]}),h.setProps({pointCount:this.getNumInstances(),operations:[a],binOptions:{cellSizePixels:o}})}return i.viewportChanged&&this.state.aggregator.setNeedsUpdate(),r}onAttributeChange(t){let{aggregator:r}=this.state;switch(t){case"positions":r.setNeedsUpdate();break;case"counts":r.setNeedsUpdate(0);break;default:}}renderLayers(){let{aggregator:t}=this.state,r=this.getSubLayerClass("cells",t5),n=t.getBins(),s=t.getResult(0);return new r(this.props,this.getSubLayerProps({id:"cell-layer"}),{data:{length:t.binCount,attributes:{getBin:n,getWeight:s}},dataComparator:(i,o)=>i.length===o.length,updateTriggers:{getBin:[n],getWeight:[s]},parameters:{depthWriteEnabled:!1,...this.props.parameters},colorDomain:()=>this.props.colorDomain||t.getResultDomain(0),extensions:[]})}getPickingInfo(t){let r=t.info,{index:n}=r;if(n>=0){let s=this.state.aggregator.getBin(n),i;s&&(i={col:s.id[0],row:s.id[1],value:s.value[0],count:s.count},s.pointIndices&&(i.pointIndices=s.pointIndices,i.points=Array.isArray(this.props.data)?s.pointIndices.map(o=>this.props.data[o]):[])),r.object=i}return r}};td.layerName="ScreenGridLayer";td.defaultProps=Uht;var r5=td;var Si=class{constructor(t,r){this.props={scaleType:"linear",lowerPercentile:0,upperPercentile:100},this.domain=null,this.cutoff=null,this.input=t,this.inputLength=r,this.attribute=t}getScalePercentile(){if(!this._percentile){let t=n5(this.input,this.inputLength);this._percentile=Vht(t)}return this._percentile}getScaleOrdinal(){if(!this._ordinal){let t=n5(this.input,this.inputLength);this._ordinal=zht(t)}return this._ordinal}getCutoff({scaleType:t,lowerPercentile:r,upperPercentile:n}){if(t==="quantile")return[r,n-1];if(r>0||n<100){let{domain:s}=this.getScalePercentile(),i=s[Math.floor(r)-1]??-1/0,o=s[Math.floor(n)-1]??1/0;if(t==="ordinal"){let{domain:a}=this.getScaleOrdinal();i=a.findIndex(c=>c>=i),o=a.findIndex(c=>c>o)-1,o===-2&&(o=a.length-1)}return[i,o]}return null}update(t){let r=this.props;if(t.scaleType!==r.scaleType)switch(t.scaleType){case"quantile":{let{attribute:n}=this.getScalePercentile();this.attribute=n,this.domain=[0,99];break}case"ordinal":{let{attribute:n,domain:s}=this.getScaleOrdinal();this.attribute=n,this.domain=[0,s.length-1];break}default:this.attribute=this.input,this.domain=null}return(t.scaleType!==r.scaleType||t.lowerPercentile!==r.lowerPercentile||t.upperPercentile!==r.upperPercentile)&&(this.cutoff=this.getCutoff(t)),this.props=t,this}};function zht(e){let t=new Set;for(let s of e)Number.isFinite(s)&&t.add(s);let r=Array.from(t).sort(),n=new Map;for(let s=0;s<r.length;s++)n.set(r[s],s);return{attribute:{value:e.map(s=>Number.isFinite(s)?n.get(s):NaN),type:"float32",size:1},domain:r}}function Vht(e,t=100){let r=Array.from(e).filter(Number.isFinite).sort(Hht),n=0,s=Math.max(1,t),i=new Array(s-1);for(;++n<s;)i[n-1]=Wht(r,n/s);return{attribute:{value:e.map(o=>Number.isFinite(o)?Ght(i,o):NaN),type:"float32",size:1},domain:i}}function n5(e,t){let r=(e.stride??4)/4,n=(e.offset??0)/4,s=e.value;if(!s){let o=e.buffer?.readSyncWebGL(0,r*4*t);o&&(s=new Float32Array(o.buffer),e.value=s)}if(r===1)return s.subarray(0,t);let i=new Float32Array(t);for(let o=0;o<t;o++)i[o]=s[o*r+n];return i}function Hht(e,t){return e-t}function Wht(e,t){let r=e.length;if(t<=0||r<2)return e[0];if(t>=1)return e[r-1];let n=(r-1)*t,s=Math.floor(n),i=e[s],o=e[s+1];return i+(o-i)*(n-s)}function Ght(e,t){let r=0,n=e.length;for(;r<n;){let s=r+n>>>1;e[s]>t?n=s:r=s+1}return r}function Jc({dataBounds:e,getBinId:t,padding:r=0}){let n=[e[0],e[1],[e[0][0],e[1][1]],[e[1][0],e[0][1]]].map(c=>t(c)),s=Math.min(...n.map(c=>c[0]))-r,i=Math.min(...n.map(c=>c[1]))-r,o=Math.max(...n.map(c=>c[0]))+r+1,a=Math.max(...n.map(c=>c[1]))+r+1;return[[s,o],[i,a]]}var s5=Math.PI/3,t_=2*Math.sin(s5),e_=1.5,i5=Array.from({length:6},(e,t)=>{let r=t*s5;return[Math.sin(r),-Math.cos(r)]});function r_([e,t],r){let n=Math.round(t=t/r/e_),s=Math.round(e=e/r/t_-(n&1)/2),i=t-n;if(Math.abs(i)*3>1){let o=e-s,a=s+(e<s?-1:1)/2,c=n+(t<n?-1:1),l=e-a,h=t-c;o*o+i*i>l*l+h*h&&(s=a+(n&1?1:-1)/2,n=c)}return[s,n]}var o5=`
  const vec2 DIST = vec2(${t_}, ${e_});
  
  ivec2 pointToHexbin(vec2 p, float radius) {
    p /= radius * DIST;
    float pj = round(p.y);
    float pjm2 = mod(pj, 2.0);
    p.x -= pjm2 * 0.5;
    float pi = round(p.x);
    vec2 d1 = p - vec2(pi, pj);
  
    if (abs(d1.y) * 3. > 1.) {
      vec2 v2 = step(0.0, d1) - 0.5;
      v2.y *= 2.0;
      vec2 d2 = d1 - v2;
      if (dot(d1, d1) > dot(d2, d2)) {
        pi += v2.x + pjm2 - 0.5;
        pj += v2.y;
      }
    }
    return ivec2(pi, pj);
  }
  `;function _b([e,t],r){return[(e+(t&1)/2)*r*t_,t*r*e_]}var a5=`
  const vec2 DIST = vec2(${t_}, ${e_});
  
  vec2 hexbinCentroid(vec2 binId, float radius) {
    binId.x += fract(binId.y * 0.5);
    return binId * DIST * radius;
  }
  `;var c5=`#version 300 es
  #define SHADER_NAME hexagon-cell-layer-vertex-shader
  in vec3 positions;
  in vec3 normals;
  in vec2 instancePositions;
  in float instanceElevationValues;
  in float instanceColorValues;
  in vec3 instancePickingColors;
  uniform sampler2D colorRange;
  out vec4 vColor;
  ${a5}
  float interp(float value, vec2 domain, vec2 range) {
  float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
  return mix(range.x, range.y, r);
  }
  vec4 interp(float value, vec2 domain, sampler2D range) {
  float r = (value - domain.x) / (domain.y - domain.x);
  return texture(range, vec2(r, 0.5));
  }
  void main(void) {
  geometry.pickingColor = instancePickingColors;
  if (isnan(instanceColorValues) ||
  instanceColorValues < hexagon.colorDomain.z ||
  instanceColorValues > hexagon.colorDomain.w ||
  instanceElevationValues < hexagon.elevationDomain.z ||
  instanceElevationValues > hexagon.elevationDomain.w
  ) {
  gl_Position = vec4(0.);
  return;
  }
  vec2 commonPosition = hexbinCentroid(instancePositions, column.radius) + (hexagon.originCommon - project.commonOrigin.xy);
  commonPosition += positions.xy * column.radius * column.coverage;
  geometry.position = vec4(commonPosition, 0.0, 1.0);
  geometry.normal = project_normal(normals);
  float elevation = 0.0;
  if (column.extruded) {
  elevation = interp(instanceElevationValues, hexagon.elevationDomain.xy, hexagon.elevationRange);
  elevation = project_size(elevation);
  geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
  }
  gl_Position = project_common_position_to_clipspace(geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  vColor = interp(instanceColorValues, hexagon.colorDomain.xy, colorRange);
  vColor.a *= layer.opacity;
  if (column.extruded) {
  vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
  }
  `;var jht=`uniform hexagonUniforms {
    vec4 colorDomain;
    vec4 elevationDomain;
    vec2 elevationRange;
    vec2 originCommon;
  } hexagon;
  `,l5={name:"hexagon",vs:jht,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>"}};var n_=class extends Tn{getShaders(){let t=super.getShaders();return t.modules.push(l5),{...t,vs:c5}}initializeState(){super.initializeState();let t=this.getAttributeManager();t.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),t.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(t){super.updateState(t);let{props:r,oldProps:n}=t,s=this.state.fillModel;if(n.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=Zc(this.context.device,r.colorRange,r.colorScaleType);let i={colorRange:this.state.colorTexture};s.shaderInputs.setProps({hexagon:i})}else n.colorScaleType!==r.colorScaleType&&Kc(this.state.colorTexture,r.colorScaleType)}finalizeState(t){super.finalizeState(t),this.state.colorTexture?.destroy()}draw({uniforms:t}){let{radius:r,hexOriginCommon:n,elevationRange:s,elevationScale:i,extruded:o,coverage:a,colorDomain:c,elevationDomain:l}=this.props,h=this.props.colorCutoff||[-1/0,1/0],f=this.props.elevationCutoff||[-1/0,1/0],u=this.state.fillModel;u.vertexArray.indexBuffer&&u.setIndexBuffer(null),u.setVertexCount(this.state.fillVertexCount);let d={colorDomain:[Math.max(c[0],h[0]),Math.min(c[1],h[1]),Math.max(c[0]-1,h[0]),Math.min(c[1]+1,h[1])],elevationDomain:[Math.max(l[0],f[0]),Math.min(l[1],f[1]),Math.max(l[0]-1,f[0]),Math.min(l[1]+1,f[1])],elevationRange:[s[0]*i,s[1]*i],originCommon:n};u.shaderInputs.setProps({column:{extruded:o,coverage:a,radius:r},hexagon:d}),u.draw(this.context.renderPass)}};n_.layerName="HexagonCellLayer";var h5=n_;var qht=`uniform binOptionsUniforms {
    vec2 hexOriginCommon;
    float radiusCommon;
  } binOptions;
  `,f5={name:"binOptions",vs:qht,uniformTypes:{hexOriginCommon:"vec2<f32>",radiusCommon:"f32"}};function u5(){}var Xht={gpuAggregation:!0,colorDomain:null,colorRange:bi,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:u5,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:u5,radius:{type:"number",min:1,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:e=>e.position},hexagonAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0},ed=class extends Ln{getAggregatorType(){let{gpuAggregation:t,hexagonAggregator:r,getColorValue:n,getElevationValue:s}=this.props;return t&&(r||n||s)?(k.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):t&&ne.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(t){if(t==="cpu"){let{hexagonAggregator:r,radius:n}=this.props;return new Ye({dimensions:2,getBin:{sources:["positions"],getValue:({positions:s},i,o)=>{if(r)return r(s,n);let c=this.state.aggregatorViewport.projectPosition(s),{radiusCommon:l,hexOriginCommon:h}=o;return r_([c[0]-h[0],c[1]-h[1]],l)}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:s})=>s},{sources:["elevationWeights"],getValue:({elevationWeights:s})=>s}]})}return new ne(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[st,f5],vs:`
    in vec3 positions;
    in vec3 positions64Low;
    in float colorWeights;
    in float elevationWeights;
    
    ${o5}
  
    void getBin(out ivec2 binId) {
      vec3 positionCommon = project_position(positions, positions64Low);
      binId = pointToHexbin(positionCommon.xy, binOptions.radiusCommon);
    }
    void getValue(out vec2 value) {
      value = vec2(colorWeights, elevationWeights);
    }
    `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(t){let r=super.updateState(t),{props:n,oldProps:s,changeFlags:i}=t,{aggregator:o}=this.state;if((i.dataChanged||!this.state.dataAsArray)&&(n.getColorValue||n.getElevationValue)&&(this.state.dataAsArray=Array.from(Yt(n.data).iterable)),r||i.dataChanged||n.radius!==s.radius||n.getColorValue!==s.getColorValue||n.getElevationValue!==s.getElevationValue||n.colorAggregation!==s.colorAggregation||n.elevationAggregation!==s.elevationAggregation){this._updateBinOptions();let{radiusCommon:a,hexOriginCommon:c,binIdRange:l,dataAsArray:h}=this.state;if(o.setProps({binIdRange:l,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{radiusCommon:a,hexOriginCommon:c},onUpdate:this._onAggregationUpdate.bind(this)}),h){let{getColorValue:f,getElevationValue:u}=this.props;o.setProps({customOperations:[f&&(d=>f(d.map(p=>h[p]),{indices:d,data:n.data})),u&&(d=>u(d.map(p=>h[p]),{indices:d,data:n.data}))]})}}return i.updateTriggersChanged&&i.updateTriggersChanged.getColorValue&&o.setNeedsUpdate(0),i.updateTriggersChanged&&i.updateTriggersChanged.getElevationValue&&o.setNeedsUpdate(1),r}_updateBinOptions(){let t=this.getBounds(),r=1,n=[0,0],s=[[0,1],[0,1]],i=this.context.viewport;if(t&&Number.isFinite(t[0][0])){let o=[(t[0][0]+t[1][0])/2,(t[0][1]+t[1][1])/2],{radius:a}=this.props,{unitsPerMeter:c}=i.getDistanceScales(o);r=c[0]*a;let l=r_(i.projectFlat(o),r);o=i.unprojectFlat(_b(l,r));let h=i.constructor;i=i.isGeospatial?new h({longitude:o[0],latitude:o[1],zoom:12}):new oe({position:[o[0],o[1],0],zoom:12}),n=[Math.fround(i.center[0]),Math.fround(i.center[1])],s=Jc({dataBounds:t,getBinId:f=>{let u=i.projectFlat(f);return u[0]-=n[0],u[1]-=n[1],r_(u,r)},padding:1})}this.setState({radiusCommon:r,hexOriginCommon:n,binIdRange:s,aggregatorViewport:i})}draw(t){t.shaderModuleProps.project&&(t.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(t)}_onAggregationUpdate({channel:t}){let r=this.getCurrentLayer().props,{aggregator:n}=this.state;if(t===0){let s=n.getResult(0);this.setState({colors:new Si(s,n.binCount)}),r.onSetColorDomain(n.getResultDomain(0))}else if(t===1){let s=n.getResult(1);this.setState({elevations:new Si(s,n.binCount)}),r.onSetElevationDomain(n.getResultDomain(1))}}onAttributeChange(t){let{aggregator:r}=this.state;switch(t){case"positions":r.setNeedsUpdate(),this._updateBinOptions();let{radiusCommon:n,hexOriginCommon:s,binIdRange:i}=this.state;r.setProps({binIdRange:i,binOptions:{radiusCommon:n,hexOriginCommon:s}});break;case"colorWeights":r.setNeedsUpdate(0);break;case"elevationWeights":r.setNeedsUpdate(1);break;default:}}renderLayers(){let{aggregator:t,radiusCommon:r,hexOriginCommon:n}=this.state,{elevationScale:s,colorRange:i,elevationRange:o,extruded:a,coverage:c,material:l,transitions:h,colorScaleType:f,lowerPercentile:u,upperPercentile:d,colorDomain:p,elevationScaleType:g,elevationLowerPercentile:m,elevationUpperPercentile:_,elevationDomain:y}=this.props,x=this.getSubLayerClass("cells",h5),A=t.getBins(),M=this.state.colors?.update({scaleType:f,lowerPercentile:u,upperPercentile:d}),E=this.state.elevations?.update({scaleType:g,lowerPercentile:m,upperPercentile:_});return!M||!E?null:new x(this.getSubLayerProps({id:"cells"}),{data:{length:t.binCount,attributes:{getBin:A,getColorValue:M.attribute,getElevationValue:E.attribute}},dataComparator:(w,v)=>w.length===v.length,updateTriggers:{getBin:[A],getColorValue:[M.attribute],getElevationValue:[E.attribute]},diskResolution:6,vertices:i5,radius:r,hexOriginCommon:n,elevationScale:s,colorRange:i,colorScaleType:f,elevationRange:o,extruded:a,coverage:c,material:l,colorDomain:M.domain||p||t.getResultDomain(0),elevationDomain:E.domain||y||t.getResultDomain(1),colorCutoff:M.cutoff,elevationCutoff:E.cutoff,transitions:h&&{getFillColor:h.getColorValue||h.getColorWeight,getElevation:h.getElevationValue||h.getElevationWeight},extensions:[]})}getPickingInfo(t){let r=t.info,{index:n}=r;if(n>=0){let s=this.state.aggregator.getBin(n),i;if(s){let o=_b(s.id,this.state.radiusCommon),a=this.context.viewport.unprojectFlat(o);i={col:s.id[0],row:s.id[1],position:a,colorValue:s.value[0],elevationValue:s.value[1],count:s.count},s.pointIndices&&(i.pointIndices=s.pointIndices,i.points=Array.isArray(this.props.data)?s.pointIndices.map(c=>this.props.data[c]):[])}r.object=i}return r}};ed.layerName="HexagonLayer";ed.defaultProps=Xht;var d5=ed;var G=.16666666666666666,L={N:[0,.5],E:[.5,0],S:[0,-.5],W:[-.5,0],NE:[.5,.5],NW:[-.5,.5],SE:[.5,-.5],SW:[-.5,-.5]},Qc=[L.W,L.SW,L.S],tl=[L.S,L.SE,L.E],el=[L.E,L.NE,L.N],rl=[L.NW,L.W,L.N],nl=[[-.5,G],[-.5,-G],[-G,-.5],[G,-.5]],sl=[[-G,-.5],[G,-.5],[.5,-G],[.5,G]],il=[[.5,-G],[.5,G],[G,.5],[-G,.5]],ol=[[-.5,G],[-.5,-G],[G,.5],[-G,.5]],p5=[L.W,L.SW,L.SE,L.E],g5=[L.S,L.SE,L.NE,L.N],m5=[L.NW,L.W,L.E,L.NE],_5=[L.NW,L.SW,L.S,L.N],x5=[[-.5,G],[-.5,-G],[.5,-G],[.5,G]],y5=[[-G,-.5],[G,-.5],[G,.5],[-G,.5]],Yht=[L.NW,L.SW,L.SE,L.NE],A5=[L.NW,L.SW,L.SE,L.E,L.N],T5=[L.W,L.SW,L.SE,L.NE,L.N],M5=[L.NW,L.W,L.S,L.SE,L.NE],E5=[L.NW,L.SW,L.S,L.E,L.NE],b5=[L.NW,L.W,[.5,-G],[.5,G],L.N],S5=[[-G,-.5],[G,-.5],L.E,L.NE,L.N],v5=[[-.5,G],[-.5,-G],L.S,L.SE,L.E],w5=[L.W,L.SW,L.S,[G,.5],[-G,.5]],C5=[L.NW,L.W,[-G,-.5],[G,-.5],L.N],P5=[[-.5,G],[-.5,-G],L.E,L.NE,L.N],R5=[L.S,L.SE,L.E,[G,.5],[-G,.5]],I5=[L.W,L.SW,L.S,[.5,-G],[.5,G]],O5=[L.W,L.SW,L.SE,L.E,[G,.5],[-G,.5]],L5=[[-.5,G],[-.5,-G],L.S,L.SE,L.NE,L.N],N5=[L.NW,L.W,[-G,-.5],[G,-.5],L.E,L.NE],B5=[L.NW,L.SW,L.S,[.5,-G],[.5,G],L.N],al=[L.W,L.SW,L.S,L.E,L.NE,L.N],cl=[L.NW,L.W,L.S,L.SE,L.E,L.N],s_=[[-.5,G],[-.5,-G],[-G,-.5],[G,-.5],L.E,L.NE,L.N],i_=[L.W,L.SW,L.S,[.5,-G],[.5,G],[G,.5],[-G,.5]],o_=[L.NW,L.W,[-G,-.5],[G,-.5],[.5,-G],[.5,G],L.N],a_=[[-.5,G],[-.5,-G],L.S,L.SE,L.E,[G,.5],[-G,.5]],F5=[[-.5,G],[-.5,-G],[-G,-.5],[G,-.5],[.5,-G],[.5,G],[G,.5],[-G,.5]],D5={0:[],1:[[L.W,L.S]],2:[[L.S,L.E]],3:[[L.W,L.E]],4:[[L.N,L.E]],5:{0:[[L.W,L.S],[L.N,L.E]],1:[[L.W,L.N],[L.S,L.E]]},6:[[L.N,L.S]],7:[[L.W,L.N]],8:[[L.W,L.N]],9:[[L.N,L.S]],10:{0:[[L.W,L.N],[L.S,L.E]],1:[[L.W,L.S],[L.N,L.E]]},11:[[L.N,L.E]],12:[[L.W,L.E]],13:[[L.S,L.E]],14:[[L.W,L.S]],15:[]};function z(e){return parseInt(e,4)}var k5={[z("0000")]:[],[z("2222")]:[],[z("2221")]:[Qc],[z("2212")]:[tl],[z("2122")]:[el],[z("1222")]:[rl],[z("0001")]:[Qc],[z("0010")]:[tl],[z("0100")]:[el],[z("1000")]:[rl],[z("2220")]:[nl],[z("2202")]:[sl],[z("2022")]:[il],[z("0222")]:[ol],[z("0002")]:[nl],[z("0020")]:[sl],[z("0200")]:[il],[z("2000")]:[ol],[z("0011")]:[p5],[z("0110")]:[g5],[z("1100")]:[m5],[z("1001")]:[_5],[z("2211")]:[p5],[z("2112")]:[g5],[z("1122")]:[m5],[z("1221")]:[_5],[z("2200")]:[x5],[z("2002")]:[y5],[z("0022")]:[x5],[z("0220")]:[y5],[z("1111")]:[Yht],[z("1211")]:[A5],[z("2111")]:[T5],[z("1112")]:[M5],[z("1121")]:[E5],[z("1011")]:[A5],[z("0111")]:[T5],[z("1110")]:[M5],[z("1101")]:[E5],[z("1200")]:[b5],[z("0120")]:[S5],[z("0012")]:[v5],[z("2001")]:[w5],[z("1022")]:[b5],[z("2102")]:[S5],[z("2210")]:[v5],[z("0221")]:[w5],[z("1002")]:[C5],[z("2100")]:[P5],[z("0210")]:[R5],[z("0021")]:[I5],[z("1220")]:[C5],[z("0122")]:[P5],[z("2012")]:[R5],[z("2201")]:[I5],[z("0211")]:[O5],[z("2110")]:[L5],[z("1102")]:[N5],[z("1021")]:[B5],[z("2011")]:[O5],[z("0112")]:[L5],[z("1120")]:[N5],[z("1201")]:[B5],[z("2101")]:[al],[z("0121")]:[al],[z("1012")]:[cl],[z("1210")]:[cl],[z("0101")]:{0:[Qc,el],1:[al],2:[al]},[z("1010")]:{0:[rl,tl],1:[cl],2:[cl]},[z("2121")]:{0:[al],1:[al],2:[Qc,el]},[z("1212")]:{0:[cl],1:[cl],2:[rl,tl]},[z("2120")]:{0:[s_],1:[s_],2:[nl,el]},[z("2021")]:{0:[i_],1:[i_],2:[Qc,il]},[z("1202")]:{0:[o_],1:[o_],2:[rl,sl]},[z("0212")]:{0:[a_],1:[a_],2:[tl,ol]},[z("0102")]:{0:[nl,el],1:[s_],2:[s_]},[z("0201")]:{0:[Qc,il],1:[i_],2:[i_]},[z("1020")]:{0:[rl,sl],1:[o_],2:[o_]},[z("2010")]:{0:[tl,ol],1:[a_],2:[a_]},[z("2020")]:{0:[ol,sl],1:[F5],2:[nl,il]},[z("0202")]:{0:[il,nl],1:[F5],2:[ol,sl]}};function rd(e,t){return Number.isNaN(e)?0:Array.isArray(t)?e<t[0]?0:e<t[1]?1:2:e>=t?1:0}function U5(e){let{x:t,y:r,xRange:n,yRange:s,getValue:i,threshold:o}=e,a=t<n[0],c=t>=n[1]-1,l=r<s[0],h=r>=s[1]-1,f=a||c||l||h,u=0,d,p,g,m;if(a||h)g=0;else{let x=i(t,r+1);g=rd(x,o),u+=x}if(c||h)m=0;else{let x=i(t+1,r+1);m=rd(x,o),u+=x}if(c||l)p=0;else{let x=i(t+1,r);p=rd(x,o),u+=x}if(a||l)d=0;else{let x=i(t,r);d=rd(x,o),u+=x}let _=-1;Number.isFinite(o)&&(_=g<<3|m<<2|p<<1|d),Array.isArray(o)&&(_=g<<6|m<<4|p<<2|d);let y=0;return f||(y=rd(u/4,o)),{code:_,meanCode:y}}function z5(e){let{x:t,y:r,z:n,code:s,meanCode:i}=e,o=k5[s];Array.isArray(o)||(o=o[i]);let a=t+1,c=r+1,l=[];return o.forEach(h=>{let f=[];h.forEach(u=>{let d=a+u[0],p=c+u[1];f.push([d,p,n])}),l.push(f)}),l}function V5(e){let{x:t,y:r,z:n,code:s,meanCode:i}=e,o=D5[s];Array.isArray(o)||(o=o[i]);let a=t+1,c=r+1,l=[];return o.forEach(h=>{h.forEach(f=>{let u=a+f[0],d=c+f[1];l.push([u,d,n])})}),l}function H5({contours:e,getValue:t,xRange:r,yRange:n}){let s=[],i=[],o=0,a=0;for(let c=0;c<e.length;c++){let l=e[c],h=l.zIndex??c,{threshold:f}=l;for(let u=r[0]-1;u<r[1];u++)for(let d=n[0]-1;d<n[1];d++){let{code:p,meanCode:g}=U5({getValue:t,threshold:f,x:u,y:d,xRange:r,yRange:n}),m={x:u,y:d,z:h,code:p,meanCode:g};if(Array.isArray(f)){let _=z5(m);for(let y of _)i[a++]={vertices:y,contour:l}}else{let _=V5(m);_.length>0&&(s[o++]={vertices:_,contour:l})}}}return{lines:s,polygons:i}}function W5(e){let{aggregator:t,binIdRange:r,channel:n}=e;if(t instanceof ne){let s=t.getResult(n)?.buffer;if(s){let i=new Float32Array(s.readSyncWebGL().buffer);return $ht(i,r)}}if(t instanceof Ye){let s=t.getResult(n)?.value,i=t.getBins()?.value;if(i&&s)return Kht(s,i,t.binCount)}return null}function $ht(e,t){let[[r,n],[s,i]]=t,o=n-r,a=i-s;return(c,l)=>(c-=r,l-=s,c<0||c>=o||l<0||l>=a?NaN:e[l*o+c])}function Kht(e,t,r){let n={};for(let s=0;s<r;s++){let i=t[s*2],o=t[s*2+1];n[i]=n[i]||{},n[i][o]=e[s]}return(s,i)=>n[s]?.[i]??NaN}var Zht=`uniform binOptionsUniforms {
    vec2 cellOriginCommon;
    vec2 cellSizeCommon;
  } binOptions;
  `,G5={name:"binOptions",vs:Zht,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};var j5=[255,255,255,255],Jht=1,Qht={cellSize:{type:"number",min:1,value:1e3},gridOrigin:{type:"array",compare:!0,value:[0,0]},getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},gpuAggregation:!0,aggregation:"SUM",contours:{type:"object",value:[{threshold:1}],optional:!0,compare:3},zOffset:.005},nd=class extends Ln{getAggregatorType(){return this.props.gpuAggregation&&ne.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(t){return t==="cpu"?new Ye({dimensions:2,getBin:{sources:["positions"],getValue:({positions:r},n,s)=>{let o=this.state.aggregatorViewport.projectPosition(r),{cellSizeCommon:a,cellOriginCommon:c}=s;return[Math.floor((o[0]-c[0])/a[0]),Math.floor((o[1]-c[1])/a[1])]}},getValue:[{sources:["counts"],getValue:({counts:r})=>r}],onUpdate:this._onAggregationUpdate.bind(this)}):new ne(this.context.device,{dimensions:2,channelCount:1,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[st,G5],vs:`
    in vec3 positions;
    in vec3 positions64Low;
    in float counts;
  
    void getBin(out ivec2 binId) {
      vec3 positionCommon = project_position(positions, positions64Low);
      vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
      binId = ivec2(gridCoords);
    }
    void getValue(out float value) {
      value = counts;
    }
    `}),onUpdate:this._onAggregationUpdate.bind(this)})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},counts:{size:1,accessor:"getWeight"}})}updateState(t){let r=super.updateState(t),{props:n,oldProps:s,changeFlags:i}=t,{aggregator:o}=this.state;if(r||i.dataChanged||n.cellSize!==s.cellSize||!tt(n.gridOrigin,s.gridOrigin,1)||n.aggregation!==s.aggregation){this._updateBinOptions();let{cellSizeCommon:a,cellOriginCommon:c,binIdRange:l}=this.state;o.setProps({binIdRange:l,pointCount:this.getNumInstances(),operations:[n.aggregation],binOptions:{cellSizeCommon:a,cellOriginCommon:c}})}return tt(s.contours,n.contours,2)||this.setState({contourData:null}),r}_updateBinOptions(){let t=this.getBounds(),r=[1,1],n=[0,0],s=[[0,1],[0,1]],i=this.context.viewport;if(t&&Number.isFinite(t[0][0])){let o=[(t[0][0]+t[1][0])/2,(t[0][1]+t[1][1])/2],{cellSize:a,gridOrigin:c}=this.props,{unitsPerMeter:l}=i.getDistanceScales(o);r[0]=l[0]*a,r[1]=l[1]*a;let h=i.projectFlat(o);n=[Math.floor((h[0]-c[0])/r[0])*r[0]+c[0],Math.floor((h[1]-c[1])/r[1])*r[1]+c[1]],o=i.unprojectFlat(n);let f=i.constructor;i=i.isGeospatial?new f({longitude:o[0],latitude:o[1],zoom:12}):new oe({position:[o[0],o[1],0],zoom:12}),n=[Math.fround(i.center[0]),Math.fround(i.center[1])],s=Jc({dataBounds:t,getBinId:u=>{let d=i.projectFlat(u);return[Math.floor((d[0]-n[0])/r[0]),Math.floor((d[1]-n[1])/r[1])]}})}this.setState({cellSizeCommon:r,cellOriginCommon:n,binIdRange:s,aggregatorViewport:i})}draw(t){t.shaderModuleProps.project&&(t.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(t)}_onAggregationUpdate(){let{aggregator:t,binIdRange:r}=this.state;this.setState({aggregatedValueReader:W5({aggregator:t,binIdRange:r,channel:0}),contourData:null})}_getContours(){let{aggregatedValueReader:t}=this.state;if(!t)return null;if(!this.state.contourData){let{binIdRange:r}=this.state,{contours:n}=this.props,s=H5({contours:n,getValue:t,xRange:r[0],yRange:r[1]});this.state.contourData=s}return this.state.contourData}onAttributeChange(t){let{aggregator:r}=this.state;switch(t){case"positions":r.setNeedsUpdate(),this._updateBinOptions();let{cellSizeCommon:n,cellOriginCommon:s,binIdRange:i}=this.state;r.setProps({binIdRange:i,binOptions:{cellSizeCommon:n,cellOriginCommon:s}});break;case"counts":r.setNeedsUpdate(0);break;default:}}renderLayers(){let t=this._getContours();if(!t)return null;let{lines:r,polygons:n}=t,{zOffset:s}=this.props,{cellOriginCommon:i,cellSizeCommon:o}=this.state,a=this.getSubLayerClass("lines",Mn),c=this.getSubLayerClass("bands",ti),l=new $().translate([i[0],i[1],0]).scale([o[0],o[1],s]),h=r&&r.length>0&&new a(this.getSubLayerProps({id:"lines"}),{data:r,coordinateSystem:W.CARTESIAN,modelMatrix:l,getPath:u=>u.vertices,getColor:u=>u.contour.color??j5,getWidth:u=>u.contour.strokeWidth??Jht,widthUnits:"pixels"}),f=n&&n.length>0&&new c(this.getSubLayerProps({id:"bands"}),{data:n,coordinateSystem:W.CARTESIAN,modelMatrix:l,getPolygon:u=>u.vertices,getFillColor:u=>u.contour.color??j5});return[h,f]}getPickingInfo(t){let r=t.info,{object:n}=r;return n&&(r.object={contour:n.contour}),r}};nd.layerName="ContourLayer";nd.defaultProps=Qht;var q5=nd;var X5=`#version 300 es
  #define SHADER_NAME grid-cell-layer-vertex-shader
  in vec3 positions;
  in vec3 normals;
  in vec2 instancePositions;
  in float instanceElevationValues;
  in float instanceColorValues;
  in vec3 instancePickingColors;
  uniform sampler2D colorRange;
  out vec4 vColor;
  float interp(float value, vec2 domain, vec2 range) {
  float r = min(max((value - domain.x) / (domain.y - domain.x), 0.), 1.);
  return mix(range.x, range.y, r);
  }
  vec4 interp(float value, vec2 domain, sampler2D range) {
  float r = (value - domain.x) / (domain.y - domain.x);
  return texture(range, vec2(r, 0.5));
  }
  void main(void) {
  geometry.pickingColor = instancePickingColors;
  if (isnan(instanceColorValues) ||
  instanceColorValues < grid.colorDomain.z ||
  instanceColorValues > grid.colorDomain.w ||
  instanceElevationValues < grid.elevationDomain.z ||
  instanceElevationValues > grid.elevationDomain.w
  ) {
  gl_Position = vec4(0.);
  return;
  }
  vec2 commonPosition = (instancePositions + (positions.xy + 1.0) / 2.0 * column.coverage) * grid.sizeCommon + grid.originCommon - project.commonOrigin.xy;
  geometry.position = vec4(commonPosition, 0.0, 1.0);
  geometry.normal = project_normal(normals);
  float elevation = 0.0;
  if (column.extruded) {
  elevation = interp(instanceElevationValues, grid.elevationDomain.xy, grid.elevationRange);
  elevation = project_size(elevation);
  geometry.position.z = (positions.z + 1.0) / 2.0 * elevation;
  }
  gl_Position = project_common_position_to_clipspace(geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  vColor = interp(instanceColorValues, grid.colorDomain.xy, colorRange);
  vColor.a *= layer.opacity;
  if (column.extruded) {
  vColor.rgb = lighting_getLightColor(vColor.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
  }
  `;var tft=`uniform gridUniforms {
    vec4 colorDomain;
    vec4 elevationDomain;
    vec2 elevationRange;
    vec2 originCommon;
    vec2 sizeCommon;
  } grid;
  `,Y5={name:"grid",vs:tft,uniformTypes:{colorDomain:"vec4<f32>",elevationDomain:"vec4<f32>",elevationRange:"vec2<f32>",originCommon:"vec2<f32>",sizeCommon:"vec2<f32>"}};var sd=class extends Tn{getShaders(){let t=super.getShaders();return t.modules.push(Y5),{...t,vs:X5}}initializeState(){super.initializeState();let t=this.getAttributeManager();t.remove(["instanceElevations","instanceFillColors","instanceLineColors","instanceStrokeWidths"]),t.addInstanced({instancePositions:{size:2,type:"float32",accessor:"getBin"},instanceColorValues:{size:1,type:"float32",accessor:"getColorValue"},instanceElevationValues:{size:1,type:"float32",accessor:"getElevationValue"}})}updateState(t){super.updateState(t);let{props:r,oldProps:n}=t,s=this.state.fillModel;if(n.colorRange!==r.colorRange){this.state.colorTexture?.destroy(),this.state.colorTexture=Zc(this.context.device,r.colorRange,r.colorScaleType);let i={colorRange:this.state.colorTexture};s.shaderInputs.setProps({grid:i})}else n.colorScaleType!==r.colorScaleType&&Kc(this.state.colorTexture,r.colorScaleType)}finalizeState(t){super.finalizeState(t),this.state.colorTexture?.destroy()}_updateGeometry(){let t=new Yn;this.state.fillModel.setGeometry(t)}draw({uniforms:t}){let{cellOriginCommon:r,cellSizeCommon:n,elevationRange:s,elevationScale:i,extruded:o,coverage:a,colorDomain:c,elevationDomain:l}=this.props,h=this.props.colorCutoff||[-1/0,1/0],f=this.props.elevationCutoff||[-1/0,1/0],u=this.state.fillModel,d={colorDomain:[Math.max(c[0],h[0]),Math.min(c[1],h[1]),Math.max(c[0]-1,h[0]),Math.min(c[1]+1,h[1])],elevationDomain:[Math.max(l[0],f[0]),Math.min(l[1],f[1]),Math.max(l[0]-1,f[0]),Math.min(l[1]+1,f[1])],elevationRange:[s[0]*i,s[1]*i],originCommon:r,sizeCommon:n};u.shaderInputs.setProps({column:{extruded:o,coverage:a},grid:d}),u.draw(this.context.renderPass)}};sd.layerName="GridCellLayer";var eft=`uniform binOptionsUniforms {
    vec2 cellOriginCommon;
    vec2 cellSizeCommon;
  } binOptions;
  `,$5={name:"binOptions",vs:eft,uniformTypes:{cellOriginCommon:"vec2<f32>",cellSizeCommon:"vec2<f32>"}};function K5(){}var rft={gpuAggregation:!0,colorDomain:null,colorRange:bi,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:1},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},colorScaleType:"quantize",onSetColorDomain:K5,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:1},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScaleType:"linear",onSetElevationDomain:K5,cellSize:{type:"number",min:0,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:e=>e.position},gridAggregator:{type:"function",optional:!0,value:null},extruded:!1,material:!0},id=class extends Ln{getAggregatorType(){let{gpuAggregation:t,gridAggregator:r,getColorValue:n,getElevationValue:s}=this.props;return t&&(r||n||s)?(k.warn("Features not supported by GPU aggregation, falling back to CPU")(),"cpu"):t&&ne.isSupported(this.context.device)?"gpu":"cpu"}createAggregator(t){if(t==="cpu"){let{gridAggregator:r,cellSize:n}=this.props;return new Ye({dimensions:2,getBin:{sources:["positions"],getValue:({positions:s},i,o)=>{if(r)return r(s,n);let c=this.state.aggregatorViewport.projectPosition(s),{cellSizeCommon:l,cellOriginCommon:h}=o;return[Math.floor((c[0]-h[0])/l[0]),Math.floor((c[1]-h[1])/l[1])]}},getValue:[{sources:["colorWeights"],getValue:({colorWeights:s})=>s},{sources:["elevationWeights"],getValue:({elevationWeights:s})=>s}]})}return new ne(this.context.device,{dimensions:2,channelCount:2,bufferLayout:this.getAttributeManager().getBufferLayouts({isInstanced:!1}),...super.getShaders({modules:[st,$5],vs:`
    in vec3 positions;
    in vec3 positions64Low;
    in float colorWeights;
    in float elevationWeights;
  
    void getBin(out ivec2 binId) {
      vec3 positionCommon = project_position(positions, positions64Low);
      vec2 gridCoords = floor(positionCommon.xy / binOptions.cellSizeCommon);
      binId = ivec2(gridCoords);
    }
    void getValue(out vec2 value) {
      value = vec2(colorWeights, elevationWeights);
    }
    `})})}initializeState(){super.initializeState(),this.getAttributeManager().add({positions:{size:3,accessor:"getPosition",type:"float64",fp64:this.use64bitPositions()},colorWeights:{size:1,accessor:"getColorWeight"},elevationWeights:{size:1,accessor:"getElevationWeight"}})}updateState(t){let r=super.updateState(t),{props:n,oldProps:s,changeFlags:i}=t,{aggregator:o}=this.state;if((i.dataChanged||!this.state.dataAsArray)&&(n.getColorValue||n.getElevationValue)&&(this.state.dataAsArray=Array.from(Yt(n.data).iterable)),r||i.dataChanged||n.cellSize!==s.cellSize||n.getColorValue!==s.getColorValue||n.getElevationValue!==s.getElevationValue||n.colorAggregation!==s.colorAggregation||n.elevationAggregation!==s.elevationAggregation){this._updateBinOptions();let{cellSizeCommon:a,cellOriginCommon:c,binIdRange:l,dataAsArray:h}=this.state;if(o.setProps({binIdRange:l,pointCount:this.getNumInstances(),operations:[n.colorAggregation,n.elevationAggregation],binOptions:{cellSizeCommon:a,cellOriginCommon:c},onUpdate:this._onAggregationUpdate.bind(this)}),h){let{getColorValue:f,getElevationValue:u}=this.props;o.setProps({customOperations:[f&&(d=>f(d.map(p=>h[p]),{indices:d,data:n.data})),u&&(d=>u(d.map(p=>h[p]),{indices:d,data:n.data}))]})}}return i.updateTriggersChanged&&i.updateTriggersChanged.getColorValue&&o.setNeedsUpdate(0),i.updateTriggersChanged&&i.updateTriggersChanged.getElevationValue&&o.setNeedsUpdate(1),r}_updateBinOptions(){let t=this.getBounds(),r=[1,1],n=[0,0],s=[[0,1],[0,1]],i=this.context.viewport;if(t&&Number.isFinite(t[0][0])){let o=[(t[0][0]+t[1][0])/2,(t[0][1]+t[1][1])/2],{cellSize:a}=this.props,{unitsPerMeter:c}=i.getDistanceScales(o);r[0]=c[0]*a,r[1]=c[1]*a;let l=i.projectFlat(o);n=[Math.floor(l[0]/r[0])*r[0],Math.floor(l[1]/r[1])*r[1]],o=i.unprojectFlat(n);let h=i.constructor;i=i.isGeospatial?new h({longitude:o[0],latitude:o[1],zoom:12}):new oe({position:[o[0],o[1],0],zoom:12}),n=[Math.fround(i.center[0]),Math.fround(i.center[1])],s=Jc({dataBounds:t,getBinId:f=>{let u=i.projectFlat(f);return[Math.floor((u[0]-n[0])/r[0]),Math.floor((u[1]-n[1])/r[1])]}})}this.setState({cellSizeCommon:r,cellOriginCommon:n,binIdRange:s,aggregatorViewport:i})}draw(t){t.shaderModuleProps.project&&(t.shaderModuleProps.project.viewport=this.state.aggregatorViewport),super.draw(t)}_onAggregationUpdate({channel:t}){let r=this.getCurrentLayer().props,{aggregator:n}=this.state;if(t===0){let s=n.getResult(0);this.setState({colors:new Si(s,n.binCount)}),r.onSetColorDomain(n.getResultDomain(0))}else if(t===1){let s=n.getResult(1);this.setState({elevations:new Si(s,n.binCount)}),r.onSetElevationDomain(n.getResultDomain(1))}}onAttributeChange(t){let{aggregator:r}=this.state;switch(t){case"positions":r.setNeedsUpdate(),this._updateBinOptions();let{cellSizeCommon:n,cellOriginCommon:s,binIdRange:i}=this.state;r.setProps({binIdRange:i,binOptions:{cellSizeCommon:n,cellOriginCommon:s}});break;case"colorWeights":r.setNeedsUpdate(0);break;case"elevationWeights":r.setNeedsUpdate(1);break;default:}}renderLayers(){let{aggregator:t,cellOriginCommon:r,cellSizeCommon:n}=this.state,{elevationScale:s,colorRange:i,elevationRange:o,extruded:a,coverage:c,material:l,transitions:h,colorScaleType:f,lowerPercentile:u,upperPercentile:d,colorDomain:p,elevationScaleType:g,elevationLowerPercentile:m,elevationUpperPercentile:_,elevationDomain:y}=this.props,x=this.getSubLayerClass("cells",sd),A=t.getBins(),M=this.state.colors?.update({scaleType:f,lowerPercentile:u,upperPercentile:d}),E=this.state.elevations?.update({scaleType:g,lowerPercentile:m,upperPercentile:_});return!M||!E?null:new x(this.getSubLayerProps({id:"cells"}),{data:{length:t.binCount,attributes:{getBin:A,getColorValue:M.attribute,getElevationValue:E.attribute}},dataComparator:(w,v)=>w.length===v.length,updateTriggers:{getBin:[A],getColorValue:[M.attribute],getElevationValue:[E.attribute]},cellOriginCommon:r,cellSizeCommon:n,elevationScale:s,colorRange:i,colorScaleType:f,elevationRange:o,extruded:a,coverage:c,material:l,colorDomain:M.domain||p||t.getResultDomain(0),elevationDomain:E.domain||y||t.getResultDomain(1),colorCutoff:M.cutoff,elevationCutoff:E.cutoff,transitions:h&&{getFillColor:h.getColorValue||h.getColorWeight,getElevation:h.getElevationValue||h.getElevationWeight},extensions:[]})}getPickingInfo(t){let r=t.info,{index:n}=r;if(n>=0){let s=this.state.aggregator.getBin(n),i;s&&(i={col:s.id[0],row:s.id[1],colorValue:s.value[0],elevationValue:s.value[1],count:s.count},s.pointIndices&&(i.pointIndices=s.pointIndices,i.points=Array.isArray(this.props.data)?s.pointIndices.map(o=>this.props.data[o]):[])),r.object=i}return r}};id.layerName="GridLayer";id.defaultProps=rft;var Z5=id;function Q5(e){let t=e.map(a=>a[0]),r=e.map(a=>a[1]),n=Math.min.apply(null,t),s=Math.max.apply(null,t),i=Math.min.apply(null,r),o=Math.max.apply(null,r);return[n,i,s,o]}function t8(e,t){return t[0]>=e[0]&&t[2]<=e[2]&&t[1]>=e[1]&&t[3]<=e[3]}var J5=new Float32Array(12);function xb(e,t=2){let r=0;for(let n of e)for(let s=0;s<t;s++)J5[r++]=n[s]||0;return J5}function e8(e,t,r){let[n,s,i,o]=e,a=i-n,c=o-s,l=a,h=c;a/c<t/r?l=t/r*c:h=r/t*a,l<t&&(l=t,h=r);let f=(i+n)/2,u=(o+s)/2;return[f-l/2,u-h/2,f+l/2,u+h/2]}function r8(e,t){let[r,n,s,i]=t;return[(e[0]-r)/(s-r),(e[1]-n)/(i-n)]}var n8=`#version 300 es
  #define SHADER_NAME heatp-map-layer-vertex-shader
  uniform sampler2D maxTexture;
  in vec3 positions;
  in vec2 texCoords;
  out vec2 vTexCoords;
  out float vIntensityMin;
  out float vIntensityMax;
  void main(void) {
  gl_Position = project_position_to_clipspace(positions, vec3(0.0), vec3(0.0));
  vTexCoords = texCoords;
  vec4 maxTexture = texture(maxTexture, vec2(0.5));
  float maxValue = triangle.aggregationMode < 0.5 ? maxTexture.r : maxTexture.g;
  float minValue = maxValue * triangle.threshold;
  if (triangle.colorDomain[1] > 0.) {
  maxValue = triangle.colorDomain[1];
  minValue = triangle.colorDomain[0];
  }
  vIntensityMax = triangle.intensity / maxValue;
  vIntensityMin = triangle.intensity / minValue;
  }
  `;var s8=`#version 300 es
  #define SHADER_NAME triangle-layer-fragment-shader
  precision highp float;
  uniform sampler2D weightsTexture;
  uniform sampler2D colorTexture;
  in vec2 vTexCoords;
  in float vIntensityMin;
  in float vIntensityMax;
  out vec4 fragColor;
  vec4 getLinearColor(float value) {
  float factor = clamp(value * vIntensityMax, 0., 1.);
  vec4 color = texture(colorTexture, vec2(factor, 0.5));
  color.a *= min(value * vIntensityMin, 1.0);
  return color;
  }
  void main(void) {
  vec4 weights = texture(weightsTexture, vTexCoords);
  float weight = weights.r;
  if (triangle.aggregationMode > 0.5) {
  weight /= max(1.0, weights.a);
  }
  if (weight <= 0.) {
  discard;
  }
  vec4 linearColor = getLinearColor(weight);
  linearColor.a *= layer.opacity;
  fragColor = linearColor;
  }
  `;var i8=`uniform triangleUniforms {
    float aggregationMode;
    vec2 colorDomain;
    float intensity;
    float threshold;
  } triangle;
  `,o8={name:"triangle",vs:i8,fs:i8,uniformTypes:{aggregationMode:"f32",colorDomain:"vec2<f32>",intensity:"f32",threshold:"f32"}};var c_=class extends ut{getShaders(){return super.getShaders({vs:n8,fs:s8,modules:[st,o8]})}initializeState({device:t}){this.setState({model:this._getModel(t)})}_getModel(t){let{vertexCount:r,data:n}=this.props;return new Y(t,{...this.getShaders(),id:this.props.id,attributes:n.attributes,bufferLayout:[{name:"positions",format:"float32x3"},{name:"texCoords",format:"float32x2"}],topology:"triangle-strip",vertexCount:r})}draw(){let{model:t}=this.state,{aggregationMode:r,colorDomain:n,intensity:s,threshold:i,colorTexture:o,maxTexture:a,weightsTexture:c}=this.props,l={aggregationMode:r,colorDomain:n,intensity:s,threshold:i,colorTexture:o,maxTexture:a,weightsTexture:c};t.shaderInputs.setProps({triangle:l}),t.draw(this.context.renderPass)}};c_.layerName="TriangleLayer";var a8=c_;function c8(e,t){let r={};for(let n in e)t.includes(n)||(r[n]=e[n]);return r}var l_=class extends Ft{initializeAggregationLayer(t){super.initializeState(this.context),this.setState({ignoreProps:c8(this.constructor._propTypes,t.data.props),dimensions:t})}updateState(t){super.updateState(t);let{changeFlags:r}=t;if(r.extensionsChanged){let n=this.getShaders({});n&&n.defines&&(n.defines.NON_INSTANCED_MODEL=1),this.updateShaders(n)}this._updateAttributes()}updateAttributes(t){this.setState({changedAttributes:t})}getAttributes(){return this.getAttributeManager().getAttributes()}getModuleSettings(){let{viewport:t,mousePosition:r,device:n}=this.context;return Object.assign(Object.create(this.props),{viewport:t,mousePosition:r,picking:{isActive:0},devicePixelRatio:n.canvasContext.cssToDeviceRatio()})}updateShaders(t){}isAggregationDirty(t,r={}){let{props:n,oldProps:s,changeFlags:i}=t,{compareAll:o=!1,dimension:a}=r,{ignoreProps:c}=this.state,{props:l,accessors:h=[]}=a,{updateTriggersChanged:f}=i;if(i.dataChanged)return!0;if(f){if(f.all)return!0;for(let u of h)if(f[u])return!0}if(o)return i.extensionsChanged?!0:Ha({oldProps:s,newProps:n,ignoreProps:c,propTypes:this.constructor._propTypes});for(let u of l)if(n[u]!==s[u])return!0;return!1}isAttributeChanged(t){let{changedAttributes:r}=this.state;return t?r&&r[t]!==void 0:!nft(r)}_getAttributeManager(){return new ur(this.context.device,{id:this.props.id,stats:this.context.stats})}};l_.layerName="AggregationLayer";var l8=l_;function nft(e){let t=!0;for(let r in e){t=!1;break}return t}var yb=`#version 300 es
  in vec3 positions;
  in vec3 positions64Low;
  in float weights;
  out vec4 weightsTexture;
  void main()
  {
  weightsTexture = vec4(weights * weight.weightsScale, 0., 0., 1.);
  float radiusTexels = project_pixel_size(weight.radiusPixels) * weight.textureWidth / (weight.commonBounds.z - weight.commonBounds.x);
  gl_PointSize = radiusTexels * 2.;
  vec3 commonPosition = project_position(positions, positions64Low);
  gl_Position.xy = (commonPosition.xy - weight.commonBounds.xy) / (weight.commonBounds.zw - weight.commonBounds.xy) ;
  gl_Position.xy = (gl_Position.xy * 2.) - (1.);
  gl_Position.w = 1.0;
  }
  `;var Ab=`#version 300 es
  in vec4 weightsTexture;
  out vec4 fragColor;
  float gaussianKDE(float u){
  return pow(2.71828, -u*u/0.05555)/(1.77245385*0.166666);
  }
  void main()
  {
  float dist = length(gl_PointCoord - vec2(0.5, 0.5));
  if (dist > 0.5) {
  discard;
  }
  fragColor = weightsTexture * gaussianKDE(2. * dist);
  DECKGL_FILTER_COLOR(fragColor, geometry);
  }
  `;var h8=`#version 300 es
  uniform sampler2D inTexture;
  out vec4 outTexture;
  void main()
  {
  int yIndex = gl_VertexID / int(maxWeight.textureSize);
  int xIndex = gl_VertexID - (yIndex * int(maxWeight.textureSize));
  vec2 uv = (0.5 + vec2(float(xIndex), float(yIndex))) / maxWeight.textureSize;
  outTexture = texture(inTexture, uv);
  gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
  gl_PointSize = 1.0;
  }
  `;var f8=`#version 300 es
  in vec4 outTexture;
  out vec4 fragColor;
  void main() {
  fragColor = outTexture;
  fragColor.g = outTexture.r / max(1.0, outTexture.a);
  }
  `;var sft=`uniform weightUniforms {
    vec4 commonBounds;
    float radiusPixels;
    float textureWidth;
    float weightsScale;
  } weight;
  `,u8={name:"weight",vs:sft,uniformTypes:{commonBounds:"vec4<f32>",radiusPixels:"f32",textureWidth:"f32",weightsScale:"f32"}},d8={name:"maxWeight",vs:`uniform maxWeightUniforms {
    float textureSize;
  } maxWeight;
  `,uniformTypes:{textureSize:"f32"}};var ift=2,Tb={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}},p8=[0,0],oft={SUM:0,MEAN:1},aft={getPosition:{type:"accessor",value:e=>e.position},getWeight:{type:"accessor",value:1},intensity:{type:"number",min:0,value:1},radiusPixels:{type:"number",min:1,max:100,value:50},colorRange:bi,threshold:{type:"number",min:0,max:1,value:.05},colorDomain:{type:"array",value:null,optional:!0},aggregation:"SUM",weightsTextureSize:{type:"number",min:128,max:2048,value:2048},debounceTimeout:{type:"number",min:0,max:1e3,value:500}},cft=["float32-renderable-webgl","texture-blend-float-webgl"],lft={data:{props:["radiusPixels"]}},od=class extends l8{getShaders(t){let r=[st];return t.modules&&(r=[...r,...t.modules]),super.getShaders({...t,modules:r})}initializeState(){super.initializeAggregationLayer(lft),this.setState({colorDomain:p8}),this._setupTextureParams(),this._setupAttributes(),this._setupResources()}shouldUpdateState({changeFlags:t}){return t.somethingChanged}updateState(t){super.updateState(t),this._updateHeatmapState(t)}_updateHeatmapState(t){let{props:r,oldProps:n}=t,s=this._getChangeFlags(t);(s.dataChanged||s.viewportChanged)&&(s.boundsChanged=this._updateBounds(s.dataChanged),this._updateTextureRenderingBounds()),s.dataChanged||s.boundsChanged?(clearTimeout(this.state.updateTimer),this.setState({isWeightMapDirty:!0})):s.viewportZoomChanged&&this._debouncedUpdateWeightmap(),r.colorRange!==n.colorRange&&this._updateColorTexture(t),this.state.isWeightMapDirty&&this._updateWeightmap(),this.setState({zoom:t.context.viewport.zoom})}renderLayers(){let{weightsTexture:t,triPositionBuffer:r,triTexCoordBuffer:n,maxWeightsTexture:s,colorTexture:i,colorDomain:o}=this.state,{updateTriggers:a,intensity:c,threshold:l,aggregation:h}=this.props,f=this.getSubLayerClass("triangle",a8);return new f(this.getSubLayerProps({id:"triangle-layer",updateTriggers:a}),{coordinateSystem:W.DEFAULT,data:{attributes:{positions:r,texCoords:n}},vertexCount:4,maxTexture:s,colorTexture:i,aggregationMode:oft[h]||0,weightsTexture:t,intensity:c,threshold:l,colorDomain:o})}finalizeState(t){super.finalizeState(t);let{weightsTransform:r,weightsTexture:n,maxWeightTransform:s,maxWeightsTexture:i,triPositionBuffer:o,triTexCoordBuffer:a,colorTexture:c,updateTimer:l}=this.state;r?.destroy(),n?.destroy(),s?.destroy(),i?.destroy(),o?.destroy(),a?.destroy(),c?.destroy(),l&&clearTimeout(l)}_getAttributeManager(){return new ur(this.context.device,{id:this.props.id,stats:this.context.stats})}_getChangeFlags(t){let r={},{dimensions:n}=this.state;r.dataChanged=this.isAttributeChanged()&&"attribute changed"||this.isAggregationDirty(t,{compareAll:!0,dimension:n.data})&&"aggregation is dirty",r.viewportChanged=t.changeFlags.viewportChanged;let{zoom:s}=this.state;return(!t.context.viewport||t.context.viewport.zoom!==s)&&(r.viewportZoomChanged=!0),r}_createTextures(){let{textureSize:t,format:r}=this.state;this.setState({weightsTexture:this.context.device.createTexture({...Tb,width:t,height:t,format:r}),maxWeightsTexture:this.context.device.createTexture({...Tb,width:1,height:1,format:r})})}_setupAttributes(){this.getAttributeManager().add({positions:{size:3,type:"float64",accessor:"getPosition"},weights:{size:1,accessor:"getWeight"}}),this.setState({positionAttributeName:"positions"})}_setupTextureParams(){let{device:t}=this.context,{weightsTextureSize:r}=this.props,n=Math.min(r,t.limits.maxTextureDimension2D),s=cft.every(a=>t.features.has(a)),i=s?"rgba32float":"rgba8unorm",o=s?1:1/255;this.setState({textureSize:n,format:i,weightsScale:o}),s||k.warn(`HeatmapLayer: ${this.id} rendering to float texture not supported, falling back to low precision format`)()}_createWeightsTransform(t){let{weightsTransform:r}=this.state,{weightsTexture:n}=this.state,s=this.getAttributeManager();r?.destroy(),r=new Ws(this.context.device,{id:`${this.id}-weights-transform`,bufferLayout:s.getBufferLayouts(),vertexCount:1,targetTexture:n,parameters:{depthWriteEnabled:!1,blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"},topology:"point-list",...t,modules:[...t.modules,u8]}),this.setState({weightsTransform:r})}_setupResources(){this._createTextures();let{device:t}=this.context,{textureSize:r,weightsTexture:n,maxWeightsTexture:s}=this.state,i=this.getShaders({vs:yb,fs:Ab});this._createWeightsTransform(i);let o=this.getShaders({vs:h8,fs:f8,modules:[d8]}),a=new Ws(t,{id:`${this.id}-max-weights-transform`,targetTexture:s,...o,vertexCount:r*r,topology:"point-list",parameters:{depthWriteEnabled:!1,blendColorOperation:"max",blendAlphaOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}}),c={inTexture:n,textureSize:r};a.model.shaderInputs.setProps({maxWeight:c}),this.setState({weightsTexture:n,maxWeightsTexture:s,maxWeightTransform:a,zoom:null,triPositionBuffer:t.createBuffer({byteLength:48}),triTexCoordBuffer:t.createBuffer({byteLength:48})})}updateShaders(t){this._createWeightsTransform({vs:yb,fs:Ab,...t})}_updateMaxWeightValue(){let{maxWeightTransform:t}=this.state;t.run({parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]})}_updateBounds(t=!1){let{viewport:r}=this.context,n=[r.unproject([0,0]),r.unproject([r.width,0]),r.unproject([0,r.height]),r.unproject([r.width,r.height])].map(a=>a.map(Math.fround)),s=Q5(n),i={visibleWorldBounds:s,viewportCorners:n},o=!1;if(t||!this.state.worldBounds||!t8(this.state.worldBounds,s)){let a=this._worldToCommonBounds(s),c=this._commonToWorldBounds(a);this.props.coordinateSystem===W.LNGLAT&&(c[1]=Math.max(c[1],-85.051129),c[3]=Math.min(c[3],85.051129),c[0]=Math.max(c[0],-360),c[2]=Math.min(c[2],360));let l=this._worldToCommonBounds(c);i.worldBounds=c,i.normalizedCommonBounds=l,o=!0}return this.setState(i),o}_updateTextureRenderingBounds(){let{triPositionBuffer:t,triTexCoordBuffer:r,normalizedCommonBounds:n,viewportCorners:s}=this.state,{viewport:i}=this.context;t.write(xb(s,3));let o=s.map(a=>r8(i.projectPosition(a),n));r.write(xb(o,2))}_updateColorTexture(t){let{colorRange:r}=t.props,{colorTexture:n}=this.state,s=mb(r,!1,Uint8Array);n&&n?.width===r.length?n.setTexture2DData({data:s}):(n?.destroy(),n=this.context.device.createTexture({...Tb,data:s,width:r.length,height:1})),this.setState({colorTexture:n})}_updateWeightmap(){let{radiusPixels:t,colorDomain:r,aggregation:n}=this.props,{worldBounds:s,textureSize:i,weightsScale:o,weightsTexture:a}=this.state,c=this.state.weightsTransform;this.state.isWeightMapDirty=!1;let l=this._worldToCommonBounds(s,{useLayerCoordinateSystem:!0});if(r&&n==="SUM"){let{viewport:x}=this.context,A=x.distanceScales.metersPerUnit[2]*(l[2]-l[0])/i;this.state.colorDomain=r.map(M=>M*A*o)}else this.state.colorDomain=r||p8;let f=this.getAttributeManager().getAttributes(),u=this.getModuleSettings();this._setModelAttributes(c.model,f),c.model.setVertexCount(this.getNumInstances());let d={radiusPixels:t,commonBounds:l,textureWidth:i,weightsScale:o,weightsTexture:a},{viewport:p,devicePixelRatio:g,coordinateSystem:m,coordinateOrigin:_}=u,{modelMatrix:y}=this.props;c.model.shaderInputs.setProps({project:{viewport:p,devicePixelRatio:g,modelMatrix:y,coordinateSystem:m,coordinateOrigin:_},weight:d}),c.run({parameters:{viewport:[0,0,i,i]},clearColor:[0,0,0,0]}),this._updateMaxWeightValue()}_debouncedUpdateWeightmap(t=!1){let{updateTimer:r}=this.state,{debounceTimeout:n}=this.props;t?(r=null,this._updateBounds(!0),this._updateTextureRenderingBounds(),this.setState({isWeightMapDirty:!0})):(this.setState({isWeightMapDirty:!1}),clearTimeout(r),r=setTimeout(this._debouncedUpdateWeightmap.bind(this,!0),n)),this.setState({updateTimer:r})}_worldToCommonBounds(t,r={}){let{useLayerCoordinateSystem:n=!1}=r,[s,i,o,a]=t,{viewport:c}=this.context,{textureSize:l}=this.state,{coordinateSystem:h}=this.props,f=n&&(h===W.LNGLAT_OFFSETS||h===W.METER_OFFSETS),u=f?c.projectPosition(this.props.coordinateOrigin):[0,0],d=l*ift/c.scale,p,g;return n&&!f?(p=this.projectPosition([s,i,0]),g=this.projectPosition([o,a,0])):(p=c.projectPosition([s,i,0]),g=c.projectPosition([o,a,0])),e8([p[0]-u[0],p[1]-u[1],g[0]-u[0],g[1]-u[1]],d,d)}_commonToWorldBounds(t){let[r,n,s,i]=t,{viewport:o}=this.context,a=o.unprojectPosition([r,n]),c=o.unprojectPosition([s,i]);return a.slice(0,2).concat(c.slice(0,2))}};od.layerName="HeatmapLayer";od.defaultProps=aft;var g8=od;var Mb=85.05113;function bb(e,t,r,n){if(r){if(r.userData._googleMap===e)return r;h_(r)}let s={click:null,rightclick:null,dblclick:null,mousemove:null,mouseout:null},i=new jr({...n,useDevicePixels:n.interleaved?!0:n.useDevicePixels,style:n.interleaved?null:{pointerEvents:"none"},parent:hft(t,n.style),views:new qs({repeat:!0}),initialViewState:{longitude:0,latitude:0,zoom:1},controller:!1});for(let o in s)s[o]=e.addListener(o,a=>uft(i,o,a));return i.userData._googleMap=e,i.userData._eventListeners=s,i}function hft(e,t){let r=document.createElement("div");return r.style.position="absolute",Object.assign(r.style,t),"getPanes"in e?e.getPanes()?.overlayLayer.appendChild(r):e.getMap()?.getDiv().appendChild(r),r}function h_(e){let{_eventListeners:t}=e.userData;for(let r in t)t[r]&&t[r].remove();e.finalize()}function m8(e,t){let{width:r,height:n}=_8(e),s=t.getProjection(),i=e.getBounds();if(!i)return{width:r,height:n,left:0,top:0};let o=i.getNorthEast(),a=i.getSouthWest(),c=s.fromLatLngToDivPixel(o),l=s.fromLatLngToDivPixel(a),h=Eb(s,r/2,n/2),f=new google.maps.LatLng(0,h[0]),u=s.fromLatLngToContainerPixel(f),d=s.fromLatLngToDivPixel(f);if(!c||!l||!d||!u)return{width:r,height:n,left:0,top:0};let p=Math.round(d.x-u.x),g=d.y-u.y,m=Eb(s,r/2,0),_=Eb(s,r/2,n),y=h[1],x=h[0];if(Math.abs(y)>Mb){y=y>0?Mb:-Mb;let b=new google.maps.LatLng(y,x),T=s.fromLatLngToContainerPixel(b);g+=T.y-n/2}g=Math.round(g);let M=180*new Ui(m).sub(_).verticalAngle()/Math.PI;M<0&&(M+=360);let E=e.getHeading()||0,w=e.getZoom()-1,v;if(M===0)v=n?(l.y-c.y)/n:1;else if(M===E){let b=new Ui([c.x,c.y]).sub([l.x,l.y]).len(),T=new Ui([r,-n]).len();v=T?b/T:1}return w+=Math.log2(v||1),{width:r,height:n,left:p,top:g,zoom:w,bearing:M,pitch:e.getTilt(),latitude:y,longitude:x}}function Sb(e,t){let{width:r,height:n}=_8(e),{center:s,heading:i,tilt:o,zoom:a}=t.getCameraParams(),c=25,l=n?r/n:1,h=.75,f=3e14,u=new $().perspective({fovy:c*Math.PI/180,aspect:l,near:h,far:f}),d=.5*u[5];return{width:r,height:n,viewState:{altitude:d,bearing:i,latitude:s.lat(),longitude:s.lng(),pitch:o,projectionMatrix:u,repeat:!0,zoom:a-1}}}function _8(e){let t=e.getDiv().firstChild;return{width:t.offsetWidth,height:t.offsetHeight}}function Eb(e,t,r){let n=new google.maps.Point(t,r),s=e.fromContainerPixelToLatLng(n);return[s.lng(),s.lat()]}function fft(e,t){if(e.pixel)return e.pixel;let r=t.getViewports()[0].project([e.latLng.lng(),e.latLng.lat()]);return{x:r[0],y:r[1]}}function uft(e,t,r){if(!e.isInitialized)return;let n={type:t,offsetCenter:fft(r,e),srcEvent:r};switch(t){case"click":case"rightclick":n.type="click",n.tapCount=1,e._onPointerDown(n),e._onEvent(n);break;case"dblclick":n.type="click",n.tapCount=2,e._onEvent(n);break;case"mousemove":n.type="pointermove",e._onPointerMove(n);break;case"mouseout":n.type="pointerleave",e._onPointerMove(n);break;default:return}}var dft=()=>!1,pft={depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],blendEquation:32774};function x8(){}var gft={interleaved:!0},ad=class{constructor(t){this.props={},this._map=null,this._deck=null,this._overlay=null,this.setProps({...gft,...t})}setMap(t){if(t===this._map)return;let{VECTOR:r,UNINITIALIZED:n}=google.maps.RenderingType;this._map&&(!t&&this._map.getRenderingType()===r&&this.props.interleaved&&this._overlay.requestRedraw(),this._overlay?.setMap(null),this._map=null),t&&(this._map=t,t.getRenderingType()!==n?this._createOverlay(t):t.addListener("renderingtype_changed",()=>{this._createOverlay(t)}))}setProps(t){if(Object.assign(this.props,t),this._deck){let r=this._deck.getCanvas();if(t.style&&r?.parentElement){let n=r.parentElement.style;Object.assign(n,t.style),t.style=null}this._deck.setProps(t)}}pickObject(t){return this._deck&&this._deck.pickObject(t)}pickMultipleObjects(t){return this._deck&&this._deck.pickMultipleObjects(t)}pickObjects(t){return this._deck&&this._deck.pickObjects(t)}finalize(){this.setMap(null),this._deck&&(h_(this._deck),this._deck=null)}_createOverlay(t){let{interleaved:r}=this.props,{VECTOR:n,UNINITIALIZED:s}=google.maps.RenderingType,i=t.getRenderingType();if(i===s)return;let a=i===n&&google.maps.WebGLOverlayView?google.maps.WebGLOverlayView:google.maps.OverlayView,c=new a;c instanceof google.maps.WebGLOverlayView?(r?(c.onAdd=x8,c.onContextRestored=this._onContextRestored.bind(this),c.onDraw=this._onDrawVectorInterleaved.bind(this)):(c.onAdd=this._onAdd.bind(this),c.onContextRestored=x8,c.onDraw=this._onDrawVectorOverlay.bind(this)),c.onContextLost=this._onContextLost.bind(this)):(c.onAdd=this._onAdd.bind(this),c.draw=this._onDrawRaster.bind(this)),c.onRemove=this._onRemove.bind(this),this._overlay=c,this._overlay.setMap(t)}_onAdd(){this._deck=bb(this._map,this._overlay,this._deck,this.props)}_onContextRestored({gl:t}){if(!this._map||!this._overlay)return;let r=()=>{this._overlay&&this._overlay.requestRedraw()},n=bb(this._map,this._overlay,this._deck,{gl:t,_customRender:r,...this.props});this._deck=n;let s=n.animationLoop;s._renderFrame=()=>{let i=t.getParameter(34964);n.device.withParametersWebGL({},()=>{s.props.onRender(s.animationProps)}),t.bindBuffer(34962,i)}}_onContextLost(){this._deck&&(h_(this._deck),this._deck=null)}_onRemove(){this._deck?.setProps({layerFilter:dft})}_onDrawRaster(){if(!this._deck||!this._map)return;let t=this._deck,{width:r,height:n,left:s,top:i,...o}=m8(this._map,this._overlay),c=t.getCanvas()?.parentElement||t.props.parent;if(c){let h=c.style;h.left=`${s}px`,h.top=`${i}px`}let l=1e4;t.setProps({width:r,height:n,viewState:{altitude:l,...o}}),t.redraw()}_onDrawVectorInterleaved({gl:t,transformer:r}){if(!this._deck||!this._map)return;let n=this._deck;if(n.setProps({...Sb(this._map,r),width:null,height:null}),n.isInitialized){let s=n.device;if(s instanceof be){let i=s.getParametersWebGL(36006);n.setProps({_framebuffer:i})}s.getDefaultCanvasContext().resize(),n.needsRedraw({clearRedrawFlags:!0}),s instanceof be&&(s.setParametersWebGL({viewport:[0,0,t.canvas.width,t.canvas.height],scissor:[0,0,t.canvas.width,t.canvas.height],stencilFunc:[519,0,255,519,0,255]}),s.withParametersWebGL(pft,()=>{n._drawLayers("google-vector",{clearCanvas:!1})}))}}_onDrawVectorOverlay({transformer:t}){if(!this._deck||!this._map)return;let r=this._deck;r.setProps({...Sb(this._map,t)}),r.redraw()}};var vb=512,mft=Math.PI/180;function f_({map:e,gl:t,deck:r}){if(e.__deck)return e.__deck;let n=r?.props._customRender,s=r?.props.onLoad,i={...r?.props,_customRender:()=>{e.triggerRepaint(),n?.("")}};i.parameters={...u_(e,!0),...i.parameters},i.views||(i.views=cd(e));let o;return(!r||r.props.gl===t)&&(Object.assign(i,{gl:t,width:null,height:null,touchAction:"unset",viewState:ll(e)}),r?.isInitialized?y8(r,e):i.onLoad=()=>{s?.(),y8(o,e)}),r?(o=r,r.setProps(i),r.userData.isExternal=!0):(o=new jr(i),e.on("remove",()=>{wb(e)})),o.userData.mapboxLayers=new Set,e.__deck=o,e.on("render",()=>{o.isInitialized&&xft(o,e)}),o}function y8(e,t){let r=()=>{e.isInitialized?yft(e,t):t.off("move",r)};t.on("move",r)}function wb(e){e.__deck?.finalize(),e.__deck=null}function u_(e,t){let r=t?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return b8(e)==="globe"&&(r.cullMode="back"),r}function A8(e,t){e.userData.mapboxLayers.add(t),Cb(e)}function T8(e,t){e.userData.mapboxLayers.delete(t),Cb(e)}function M8(e,t){Cb(e)}function E8(e,t,r,n){let{currentViewport:s}=e.userData,i=!1;s||(s=S8(e,t,n),e.userData.currentViewport=s,i=!0),e.isInitialized&&e._drawLayers("mapbox-repaint",{viewports:[s],layerFilter:({layer:o})=>r.id===o.id||o.props.operation.includes("terrain"),clearStack:i,clearCanvas:!1})}function b8(e){let t=e.getProjection?.(),r=t?.type||t?.name;if(r==="globe")return"globe";if(r&&r!=="mercator")throw new Error("Unsupported projection");return"mercator"}function cd(e){return b8(e)==="globe"?new Xg({id:"mapbox"}):new qs({id:"mapbox"})}function ll(e){let{lng:t,lat:r}=e.getCenter(),n={longitude:(t+540)%360-180,latitude:r,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch(),padding:e.getPadding(),repeat:e.getRenderWorldCopies()};return e.getTerrain?.()&&_ft(e,n),n}function _ft(e,t){if(e.getFreeCameraOptions){let{position:r}=e.getFreeCameraOptions();if(!r||r.z===void 0)return;let n=e.transform.height,{longitude:s,latitude:i,pitch:o}=t,a=r.x*vb,c=(1-r.y)*vb,l=r.z*vb,h=Kt([s,i]),f=a-h[0],u=c-h[1],d=Math.sqrt(f*f+u*u),p=o*mft,g=1.5*n,m=p<.001?g*Math.cos(p)/l:g*Math.sin(p)/d;t.zoom=Math.log2(m);let _=g*Math.cos(p)/m,y=l-_;t.position=[0,0,y/ji(i)]}else typeof e.transform.elevation=="number"&&(t.position=[0,0,e.transform.elevation])}function S8(e,t,r){let n=ll(t),s=cd(t);r&&(s.props.nearZMultiplier=.2);let i=r?.nearZ??t.transform._nearZ,o=r?.farZ??t.transform._farZ;return Number.isFinite(i)&&(n.nearZ=i/t.transform.height,n.farZ=o/t.transform.height),s.makeViewport({width:e.width,height:e.height,viewState:n})}function xft(e,t){let{mapboxLayers:r,isExternal:n}=e.userData;if(n){let s=Array.from(r,h=>h.id),o=We(e.props.layers,Boolean).some(h=>h&&!s.includes(h.id)),a=e.getViewports(),c=a.findIndex(h=>h.id==="mapbox"),l=a.length>1||c<0;(o||l)&&(c>=0&&(a=a.slice(),a[c]=S8(e,t)),e._drawLayers("mapbox-repaint",{viewports:a,layerFilter:h=>(!e.props.layerFilter||e.props.layerFilter(h))&&(h.viewport.id!=="mapbox"||!s.includes(h.layer.id)),clearCanvas:!1}))}e.userData.currentViewport=null}function yft(e,t){e.setProps({viewState:ll(t)}),e.needsRedraw({clearRedrawFlags:!0})}function Cb(e){if(e.userData.isExternal)return;let t=[];e.userData.mapboxLayers.forEach(r=>{let n=r.props.type,s=new n(r.props);t.push(s)}),e.setProps({layers:t})}var ld=class{constructor(t){if(!t.id)throw new Error("Layer must have an unique id");this.id=t.id,this.type="custom",this.renderingMode=t.renderingMode||"3d",this.map=null,this.deck=null,this.props=t}onAdd(t,r){this.map=t,this.deck=f_({map:t,gl:r,deck:this.props.deck}),A8(this.deck,this)}onRemove(){this.deck&&T8(this.deck,this)}setProps(t){Object.assign(this.props,t,{id:this.id}),this.deck&&M8(this.deck,this)}render(t,r){E8(this.deck,this.map,this,r)}};var Pb="__UNDEFINED__";function hd(e,t,r,n){if(!e||!t||!e.style||!e.style._loaded)return;let s=We(n,Boolean);if(r!==n){let a=We(r,Boolean),c=new Set(a.map(l=>l.id));for(let l of s)c.delete(l.id);for(let l of c)e.getLayer(l)&&e.removeLayer(l)}for(let a of s){let c=e.getLayer(a.id);c?(c.implementation||c).setProps(a.props):e.addLayer(new ld({id:a.id,deck:t}),a.props.beforeId)}let i=e.style._order,o={};for(let a of s){let{beforeId:c}=a.props;(!c||!i.includes(c))&&(c=Pb),o[c]=o[c]||[],o[c].push(a.id)}for(let a in o){let c=o[a],l=a===Pb?i.length:i.indexOf(a),h=a===Pb?void 0:a;for(let f=c.length-1;f>=0;f--){let u=c[f],d=i.indexOf(u);d!==l-1&&(e.moveLayer(u,h),d>l&&l++),l--,h=u}}}var fd=class{constructor(t){this._handleStyleChange=()=>{hd(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){let{clientWidth:s,clientHeight:i}=this._map.getContainer();Object.assign(this._container.style,{width:`${s}px`,height:`${i}px`})}},this._updateViewState=()=>{let s=this._deck,i=this._map;s&&i&&(s.setProps({views:this._props.views||cd(i),viewState:ll(i)}),s.isInitialized&&s.redraw())},this._handleMouseEvent=s=>{let i=this._deck;if(!i||!i.isInitialized)return;let o={type:s.type,offsetCenter:s.point,srcEvent:s},a=this._lastMouseDownPoint;switch(!s.point&&a&&(o.deltaX=s.originalEvent.clientX-a.clientX,o.deltaY=s.originalEvent.clientY-a.clientY,o.offsetCenter={x:a.x+o.deltaX,y:a.y+o.deltaY}),o.type){case"mousedown":i._onPointerDown(o),this._lastMouseDownPoint={...s.point,clientX:s.originalEvent.clientX,clientY:s.originalEvent.clientY};break;case"dragstart":o.type="panstart",i._onEvent(o);break;case"drag":o.type="panmove",i._onEvent(o);break;case"dragend":o.type="panend",i._onEvent(o);break;case"click":o.tapCount=1,i._onEvent(o);break;case"dblclick":o.type="click",o.tapCount=2,i._onEvent(o);break;case"mousemove":o.type="pointermove",i._onPointerMove(o);break;case"mouseout":o.type="pointerleave",i._onPointerMove(o);break;default:return}};let{interleaved:r=!1,...n}=t;this._interleaved=r,this._props=n}setProps(t){this._interleaved&&t.layers&&hd(this._map,this._deck,this._props.layers,t.layers),Object.assign(this._props,t),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...u_(this._map,this._interleaved),...this._props.parameters}})}onAdd(t){return this._map=t,this._interleaved?this._onAddInterleaved(t):this._onAddOverlaid(t)}_onAddOverlaid(t){let r=document.createElement("div");return Object.assign(r.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=r,this._deck=new jr({...this._props,parent:r,parameters:{...u_(t,!1),...this._props.parameters},views:this._props.views||cd(t),viewState:ll(t)}),t.on("resize",this._updateContainerSize),t.on("render",this._updateViewState),t.on("mousedown",this._handleMouseEvent),t.on("dragstart",this._handleMouseEvent),t.on("drag",this._handleMouseEvent),t.on("dragend",this._handleMouseEvent),t.on("mousemove",this._handleMouseEvent),t.on("mouseout",this._handleMouseEvent),t.on("click",this._handleMouseEvent),t.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),r}_onAddInterleaved(t){let r=t.painter.context.gl;return r instanceof WebGLRenderingContext&&k.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=f_({map:t,gl:r,deck:new jr({...this._props,gl:r})}),t.on("styledata",this._handleStyleChange),hd(t,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){let t=this._map;t&&(this._interleaved?this._onRemoveInterleaved(t):this._onRemoveOverlaid(t)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(t){t.off("resize",this._updateContainerSize),t.off("render",this._updateViewState),t.off("mousedown",this._handleMouseEvent),t.off("dragstart",this._handleMouseEvent),t.off("drag",this._handleMouseEvent),t.off("dragend",this._handleMouseEvent),t.off("mousemove",this._handleMouseEvent),t.off("mouseout",this._handleMouseEvent),t.off("click",this._handleMouseEvent),t.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(t){t.off("styledata",this._handleStyleChange),hd(t,this._deck,this._props.layers,[]),wb(t)}getDefaultPosition(){return"top-left"}pickObject(t){return yt(this._deck),this._deck.pickObject(t)}pickMultipleObjects(t){return yt(this._deck),this._deck.pickMultipleObjects(t)}pickObjects(t){return yt(this._deck),this._deck.pickObjects(t)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}};var __,Nt,R8,Aft,qo,v8,I8,Rb,Nb,Ib,Ob,Tft,ud={},O8=[],Mft=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Bb=Array.isArray;function vi(e,t){for(var r in t)e[r]=t[r];return e}function L8(e){var t=e.parentNode;t&&t.removeChild(e)}function Eft(e,t,r){var n,s,i,o={};for(i in t)i=="key"?n=t[i]:i=="ref"?s=t[i]:o[i]=t[i];if(arguments.length>2&&(o.children=arguments.length>3?__.call(arguments,2):r),typeof e=="function"&&e.defaultProps!=null)for(i in e.defaultProps)o[i]===void 0&&(o[i]=e.defaultProps[i]);return p_(e,o,n,s,null)}function p_(e,t,r,n,s){var i={type:e,props:t,key:r,ref:n,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:s??++R8,__i:-1,__u:0};return s==null&&Nt.vnode!=null&&Nt.vnode(i),i}function hl(e){return e.children}function g_(e,t){this.props=e,this.context=t}function Xo(e,t){if(t==null)return e.__?Xo(e.__,e.__i+1):null;for(var r;t<e.__k.length;t++)if((r=e.__k[t])!=null&&r.__e!=null)return r.__e;return typeof e.type=="function"?Xo(e):null}function N8(e){var t,r;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((r=e.__k[t])!=null&&r.__e!=null){e.__e=e.__c.base=r.__e;break}return N8(e)}}function w8(e){(!e.__d&&(e.__d=!0)&&qo.push(e)&&!m_.__r++||v8!==Nt.debounceRendering)&&((v8=Nt.debounceRendering)||I8)(m_)}function m_(){var e,t,r,n,s,i,o,a;for(qo.sort(Rb);e=qo.shift();)e.__d&&(t=qo.length,n=void 0,i=(s=(r=e).__v).__e,o=[],a=[],r.__P&&((n=vi({},s)).__v=s.__v+1,Nt.vnode&&Nt.vnode(n),Fb(r.__P,n,s,r.__n,r.__P.namespaceURI,32&s.__u?[i]:null,o,i??Xo(s),!!(32&s.__u),a),n.__v=s.__v,n.__.__k[n.__i]=n,D8(o,n,a),n.__e!=i&&N8(n)),qo.length>t&&qo.sort(Rb));m_.__r=0}function B8(e,t,r,n,s,i,o,a,c,l,h){var f,u,d,p,g,m=n&&n.__k||O8,_=t.length;for(r.__d=c,bft(r,t,m),c=r.__d,f=0;f<_;f++)(d=r.__k[f])!=null&&typeof d!="boolean"&&typeof d!="function"&&(u=d.__i===-1?ud:m[d.__i]||ud,d.__i=f,Fb(e,d,u,s,i,o,a,c,l,h),p=d.__e,d.ref&&u.ref!=d.ref&&(u.ref&&Db(u.ref,null,d),h.push(d.ref,d.__c||p,d)),g==null&&p!=null&&(g=p),65536&d.__u||u.__k===d.__k?c=F8(d,c,e):typeof d.type=="function"&&d.__d!==void 0?c=d.__d:p&&(c=p.nextSibling),d.__d=void 0,d.__u&=-196609);r.__d=c,r.__e=g}function bft(e,t,r){var n,s,i,o,a,c=t.length,l=r.length,h=l,f=0;for(e.__k=[],n=0;n<c;n++)o=n+f,(s=e.__k[n]=(s=t[n])==null||typeof s=="boolean"||typeof s=="function"?null:typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?p_(null,s,null,null,null):Bb(s)?p_(hl,{children:s},null,null,null):s.constructor===void 0&&s.__b>0?p_(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s)!=null?(s.__=e,s.__b=e.__b+1,a=Sft(s,r,o,h),s.__i=a,i=null,a!==-1&&(h--,(i=r[a])&&(i.__u|=131072)),i==null||i.__v===null?(a==-1&&f--,typeof s.type!="function"&&(s.__u|=65536)):a!==o&&(a==o-1?f--:a==o+1?f++:a>o?h>c-o?f+=a-o:f--:a<o&&(a==o-f?f-=a-o:f++),a!==n+f&&(s.__u|=65536))):(i=r[o])&&i.key==null&&i.__e&&!(131072&i.__u)&&(i.__e==e.__d&&(e.__d=Xo(i)),Lb(i,i,!1),r[o]=null,h--);if(h)for(n=0;n<l;n++)(i=r[n])!=null&&!(131072&i.__u)&&(i.__e==e.__d&&(e.__d=Xo(i)),Lb(i,i))}function F8(e,t,r){var n,s;if(typeof e.type=="function"){for(n=e.__k,s=0;n&&s<n.length;s++)n[s]&&(n[s].__=e,t=F8(n[s],t,r));return t}e.__e!=t&&(t&&e.type&&!r.contains(t)&&(t=Xo(e)),r.insertBefore(e.__e,t||null),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType===8);return t}function Sft(e,t,r,n){var s=e.key,i=e.type,o=r-1,a=r+1,c=t[r];if(c===null||c&&s==c.key&&i===c.type&&!(131072&c.__u))return r;if(n>(c!=null&&!(131072&c.__u)?1:0))for(;o>=0||a<t.length;){if(o>=0){if((c=t[o])&&!(131072&c.__u)&&s==c.key&&i===c.type)return o;o--}if(a<t.length){if((c=t[a])&&!(131072&c.__u)&&s==c.key&&i===c.type)return a;a++}}return-1}function C8(e,t,r){t[0]==="-"?e.setProperty(t,r??""):e[t]=r==null?"":typeof r!="number"||Mft.test(t)?r:r+"px"}function d_(e,t,r,n,s){var i;t:if(t==="style")if(typeof r=="string")e.style.cssText=r;else{if(typeof n=="string"&&(e.style.cssText=n=""),n)for(t in n)r&&t in r||C8(e.style,t,"");if(r)for(t in r)n&&r[t]===n[t]||C8(e.style,t,r[t])}else if(t[0]==="o"&&t[1]==="n")i=t!==(t=t.replace(/(PointerCapture)$|Capture$/i,"$1")),t=t.toLowerCase()in e||t==="onFocusOut"||t==="onFocusIn"?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+i]=r,r?n?r.u=n.u:(r.u=Nb,e.addEventListener(t,i?Ob:Ib,i)):e.removeEventListener(t,i?Ob:Ib,i);else{if(s=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=r??"";break t}catch{}typeof r=="function"||(r==null||r===!1&&t[4]!=="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&r==1?"":r))}}function P8(e){return function(t){if(this.l){var r=this.l[t.type+e];if(t.t==null)t.t=Nb++;else if(t.t<r.u)return;return r(Nt.event?Nt.event(t):t)}}}function Fb(e,t,r,n,s,i,o,a,c,l){var h,f,u,d,p,g,m,_,y,x,A,M,E,w,v,b,T=t.type;if(t.constructor!==void 0)return null;128&r.__u&&(c=!!(32&r.__u),i=[a=t.__e=r.__e]),(h=Nt.__b)&&h(t);t:if(typeof T=="function")try{if(_=t.props,y="prototype"in T&&T.prototype.render,x=(h=T.contextType)&&n[h.__c],A=h?x?x.props.value:h.__:n,r.__c?m=(f=t.__c=r.__c).__=f.__E:(y?t.__c=f=new T(_,A):(t.__c=f=new g_(_,A),f.constructor=T,f.render=wft),x&&x.sub(f),f.props=_,f.state||(f.state={}),f.context=A,f.__n=n,u=f.__d=!0,f.__h=[],f._sb=[]),y&&f.__s==null&&(f.__s=f.state),y&&T.getDerivedStateFromProps!=null&&(f.__s==f.state&&(f.__s=vi({},f.__s)),vi(f.__s,T.getDerivedStateFromProps(_,f.__s))),d=f.props,p=f.state,f.__v=t,u)y&&T.getDerivedStateFromProps==null&&f.componentWillMount!=null&&f.componentWillMount(),y&&f.componentDidMount!=null&&f.__h.push(f.componentDidMount);else{if(y&&T.getDerivedStateFromProps==null&&_!==d&&f.componentWillReceiveProps!=null&&f.componentWillReceiveProps(_,A),!f.__e&&(f.shouldComponentUpdate!=null&&f.shouldComponentUpdate(_,f.__s,A)===!1||t.__v===r.__v)){for(t.__v!==r.__v&&(f.props=_,f.state=f.__s,f.__d=!1),t.__e=r.__e,t.__k=r.__k,t.__k.forEach(function(I){I&&(I.__=t)}),M=0;M<f._sb.length;M++)f.__h.push(f._sb[M]);f._sb=[],f.__h.length&&o.push(f);break t}f.componentWillUpdate!=null&&f.componentWillUpdate(_,f.__s,A),y&&f.componentDidUpdate!=null&&f.__h.push(function(){f.componentDidUpdate(d,p,g)})}if(f.context=A,f.props=_,f.__P=e,f.__e=!1,E=Nt.__r,w=0,y){for(f.state=f.__s,f.__d=!1,E&&E(t),h=f.render(f.props,f.state,f.context),v=0;v<f._sb.length;v++)f.__h.push(f._sb[v]);f._sb=[]}else do f.__d=!1,E&&E(t),h=f.render(f.props,f.state,f.context),f.state=f.__s;while(f.__d&&++w<25);f.state=f.__s,f.getChildContext!=null&&(n=vi(vi({},n),f.getChildContext())),y&&!u&&f.getSnapshotBeforeUpdate!=null&&(g=f.getSnapshotBeforeUpdate(d,p)),B8(e,Bb(b=h!=null&&h.type===hl&&h.key==null?h.props.children:h)?b:[b],t,r,n,s,i,o,a,c,l),f.base=t.__e,t.__u&=-161,f.__h.length&&o.push(f),m&&(f.__E=f.__=null)}catch(I){if(t.__v=null,c||i!=null){for(t.__u|=c?160:32;a&&a.nodeType===8&&a.nextSibling;)a=a.nextSibling;i[i.indexOf(a)]=null,t.__e=a}else t.__e=r.__e,t.__k=r.__k;Nt.__e(I,t,r)}else i==null&&t.__v===r.__v?(t.__k=r.__k,t.__e=r.__e):t.__e=vft(r.__e,t,r,n,s,i,o,c,l);(h=Nt.diffed)&&h(t)}function D8(e,t,r){t.__d=void 0;for(var n=0;n<r.length;n++)Db(r[n],r[++n],r[++n]);Nt.__c&&Nt.__c(t,e),e.some(function(s){try{e=s.__h,s.__h=[],e.some(function(i){i.call(s)})}catch(i){Nt.__e(i,s.__v)}})}function vft(e,t,r,n,s,i,o,a,c){var l,h,f,u,d,p,g,m=r.props,_=t.props,y=t.type;if(y==="svg"?s="http://www.w3.org/2000/svg":y==="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),i!=null){for(l=0;l<i.length;l++)if((d=i[l])&&"setAttribute"in d==!!y&&(y?d.localName===y:d.nodeType===3)){e=d,i[l]=null;break}}if(e==null){if(y===null)return document.createTextNode(_);e=document.createElementNS(s,y,_.is&&_),i=null,a=!1}if(y===null)m===_||a&&e.data===_||(e.data=_);else{if(i=i&&__.call(e.childNodes),m=r.props||ud,!a&&i!=null)for(m={},l=0;l<e.attributes.length;l++)m[(d=e.attributes[l]).name]=d.value;for(l in m)if(d=m[l],l!="children"){if(l=="dangerouslySetInnerHTML")f=d;else if(l!=="key"&&!(l in _)){if(l=="value"&&"defaultValue"in _||l=="checked"&&"defaultChecked"in _)continue;d_(e,l,null,d,s)}}for(l in _)d=_[l],l=="children"?u=d:l=="dangerouslySetInnerHTML"?h=d:l=="value"?p=d:l=="checked"?g=d:l==="key"||a&&typeof d!="function"||m[l]===d||d_(e,l,d,m[l],s);if(h)a||f&&(h.__html===f.__html||h.__html===e.innerHTML)||(e.innerHTML=h.__html),t.__k=[];else if(f&&(e.innerHTML=""),B8(e,Bb(u)?u:[u],t,r,n,y==="foreignObject"?"http://www.w3.org/1999/xhtml":s,i,o,i?i[0]:r.__k&&Xo(r,0),a,c),i!=null)for(l=i.length;l--;)i[l]!=null&&L8(i[l]);a||(l="value",p!==void 0&&(p!==e[l]||y==="progress"&&!p||y==="option"&&p!==m[l])&&d_(e,l,p,m[l],s),l="checked",g!==void 0&&g!==e[l]&&d_(e,l,g,m[l],s))}return e}function Db(e,t,r){try{if(typeof e=="function"){var n=typeof e.__u=="function";n&&e.__u(),n&&t==null||(e.__u=e(t))}else e.current=t}catch(s){Nt.__e(s,r)}}function Lb(e,t,r){var n,s;if(Nt.unmount&&Nt.unmount(e),(n=e.ref)&&(n.current&&n.current!==e.__e||Db(n,null,t)),(n=e.__c)!=null){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(i){Nt.__e(i,t)}n.base=n.__P=null}if(n=e.__k)for(s=0;s<n.length;s++)n[s]&&Lb(n[s],t,r||typeof e.type!="function");r||e.__e==null||L8(e.__e),e.__c=e.__=e.__e=e.__d=void 0}function wft(e,t,r){return this.constructor(e,r)}function fl(e,t,r){var n,s,i,o;Nt.__&&Nt.__(e,t),s=(n=typeof r=="function")?null:r&&r.__k||t.__k,i=[],o=[],Fb(t,e=(!n&&r||t).__k=Eft(hl,null,[e]),s||ud,ud,t.namespaceURI,!n&&r?[r]:s?null:t.firstChild?__.call(t.childNodes):null,i,!n&&r?r:s?s.__e:t.firstChild,n,o),D8(i,e,o)}__=O8.slice,Nt={__e:function(e,t,r,n){for(var s,i,o;t=t.__;)if((s=t.__c)&&!s.__)try{if((i=s.constructor)&&i.getDerivedStateFromError!=null&&(s.setState(i.getDerivedStateFromError(e)),o=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(e,n||{}),o=s.__d),o)return s.__E=s}catch(a){e=a}throw e}},R8=0,Aft=function(e){return e!=null&&e.constructor==null},g_.prototype.setState=function(e,t){var r;r=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=vi({},this.state),typeof e=="function"&&(e=e(vi({},r),this.props)),e&&vi(r,e),e!=null&&this.__v&&(t&&this._sb.push(t),w8(this))},g_.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),w8(this))},g_.prototype.render=hl,qo=[],I8=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Rb=function(e,t){return e.__v.__b-t.__v.__b},m_.__r=0,Nb=0,Ib=P8(!1),Ob=P8(!0),Tft=0;var Cft=0,Mie=Array.isArray;function $t(e,t,r,n,s,i){t||(t={});var o,a,c=t;if("ref"in c)for(a in c={},t)a=="ref"?o=t[a]:c[a]=t[a];var l={type:e,props:c,key:r,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--Cft,__i:-1,__u:0,__source:s,__self:i};if(typeof e=="function"&&(o=e.defaultProps))for(a in o)c[a]===void 0&&(c[a]=o[a]);return Nt.vnode&&Nt.vnode(l),l}var k8=e=>{let{className:t,label:r,onClick:n}=e;return $t("div",{className:"deck-widget-button",children:$t("button",{className:`deck-widget-icon-button ${t}`,type:"button",onClick:n,title:r,children:$t("div",{className:"deck-widget-icon"})})})},U8=e=>{let{children:t,orientation:r}=e;return $t("div",{className:`deck-widget-button-group ${r}`,children:t})},kb=e=>{let{className:t,label:r,onClick:n}=e;return $t("button",{className:`deck-widget-icon-button ${t}`,type:"button",onClick:n,title:r,children:$t("div",{className:"deck-widget-icon"})})};var x_=class{constructor(t){this.id="fullscreen",this.placement="top-left",this.fullscreen=!1,this.id=t.id??this.id,this.placement=t.placement??this.placement,this.props={...t,enterLabel:t.enterLabel??"Enter Fullscreen",exitLabel:t.exitLabel??"Exit Fullscreen",style:t.style??{}}}onAdd({deck:t}){let{style:r,className:n}=this.props,s=document.createElement("div");return s.classList.add("deck-widget","deck-widget-fullscreen"),n&&s.classList.add(n),Yr(s,r),this.deck=t,this.element=s,this.update(),document.addEventListener("fullscreenchange",this.onFullscreenChange.bind(this)),s}onRemove(){this.deck=void 0,this.element=void 0,document.removeEventListener("fullscreenchange",this.onFullscreenChange.bind(this))}update(){let{enterLabel:t,exitLabel:r}=this.props,n=this.element;if(!n)return;let s=$t(k8,{onClick:this.handleClick.bind(this),label:this.fullscreen?r:t,className:this.fullscreen?"deck-widget-fullscreen-exit":"deck-widget-fullscreen-enter"});fl(s,n)}setProps(t){this.placement=t.placement??this.placement;let r=this.props,n=this.element;n&&(r.className!==t.className&&(r.className&&n.classList.remove(r.className),t.className&&n.classList.add(t.className)),tt(r.style,t.style,1)||(Zs(n,r.style),Yr(n,t.style))),Object.assign(this.props,t),this.update()}getContainer(){return this.props.container||this.deck?.getCanvas()?.parentElement}onFullscreenChange(){let t=this.fullscreen,r=document.fullscreenElement===this.getContainer();t!==r&&(this.fullscreen=!this.fullscreen),this.update()}async handleClick(){this.fullscreen?await this.exitFullscreen():await this.requestFullscreen(),this.update()}async requestFullscreen(){let t=this.getContainer();t?.requestFullscreen?await t.requestFullscreen({navigationUI:"hide"}):this.togglePseudoFullscreen()}async exitFullscreen(){document.exitFullscreen?await document.exitFullscreen():this.togglePseudoFullscreen()}togglePseudoFullscreen(){this.getContainer()?.classList.toggle("deck-pseudo-fullscreen")}};var y_=class{constructor(t){this.id="compass",this.placement="top-left",this.viewId=null,this.viewports={},this.id=t.id??this.id,this.viewId=t.viewId??this.viewId,this.placement=t.placement??this.placement,this.props={...t,transitionDuration:t.transitionDuration??200,label:t.label??"Reset Compass",style:t.style??{}}}setProps(t){this.placement=t.placement??this.placement,this.viewId=t.viewId??this.viewId;let r=this.props,n=this.element;n&&(r.className!==t.className&&(r.className&&n.classList.remove(r.className),t.className&&n.classList.add(t.className)),tt(r.style,t.style,1)||(Zs(n,r.style),Yr(n,t.style))),Object.assign(this.props,t),this.update()}onViewportChange(t){t.equals(this.viewports[t.id])||(this.viewports[t.id]=t,this.update())}onAdd({deck:t}){let{style:r,className:n}=this.props,s=document.createElement("div");return s.classList.add("deck-widget","deck-widget-compass"),n&&s.classList.add(n),Yr(s,r),this.deck=t,this.element=s,this.update(),s}getRotation(t){return t instanceof Re?[-t.bearing,t.pitch]:t instanceof Xr?[0,Math.max(-80,Math.min(80,t.latitude))]:[0,0]}update(){let t=this.viewId||Object.values(this.viewports)[0]?.id||"default-view",r=this.viewports[t],[n,s]=this.getRotation(r),i=this.element;if(!i)return;let o=$t("div",{className:"deck-widget-button",style:{perspective:100},children:$t("button",{type:"button",onClick:()=>{for(let a of Object.values(this.viewports))this.handleCompassReset(a)},title:this.props.label,style:{transform:`rotateX(${s}deg)`},children:$t("svg",{fill:"none",width:"100%",height:"100%",viewBox:"0 0 26 26",children:$t("g",{transform:`rotate(${n},13,13)`,children:[$t("path",{d:"M10 13.0001L12.9999 5L15.9997 13.0001H10Z",fill:"var(--icon-compass-north-color, #F05C44)"}),$t("path",{d:"M16.0002 12.9999L13.0004 21L10.0005 12.9999H16.0002Z",fill:"var(--icon-compass-south-color, #C2C2CC)"})]})})})});fl(o,i)}onRemove(){this.deck=void 0,this.element=void 0}handleCompassReset(t){let r=this.viewId||t.id||"default-view";if(t instanceof Re){let n={...t,bearing:0,...this.getRotation(t)[0]===0?{pitch:0}:{},transitionDuration:this.props.transitionDuration,transitionInterpolator:new rs};this.deck._onViewStateChange({viewId:r,viewState:n,interactionState:{}})}}};var A_=class{constructor(t){this.id="zoom",this.placement="top-left",this.viewId=null,this.viewports={},this.id=t.id??this.id,this.viewId=t.viewId??this.viewId,this.placement=t.placement??this.placement,this.props={...t,orientation:t.orientation??"vertical",transitionDuration:t.transitionDuration??200,zoomInLabel:t.zoomInLabel??"Zoom In",zoomOutLabel:t.zoomOutLabel??"Zoom Out",style:t.style??{}}}onAdd({deck:t}){let{style:r,className:n}=this.props,s=document.createElement("div");return s.classList.add("deck-widget","deck-widget-zoom"),n&&s.classList.add(n),Yr(s,r),this.deck=t,this.element=s,this.update(),s}onRemove(){this.deck=void 0,this.element=void 0}setProps(t){this.placement=t.placement??this.placement,this.viewId=t.viewId??this.viewId;let r=this.props,n=this.element;n&&(r.className!==t.className&&(r.className&&n.classList.remove(r.className),t.className&&n.classList.add(t.className)),tt(r.style,t.style,1)||(Zs(n,r.style),Yr(n,t.style))),Object.assign(this.props,t),this.update()}onViewportChange(t){this.viewports[t.id]=t}handleZoom(t,r){let n=this.viewId||t?.id||"default-view",s={...t,zoom:r,transitionDuration:this.props.transitionDuration,transitionInterpolator:new rs};this.deck._onViewStateChange({viewId:n,viewState:s,interactionState:{}})}handleZoomIn(){for(let t of Object.values(this.viewports))this.handleZoom(t,t.zoom+1)}handleZoomOut(){for(let t of Object.values(this.viewports))this.handleZoom(t,t.zoom-1)}update(){let t=this.element;if(!t)return;let r=$t(U8,{orientation:this.props.orientation,children:[$t(kb,{onClick:()=>this.handleZoomIn(),label:this.props.zoomInLabel,className:"deck-widget-zoom-in"}),$t(kb,{onClick:()=>this.handleZoomOut(),label:this.props.zoomOutLabel,className:"deck-widget-zoom-out"})]});fl(r,t)}};var Pft={"--button-background":"#fff","--button-stroke":"rgba(255, 255, 255, 0.3)","--button-inner-stroke":"unset","--button-shadow":"0px 0px 8px 0px rgba(0, 0, 0, 0.25)","--button-backdrop-filter":"unset","--button-icon-idle":"rgba(97, 97, 102, 1)","--button-icon-hover":"rgba(24, 24, 26, 1)","--icon-compass-north-color":"#F05C44","--icon-compass-south-color":"#C2C2CC"},Rft={"--button-background":"rgba(18, 18, 20, 1)","--button-stroke":"rgba(18, 18, 20, 0.30)","--button-inner-stroke":"unset","--button-shadow":"0px 0px 8px 0px rgba(0, 0, 0, 0.25)","--button-backdrop-filter":"unset","--button-icon-idle":"rgba(158, 157, 168, 1)","--button-icon-hover":"rgba(215, 214, 229, 1)","--icon-compass-north-color":"#F05C44","--icon-compass-south-color":"#C2C2CC"},Ift={"--button-background":"rgba(255, 255, 255, 0.6)","--button-stroke":"rgba(255, 255, 255, 0.3)","--button-inner-stroke":"1px solid rgba(255, 255, 255, 0.6)","--button-shadow":"0px 0px 8px 0px rgba(0, 0, 0, 0.25), 0px 0px 8px 0px rgba(0, 0, 0, 0.1) inset","--button-backdrop-filter":"blur(4px)","--button-icon-idle":"rgba(97, 97, 102, 1)","--button-icon-hover":"rgba(24, 24, 26, 1)","--icon-compass-north-color":"#F05C44","--icon-compass-south-color":"#C2C2CC"},Oft={"--button-background":"rgba(18, 18, 20, 0.75)","--button-stroke":"rgba(18, 18, 20, 0.30)","--button-inner-stroke":"1px solid rgba(18, 18, 20, 0.75)","--button-shadow":"0px 0px 8px 0px rgba(0, 0, 0, 0.25), 0px 0px 8px 0px rgba(0, 0, 0, 0.1) inset","--button-backdrop-filter":"blur(4px)","--button-icon-idle":"rgba(158, 157, 168, 1)","--button-icon-hover":"rgba(215, 214, 229, 1)","--icon-compass-north-color":"#F05C44","--icon-compass-south-color":"#C2C2CC"};var dd=Nn(Kf(),1);ec._checkH3Lib=()=>{let e='include the <script src="https://unpkg.com/h3-js@^4.0.0"><\/script> tag before the deck.gl script tag. https://deck.gl/docs/api-reference/geo-layers/h3-hexagon-layer';if(dd){if(dd.polyfill&&!dd.polygonToCells)throw new Error(`Incompatible h3-js version. ${e}`)}else throw new Error(`To use H3 functionality, ${e}`)};return Y8(Lft);})();
  /*! Bundled license information:
  
  long/dist/long.js:
    (**
     * @license long.js (c) 2013 Daniel Wirtz <dcode@dcode.io>
     * Released under the Apache License, Version 2.0
     * see: https://github.com/dcodeIO/long.js for details
     *)
  
  ieee754/index.js:
    (*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> *)
  
  long/index.js:
    (**
     * @license
     * Copyright 2009 The Closure Library Authors
     * Copyright 2020 Daniel Wirtz / The long.js Authors.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *     http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     *
     * SPDX-License-Identifier: Apache-2.0
     *)
  */
        return __exports__;
        });